  Fichero: /home/dragonyte/Backup/csra1/.git/objects/00/03946c5eabca436e7fc8bbc56df7cb281ad82f
  Tamaño: 71        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293838    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.239591996 -0500
Modificación: 2023-07-30 06:50:22.908333886 -0500
      Cambio: 2023-10-20 16:46:06.713329611 -0500
    Creación: 2023-10-20 16:46:06.713329611 -0500
040000 tree bcf616d3942cc000681f5c65d3cabf8bb6701ce3	css
040000 tree 2c7848b07d949fbb35e573b4d21768444f8d222f	js
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/00/0dcca5291b3482208f5e60169095097db50258
  Tamaño: 252       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293837    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.239591996 -0500
Modificación: 2023-10-16 17:33:29.742257153 -0500
      Cambio: 2023-10-20 16:46:06.713329611 -0500
    Creación: 2023-10-20 16:46:06.709996366 -0500
040000 tree a05d527cf3bbdee68cb6677fda6174823fa5d6f8	event
040000 tree 12e9e38aa524c73274e5c41f3f465df3a3835029	kri
040000 tree bf26cbec7b3a99878eea5fe64236fa8c6693da97	login
040000 tree 4f27caa9c5680f7c74a99a1cc1eb3911d428c67f	propertie
040000 tree 8494db4705a8620c9116e70e5f31fa4b042d135f	register
040000 tree 4d17a1f804549e5391f2e10983a9f8becdd63319	risk
040000 tree 2f47ccb2e200d0e41df57356190e2cc8bfd87708	type
040000 tree 51b4f483439170ce1f66b8dc07444e95bac424b7	user
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/00/12f9ae90c3e8d5ae8bfea1873c7a7de1ca77fe
  Tamaño: 249       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293836    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.236258708 -0500
Modificación: 2023-05-14 07:33:53.885373117 -0500
      Cambio: 2023-10-20 16:46:06.709996366 -0500
    Creación: 2023-10-20 16:46:06.709996366 -0500
<?php 
class KriModel extends Model{
	protected $table = "kris";
	protected $columns = ["kri","objective","propertie_id","percentage","syntax"];
	protected $args= [":kri",":objective",":propertie_id",":percentage",":syntax"];
	protected $relations= ["kris"=>"properties"];
	protected $much_to_much= ["kris"=>"events"];

	public function __construct(){
		parent::__construct();
	}

	public function insertKri(){
		$this->insert();
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/02/0047f4e081c80f66c79414054ee1bb351f7882
  Tamaño: 437       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293767    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.206259122 -0500
Modificación: 2023-05-15 15:43:32.896709075 -0500
      Cambio: 2023-10-20 16:46:06.683330401 -0500
    Creación: 2023-10-20 16:46:06.679997156 -0500
100644 blob 46141854b6c4aac2047018836b3340f5f62dd0c2	.htaccess
100644 blob da437ed708de7ea2d1ed5bb37dc51d00740740f6	Dockerfile
040000 tree 39d44e28008599bd02bb3f75303394c5c0707cd5	assets
040000 tree 0994b646c5cf6fe1259596f6e540c6055d0d4e1c	components
100644 blob 886fe19262e1dcc9bc5827b9b360744e6fe4cf58	config.php
040000 tree 8121c7787359d46d481a87aaf188f7804f5cd62c	controllers
100644 blob 8dadb53d86e692a9145d4db33bc19d31c3303116	data.sql
100644 blob 82c1b06cf8655c3159204f46dafb691aa3fe03c0	database.php
100644 blob 27dae4899dda3ef6df80d4bdc4ec9c52248ccb59	index.php
040000 tree da2d29e849e1ebec1ccf31e933891f35c47e63bb	models
100644 blob 5b9a73936584eabcb55fd9e03862f7c4e6eab1b1	router.php
100644 blob dc9cfb9c2e93b41acbe9d8bcc6932aa67031e82d	seeder.sql
040000 tree 791f9a574ee5bedc8e5af3a5b6bf1650683c4ae7	views
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/03/556fbfaac81427b6c9ff918bebe1b7e69b84e2
  Tamaño: 179       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293957    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.362923628 -0500
Modificación: 2023-05-15 15:43:32.910042407 -0500
      Cambio: 2023-10-20 16:46:06.786661012 -0500
    Creación: 2023-10-20 16:46:06.786661012 -0500
tree 020047f4e081c80f66c79414054ee1bb351f7882
parent 33452ee949b828454cae58e2d991718a76da0349
author DragonyteEvol <acuarionevol@outlook.com> 1684183412 +0000
committer DragonyteEvol <acuarionevol@outlook.com> 1684183412 +0000

docs: model docs and router docs
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/03/af754393850698c31d45a634f08c29dd9b28bf
  Tamaño: 252       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293955    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.362923628 -0500
Modificación: 2023-10-07 13:37:54.476130740 -0500
      Cambio: 2023-10-20 16:46:06.786661012 -0500
    Creación: 2023-10-20 16:46:06.786661012 -0500
040000 tree c6fcef640a78c9903fb6370e39da1c2dad660112	event
040000 tree 5872beebdeac6f4243f191582c95a25dfeeb9613	kri
040000 tree bf26cbec7b3a99878eea5fe64236fa8c6693da97	login
040000 tree 4f27caa9c5680f7c74a99a1cc1eb3911d428c67f	propertie
040000 tree 8494db4705a8620c9116e70e5f31fa4b042d135f	register
040000 tree b52e2a473825ac2719a6deeec6908576f3458f73	risk
040000 tree 2f47ccb2e200d0e41df57356190e2cc8bfd87708	type
040000 tree 51b4f483439170ce1f66b8dc07444e95bac424b7	user
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/03/d434714b9c4aeca68bd623c8ac65e1998fea2e
  Tamaño: 159       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293953    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.359590341 -0500
Modificación: 2023-03-28 17:22:06.567978311 -0500
      Cambio: 2023-10-20 16:46:06.786661012 -0500
    Creación: 2023-10-20 16:46:06.786661012 -0500
<?php
require_once("models/KriModel.php");
class KriController extends Controller{

	public function __construct(){
		parent::__construct();
		$this->model = new KriModel();
	}

}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/03/f767538382d563d4d5e221f42339855a36c5fd
  Tamaño: 758       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293956    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.362923628 -0500
Modificación: 2023-06-24 08:01:27.666460089 -0500
      Cambio: 2023-10-20 16:46:06.786661012 -0500
    Creación: 2023-10-20 16:46:06.786661012 -0500
<?php  
include_once("components/header.php");
?>
<div class="card">
	<div class="card-header">
		<div class="row">
			<div class="col-6">
				<div class="row">
					<div class="input-group mb-3">
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalCreate">
+
</button>

						<input id="search" type="text" class="form-control" placeholder="Buscar tipos" aria-label="Example text with button addon" aria-describedby="button-addon1">
					</div>
				</div>
			</div>
			<div class="col-6">
				<div class="row">
					<div class="col-6">
						<input class="form-control" name="from" type="datetime-local">
					</div>
					<div class="col-6">
						<input class="form-control d-flex" name="to" type="datetime-local">
					</div>
				</div>
			</div>
		</div>
	</div>
	<table class="table table-borderless">
		<thead>
			<tr>
				<th scope="col">#</th>
				<th scope="col">Tipo</th>
				<th scope="col">Fecha de creacion</th>
			</tr>
		</thead>
		<tbody id="types">
			<?php  foreach($data["types"] as $kri): ?>
			<tr>
				<th scope="row"><?= $kri["id_master"] ?></th>
				<td>
					<a href="/type/show/<?= $kri['id_master'] ?>">
						<?= $kri["type"] ?>
					</a>
				</td>
				<td><?= $kri["created_at"] ?></td>
			</tr>
			<?php  endforeach; ?>
		</tbody>
	</table>
</div>
<div id="modalCreate" class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
...
</div>

<script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
<script src="assets/js/search.js"></script>
<script>
searchTable({
componentEvent: "search",
	listOptions: "types",
	search: "type",
	components: [
		"created_at"
	],
	value: "type",
	table: "types",
})
</script>
</script>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/03/ff85d3fd9304ea946de68fb0ad15f65fb2b607
  Tamaño: 1010      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293954    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.362923628 -0500
Modificación: 2023-03-28 17:22:06.567978311 -0500
      Cambio: 2023-10-20 16:46:06.786661012 -0500
    Creación: 2023-10-20 16:46:06.786661012 -0500
<?php 
class Model{
	public $db;
	private $data;

	public function __construct($second_database = FALSE){
		$this->db=Connection::connect($second_database);
	}
	public function getCustom($sql){
		$state = $this->db->prepare($sql);
		if($state->execute()){
			while($row=$state->fetch(PDO::FETCH_ASSOC)){
				$this->data[]=$row;
			}
			return $this->data;
		}
	}

	/* toma todos los usuarios de la base de datos */
	/* 	retorna un lista con usuarios */
	/* puede recibir un array de nobres de tablas para generar una relacion de uno a muchos */
	public function getAll(){
		$sql = "SELECT *,$this->table.id as id_master FROM $this->table ";
		/* relacion de tablas */
		if(count($this->relations)<>0){
			foreach($this->relations as $join){
				$column = (substr($join,0,-1)) . "_id";
				$sql = $sql . "INNER JOIN $join ON $this->table.$column=$join.id ";
			}
		}
		/* ejecucion de query */
		$state = $this->db->prepare($sql);
		if($state->execute()){
			while($row=$state->fetch(PDO::FETCH_ASSOC)){
				$this->data[]=$row;
			}
			return $this->data;
		}
	}


	/* toma un usuario por id de la base de datos */
	/* 	retorna una lista con el usuario */
	public function selectById($id){
		$sql = "SELECT * FROM $this->table WHERE id=:id";
		$state = $this->db->prepare($sql);
		$state->bindParam(":id",$id);
		if($state->execute()){
			while($row=$state->fetch(PDO::FETCH_ASSOC)){
				$this->data[]=$row;
			}
			return $this->data;
		}
	}

	/* inserta un usuario en la base de datos */
	/* 	retorna el numero de id de el usuario registrado */
	public function insert(){
		$columns = implode(",",$this->columns);
		$args = implode(",",$this->args);
		$sql = "INSERT INTO $this->table($columns) values($args)";
		$state = $this->db->prepare($sql);
		$this->setParams($state);
		$state->execute();
		return $this->db->lastInsertId();
	}


	public function update(){
		$prepare_sql = "";
		for($i=0;$i < count($this->args);$i++){
			if((count($this->args)-1)==$i){
				$prepare_sql = $prepare_sql . $this->columns[$i] . "=" . $this->args[$i];
			}else{
				$prepare_sql = $prepare_sql . $this->columns[$i] . "=" . $this->args[$i] . ",";
			}
		}
		$sql = "UPDATE $this->table set $prepare_sql WHERE id=:id";
		$state = $this->db->prepare($sql);
		$this->setParams($state);
		$state->bindParam(":id",$this->id);
		$state->execute();
		return $this->db->lastInsertId();
	}

	public function delete($id){
		$sql = "DELETE FROM $this->table WHERE id=:id";
		$state = $this->db->prepare($sql);
		$state->bindParam(":id",$id);
		$state->execute();
	}

	private function setParams($state){
		for($i=0;$i < count($this->args);$i++){
			if($this->args[$i]==":password"){
				$password = password_hash($this->password,PASSWORD_BCRYPT);
				$state->bindParam($this->args[$i],$password);
			}else{
				$state->bindParam($this->args[$i],$this->{$this->columns[$i]});
			}
		}
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/04/9ba487ee94127dfec1da4843fdb9d482387562
  Tamaño: 744       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293605    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.129593511 -0500
Modificación: 2023-10-07 13:37:49.699592477 -0500
      Cambio: 2023-10-20 16:46:06.609999001 -0500
    Creación: 2023-10-20 16:46:06.606665755 -0500
<?php 
class EventModel extends Model{
	protected $table = "events";
	protected $columns = ["event","type","source_id","event_id"];
	protected $args= [":event",":type",":source_id",":event_id"];
	protected $record_table="records";
	protected $search_criteria="event";

	public function __construct(){
		parent::__construct();
	}

	public function getAll(){
		//optencion de query
		$sql = $this->getSelectQuery(TRUE);
		/* ejecucion de query */
		$this->execute($sql,$this->table);
		return $this->data;
	}

	/* busca elementos en la base de datos */
	/* 	retorna un array con los elementos encontrados */
	public function search($search){
		$sql = $this->getSelectQuery(FALSE);
		$sql=$sql . " WHERE $this->search_criteria LIKE '%$search%' ";
		//AGRUPACION POR ID DE OSIEM Y FUENTE PARA EVITAR CRUCES DE EVENTOS
		$sql = $sql . "GROUP BY $this->table.id,$this->table.event_id,$this->table.source_id";
		$this->execute($sql,$this->table);
		return $this->data;
	}

	//genera el query principal de la seleccion de eventos
	//recibe como paremetros un booleano para inyectar al query la agrupacion por evento y fuente
	//retorna un string con la query a ejecutar
	private function getSelectQuery($group){
		$sql = "SELECT *,count($this->table.event_id) as score,$this->table.id as master_id FROM $this->table ";
		//UNION A CALCULO DE PUNTAJE 
		$sql = $sql . "LEFT JOIN $this->record_table ON $this->table.event_id=$this->record_table.event_id AND $this->table.source_id=$this->record_table.source_id ";
		//AGRUPACION POR ID DE OSIEM Y FUENTE PARA EVITAR CRUCES DE EVENTOS
		if($group){
			$sql = $sql . "GROUP BY $this->table.id,$this->table.event_id,$this->table.source_id";
		}
		return $sql;
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/05/849fd380fdaae9648c991784a066c1360b099e
  Tamaño: 725       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293781    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.212925696 -0500
Modificación: 2023-10-15 17:00:48.616078609 -0500
      Cambio: 2023-10-20 16:46:06.686663647 -0500
    Creación: 2023-10-20 16:46:06.686663647 -0500
<?php 
require_once("models/QualifierModel.php");
require_once("models/EventModel.php");
class KriModel extends Model{
	protected $table = "kris";
	protected $columns = ["kri","objective","propertie_id","percentage","syntax"];
	protected $args= [":kri",":objective",":propertie_id",":percentage",":syntax"];
	protected $one_to_one= ["kris"=>"properties"];
	protected $one_to_much= ["kris"=>"qualifiers"];
	protected $much_to_much= ["kris"=>"events"];

	public function __construct(){
		parent::__construct();
		$this->event_model = new EventModel(); //AFECTA LA TABLA EVENTS
		$this->qualifier_model = new QualifierModel(); //AFECTA A LA TABLA QUALIFIERS
	}

	/* selecciona un kri de la base de datos calcula su puntaje */
	/* retorna un array de elementos con los datos del kri y su puntje */
	/* recibe un id de kri */
	public function getByIdScore($id){
		$this->selectById($id);
		/* CALCULAR PUNTAJE DE KRI */
		$syntax = $this->data["kris"][0]["syntax"];
		$this->getScore($id,$syntax);
		return $this->data;
	}

	/* calcula el puntaje ponderado y calificado de un kri */
	/* adjunta los resultados al array principal del modelo retorna el valor cualificado*/
	/* requiere como datos de entrada un id de kri y una syntax o ecuacion ejemplo 2+4 */
	public function getScore($id,$syntax){
		/* puntaje calculado por ecuacion */
		$this->data["score"] = $this->event_model->getScore($syntax);
		/* puntaje ponderado por calificadores */
		$this->data["score_qualified"]=$this->qualifier_model->getQualifierScore($id,$this->data["score"]);
		return $this->data["score_qualified"];
	}

}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/05/d7d4d8f9670e0e5b2c24fe3469c804e2f0f4b4
  Tamaño: 255       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293782    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.216258984 -0500
Modificación: 2023-05-18 14:54:53.498629289 -0500
      Cambio: 2023-10-20 16:46:06.686663647 -0500
    Creación: 2023-10-20 16:46:06.686663647 -0500
<?php 
class SourceModel extends Model{
	protected $table = "plugin";
	protected $columns = ["vendor"];
	protected $args= [":vendor"];

	public function __construct(){
		parent::__construct(TRUE);
	}

	public function getAll()
	{
		$sql = "SELECT vendor FROM $this->table GROUP BY 1";
		$data =$this->getCustom($sql);
		var_dump($data);
		return $data;
	}

}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/05/f353ec5bfd9395ea4888c312812f036f482942
  Tamaño: 2139      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293783    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.216258984 -0500
Modificación: 2023-10-14 17:45:42.235855965 -0500
      Cambio: 2023-10-20 16:46:06.686663647 -0500
    Creación: 2023-10-20 16:46:06.686663647 -0500
<?php 
class Model{
	public $db;
	public $data;
	private $process_data;

	public function __construct($second_database = FALSE){
		$this->db=Connection::connect($second_database);
	}

	/* permite ejecutar consultas sql customizadas a cada modelo */
	/* 	retorna la informacion consultada o registrada */
	public function getCustom($sql,$param=0){
		$this->execute($sql,$this->table,$param);
	}

	/* toma todos los usuarios de la base de datos */
	/* 	retorna un lista con usuarios */
	/* puede recibir un array de nobres de tablas para generar una relacion de uno a muchos */
	public function getAll(){
		/* relacion de tablas */
		$sql = "SELECT *,$this->table.id as id_master FROM $this->table ";
		if(count($this->one_to_one)<>0){
			foreach($this->one_to_one as $join){
				$column = substr($join,0,-1) . "_id";
				$sql = $sql . "INNER JOIN $join ON $this->table.$column=$join.id ";
			}
		}
		/* ejecucion de query */
		$this->execute($sql,$this->table);
		return $this->data;
	}

	/* toma un usuario por id de la base de datos */
	/* 	retorna una lista con el usuario */
	public function selectById($id){
		$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
		//RELACION 1 A 1
		if(count($this->one_to_one)<>0){
			foreach($this->one_to_one as $join){
				$column = substr($join,0,-1) . "_id";
				$sql = $sql . "INNER JOIN $join ON $this->table.$column=$join.id ";
			}
		}
		$sql = $sql . "WHERE $this->table.id=:id";
		$this->execute($sql,$this->table,$id);
		//RELACION 1 A MUCHOS
		if(count($this->one_to_much)<>0){
			$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
			foreach(array_keys($this->one_to_much) as $join){
				$relation= $this->one_to_much[$join];//QUALIFIERS;
				$column_2 = substr($join,0,-1) . "_id"; //KRI_ID;
				$sql = $sql . "INNER JOIN $relation ON $join.id=$relation.$column_2 ";
				$sql = $sql . "WHERE $this->table.id=:id";
				$this->data["sql"]=$sql;
				$this->execute($sql,$relation,$id);
				$sql = str_replace("WHERE $this->table.id=:id","",$sql);
			}
		}
		//RELACION MUCHOS A MUCHOS
		if(count($this->much_to_much)<>0){
			$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
			foreach(array_keys($this->much_to_much) as $join){
				$relation= substr($this->much_to_much[$join],0,-1);
				$table_relation = substr($join,0,-1) . "_" . $relation;
				$column_1 = $relation . "_id";
				$column_2 = substr($join,0,-1) . "_id";
				$join_table = $this->much_to_much[$join];
				$sql = $sql . "INNER JOIN $table_relation ON $join.id=$table_relation.$column_2 ";
				$sql = $sql . "INNER JOIN $join_table ON $table_relation.$column_1=$join_table.id ";
				$sql = $sql . "WHERE $this->table.id=:id";
				$this->execute($sql,$join_table,$id);
			}
		}
		return $this->data;
	}

	/* inserta un registro a la base de datos con sus respectivas relaciones */
	/* 	retorna el id del elemento registrado */
	public function insert(){
		try{
			if(!$this->db->inTransaction()){
				$this->db->beginTransaction();
			}
			$columns = implode(",",$this->columns);
			$args = implode(",",$this->args);
			$sql = "INSERT INTO $this->table($columns) values($args)";
			$state = $this->db->prepare($sql);
			$this->setParams($state);
			$state->execute();
			$id = $this->db->lastInsertId();
			if(count($this->much_to_much)>0){
				foreach(array_keys($this->much_to_much) as $join){
					$relation= substr($this->much_to_much[$join],0,-1);//event
					$table_relation = substr($join,0,-1) . "_" . $relation;//kri_event
					$column_2 = substr($join,0,-1) . "_id";//kri_id
					$column_1 = $relation . "_id";//event_id
					$sql = "INSERT INTO $table_relation($column_1,$column_2) VALUES(:$column_1,:$column_2)";
					for($i=0;$i< count($_POST[$relation]);$i++){
						$state = $this->db->prepare($sql);
						$state->bindParam(":$column_1",$_POST[$relation][$i]);
						$state->bindParam(":$column_2",$id);
						$state->execute();
					}
				}

			}
			return $id;
		}catch(PDOException $e){
			echo $e->getMessage();
			$this->db->rollBack();
		}
	}

	/* modifica un elemento en la base de datos */
	/* 	retorna el ultimo in elemento de la tabla */
	public function update(){
		try{
			if(!$this->db->inTransaction()){
				$this->db->beginTransaction();
			}
			$prepare_sql = "";
			for($i=0;$i < count($this->args);$i++){
				if((count($this->args)-1)==$i){
					$prepare_sql = $prepare_sql . $this->columns[$i] . "=" . $this->args[$i];
				}else{
					$prepare_sql = $prepare_sql . $this->columns[$i] . "=" . $this->args[$i] . ",";
				}
			}
			$sql = "UPDATE $this->table set $prepare_sql WHERE id=:id";
			$state = $this->db->prepare($sql);
			$this->setParams($state);
			$state->bindParam(":id",$this->id);
			$state->execute();
			return $this->db->lastInsertId();
		}catch(PDOException $e){
			$this->db->rollBack();
		}
	}

	/* borra un elemento de la base de datos */
	/* 	no retorna informacion */
	public function delete($id){
		try{
			if(!$this->db->inTransaction()){
				$this->db->beginTransaction();
			}
			$sql = "DELETE FROM $this->table WHERE id=:id";
			$state = $this->db->prepare($sql);
			$state->bindParam(":id",$id);
			$state->execute();
		}catch(PDOException $e){
			$this->db->rollBack();
		}
	}

	/* busca elementos en la base de datos */
	/* 	retorna un array con los elementos encontrados */
	public function search($search){
		$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
		if(count($this->one_to_one)<>0){
			foreach($this->one_to_one as $join){
				$column = substr($join,0,-1) . "_id";
				$sql = $sql . "INNER JOIN $join ON $this->table.$column=$join.id ";
			}
		}
		$column = substr($this->table,0,-1);
		$sql=$sql . " WHERE $column LIKE '%$search%'";
		$this->execute($sql,$this->table);
		return $this->data;
	}

	/* escribe los cambios en la base de datos si el dml esta en una transaccion */
	/* 	no retorna informacion pero termina la transaccion actual */
	public function saveChanges(){
		$this->db->commit();
	}

	/* establece las variables de las consultas preparadas */
	/* 	no retorna informacion pero deja la consulta preparada lista para su ejecucion */
	private function setParams($state){
		for($i=0;$i < count($this->args);$i++){
			if($this->args[$i]==":password"){
				$password = password_hash($this->password,PASSWORD_BCRYPT);
				$state->bindParam($this->args[$i],$password);
			}else{
				$state->bindParam($this->args[$i],$this->{$this->columns[$i]});
			}
		}
	}

	/* ejecuta la consulta preparada */
	/* modifica la variable data adjuntando la informacion en esta variable con llave especifica*/
	public function execute($sql,$key,$id=0){
		$state = $this->db->prepare($sql);
		if($id<>0){
			$state->bindParam(":id",$id);
		}
		if($state->execute()){
			while($row=$state->fetch(PDO::FETCH_ASSOC)){
				$this->process_data[]=$row;
			}
			$this->data[$key]=$this->process_data;
			$this->process_data=[];
		}
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/06/6edf40e2ec64bd78e8d33055d1ee59740d29fe
  Tamaño: 54        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293639    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.146259948 -0500
Modificación: 2023-04-06 11:42:35.979384314 -0500
      Cambio: 2023-10-20 16:46:06.623331983 -0500
    Creación: 2023-10-20 16:46:06.623331983 -0500
100644 blob 2c54cff438b1e58059cac3ec5a503876a4c11637	search.js
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/07/a9d2abeb523436c2863c3129e2c4f1fd26c654
  Tamaño: 223       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293940    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.332924043 -0500
Modificación: 2023-04-06 11:42:20.719384036 -0500
      Cambio: 2023-10-20 16:46:06.783327766 -0500
    Creación: 2023-10-20 16:46:06.783327766 -0500
<?php
require_once("models/TemplateModel.php");
class TemplateController extends Controller{

	public function __construct(){
		parent::__construct();
		$this->model = new TemplateModel();
	}

	public function search(){
		$search = $_GET["id"]; 
		$data = $this->model->search($search);
		echo json_encode($data);
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/09/56b0e17c0dca01d2d22e6dcfff983d8e0308cd
  Tamaño: 63        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293622    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.139593374 -0500
Modificación: 2023-03-23 13:20:22.548964652 -0500
      Cambio: 2023-10-20 16:46:06.616665492 -0500
    Creación: 2023-10-20 16:46:06.616665492 -0500
100644 blob 7911ccbc461079c54ffea2f1b7b6eea9a1cd2ade	UserController.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/09/94b646c5cf6fe1259596f6e540c6055d0d4e1c
  Tamaño: 55        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293621    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.139593374 -0500
Modificación: 2023-05-14 07:37:26.445367515 -0500
      Cambio: 2023-10-20 16:46:06.616665492 -0500
    Creación: 2023-10-20 16:46:06.616665492 -0500
100644 blob 9abf0dc8c60c71c9f78d57243f8530cea132319a	header.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/0c/ab3362e83d0c6f59de5574d70883a4bae432e2
  Tamaño: 2469      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293689    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.172926248 -0500
Modificación: 2023-10-17 15:55:29.893206763 -0500
      Cambio: 2023-10-20 16:46:06.646664701 -0500
    Creación: 2023-10-20 16:46:06.646664701 -0500
<?php 
class Model{
	public $db;
	public $data;
	private $process_data;

	public function __construct($second_database = FALSE){
		$this->db=Connection::connect($second_database);
	}

	/* permite ejecutar consultas sql customizadas a cada modelo */
	/* 	retorna la informacion consultada o registrada */
	public function getCustom($sql,$param=0){
		$this->execute($sql,$this->table,$param);
	}

	/* toma todos los usuarios de la base de datos */
	/* 	retorna un lista con usuarios */
	/* puede recibir un array de nobres de tablas para generar una relacion de uno a muchos */
	public function getAll(){
		/* relacion de tablas */
		$sql = "SELECT *,$this->table.id as id_master FROM $this->table ";
		if(count($this->one_to_one)<>0){
			foreach($this->one_to_one as $join){
				$column = substr($join,0,-1) . "_id";
				$sql = $sql . "INNER JOIN $join ON $this->table.$column=$join.id ";
			}
		}
		/* ejecucion de query */
		$this->execute($sql,$this->table);
		return $this->data;
	}

	/* toma un usuario por id de la base de datos */
	/* 	retorna una lista con el usuario */
	public function selectById($id){
		$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
		//RELACION 1 A 1
		if(count($this->one_to_one)<>0){
			foreach($this->one_to_one as $join){
				$column = substr($join,0,-1) . "_id";
				$sql = $sql . "INNER JOIN $join ON $this->table.$column=$join.id ";
			}
		}
		$sql = $sql . "WHERE $this->table.id=:id";
		$this->execute($sql,$this->table,$id);
		//RELACION 1 A MUCHOS
		if(count($this->one_to_much)<>0){
			$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
			foreach(array_keys($this->one_to_much) as $join){
				$relation= $this->one_to_much[$join];//QUALIFIERS;
				$column_2 = substr($join,0,-1) . "_id"; //KRI_ID;
				$sql = $sql . "INNER JOIN $relation ON $join.id=$relation.$column_2 ";
				$sql = $sql . "WHERE $this->table.id=:id";
				$this->data["sql"]=$sql;
				$this->execute($sql,$relation,$id);
				$sql = str_replace("WHERE $this->table.id=:id","",$sql);
			}
		}
		//RELACION MUCHOS A MUCHOS
		if(count($this->much_to_much)<>0){
			$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
			foreach(array_keys($this->much_to_much) as $join){
				$relation= substr($this->much_to_much[$join],0,-1);
				$table_relation = substr($join,0,-1) . "_" . $relation;
				$column_1 = $relation . "_id";
				$column_2 = substr($join,0,-1) . "_id";
				$join_table = $this->much_to_much[$join];
				$sql = $sql . " INNER JOIN $table_relation ON $join.id=$table_relation.$column_2 ";
				$sql = $sql . " INNER JOIN $join_table ON $table_relation.$column_1=$join_table.id ";
				$sql = $sql . "WHERE $this->table.id=:id";
				$this->execute($sql,$join_table,$id);
				$sql = str_replace("WHERE $this->table.id=:id","",$sql);
			}
		}
		return $this->data;
	}

	/* inserta un registro a la base de datos con sus respectivas relaciones */
	/* 	retorna el id del elemento registrado */
	public function insert(){
		try{
			if(!$this->db->inTransaction()){
				$this->db->beginTransaction();
			}
			$columns = implode(",",$this->columns);
			$args = implode(",",$this->args);
			$sql = "INSERT INTO $this->table($columns) values($args)";
			$state = $this->db->prepare($sql);
			$this->setParams($state);
			$state->execute();
			$id = $this->db->lastInsertId();
			if(count($this->much_to_much)>0){
				foreach(array_keys($this->much_to_much) as $join){
					$relation= substr($this->much_to_much[$join],0,-1);//event
					$table_relation = substr($join,0,-1) . "_" . $relation;//kri_event
					$column_2 = substr($join,0,-1) . "_id";//kri_id
					$column_1 = $relation . "_id";//event_id
					$sql = "INSERT INTO $table_relation($column_1,$column_2) VALUES(:$column_1,:$column_2)";
					for($i=0;$i< count($_POST[$relation]);$i++){
						$state = $this->db->prepare($sql);
						$state->bindParam(":$column_1",$_POST[$relation][$i]);
						$state->bindParam(":$column_2",$id);
						$state->execute();
					}
				}

			}
			return $id;
		}catch(PDOException $e){
			echo $e->getMessage();
			$this->db->rollBack();
		}
	}

	/* modifica un elemento en la base de datos */
	/* recibe el id del elemento a modificar */
	/* 	retorna el ultimo in elemento de la tabla */
	public function update($id){
		try{
			if(!$this->db->inTransaction()){
				$this->db->beginTransaction();
			}
			$prepare_sql = "";
			for($i=0;$i < count($this->args);$i++){
				if((count($this->args)-1)==$i){
					$prepare_sql = $prepare_sql . $this->columns[$i] . "=" . $this->args[$i];
				}else{
					$prepare_sql = $prepare_sql . $this->columns[$i] . "=" . $this->args[$i] . ",";
				}
			}
			$sql = "UPDATE $this->table set $prepare_sql WHERE id=:id";
			$state = $this->db->prepare($sql);
			$state = $this->setParams($state);
			$state->bindParam(":id",$id);
			$state->execute();
			$this->refreshDataRelations($id,$this->much_to_much);
		}catch(PDOException $e){
			var_dump($e);
			$this->db->rollBack();
		}
	}

	/* borra un elemento de la base de datos */
	/* 	no retorna informacion */
	public function delete($id){
		try{
			if(!$this->db->inTransaction()){
				$this->db->beginTransaction();
			}
			$sql = "DELETE FROM $this->table WHERE id=:id";
			$state = $this->db->prepare($sql);
			$state->bindParam(":id",$id);
			$state->execute();
		}catch(PDOException $e){
			$this->db->rollBack();
		}
	}

	/* busca elementos en la base de datos */
	/* 	retorna un array con los elementos encontrados */
	public function search($search){
		$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
		if(count($this->one_to_one)<>0){
			foreach($this->one_to_one as $join){
				$column = substr($join,0,-1) . "_id";
				$sql = $sql . "INNER JOIN $join ON $this->table.$column=$join.id ";
			}
		}
		$column = substr($this->table,0,-1);
		$sql=$sql . " WHERE $column LIKE '%$search%'";
		$this->execute($sql,$this->table);
		return $this->data;
	}

	/* escribe los cambios en la base de datos si el dml esta en una transaccion */
	/* 	no retorna informacion pero termina la transaccion actual */
	public function saveChanges(){
		$this->db->commit();
	}

	/* establece las variables de las consultas preparadas */
	/* 	no retorna informacion pero deja la consulta preparada lista para su ejecucion */
	public function setParams($state){
		for($i=0;$i < count($this->args);$i++){
			if($this->args[$i]==":password"){
				$password = password_hash($this->password,PASSWORD_BCRYPT);
				$state->bindParam($this->args[$i],$password);
			}else{
				$state->bindParam($this->args[$i],$this->{$this->columns[$i]});
			}
		}
		return $state;
	}

	/* ejecuta la consulta preparada */
	/* modifica la variable data adjuntando la informacion en esta variable con llave especifica*/
	public function execute($sql,$key,$id=0){
		$state = $this->db->prepare($sql);
		if($id<>0){
			$state->bindParam(":id",$id);
		}
		if($state->execute()){
			while($row=$state->fetch(PDO::FETCH_ASSOC)){
				$this->process_data[]=$row;
			}
			$this->data[$key]=$this->process_data;
			$this->process_data=[];
		}
	}

	//BORRA Y RECREA LAS RELACIONES MUCHOS A MUCHOS DE UNA TABLA RELACION
	//recibe un id de referencia generalemente el id de el elemento de la tabla principal, y las un diccionario de tabla relacion
	//no retorna informacion
	public function refreshDataRelations($id_reference,$relations){
		foreach(array_keys($relations) as $join){
			$relation= substr($relations[$join],0,-1);//event
			$table_relation = substr($join,0,-1) . "_" . $relation;//kri_event
			$column_2 = substr($join,0,-1) . "_id";//kri_id
			$column_1 = $relation . "_id";//event_id
			//BORRA LAS DEPENDECIAS O RELACIONES ANTERIORES
			$sql = "DELETE FROM $table_relation WHERE $column_2=:id";
			$state = $this->db->prepare($sql);
			$state->bindParam(":id",$id_reference);
			$state->execute();
			//RECREA LAS DEPENEDENCIAS O RELACIONES
			$sql = "INSERT INTO $table_relation($column_1,$column_2) VALUES(:$column_1,:$column_2)";
			for($i=0;$i< count($_POST[$relation]);$i++){
				$state = $this->db->prepare($sql);
				$state->bindParam(":$column_1",$_POST[$relation][$i]);
				$state->bindParam(":$column_2",$id_reference);
				$state->execute();
			}
		}

	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/0d/92498866d4f8052aa2042686156a488dbc030e
  Tamaño: 45        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293547    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.102927213 -0500
Modificación: 2023-03-01 15:26:02.459476539 -0500
      Cambio: 2023-10-20 16:46:06.583333037 -0500
    Creación: 2023-10-20 16:46:06.583333037 -0500
040000 tree bcf616d3942cc000681f5c65d3cabf8bb6701ce3	css
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/0f/35fb8414fdd10a605776566afb2f822b56754b
  Tamaño: 190       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293701    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.176259535 -0500
Modificación: 2023-04-06 11:42:36.059384316 -0500
      Cambio: 2023-10-20 16:46:06.649997947 -0500
    Creación: 2023-10-20 16:46:06.649997947 -0500
040000 tree 4cb5dcd58c33e1976ff95689059a5f38b4a0dd68	event
040000 tree 4a50142398d9b17b7464afff51695fbefea76c13	kri
040000 tree bf26cbec7b3a99878eea5fe64236fa8c6693da97	login
040000 tree 8494db4705a8620c9116e70e5f31fa4b042d135f	register
040000 tree 3f996d487c0a5063b1b018a35ccab9e527738db6	risk
040000 tree 51b4f483439170ce1f66b8dc07444e95bac424b7	user
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/0f/5442a076633333fb6ee66e06bf9af94fd24f7c
  Tamaño: 731       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293703    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.179592822 -0500
Modificación: 2023-03-28 17:22:06.617978310 -0500
      Cambio: 2023-10-20 16:46:06.649997947 -0500
    Creación: 2023-10-20 16:46:06.649997947 -0500
<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<link rel="stylesheet" href="assets/css/styles.css">
	<title>Registrarse - Csra</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
</head>
<body>
	<div class="container text-center">
		<div class="row justify-content-center">
			<div class="col-sm-10 col-md-8 col-lg-4">
				<h1>Registrarse</h1>
				<span>o <a href="/login">Iniciar sesion</a></span>
				<!-- formulario para creacion de usuarios -->
				<form action="/register/register" method="POST">
					<input type="text" class="form-control my-2" placeholder="Ingresa tu nombre" name="name">
					<input type="text" class="form-control my-2" placeholder="Ingresa tu email" name="email">
					<input type="password" class="form-control my-2" placeholder="Ingresa tu contraseña" name="password">
					<input type="password" class="form-control my-2" placeholder="Confirma tu contraseña" name="confirm_password">
					<input class="form-control my-2 btn btn-primary" type="submit" value="Enviar">
				</form>
			</div>
		</div>
	</div>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
</body>
</html>




---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/0f/ff838871cb857cf76c1f8e3ce22d160d054f1d
  Tamaño: 358       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293702    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.176259535 -0500
Modificación: 2023-10-17 16:44:12.981025200 -0500
      Cambio: 2023-10-20 16:46:06.649997947 -0500
    Creación: 2023-10-20 16:46:06.649997947 -0500
100644 blob 6ec0742d4cbf2bc6d52e80e97f0954b9ba429d27	EventModel.php
100644 blob fcee99b97e460cc55341d071a423b702cb3fee91	KriModel.php
100644 blob b86d6040e2ff33646684be75e19a09975f41468b	Model.php
100644 blob cf27b3beec50366ce112f05e7a070bf6cf045070	PropertieModel.php
100644 blob f1562673fb0c495c4bdf7a70a6c59f834216445c	QualifierModel.php
100644 blob 3f36dc91c903e4be4239b127f4d48a9f11011911	RecordModel.php
100644 blob 730a24116f0181eadde3a5c5ca6e2d03d57ba8f7	RiskModel.php
100644 blob 05d7d4d8f9670e0e5b2c24fe3469c804e2f0f4b4	SourceModel.php
100644 blob 94c0b90d03c95b7e9484842795b32a9d4a3eacb3	TemplateModel.php
100644 blob 95085117329d973fd6c36029b44293bcedd69742	TypeModel.php
100644 blob 98bcd9d15ece27bab02c81584e6e0b10ed3cfd21	UserModel.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/11/1a60c27b7d7b9858e2520b499e3002750cbf57
  Tamaño: 783       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293926    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.326257467 -0500
Modificación: 2023-03-01 15:25:39.046143824 -0500
      Cambio: 2023-10-20 16:46:06.769994784 -0500
    Creación: 2023-10-20 16:46:06.769994784 -0500
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<link rel="stylesheet" href="assets/css/styles.css">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
	<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100&display=swap" rel="stylesheet">
	<title>Registrarse - Csra</title>
</head>
<body>
<div class="container text-center">
<div class="row justify-content-center">
<div class="col-10">
	<?php require("components/header.php") ?>
	<h1>Registrarse</h1>
	<span>o <a href="login.php">Inicia sesion</a></span>
	<form action="" method="POST">
		<input type="text" class="form-control my-2" placeholder="Ingresa tu nombre" name="name">
		<input type="text" class="form-control my-2" placeholder="Ingresa tu email" name="email">
		<input type="password" class="form-control my-2" placeholder="Ingresa tu contraseña" name="password">
		<input type="password" class="form-control my-2" placeholder="Confirma tu contraseña" name="confirm_password">
		<input class="form-control my-2 btn btn-primary" type="submit" value="Enviar">
	</form>
</div>
</div>

</div>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
</body>
</html>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/12/161e6b1e0c15ee72b6b3faad08a3c52505e53d
  Tamaño: 227       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293693    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.172926248 -0500
Modificación: 2023-10-07 13:48:31.031686929 -0500
      Cambio: 2023-10-20 16:46:06.646664701 -0500
    Creación: 2023-10-20 16:46:06.646664701 -0500
tree f74ed6ddae77f565f22c5304e67fa1a552396f47
parent cf8370dc257425bfd170576deb5a3328613bf915
author DragonyteEvol <acuarionevol@outlook.com> 1696703874 -0500
committer DragonyteEvol <acuarionevol@outlook.com> 1696703874 -0500

fix: Fixed id from events on search to charge
-Change view event and variable name to all dependecies
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/12/620ce4178e3b649067d4a02a366ef83bb8d47e
  Tamaño: 297       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293691    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.172926248 -0500
Modificación: 2023-03-28 17:22:06.567978311 -0500
      Cambio: 2023-10-20 16:46:06.646664701 -0500
    Creación: 2023-10-20 16:46:06.646664701 -0500
<?php
require_once("models/UserModel.php");
class RegisterController extends Controller{

	public function __construct(){
		$this->model = new UserModel();
	}

	/* muestra el formulario de registro de usuarios */
	/* retorna una vista */
	public function index()
	{
		require_once("views/register/index.php");
	}

	/* registra al usuario a traves del formulario y redirecciona a la pagina de login */
	public function register()
	{
		$this->create();
		header("Location: /login");
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/12/e9e38aa524c73274e5c41f3f465df3a3835029
  Tamaño: 115       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293692    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.172926248 -0500
Modificación: 2023-10-15 17:00:51.892659980 -0500
      Cambio: 2023-10-20 16:46:06.646664701 -0500
    Creación: 2023-10-20 16:46:06.646664701 -0500
100644 blob b87f3bc3e2670a781ac9265c829fccc2617c9ac8	create.php
100644 blob cf08f28d8f82235f4e9a7f4bff674b0fd4cc38cb	index.php
100644 blob f786f5bcd89fc671e9d9267d1fe463d37b53020d	show.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/15/97f2dc1f4c9ab76dff55722a3b37bd24fe643c
  Tamaño: 1654      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293863    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.249591858 -0500
Modificación: 2023-10-07 12:37:09.244269770 -0500
      Cambio: 2023-10-20 16:46:06.719996103 -0500
    Creación: 2023-10-20 16:46:06.719996103 -0500
 // crea los eventos necesarios para una busqueda y sus consecuencias
// recibe como parametro de entra un json con la configuracion de la busqueda

// componenetEvent = El componente que recibira los eventos de cambio y keyup
// listOptions = la lista de opciones que se modificara cuando el servidor arroge respuesta
// searh = el nombre del modelo sin "controller" sobre el cual se realizara la busqueda
// componnets = el arreglo de componenetes que se quiere modificar cuando el evento arroje respuesta
// value = el valor que se quiere representar en la opcion de listOptions
	// EJEMPLO
// ({
// componentEvent: "template",
// 	listOptions: "datalistOptions",
// 	search: "template",
// 	components: new Map([
// 		["source_id","plugin_id"],
// 		["source","vendor"],
// 		["event_id","sid"]
// 	]),
// 	value: "name",
// 	table: "plugin_sid"
// })
function searchEvent(args){
	// Tomar los elementos pricipales de la busqueda
	var componentEvent = document.getElementById(args.componentEvent)
	var options = document.getElementById(args.listOptions)
	if(componentEvent==null){
		axios_get(args,options)
	}else{
		// evento de keyup y axios
		componentEvent.addEventListener('keyup',(e) =>{
			search = componentEvent.value;
			axios_get(args,options,search)
		})
		//evento de cambio
		componentEvent.addEventListener("change", (e)=>{
			for(var option of options.childNodes){
				if(option.value==componentEvent.value){
					for(c of args.components.keys()){
						var com = document.getElementById(c)
						com.value = option.attributes[c].value
					}
				}
			}

		})
	}
}

function axios_get(args,options,search=""){
	axios({
		method: "GET",
		url: "/"+args.search+"/search/" + (search.replace(" ","_"))
	}).then(res =>{
		options.innerHTML = ""
		select_options = ""
		for(var p of res.data[args.table]){
			select_options += "<"+args.tag+" "
			for(var pa of args.components){
				var val = pa[1]
				select_options += pa[0] + "='"+p[val]+"' "
			}
			var internalValue = args.value
			select_options += "value='"+p[internalValue]+"' class='"+args.class+"' onclick='"+args.customFunction+"({"
			for(var pa of args.components){
				var val = pa[1]
				select_options += pa[0] + ": "+ '"'+p[val]+'",'
			}
			select_options += "})'>"+p[internalValue]+"</"+args.tag+">"
			console.log(select_options)
		}
		options.innerHTML = select_options
	}).catch(e => {
		console.log("DEBUG:" + e)
	})
}

//-------------------------------------------------------------------------------
//Busca de forma asincrona en una tabla de base de datos para representarl la informacion consultada en una tabla
//resibe como entrada un argumento de tipo json de la siguiente forma:
//
/*{
componentevent: "search",
	listoptions: "kris",
	search: "kri",
	components: [
		"objective",
		"propertie",
		"percentage"
	],
	value: "kri",
	table: "kris",
}*/
//donde componentEvent es el cuadro de texto sobre el cual se realiza la busqueda
//listOptions es el cuerpo del elemento sobre el cual se van a mostrar los datos
//componenets es un array lista o elemeto iterable que contiene todos los datos a representar en la fila de informacion
//value es el campo principal del registro que generalmente es el nombre y que tiene un link asociado a el
//tabla es la tabla en base de datos sobre la cual se realizara la consulta
function searchTable(args){
	// Tomar los elementos pricipales de la busqueda
	var componentEvent = document.getElementById(args.componentEvent)
	var options = document.getElementById(args.listOptions)
	// evento de keyup y axios
	componentEvent.addEventListener('keyup',(e) =>{
		search = componentEvent.value;
		axios({
			method: "GET",
			url: "/"+args.search+"/search/" + (search.replace(" ","_"))
		}).then(res =>{
			console.log(res)
			var html = ""
			for(var p of res.data[args.table]){
				html+="<tr><th scope='row'>"+p.id_master+"</th>"
				html+="<td><a href='/"+args.value+"/show/"+p.id_master+"'>"+p[args.value]+"</a></td>"
				for(o of args.components){
					if(o=="score"){
						html+="<td><span class='badge text-bg-primary'>"+p[o]+"</span></td>"
					}else{
						html+="<td>"+p[o]+"</td>"
					}
				}
				html+="</tr>"
				options.innerHTML=html
			}
		}).catch(e => {
			console.log("DEBUG:" + e)
		})
	})
}
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/17/3252b1c219932d5e672e4ff7b0c71c7b6b1c3e
  Tamaño: 84        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293764    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.206259122 -0500
Modificación: 2023-05-14 07:37:26.522034178 -0500
      Cambio: 2023-10-20 16:46:06.679997156 -0500
    Creación: 2023-10-20 16:46:06.679997156 -0500
100644 blob 97b1828d19670ca13dd69f3270dd0eac7ec6fe5b	create.php
100644 blob 72ad5b308420b3ad889e1e6f205d834a1313f45e	index.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/17/f4d865577dbfb276e0d08703c097a5f49064cc
  Tamaño: 299       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293765    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.206259122 -0500
Modificación: 2023-10-17 16:45:28.452478861 -0500
      Cambio: 2023-10-20 16:46:06.679997156 -0500
    Creación: 2023-10-20 16:46:06.679997156 -0500
tree c553744c52992965b6281e0645c8e3867ca7c4cb
parent be4d0deedfe7815f0b89e97f2a3d557991469cfb
author DragonyteEvol <acuarionevol@outlook.com> 1697579053 -0500
committer DragonyteEvol <acuarionevol@outlook.com> 1697579053 -0500

feat: Update risk with dependencies
- View formated to send headers and data to update risk
- Updated kris related to risks
- Fixed create risk because de type dropdown dont have value
- Axios load properties and types on create and update view
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/19/b02a0196c7f2006ced697a2c220cd35c80791d
  Tamaño: 787       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293699    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.176259535 -0500
Modificación: 2023-10-14 17:45:41.852533592 -0500
      Cambio: 2023-10-20 16:46:06.649997947 -0500
    Creación: 2023-10-20 16:46:06.649997947 -0500
<head>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
<nav class="navbar navbar-expand-lg bg-body-tertiary">
  <div class="container-fluid">
	<a class="navbar-brand" href="#"></a>
	<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
	  <span class="navbar-toggler-icon"></span>
	</button>
	<div class="collapse navbar-collapse" id="navbarNavDropdown">
	  <ul class="navbar-nav">
		<li class="nav-item">
		  <a class="nav-link" aria-current="page" href="/risk">Inicio</a>
		</li>
		<li class="nav-item">
		  <a class="nav-link" href="/risk">Riesgos</a>
		</li>
		<li class="nav-item">
		  <a class="nav-link" href="/kri">KRI's</a>
		</li>
		<li class="nav-item">
		  <a class="nav-link" href="/event">Eventos</a>
		</li>
		<li class="nav-item dropdown">
		  <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">Mas</a>
		  <ul class="dropdown-menu">
			<li><a class="dropdown-item" href="/user">Usuarios</a></li>
			<li><a class="dropdown-item" href="/source">Fuentes</a></li>
			<li><a class="dropdown-item" href="/propertie">Propiedades</a></li>
			<li><a class="dropdown-item" href="/type">Tipos</a></li>
			<li><a class="dropdown-item" href="/configuration">Configuracion</a></li>
		  </ul>
		</li>
	  </ul>
	</div>
  </div>
</nav>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
 <script src="https://unpkg.com/boxicons@2.1.4/dist/boxicons.js"></script>
</head>


---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/1a/2d0a5475f349943b7edba21a42333b1f1fc73d
  Tamaño: 1358      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293509    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.086260776 -0500
Modificación: 2023-05-14 07:33:53.912039782 -0500
      Cambio: 2023-10-20 16:46:06.566666810 -0500
    Creación: 2023-10-20 16:46:06.566666810 -0500
<?php  
include_once("components/header.php");
?>

<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalCreate">
X
</button>

<table class="table table-borderless">
  <thead>
    <tr>
      <th scope="col">#</th>
      <th scope="col">Evento</th>
      <th scope="col">Tipo</th>
    </tr>
  </thead>
  <tbody>
	  <?php  foreach($data["events"] as $risk): ?>
	  <tr>
		  <th scope="row"><?= $risk["id_master"] ?></th>
		  <td>
			  <a class="link-dark" href="/event/show/<?= $risk['id_master'] ?>">
			  <?= $risk["event"] ?>
			  </a>
		  </td>
		  <td><?= $risk["propertie"] ?></td>
		  <td><?= $risk["type"] ?></td>
	  </tr>
	  <?php  endforeach; ?>
  </tbody>
</table>
<!-- ///////////////// -->
 <!-- Formulario modal para creacion de eventos --> 
<div id="modalCreate" class="modal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Crear evento</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
	  <div class="modal-body">
		  <!-- formulario de inicio de sesion -->
		  <form action="/event/insert" method="POST" class="needs-validation">
			<!-- TEMPLATE -->
			  <div class="form-floating mb-3">
				  <input type="text" class="form-control" list="datalistOptions" id="template" placeholder="Type to search...">
				  <datalist id="datalistOptions">
				  </datalist>
				  <label for="floatingInput">Selecciona y busca una platilla</label>
			  </div>

			  <!-- NOMBRE -->
			  <div class="form-floating mb-3">
				  <input type="text" required class="form-control" name="event" id="floatingInput" placeholder="Insegra un nombre">
				  <label for="floatingInput">Ingresa un nombre</label>
			  </div>
			  <!-- TIPO DE EVENTO -->
			  <div class="form-floating mb-3">
				  <select name="type" class="form-select" id="floatingSelect" aria-label="Floating label select example">
					  <option selected value="automatic">Automatico</option>
					  <option value="manual">Manual</option>
				  </select>
				  <label for="floatingSelect">Tipo de evento</label>
			  </div>
			  <!-- ID DE LA FUENTE -->
			  <div class="form-floating mb-3">
				  <input type="text" name="source_id" class="form-control disabled" id="source_id">
				  <label for="floatingInput">ID de la fuente</label>
			  </div>
			  <!-- IDE DEL EVENTO -->
			  <div class="form-floating mb-3">
				  <input name="event_id" type="text" class="form-control disabled" id="event_id">
				  <label for="floatingInput">ID del evento</label>
			  </div>
			  <!-- FUENTE -->
			  <div class="form-floating mb-3">
				  <input type="text" disabled class="form-control" id="source">
				  <label for="floatingInput">Fuente</label>
			  </div>
			  <div class="modal-footer">
				  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
				  <button type="submit" class="btn btn-primary">Enviar</button>
			  </div>
		  </form>
	  </div>
	</div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
<script src="assets/js/search.js"></script>
<script>
/* searchEvent({ */
/* componentEvent: "template", */
/* 	listOptions: "datalistOptions", */
/* 	search: "template", */
/* 	components: new Map([ */
/* 		["source_id","plugin_id"], */
/* 		["source","vendor"], */
/* 		["event_id","sid"] */
/* 	]), */
/* 	value: "name" */
/* }) */
searchEvent({
componentEvent: "template",
	listOptions: "datalistOptions",
	search: "template",
	components: new Map([
		["source_id","plugin_id"],
		["source","vendor"],
		["event_id","sid"]
	]),
	value: "name",
	table: "plugin_sid",
	tag: "option"
})
</script>
</script>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/1a/3e6de70fbc9cace200d68e22b4fcd3b277ae75
  Tamaño: 358       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293510    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.086260776 -0500
Modificación: 2023-05-19 15:57:49.889476342 -0500
      Cambio: 2023-10-20 16:46:06.566666810 -0500
    Creación: 2023-10-20 16:46:06.566666810 -0500
100644 blob 34dcbd5666a9705354669066f464e69bdd63f1f5	EventModel.php
100644 blob 75ecfefcec79175ffb210f3fcbbe5c8b2e773879	KriModel.php
100644 blob 5d6389fde30c3d682f559aaa5916f900c3e7adaf	Model.php
100644 blob cf27b3beec50366ce112f05e7a070bf6cf045070	PropertieModel.php
100644 blob 2b7e2e2a08d9bfe6fc287d1eadf68a3ae2bef753	QualifierModel.php
100644 blob 3f36dc91c903e4be4239b127f4d48a9f11011911	RecordModel.php
100644 blob 730a24116f0181eadde3a5c5ca6e2d03d57ba8f7	RiskModel.php
100644 blob 05d7d4d8f9670e0e5b2c24fe3469c804e2f0f4b4	SourceModel.php
100644 blob 94c0b90d03c95b7e9484842795b32a9d4a3eacb3	TemplateModel.php
100644 blob 95085117329d973fd6c36029b44293bcedd69742	TypeModel.php
100644 blob 98bcd9d15ece27bab02c81584e6e0b10ed3cfd21	UserModel.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/1b/b8bfb26dcbad31d92f0d06e45d2ca9e2950579
  Tamaño: 333       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293924    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.326257467 -0500
Modificación: 2023-05-14 07:37:26.475367514 -0500
      Cambio: 2023-10-20 16:46:06.769994784 -0500
    Creación: 2023-10-20 16:46:06.769994784 -0500
100644 blob 916405f23887474176f88d1c45f7fa7fdbcdd9e2	Controller.php
100644 blob 3879d1d4659eb6b9c63dd2d83bbc6ffe124a9a0b	EventController.php
100644 blob 26b0fa7d9a575d91a0321146d0533890494024af	KriController.php
100644 blob ab88d0b50b2f02ca6a63488e849280128184eafb	LoginController.php
100644 blob 56b41c3c0b81d3e213654e2b64a9e8e43e0c8b30	PropertieController.php
100644 blob 12620ce4178e3b649067d4a02a366ef83bb8d47e	RegisterController.php
100644 blob 5fa1c0a8e82b84d03e204b24bdde9483e720aba0	RiskController.php
100644 blob 8c1bb57955e07f847b2b8e617e4db6218f8ced28	SourceController.php
100644 blob 07a9d2abeb523436c2863c3129e2c4f1fd26c654	TemplateController.php
100644 blob fb02603f5e1e778c1b626de544c3f0834532d3e1	UserController.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/1d/1dde553e77e1ba21a74dbf3347ccc2ff350e71
  Tamaño: 180       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293616    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.136260087 -0500
Modificación: 2023-09-04 05:42:00.996685521 -0500
      Cambio: 2023-10-20 16:46:06.616665492 -0500
    Creación: 2023-10-20 16:46:06.616665492 -0500
tree 6ca66bf5ccfd8ea4b7f12dac3a50c97ec6b567de
parent a3785474108091d2559af2c5269385d497e69172
author DragonyteEvol <acuarionevol@outlook.com> 1693824120 +0000
committer DragonyteEvol <acuarionevol@outlook.com> 1693824120 +0000

refactor: mysql dump seeder
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/1d/46055131350fa0ce58e3fe2f796772ad5d5acc
  Tamaño: 1625      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293617    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.136260087 -0500
Modificación: 2023-10-07 13:37:49.789590057 -0500
      Cambio: 2023-10-20 16:46:06.616665492 -0500
    Creación: 2023-10-20 16:46:06.616665492 -0500
<?php  
include_once("components/header.php");
?>
<div class="card">
	<div class="card-header">
		<div class="row">
			<div class="col-6">
				<div class="row">
					<div class="input-group mb-3">
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalCreate">
	+
</button>
						<input id="searchEvent" type="text" class="form-control" placeholder="Buscar evento" aria-label="Example text with button addon" aria-describedby="button-addon1">
					</div>
				</div>
			</div>
			<div class="col-6">
				<div class="row">
					<div class="col-6">
						<input class="form-control" name="from" type="datetime-local">
					</div>
					<div class="col-6">
						<input class="form-control d-flex" name="to" type="datetime-local">
					</div>
				</div>
			</div>
		</div>
	</div>

	<table class="table table-borderless">
		<thead>
			<tr>
				<th scope="col">#</th>
				<th scope="col">Evento</th>
				<th scope="col">Tipo</th>
				<th scope="col">Puntaje</th>
			</tr>
		</thead>
		<tbody id="events">
			<?php  foreach($data["events"] as $risk): ?>
			<tr>
				<th scope="row"><?= $risk["master_id"] ?></th>
				<td>
					<a class="link-dark" href="/event/show/<?= $risk['master_id'] ?>">
						<?= $risk["event"] ?>
					</a>
				</td>
				<td><?= $risk["type"] ?></td>
				<td>
					<span class="badge text-bg-primary">
						<?= $risk["score"] ?>
					</span>
				</td>
			</tr>
			<?php  endforeach; ?>
		</tbody>
	</table>
</div>
<!-- ///////////////// -->
<!-- Formulario modal para creacion de eventos --> 
<div id="modalCreate" class="modal" tabindex="-1">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Crear evento</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<!-- formulario de inicio de sesion -->
				<form action="/event/insert" method="POST" class="needs-validation">
					<!-- TEMPLATE -->
					<div class="form-floating mb-3">
						<input type="text" class="form-control" list="datalistOptions" id="template" placeholder="Type to search...">
						<datalist id="datalistOptions">
						</datalist>
						<label for="floatingInput">Selecciona y busca una platilla</label>
					</div>

					<!-- NOMBRE -->
					<div class="form-floating mb-3">
						<input type="text" required class="form-control" name="event" id="floatingInput" placeholder="Insegra un nombre">
						<label for="floatingInput">Ingresa un nombre</label>
					</div>
					<!-- TIPO DE EVENTO -->
					<div class="form-floating mb-3">
						<select name="type" class="form-select" id="floatingSelect" aria-label="Floating label select example">
							<option selected value="automatic">Automatico</option>
							<option value="manual">Manual</option>
						</select>
						<label for="floatingSelect">Tipo de evento</label>
					</div>
					<!-- ID DE LA FUENTE -->
					<div class="form-floating mb-3">
						<input type="text" name="source_id" class="form-control disabled" id="source_id">
						<label for="floatingInput">ID de la fuente</label>
					</div>
					<!-- IDE DEL EVENTO -->
					<div class="form-floating mb-3">
						<input name="event_id" type="text" class="form-control disabled" id="event_id">
						<label for="floatingInput">ID del evento</label>
					</div>
					<!-- FUENTE -->
					<div class="form-floating mb-3">
						<input type="text" disabled class="form-control" id="source">
						<label for="floatingInput">Fuente</label>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
						<button type="submit" class="btn btn-primary">Enviar</button>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
<script src="assets/js/search.js"></script>
<script>
	/* searchEvent({ */
	/* componentEvent: "template", */
	/* 	listOptions: "datalistOptions", */
	/* 	search: "template", */
	/* 	components: new Map([ */
	/* 		["source_id","plugin_id"], */
	/* 		["source","vendor"], */
	/* 		["event_id","sid"] */
	/* 	]), */
	/* 	value: "name" */
	/* }) */
	searchEvent({
		componentEvent: "template",
		listOptions: "datalistOptions",
		search: "template",
		components: new Map([
			["source_id","plugin_id"],
			["source","vendor"],
			["event_id","sid"]
		]),
		value: "name",
		table: "plugin_sid",
		tag: "option"
	})
	searchTable({
		componentEvent: "searchEvent",
		listOptions: "events",
		search: "event",
		components: [
			"type",
			"score"
		],
		value: "event",
		table: "events",
	})
</script>
</script>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/1f/ddccbb92168445aecf32c6c1f26b7bcafd0b18
  Tamaño: 188       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293586    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.122926937 -0500
Modificación: 2023-05-14 08:14:53.175308346 -0500
      Cambio: 2023-10-20 16:46:06.603332510 -0500
    Creación: 2023-10-20 16:46:06.599999264 -0500
tree 3614f12e907d47d42bb32f1e6d3c594f12a65b20
parent f1e45e6403b94eee9c4566b08b8733949eb4658d
author DragonyteEvol <acuarionevol@outlook.com> 1684070093 +0000
committer DragonyteEvol <acuarionevol@outlook.com> 1684070093 +0000

style: search input and date selectors kri
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/20/5573f9bfd3e887896441a4cc6cfa3e448b913b
  Tamaño: 228       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293951    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.359590341 -0500
Modificación: 2023-10-14 17:46:43.924092219 -0500
      Cambio: 2023-10-20 16:46:06.786661012 -0500
    Creación: 2023-10-20 16:46:06.783327766 -0500
tree 538a7c847966fd929cc6e4e99f6df2acb042e3eb
parent ae5a124334db6294ffbfd0851e3036f54250a9b4
author DragonyteEvol <acuarionevol@outlook.com> 1697323550 -0500
committer DragonyteEvol <acuarionevol@outlook.com> 1697323550 -0500

feat: Calculate kri result
-View to show calculate score
-Model modified to calculate score an relationed to a qualifier
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/22/d0529b836f7a825229a1712d4887fa03362824
  Tamaño: 251       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293712    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.182926109 -0500
Modificación: 2023-06-24 08:01:49.933126171 -0500
      Cambio: 2023-10-20 16:46:06.653331192 -0500
    Creación: 2023-10-20 16:46:06.653331192 -0500
040000 tree cc5b145a856deed5758e9b07bc1f1774370e2d4e	event
040000 tree 40cf13e2e9105df27d498d6be62b4c67bbabfdd1	kri
040000 tree bf26cbec7b3a99878eea5fe64236fa8c6693da97	login
040000 tree 4f27caa9c5680f7c74a99a1cc1eb3911d428c67f	propertie
040000 tree 8494db4705a8620c9116e70e5f31fa4b042d135f	register
040000 tree b52e2a473825ac2719a6deeec6908576f3458f73	risk
040000 tree 2f47ccb2e200d0e41df57356190e2cc8bfd87708	type
040000 tree 51b4f483439170ce1f66b8dc07444e95bac424b7	user
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/23/aceaabb11dba079e2e4032b13463e21062eed3
  Tamaño: 844       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293988    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.392923215 -0500
Modificación: 2023-10-07 12:37:09.327600825 -0500
      Cambio: 2023-10-20 16:46:06.806660484 -0500
    Creación: 2023-10-20 16:46:06.806660484 -0500
<?php  
include_once("components/header.php");
?>
<!-- FORMULARIO DE CREACION DE eventS -->
<div class="container">
	<form action="//update" method="POST" class="needs-validation">
		<div class="card my-5">
			<?php  foreach($data["events"] as $event): ?>
			<div class="card-header">
				<h5><b><?=$event['master_id']?> | </b><?=$event['event']?></h5>
			</div>
			<div class="card-body">
				<!-- EVENTO -->
				<div class="form-floating mb-3">
					<input type="text" value="<?= $event['event'] ?>" required class="form-control" name="event" id="floatingInput" placeholder="Insegra un nombre">
					<label for="floatingInput">Nombre del evento</label>
				</div>
				<div class="row">
					<div class="col-4">
						<!-- TIPO -->
						<div class="form-floating mb-3">
							<select name="propertie_id" class="form-select" id="datalistOptions" aria-label="">
								<option value="<?= $event['type_id'] ?>" selected><?= $event['type']?></option>
								<option value="1">automatic</option>
								<option value="2">manual</option>
							</select>
							<label for="floatingSelect">Tipo de evento</label>
						</div>
					</div>
					<div class="col-4">
						<!-- FUENTE ID OSIEM -->
						<div class="form-floating mb-3">
							<input name="percentage" type="number" value="<?= $event['source_id'] ?>" class="form-control">
							<label for="floatingInput">Fuente OSIEM</label>
						</div>
					</div>
					<div class="col-4">
						<!-- EVENT ID-->
						<div class="form-floating mb-3">
							<input name="percentage" type="number" value="<?= $event['event_id'] ?>" class="form-control">
							<label for="floatingInput">Evento OSIEM</label>
						</div>
					</div>
				</div>
				<?php  endforeach; ?>
			</div>
			<div class="card-footer">
				<!-- END FIELD -->
				<div class="row">
					<div class="col-4">
						<button type="reset" class="btn btn-outline-secondary form-control">Limpiar</button>
					</div>
					<div class="col-4">
						<button type="submit" class="btn btn-primary form-control">Actualizar</button>
					</div>
				</div>
			</div>
		</div>
	</form>
</div>
<script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/23/f8bdff58d74ec621f202e8ac5effcdfa20803e
  Tamaño: 437       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293989    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.396256502 -0500
Modificación: 2023-09-03 08:50:32.130363576 -0500
      Cambio: 2023-10-20 16:46:06.806660484 -0500
    Creación: 2023-10-20 16:46:06.806660484 -0500
100644 blob 46141854b6c4aac2047018836b3340f5f62dd0c2	.htaccess
100644 blob da437ed708de7ea2d1ed5bb37dc51d00740740f6	Dockerfile
040000 tree 0003946c5eabca436e7fc8bbc56df7cb281ad82f	assets
040000 tree 0994b646c5cf6fe1259596f6e540c6055d0d4e1c	components
100644 blob 886fe19262e1dcc9bc5827b9b360744e6fe4cf58	config.php
040000 tree 3329768bb423a41c591994dd10004b955cd995aa	controllers
100644 blob 8dadb53d86e692a9145d4db33bc19d31c3303116	data.sql
100644 blob 82c1b06cf8655c3159204f46dafb691aa3fe03c0	database.php
100644 blob 27dae4899dda3ef6df80d4bdc4ec9c52248ccb59	index.php
040000 tree 7046280d0cc412fea068f988e20ecff02660c27a	models
100644 blob d9a4ec66dfeb45d52c58647f352aaaae6b84cd28	router.php
100644 blob dc9cfb9c2e93b41acbe9d8bcc6932aa67031e82d	seeder.sql
040000 tree f0884e35b716d60b93b38a60c1e8868a6f6f9cea	views
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/24/6b016aa69ab4b6deddf8ad403b11770307d811
  Tamaño: 2144      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293677    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.162926385 -0500
Modificación: 2023-10-08 19:55:08.183944596 -0500
      Cambio: 2023-10-20 16:46:06.639998210 -0500
    Creación: 2023-10-20 16:46:06.639998210 -0500
<?php 
class Model{
	public $db;
	public $data;
	private $process_data;

	public function __construct($second_database = FALSE){
		$this->db=Connection::connect($second_database);
	}

	/* permite ejecutar consultas sql customizadas a cada modelo */
	/* 	retorna la informacion consultada o registrada */
	public function getCustom($sql,$param=0){
		$this->execute($sql,$this->table,$param);
		return $this->data;
	}

	/* toma todos los usuarios de la base de datos */
	/* 	retorna un lista con usuarios */
	/* puede recibir un array de nobres de tablas para generar una relacion de uno a muchos */
	public function getAll(){
		/* relacion de tablas */
		$sql = "SELECT *,$this->table.id as id_master FROM $this->table ";
		if(count($this->one_to_one)<>0){
			foreach($this->one_to_one as $join){
				$column = substr($join,0,-1) . "_id";
				$sql = $sql . "INNER JOIN $join ON $this->table.$column=$join.id ";
			}
		}
		/* ejecucion de query */
		$this->execute($sql,$this->table);
		return $this->data;
	}

	/* toma un usuario por id de la base de datos */
	/* 	retorna una lista con el usuario */
	public function selectById($id){
		$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
		//RELACION 1 A 1
		if(count($this->one_to_one)<>0){
			foreach($this->one_to_one as $join){
				$column = substr($join,0,-1) . "_id";
				$sql = $sql . "INNER JOIN $join ON $this->table.$column=$join.id ";
			}
		}
		$sql = $sql . "WHERE $this->table.id=:id";
		$this->execute($sql,$this->table,$id);
		//RELACION 1 A MUCHOS
		if(count($this->one_to_much)<>0){
			$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
			foreach(array_keys($this->one_to_much) as $join){
				$relation= $this->one_to_much[$join];//QUALIFIERS;
				$column_2 = substr($join,0,-1) . "_id"; //KRI_ID;
				$sql = $sql . "INNER JOIN $relation ON $join.id=$relation.$column_2 ";
				$sql = $sql . "WHERE $this->table.id=:id";
				$this->data["sql"]=$sql;
				$this->execute($sql,$relation,$id);
				$sql = str_replace("WHERE $this->table.id=:id","",$sql);
			}
		}
		//RELACION MUCHOS A MUCHOS
		if(count($this->much_to_much)<>0){
			$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
			foreach(array_keys($this->much_to_much) as $join){
				$relation= substr($this->much_to_much[$join],0,-1);
				$table_relation = substr($join,0,-1) . "_" . $relation;
				$column_1 = $relation . "_id";
				$column_2 = substr($join,0,-1) . "_id";
				$join_table = $this->much_to_much[$join];
				$sql = $sql . "INNER JOIN $table_relation ON $join.id=$table_relation.$column_2 ";
				$sql = $sql . "INNER JOIN $join_table ON $table_relation.$column_1=$join_table.id ";
				$sql = $sql . "WHERE $this->table.id=:id";
				$this->execute($sql,$join_table,$id);
			}
		}
		return $this->data;
	}

	/* inserta un registro a la base de datos con sus respectivas relaciones */
	/* 	retorna el id del elemento registrado */
	public function insert(){
		try{
			if(!$this->db->inTransaction()){
				$this->db->beginTransaction();
			}
			$columns = implode(",",$this->columns);
			$args = implode(",",$this->args);
			$sql = "INSERT INTO $this->table($columns) values($args)";
			$state = $this->db->prepare($sql);
			$this->setParams($state);
			$state->execute();
			$id = $this->db->lastInsertId();
			if(count($this->much_to_much)>0){
				foreach(array_keys($this->much_to_much) as $join){
					$relation= substr($this->much_to_much[$join],0,-1);//event
					$table_relation = substr($join,0,-1) . "_" . $relation;//kri_event
					$column_2 = substr($join,0,-1) . "_id";//kri_id
					$column_1 = $relation . "_id";//event_id
					$sql = "INSERT INTO $table_relation($column_1,$column_2) VALUES(:$column_1,:$column_2)";
					for($i=0;$i< count($_POST[$relation]);$i++){
						$state = $this->db->prepare($sql);
						$state->bindParam(":$column_1",$_POST[$relation][$i]);
						$state->bindParam(":$column_2",$id);
						$state->execute();
					}
				}

			}
			return $id;
		}catch(PDOException $e){
			echo $e->getMessage();
			$this->db->rollBack();
		}
	}

	/* modifica un elemento en la base de datos */
	/* 	retorna el ultimo in elemento de la tabla */
	public function update(){
		try{
			if(!$this->db->inTransaction()){
				$this->db->beginTransaction();
			}
			$prepare_sql = "";
			for($i=0;$i < count($this->args);$i++){
				if((count($this->args)-1)==$i){
					$prepare_sql = $prepare_sql . $this->columns[$i] . "=" . $this->args[$i];
				}else{
					$prepare_sql = $prepare_sql . $this->columns[$i] . "=" . $this->args[$i] . ",";
				}
			}
			$sql = "UPDATE $this->table set $prepare_sql WHERE id=:id";
			$state = $this->db->prepare($sql);
			$this->setParams($state);
			$state->bindParam(":id",$this->id);
			$state->execute();
			return $this->db->lastInsertId();
		}catch(PDOException $e){
			$this->db->rollBack();
		}
	}

	/* borra un elemento de la base de datos */
	/* 	no retorna informacion */
	public function delete($id){
		try{
			if(!$this->db->inTransaction()){
				$this->db->beginTransaction();
			}
			$sql = "DELETE FROM $this->table WHERE id=:id";
			$state = $this->db->prepare($sql);
			$state->bindParam(":id",$id);
			$state->execute();
		}catch(PDOException $e){
			$this->db->rollBack();
		}
	}

	/* busca elementos en la base de datos */
	/* 	retorna un array con los elementos encontrados */
	public function search($search){
		$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
		if(count($this->one_to_one)<>0){
			foreach($this->one_to_one as $join){
				$column = substr($join,0,-1) . "_id";
				$sql = $sql . "INNER JOIN $join ON $this->table.$column=$join.id ";
			}
		}
		$column = substr($this->table,0,-1);
		$sql=$sql . " WHERE $column LIKE '%$search%'";
		$this->execute($sql,$this->table);
		return $this->data;
	}

	/* escribe los cambios en la base de datos si el dml esta en una transaccion */
	/* 	no retorna informacion pero termina la transaccion actual */
	public function saveChanges(){
		$this->db->commit();
	}

	/* establece las variables de las consultas preparadas */
	/* 	no retorna informacion pero deja la consulta preparada lista para su ejecucion */
	private function setParams($state){
		for($i=0;$i < count($this->args);$i++){
			if($this->args[$i]==":password"){
				$password = password_hash($this->password,PASSWORD_BCRYPT);
				$state->bindParam($this->args[$i],$password);
			}else{
				$state->bindParam($this->args[$i],$this->{$this->columns[$i]});
			}
		}
	}

	/* ejecuta la consulta preparada */
	/* modifica la variable data adjuntando la informacion en esta variable con llave especifica*/
	public function execute($sql,$key,$id=0){
		$state = $this->db->prepare($sql);
		if($id<>0){
			$state->bindParam(":id",$id);
		}
		if($state->execute()){
			while($row=$state->fetch(PDO::FETCH_ASSOC)){
				$this->process_data[]=$row;
			}
			$this->data[$key]=$this->process_data;
			$this->process_data=[];
		}
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/24/da435abea8fd62be16fe6701640f7684131640
  Tamaño: 46        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293678    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.166259672 -0500
Modificación: 2023-02-24 01:39:43.517402201 -0500
      Cambio: 2023-10-20 16:46:06.639998210 -0500
    Creación: 2023-10-20 16:46:06.639998210 -0500
040000 tree 4f2928d7b9b4aca44b962da4f8f6e48973a56713	css
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/26/b0fa7d9a575d91a0321146d0533890494024af
  Tamaño: 351       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293530    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.096260638 -0500
Modificación: 2023-05-14 07:33:53.885373117 -0500
      Cambio: 2023-10-20 16:46:06.573333301 -0500
    Creación: 2023-10-20 16:46:06.573333301 -0500
<?php
require_once("models/KriModel.php");
require_once("models/QualifierModel.php");
class KriController extends Controller{

	public $autosave = false;

	public function __construct(){
		parent::__construct();
		$this->model = new KriModel();
		$this->qualifier_model = new QualifierModel();
	}

	/* public function insert(){ */
	/* 	$this->modelParams(); */
	/* 	$id = $this->model->insert(); */
	/* 	$qualifier= new QualifierModel(); */
	/* 	$qualifier->severalInsert($id); */
	/* 	$qualifier->saveChanges(); */
	/* 	$this->model->saveChanges(); */
	/* 	header("Location: /$this->controller"); */
	/* } */

	public function insert(){
		$this->modelParams();
		$id = $this->model->insert();
		$this->qualifier_model->insertQualifiers($id,$this->model->db);
		$this->model->saveChanges();
		header("Location: /$this->controller");
	}

}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/27/dae4899dda3ef6df80d4bdc4ec9c52248ccb59
  Tamaño: 143       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293826    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.232925421 -0500
Modificación: 2023-03-28 17:22:06.604644979 -0500
      Cambio: 2023-10-20 16:46:06.706663120 -0500
    Creación: 2023-10-20 16:46:06.706663120 -0500
<?php
/* valida si el servidor se encuentra en modo seguro */ 
/* y en respuesta redirige a la zona de registro segun el protocolo */
header("Location: /login");
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/27/dc0da7ed422a8aad877a4acc5a5e070e17887d
  Tamaño: 115       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293825    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.232925421 -0500
Modificación: 2023-06-12 07:27:14.824685608 -0500
      Cambio: 2023-10-20 16:46:06.706663120 -0500
    Creación: 2023-10-20 16:46:06.706663120 -0500
100644 blob 97b1828d19670ca13dd69f3270dd0eac7ec6fe5b	create.php
100644 blob 95db84274bcdf088a7f0c9914dcd9b4f8926be36	index.php
100644 blob b46076eb67ae791c25565c159aa7c1ea1e16ee1c	show.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/28/990a16edb396c569dbe70e310a1594ac70d185
  Tamaño: 2141      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293787    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.216258984 -0500
Modificación: 2023-10-16 16:47:23.849836947 -0500
      Cambio: 2023-10-20 16:46:06.689996892 -0500
    Creación: 2023-10-20 16:46:06.689996892 -0500
<?php 
class Model{
	public $db;
	public $data;
	private $process_data;

	public function __construct($second_database = FALSE){
		$this->db=Connection::connect($second_database);
	}

	/* permite ejecutar consultas sql customizadas a cada modelo */
	/* 	retorna la informacion consultada o registrada */
	public function getCustom($sql,$param=0){
		$this->execute($sql,$this->table,$param);
	}

	/* toma todos los usuarios de la base de datos */
	/* 	retorna un lista con usuarios */
	/* puede recibir un array de nobres de tablas para generar una relacion de uno a muchos */
	public function getAll(){
		/* relacion de tablas */
		$sql = "SELECT *,$this->table.id as id_master FROM $this->table ";
		if(count($this->one_to_one)<>0){
			foreach($this->one_to_one as $join){
				$column = substr($join,0,-1) . "_id";
				$sql = $sql . "INNER JOIN $join ON $this->table.$column=$join.id ";
			}
		}
		/* ejecucion de query */
		$this->execute($sql,$this->table);
		return $this->data;
	}

	/* toma un usuario por id de la base de datos */
	/* 	retorna una lista con el usuario */
	public function selectById($id){
		$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
		//RELACION 1 A 1
		if(count($this->one_to_one)<>0){
			foreach($this->one_to_one as $join){
				$column = substr($join,0,-1) . "_id";
				$sql = $sql . "INNER JOIN $join ON $this->table.$column=$join.id ";
			}
		}
		$sql = $sql . "WHERE $this->table.id=:id";
		$this->execute($sql,$this->table,$id);
		//RELACION 1 A MUCHOS
		if(count($this->one_to_much)<>0){
			$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
			foreach(array_keys($this->one_to_much) as $join){
				$relation= $this->one_to_much[$join];//QUALIFIERS;
				$column_2 = substr($join,0,-1) . "_id"; //KRI_ID;
				$sql = $sql . "INNER JOIN $relation ON $join.id=$relation.$column_2 ";
				$sql = $sql . "WHERE $this->table.id=:id";
				$this->data["sql"]=$sql;
				$this->execute($sql,$relation,$id);
				$sql = str_replace("WHERE $this->table.id=:id","",$sql);
			}
		}
		//RELACION MUCHOS A MUCHOS
		if(count($this->much_to_much)<>0){
			$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
			foreach(array_keys($this->much_to_much) as $join){
				$relation= substr($this->much_to_much[$join],0,-1);
				$table_relation = substr($join,0,-1) . "_" . $relation;
				$column_1 = $relation . "_id";
				$column_2 = substr($join,0,-1) . "_id";
				$join_table = $this->much_to_much[$join];
				$sql = $sql . " INNER JOIN $table_relation ON $join.id=$table_relation.$column_2 ";
				$sql = $sql . " INNER JOIN $join_table ON $table_relation.$column_1=$join_table.id ";
				$sql = $sql . "WHERE $this->table.id=:id";
				$this->execute($sql,$join_table,$id);
				$sql = str_replace("WHERE $this->table.id=:id","",$sql);
			}
		}
		return $this->data;
	}

	/* inserta un registro a la base de datos con sus respectivas relaciones */
	/* 	retorna el id del elemento registrado */
	public function insert(){
		try{
			if(!$this->db->inTransaction()){
				$this->db->beginTransaction();
			}
			$columns = implode(",",$this->columns);
			$args = implode(",",$this->args);
			$sql = "INSERT INTO $this->table($columns) values($args)";
			$state = $this->db->prepare($sql);
			$this->setParams($state);
			$state->execute();
			$id = $this->db->lastInsertId();
			if(count($this->much_to_much)>0){
				foreach(array_keys($this->much_to_much) as $join){
					$relation= substr($this->much_to_much[$join],0,-1);//event
					$table_relation = substr($join,0,-1) . "_" . $relation;//kri_event
					$column_2 = substr($join,0,-1) . "_id";//kri_id
					$column_1 = $relation . "_id";//event_id
					$sql = "INSERT INTO $table_relation($column_1,$column_2) VALUES(:$column_1,:$column_2)";
					for($i=0;$i< count($_POST[$relation]);$i++){
						$state = $this->db->prepare($sql);
						$state->bindParam(":$column_1",$_POST[$relation][$i]);
						$state->bindParam(":$column_2",$id);
						$state->execute();
					}
				}

			}
			return $id;
		}catch(PDOException $e){
			echo $e->getMessage();
			$this->db->rollBack();
		}
	}

	/* modifica un elemento en la base de datos */
	/* 	retorna el ultimo in elemento de la tabla */
	public function update(){
		try{
			if(!$this->db->inTransaction()){
				$this->db->beginTransaction();
			}
			$prepare_sql = "";
			for($i=0;$i < count($this->args);$i++){
				if((count($this->args)-1)==$i){
					$prepare_sql = $prepare_sql . $this->columns[$i] . "=" . $this->args[$i];
				}else{
					$prepare_sql = $prepare_sql . $this->columns[$i] . "=" . $this->args[$i] . ",";
				}
			}
			$sql = "UPDATE $this->table set $prepare_sql WHERE id=:id";
			$state = $this->db->prepare($sql);
			$this->setParams($state);
			$state->bindParam(":id",$this->id);
			$state->execute();
			return $this->db->lastInsertId();
		}catch(PDOException $e){
			$this->db->rollBack();
		}
	}

	/* borra un elemento de la base de datos */
	/* 	no retorna informacion */
	public function delete($id){
		try{
			if(!$this->db->inTransaction()){
				$this->db->beginTransaction();
			}
			$sql = "DELETE FROM $this->table WHERE id=:id";
			$state = $this->db->prepare($sql);
			$state->bindParam(":id",$id);
			$state->execute();
		}catch(PDOException $e){
			$this->db->rollBack();
		}
	}

	/* busca elementos en la base de datos */
	/* 	retorna un array con los elementos encontrados */
	public function search($search){
		$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
		if(count($this->one_to_one)<>0){
			foreach($this->one_to_one as $join){
				$column = substr($join,0,-1) . "_id";
				$sql = $sql . "INNER JOIN $join ON $this->table.$column=$join.id ";
			}
		}
		$column = substr($this->table,0,-1);
		$sql=$sql . " WHERE $column LIKE '%$search%'";
		$this->execute($sql,$this->table);
		return $this->data;
	}

	/* escribe los cambios en la base de datos si el dml esta en una transaccion */
	/* 	no retorna informacion pero termina la transaccion actual */
	public function saveChanges(){
		$this->db->commit();
	}

	/* establece las variables de las consultas preparadas */
	/* 	no retorna informacion pero deja la consulta preparada lista para su ejecucion */
	private function setParams($state){
		for($i=0;$i < count($this->args);$i++){
			if($this->args[$i]==":password"){
				$password = password_hash($this->password,PASSWORD_BCRYPT);
				$state->bindParam($this->args[$i],$password);
			}else{
				$state->bindParam($this->args[$i],$this->{$this->columns[$i]});
			}
		}
	}

	/* ejecuta la consulta preparada */
	/* modifica la variable data adjuntando la informacion en esta variable con llave especifica*/
	public function execute($sql,$key,$id=0){
		$state = $this->db->prepare($sql);
		if($id<>0){
			$state->bindParam(":id",$id);
		}
		if($state->execute()){
			while($row=$state->fetch(PDO::FETCH_ASSOC)){
				$this->process_data[]=$row;
			}
			$this->data[$key]=$this->process_data;
			$this->process_data=[];
		}
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/29/82a119945b4383064e25822f964deac0ddab5f
  Tamaño: 53        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293743    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.196259259 -0500
Modificación: 2023-03-01 15:26:02.482809872 -0500
      Cambio: 2023-10-20 16:46:06.669997419 -0500
    Creación: 2023-10-20 16:46:06.669997419 -0500
100644 blob aadb44394094a8e225cda6941d94e0ce387e3f8a	user.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/29/d1c35262abc81cd85e6995651d71a6876cc247
  Tamaño: 190       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293744    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.196259259 -0500
Modificación: 2023-05-14 07:37:26.605367509 -0500
      Cambio: 2023-10-20 16:46:06.669997419 -0500
    Creación: 2023-10-20 16:46:06.669997419 -0500
040000 tree e7163dc73857b94aef2fd3bef6b5c904a4c4abb1	event
040000 tree 173252b1c219932d5e672e4ff7b0c71c7b6b1c3e	kri
040000 tree bf26cbec7b3a99878eea5fe64236fa8c6693da97	login
040000 tree 8494db4705a8620c9116e70e5f31fa4b042d135f	register
040000 tree 3f996d487c0a5063b1b018a35ccab9e527738db6	risk
040000 tree 51b4f483439170ce1f66b8dc07444e95bac424b7	user
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/29/efbdddff199cb88547a0f4aaf77c5212ae2414
  Tamaño: 344       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293742    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.196259259 -0500
Modificación: 2023-03-16 15:57:44.965061428 -0500
      Cambio: 2023-10-20 16:46:06.669997419 -0500
    Creación: 2023-10-20 16:46:06.669997419 -0500
100644 blob 6d6439aba4747c1cef248b31d8b285cea7edaec4	.htaccess
100644 blob da437ed708de7ea2d1ed5bb37dc51d00740740f6	Dockerfile
040000 tree 0d92498866d4f8052aa2042686156a488dbc030e	assets
040000 tree b055b0905a34aea1429e2e0a15223facdb174cd3	components
100644 blob 518e0b10de2304163e8239495cd07c0bfdeaf0db	config.php
040000 tree 779bbcc808b53a8b23f509f871bc21fc3533a9b0	controllers
100644 blob c30106bebe8e4c8d15269163413d17eb08e94520	database.php
040000 tree ea798c332d7a4925b373b75e6d99fc951c80fc0b	models
100644 blob 36f6da7a3c9a1c848c393789cb588431b45b1f44	router.php
040000 tree efa9648e148a5040e3f1dc1466a9603935db2b25	views
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/2b/4f82d11c0f079ba589cd88fbd5754651180895
  Tamaño: 327       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293724    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.189592685 -0500
Modificación: 2023-03-30 15:50:29.527642374 -0500
      Cambio: 2023-10-20 16:46:06.659997683 -0500
    Creación: 2023-10-20 16:46:06.659997683 -0500
100644 blob 34dcbd5666a9705354669066f464e69bdd63f1f5	EventModel.php
100644 blob b3c9286a163b4b0860a0fb6bf721ff41da998359	KriModel.php
100644 blob c3ab34a28c63d96d86a5343ed9d8251db98c5fcb	Model.php
100644 blob cf27b3beec50366ce112f05e7a070bf6cf045070	PropertieModel.php
100644 blob efa9faad575764b049d5e235a17f25c991dd5a2d	QualifierModel.php
100644 blob 3f36dc91c903e4be4239b127f4d48a9f11011911	RecordModel.php
100644 blob 89650d49c24a4c78508f834c6d911c0813a3fd3c	RiskModel.php
100644 blob 6320883040fcc985f2ac32c5aa844826a093d35d	SourceModel.php
100644 blob 95085117329d973fd6c36029b44293bcedd69742	TypeModel.php
100644 blob 98bcd9d15ece27bab02c81584e6e0b10ed3cfd21	UserModel.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/2b/71774bdfa2d355d194de2161bbbeaf4f696d21
  Tamaño: 357       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293726    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.189592685 -0500
Modificación: 2023-10-14 17:45:49.395651260 -0500
      Cambio: 2023-10-20 16:46:06.663330928 -0500
    Creación: 2023-10-20 16:46:06.659997683 -0500
100644 blob 6ec0742d4cbf2bc6d52e80e97f0954b9ba429d27	EventModel.php
100644 blob 5db7a8714b2cc20d8e3700c23151e666ca60e818	KriModel.php
100644 blob 05f353ec5bfd9395ea4888c312812f036f482942	Model.php
100644 blob cf27b3beec50366ce112f05e7a070bf6cf045070	PropertieModel.php
100644 blob 451577bd049f836b07b10907d0cd862efcd8dbb2	QualifierModel.php
100644 blob 3f36dc91c903e4be4239b127f4d48a9f11011911	RecordModel.php
100644 blob 730a24116f0181eadde3a5c5ca6e2d03d57ba8f7	RiskModel.php
100644 blob 05d7d4d8f9670e0e5b2c24fe3469c804e2f0f4b4	SourceModel.php
100644 blob 94c0b90d03c95b7e9484842795b32a9d4a3eacb3	TemplateModel.php
100644 blob 95085117329d973fd6c36029b44293bcedd69742	TypeModel.php
100644 blob 98bcd9d15ece27bab02c81584e6e0b10ed3cfd21	UserModel.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/2b/7e2e2a08d9bfe6fc287d1eadf68a3ae2bef753
  Tamaño: 279       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293725    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.189592685 -0500
Modificación: 2023-05-14 07:33:53.902039782 -0500
      Cambio: 2023-10-20 16:46:06.659997683 -0500
    Creación: 2023-10-20 16:46:06.659997683 -0500
<?php 
class QualifierModel extends Model{
	protected $table = "qualifiers";
	protected $columns = ["type","value","kri_id"];
	protected $args= [":type",":value",":kri_id"];

	public function __construct(){
		parent::__construct();
	}

	public function insertQualifiers($id,$db){
		$this->db = $db;
		$this->kri_id=$id;
		for($i=0;$i < count($_POST["qualifiers"]);$i++){
			$this->type=$_POST["qualifiers"][$i];
			$this->value=$_POST["qualifiers_values"][$i];
			$this->insert();
		}
	}

}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/2b/e2a51092458052ab4cadc975f44f9ec12049c9
  Tamaño: 438       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293723    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.189592685 -0500
Modificación: 2023-05-18 14:55:49.898630305 -0500
      Cambio: 2023-10-20 16:46:06.659997683 -0500
    Creación: 2023-10-20 16:46:06.659997683 -0500
100644 blob 46141854b6c4aac2047018836b3340f5f62dd0c2	.htaccess
100644 blob da437ed708de7ea2d1ed5bb37dc51d00740740f6	Dockerfile
040000 tree 39d44e28008599bd02bb3f75303394c5c0707cd5	assets
040000 tree 0994b646c5cf6fe1259596f6e540c6055d0d4e1c	components
100644 blob 886fe19262e1dcc9bc5827b9b360744e6fe4cf58	config.php
040000 tree 7488404deb644d5c52e3dde927adbcf90e43ae7f	controllers
100644 blob 8dadb53d86e692a9145d4db33bc19d31c3303116	data.sql
100644 blob 82c1b06cf8655c3159204f46dafb691aa3fe03c0	database.php
100644 blob 27dae4899dda3ef6df80d4bdc4ec9c52248ccb59	index.php
040000 tree 1a3e6de70fbc9cace200d68e22b4fcd3b277ae75	models
100644 blob 5b9a73936584eabcb55fd9e03862f7c4e6eab1b1	router.php
100644 blob dc9cfb9c2e93b41acbe9d8bcc6932aa67031e82d	seeder.sql
040000 tree 9a48b8638822e29e44378877ec56ed75c75f25a4	views
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/2c/54cff438b1e58059cac3ec5a503876a4c11637
  Tamaño: 924       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293456    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.052927902 -0500
Modificación: 2023-04-06 11:42:20.719384036 -0500
      Cambio: 2023-10-20 16:46:06.540000846 -0500
    Creación: 2023-10-20 16:46:06.540000846 -0500
// crea los eventos necesarios para una busqueda y sus consecuencias
// recibe como parametro de entra un json con la configuracion de la busqueda

// componenetEvent = El componente que recibira los eventos de cambio y keyup
// listOptions = la lista de opciones que se modificara cuando el servidor arroge respuesta
// searh = el nombre del modelo sin "controller" sobre el cual se realizara la busqueda
// componnets = el arreglo de componenetes que se quiere modificar cuando el evento arroje respuesta
// value = el valor que se quiere representar en la opcion de listOptions
	// EJEMPLO
// ({
// componentEvent: "template",
// 	listOptions: "datalistOptions",
// 	search: "template",
// 	components: new Map([
// 		["source_id","plugin_id"],
// 		["source","vendor"],
// 		["event_id","sid"]
// 	]),
// 	value: "name"
// })
function searchEvent(args){
	// Tomar los elementos pricipales de la busqueda
	var componentEvent = document.getElementById(args.componentEvent)
	var options = document.getElementById(args.listOptions)
	// evento de keyup y axios
	componentEvent.addEventListener('keyup',(e) =>{
		search = componentEvent.value;
		axios({
			method: "GET",
			url: "/"+args.search+"/search/" + (search.replace(" ","_"))
		}).then(res =>{
			options.innerHTML = ""
			select_options = ""
			for(var p of res.data.plugin_sid){
				select_options += "<option "
				for(var pa of args.components){
					var val = pa[1]
					select_options += pa[0] + "='"+p[val]+"' "
				}
				var internalValue = args.value
				select_options += "value='"+p[internalValue]+"'>"
				console.log(select_options)
			}
			options.innerHTML = select_options
		}).catch(e => {
			console.log("DEBUG:" + e)
		})
	})
	//evento de cambio
	componentEvent.addEventListener("change", (e)=>{
		for(var option of options.childNodes){
			if(option.value==componentEvent.value){
				for(c of args.components.keys()){
					var com = document.getElementById(c)
					com.value = option.attributes[c].value
				}
			}
		}

	})
}
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/2c/7848b07d949fbb35e573b4d21768444f8d222f
  Tamaño: 54        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293455    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.052927902 -0500
Modificación: 2023-07-30 06:50:22.888333887 -0500
      Cambio: 2023-10-20 16:46:06.540000846 -0500
    Creación: 2023-10-20 16:46:06.540000846 -0500
100644 blob 750346687b919f27ee4e68db696766e80324e699	search.js
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/2d/76721c290a256bc1563cd8805ab40cbb847e66
  Tamaño: 739       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293491    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.069594339 -0500
Modificación: 2023-03-09 13:43:50.275762584 -0500
      Cambio: 2023-10-20 16:46:06.556667073 -0500
    Creación: 2023-10-20 16:46:06.556667073 -0500
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Iniciar sesion - Csra</title>
		<link rel="stylesheet" href="assets/css/styles.css">
		<!-- cdn bootstrap -->
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
	</head>
	<body>
		<div class="container text-center">
			<div class="row justify-content-center">
				<div class="col-sm-10 col-md-8 col-lg-4">
					<h1>Iniciar sesion</h1>
					<span>o <a href="singup.php">Registrarse</a></span>
					<!-- formulario de inicio de sesion -->
					<form action="controllers/UserController.php" method="POST">
						<input type="text" class="form-control my-2" placeholder="Ingresa tu nombre" name="name">
						<input type="password" class="form-control my-2" placeholder="Ingresa tu contraseña" name="password">
						<input class="form-control my-2 btn btn-primary" type="submit" value="Enviar">
					</form>
				</div>
			</div>
		</div>
	</body>
	<!-- javascript de bootstrap -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
</html>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/2d/eb9ccdbfeae04c5aae7d04596d0107d8c32932
  Tamaño: 436       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293492    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.072927626 -0500
Modificación: 2023-10-17 16:03:13.374521295 -0500
      Cambio: 2023-10-20 16:46:06.556667073 -0500
    Creación: 2023-10-20 16:46:06.556667073 -0500
100644 blob 46141854b6c4aac2047018836b3340f5f62dd0c2	.htaccess
100644 blob da437ed708de7ea2d1ed5bb37dc51d00740740f6	Dockerfile
040000 tree dd6218d45158d9a2b0981c704e5c5c0d3130c418	assets
040000 tree ee84c1fda671963354e74a972bfc478930dd45c8	components
100644 blob 886fe19262e1dcc9bc5827b9b360744e6fe4cf58	config.php
040000 tree d10ce92c241bfadf68d3af2d0dda28bbb5aeac2a	controllers
100644 blob 8dadb53d86e692a9145d4db33bc19d31c3303116	data.sql
100644 blob 82c1b06cf8655c3159204f46dafb691aa3fe03c0	database.php
100644 blob 27dae4899dda3ef6df80d4bdc4ec9c52248ccb59	index.php
040000 tree 0fff838871cb857cf76c1f8e3ce22d160d054f1d	models
100644 blob d9a4ec66dfeb45d52c58647f352aaaae6b84cd28	router.php
100644 blob 46dfb9c57e8457a46bcf674b8b4097ac91049470	seeder.sql
040000 tree cc9e32ea4e986eec0662cbb0bf5238c07a50a0a6	views
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/2f/47ccb2e200d0e41df57356190e2cc8bfd87708
  Tamaño: 54        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293734    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.192925972 -0500
Modificación: 2023-06-24 08:01:49.933126171 -0500
      Cambio: 2023-10-20 16:46:06.666664174 -0500
    Creación: 2023-10-20 16:46:06.666664174 -0500
100644 blob 03f767538382d563d4d5e221f42339855a36c5fd	index.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/2f/5d7e49cca0b3a746dded8d83c025c0948a170b
  Tamaño: 116       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293730    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.189592685 -0500
Modificación: 2023-03-23 13:20:22.558964653 -0500
      Cambio: 2023-10-20 16:46:06.663330928 -0500
    Creación: 2023-10-20 16:46:06.663330928 -0500
100644 blob 2d76721c290a256bc1563cd8805ab40cbb847e66	login.php
100644 blob b39c25f566b37f522483a453100653f3ae7b3ad9	signup.php
040000 tree 93e6a6655f30025a91414dd9a8f092be58f467bf	user
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/2f/6c5691cd7fa5ac4aa9c09ebb3092d82aeffa1d
  Tamaño: 84        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293731    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.192925972 -0500
Modificación: 2023-03-30 15:50:29.527642374 -0500
      Cambio: 2023-10-20 16:46:06.666664174 -0500
    Creación: 2023-10-20 16:46:06.666664174 -0500
100644 blob c443b1afdad166a61b199a2315c5cf681dcb766b	index.php
100644 blob a304f375bdf785e19cc02369d54ea893fe1b9fc5	show.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/2f/8936d52152af3cdddd42764f2beecc76060c4e
  Tamaño: 115       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293733    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.192925972 -0500
Modificación: 2023-10-14 17:45:49.552313447 -0500
      Cambio: 2023-10-20 16:46:06.666664174 -0500
    Creación: 2023-10-20 16:46:06.666664174 -0500
100644 blob b87f3bc3e2670a781ac9265c829fccc2617c9ac8	create.php
100644 blob cf08f28d8f82235f4e9a7f4bff674b0fd4cc38cb	index.php
100644 blob 96bf1251ea04f805d6d1265aa4d4b0d62c6a3743	show.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/2f/a4a95f4909b0ba34f5fb69a041e4dbd994d8c9
  Tamaño: 1597      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293732    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.192925972 -0500
Modificación: 2023-06-24 08:01:27.523126760 -0500
      Cambio: 2023-10-20 16:46:06.666664174 -0500
    Creación: 2023-10-20 16:46:06.666664174 -0500
 // crea los eventos necesarios para una busqueda y sus consecuencias
// recibe como parametro de entra un json con la configuracion de la busqueda

// componenetEvent = El componente que recibira los eventos de cambio y keyup
// listOptions = la lista de opciones que se modificara cuando el servidor arroge respuesta
// searh = el nombre del modelo sin "controller" sobre el cual se realizara la busqueda
// componnets = el arreglo de componenetes que se quiere modificar cuando el evento arroje respuesta
// value = el valor que se quiere representar en la opcion de listOptions
	// EJEMPLO
// ({
// componentEvent: "template",
// 	listOptions: "datalistOptions",
// 	search: "template",
// 	components: new Map([
// 		["source_id","plugin_id"],
// 		["source","vendor"],
// 		["event_id","sid"]
// 	]),
// 	value: "name",
// 	table: "plugin_sid"
// })
function searchEvent(args){
	// Tomar los elementos pricipales de la busqueda
	var componentEvent = document.getElementById(args.componentEvent)
	var options = document.getElementById(args.listOptions)
	if(componentEvent==null){
		axios_get(args,options)
	}else{
		// evento de keyup y axios
		componentEvent.addEventListener('keyup',(e) =>{
			search = componentEvent.value;
			axios_get(args,options,search)
		})
		//evento de cambio
		componentEvent.addEventListener("change", (e)=>{
			for(var option of options.childNodes){
				if(option.value==componentEvent.value){
					for(c of args.components.keys()){
						var com = document.getElementById(c)
						com.value = option.attributes[c].value
					}
				}
			}

		})
	}
}

function axios_get(args,options,search=""){
	axios({
		method: "GET",
		url: "/"+args.search+"/search/" + (search.replace(" ","_"))
	}).then(res =>{
		options.innerHTML = ""
		select_options = ""
		for(var p of res.data[args.table]){
			select_options += "<"+args.tag+" "
			for(var pa of args.components){
				var val = pa[1]
				select_options += pa[0] + "='"+p[val]+"' "
			}
			var internalValue = args.value
			select_options += "value='"+p[internalValue]+"' class='"+args.class+"' onclick='"+args.customFunction+"({"
			for(var pa of args.components){
				var val = pa[1]
				select_options += pa[0] + ": "+ '"'+p[val]+'",'
			}
			select_options += "})'>"+p[internalValue]+"</"+args.tag+">"
			console.log(select_options)
		}
		options.innerHTML = select_options
	}).catch(e => {
		console.log("DEBUG:" + e)
	})
}

//-------------------------------------------------------------------------------
//Busca de forma asincrona en una tabla de base de datos para representarl la informacion consultada en una tabla
//resibe como entrada un argumento de tipo json de la siguiente forma:
//
/*{
componentevent: "search",
	listoptions: "kris",
	search: "kri",
	components: [
		"objective",
		"propertie",
		"percentage"
	],
	value: "kri",
	table: "kris",
}*/
//donde componentEvent es el cuadro de texto sobre el cual se realiza la busqueda
//listOptions es el cuerpo del elemento sobre el cual se van a mostrar los datos
//componenets es un array lista o elemeto iterable que contiene todos los datos a representar en la fila de informacion
//value es el campo principal del registro que generalmente es el nombre y que tiene un link asociado a el
//tabla es la tabla en base de datos sobre la cual se realizara la consulta
function searchTable(args){
	// Tomar los elementos pricipales de la busqueda
	var componentEvent = document.getElementById(args.componentEvent)
	var options = document.getElementById(args.listOptions)
	// evento de keyup y axios
	componentEvent.addEventListener('keyup',(e) =>{
		search = componentEvent.value;
		axios({
			method: "GET",
			url: "/"+args.search+"/search/" + (search.replace(" ","_"))
		}).then(res =>{
			var html = ""
			for(var p of res.data[args.table]){
				html+="<tr><th scope='row'>"+p.master_id+"</th>"
				html+="<td><a href='/"+args.value+"/show/"+p.master_id+"'>"+p[args.value]+"</a></td>"
				for(o of args.components){
					html+="<td>"+p[o]+"</td>"
				}
				html+="</tr>"
				options.innerHTML=html
			}
		}).catch(e => {
			console.log("DEBUG:" + e)
		})
	})
}
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/30/2133f4f330c58639271e8434f7364d757cc868
  Tamaño: 359       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293577    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.116260362 -0500
Modificación: 2023-10-17 16:44:12.981025200 -0500
      Cambio: 2023-10-20 16:46:06.596666019 -0500
    Creación: 2023-10-20 16:46:06.596666019 -0500
100644 blob f5fbcc6ec8eff868d90ec3a3664548402436f1e5	Controller.php
100644 blob 43b66da7c98ec0406611ebd66751eba7be411194	EventController.php
100644 blob c81d35df6c60b54d1c416b7487f81156beff6d61	KriController.php
100644 blob ab88d0b50b2f02ca6a63488e849280128184eafb	LoginController.php
100644 blob 56b41c3c0b81d3e213654e2b64a9e8e43e0c8b30	PropertieController.php
100644 blob 12620ce4178e3b649067d4a02a366ef83bb8d47e	RegisterController.php
100644 blob c76a0a907d381a4e648401d5f3e431c3de645266	RiskController.php
100644 blob 8c1bb57955e07f847b2b8e617e4db6218f8ced28	SourceController.php
100644 blob 07a9d2abeb523436c2863c3129e2c4f1fd26c654	TemplateController.php
100644 blob 9948526e371ec84f39ad45662721203603f6abf6	TypeController.php
100644 blob fb02603f5e1e778c1b626de544c3f0834532d3e1	UserController.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/30/5c1a20a126abf03b08778ca6b3560ca0640a42
  Tamaño: 251       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293580    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.122926937 -0500
Modificación: 2023-10-17 15:55:34.969741790 -0500
      Cambio: 2023-10-20 16:46:06.599999264 -0500
    Creación: 2023-10-20 16:46:06.599999264 -0500
040000 tree a05d527cf3bbdee68cb6677fda6174823fa5d6f8	event
040000 tree 308825de38a9227b205beaff0966241c92688b54	kri
040000 tree bf26cbec7b3a99878eea5fe64236fa8c6693da97	login
040000 tree 4f27caa9c5680f7c74a99a1cc1eb3911d428c67f	propertie
040000 tree 8494db4705a8620c9116e70e5f31fa4b042d135f	register
040000 tree 4d17a1f804549e5391f2e10983a9f8becdd63319	risk
040000 tree 2f47ccb2e200d0e41df57356190e2cc8bfd87708	type
040000 tree 51b4f483439170ce1f66b8dc07444e95bac424b7	user
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/30/8825de38a9227b205beaff0966241c92688b54
  Tamaño: 114       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293579    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.119593650 -0500
Modificación: 2023-10-17 15:55:34.929742827 -0500
      Cambio: 2023-10-20 16:46:06.599999264 -0500
    Creación: 2023-10-20 16:46:06.599999264 -0500
100644 blob d08b6bd70952d6953478a03f27843416f607eabb	create.php
100644 blob cf08f28d8f82235f4e9a7f4bff674b0fd4cc38cb	index.php
100644 blob c8dc0abfd6095d873a7f6613b05bc0670ad81955	show.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/30/cca64a0adebfcd8627b0ae4cd71f260a04b1d0
  Tamaño: 227       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293578    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.119593650 -0500
Modificación: 2023-03-28 17:22:06.567978311 -0500
      Cambio: 2023-10-20 16:46:06.599999264 -0500
    Creación: 2023-10-20 16:46:06.596666019 -0500
<?php
require_once("database.php");
require("models/Model.php");
require("controllers/Controller.php");
/* var_dump($_GET); */
$controller = $_GET["controller"];
$action = $_GET["action"];
$id = $_GET["id"];

if(empty($action)){
	$action = "index";
}
$controller = ucfirst($controller) . "Controller";
include "controllers/$controller.php";
$ctrl = new $controller;
$ctrl->{$action}();
?>

---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/30/f2000552c83bf93a8b18c8d39bf7ad3e04c634
  Tamaño: 257       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293581    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.122926937 -0500
Modificación: 2023-10-17 15:57:19.930353334 -0500
      Cambio: 2023-10-20 16:46:06.599999264 -0500
    Creación: 2023-10-20 16:46:06.599999264 -0500
tree c203a5a40ec2cdbacea1d398f28dc83096d11f9a
parent c7de421c9e74da78c171f2838f7c55f776b4ec05
author DragonyteEvol <acuarionevol@outlook.com> 1697576135 -0500
committer DragonyteEvol <acuarionevol@outlook.com> 1697576135 -0500

feat: Update kris view
- Update function to update kris and relations
- Qualifiers to kris updated in the same transation
- Events to kris updated in the same transaction
- Function to add new Qualifiers in edit
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/31/f58096a38b58d43d09cd81149deb69aef0499d
  Tamaño: 359       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293865    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.249591858 -0500
Modificación: 2023-04-13 16:00:40.143749336 -0500
      Cambio: 2023-10-20 16:46:06.723329347 -0500
    Creación: 2023-10-20 16:46:06.723329347 -0500
100644 blob 34dcbd5666a9705354669066f464e69bdd63f1f5	EventModel.php
100644 blob 85f9bb9a95b032e5df4c7055896bad5c0e2bf2bf	KriModel.php
100644 blob 349cd442ae9b53536afae36e7d9922f3fe84b1b9	Model.php
100644 blob cf27b3beec50366ce112f05e7a070bf6cf045070	PropertieModel.php
100644 blob efa9faad575764b049d5e235a17f25c991dd5a2d	QualifierModel.php
100644 blob 3f36dc91c903e4be4239b127f4d48a9f11011911	RecordModel.php
100644 blob da44e54bc0a27b71b4025e2ec66691e9e08ae0d1	RiskModel.php
100644 blob 05d7d4d8f9670e0e5b2c24fe3469c804e2f0f4b4	SourceModel.php
100644 blob 94c0b90d03c95b7e9484842795b32a9d4a3eacb3	TemplateModel.php
100644 blob 95085117329d973fd6c36029b44293bcedd69742	TypeModel.php
100644 blob 98bcd9d15ece27bab02c81584e6e0b10ed3cfd21	UserModel.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/33/29768bb423a41c591994dd10004b955cd995aa
  Tamaño: 360       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293805    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.226258846 -0500
Modificación: 2023-06-24 08:01:49.899792837 -0500
      Cambio: 2023-10-20 16:46:06.699996629 -0500
    Creación: 2023-10-20 16:46:06.699996629 -0500
100644 blob 916405f23887474176f88d1c45f7fa7fdbcdd9e2	Controller.php
100644 blob 888248a73fe883e3982223d1a84670bdf1a19641	EventController.php
100644 blob 98c3ca2672d8e18092c781648a6d6974b6295825	KriController.php
100644 blob ab88d0b50b2f02ca6a63488e849280128184eafb	LoginController.php
100644 blob 56b41c3c0b81d3e213654e2b64a9e8e43e0c8b30	PropertieController.php
100644 blob 12620ce4178e3b649067d4a02a366ef83bb8d47e	RegisterController.php
100644 blob 5fa1c0a8e82b84d03e204b24bdde9483e720aba0	RiskController.php
100644 blob 8c1bb57955e07f847b2b8e617e4db6218f8ced28	SourceController.php
100644 blob 07a9d2abeb523436c2863c3129e2c4f1fd26c654	TemplateController.php
100644 blob 9948526e371ec84f39ad45662721203603f6abf6	TypeController.php
100644 blob fb02603f5e1e778c1b626de544c3f0834532d3e1	UserController.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/33/452ee949b828454cae58e2d991718a76da0349
  Tamaño: 186       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293806    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.226258846 -0500
Modificación: 2023-05-14 10:25:27.635102169 -0500
      Cambio: 2023-10-20 16:46:06.699996629 -0500
    Creación: 2023-10-20 16:46:06.699996629 -0500
tree 7a818480691e7e22afb1c6955896ba963accda6c
parent 1fddccbb92168445aecf32c6c1f26b7bcafd0b18
author DragonyteEvol <acuarionevol@outlook.com> 1684077927 +0000
committer DragonyteEvol <acuarionevol@outlook.com> 1684077927 +0000

docs: only full group by disbled steps
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/33/8f08711752934ac7796d89008e8601848ba04b
  Tamaño: 437       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293804    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.222925559 -0500
Modificación: 2023-03-30 15:50:29.547642373 -0500
      Cambio: 2023-10-20 16:46:06.699996629 -0500
    Creación: 2023-10-20 16:46:06.699996629 -0500
100644 blob 6d6439aba4747c1cef248b31d8b285cea7edaec4	.htaccess
100644 blob da437ed708de7ea2d1ed5bb37dc51d00740740f6	Dockerfile
040000 tree 0d92498866d4f8052aa2042686156a488dbc030e	assets
040000 tree 9c4a38e4261dc3f0ad3cb12e32ec9b1eaa1b8d09	components
100644 blob fc5c9dceab7ea6a3e92e9e475208d3d4a4402846	config.php
040000 tree 720f58d6a022d4a25d56d8c93eaa65129da71568	controllers
100644 blob 8dadb53d86e692a9145d4db33bc19d31c3303116	data.sql
100644 blob 82c1b06cf8655c3159204f46dafb691aa3fe03c0	database.php
100644 blob 27dae4899dda3ef6df80d4bdc4ec9c52248ccb59	index.php
040000 tree 2b4f82d11c0f079ba589cd88fbd5754651180895	models
100644 blob 30cca64a0adebfcd8627b0ae4cd71f260a04b1d0	router.php
100644 blob dc9cfb9c2e93b41acbe9d8bcc6932aa67031e82d	seeder.sql
040000 tree 78592a30421dcdff168e2dce95c70bb2613607ec	views
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/33/c82f5ce99cd7573eee526bf228c0a717b9b359
  Tamaño: 251       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293803    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.222925559 -0500
Modificación: 2023-10-18 16:45:46.060374504 -0500
      Cambio: 2023-10-20 16:46:06.696663383 -0500
    Creación: 2023-10-20 16:46:06.696663383 -0500
040000 tree c1a43b69371eea8ab5885b0c3a756f816af941ea	event
040000 tree 308825de38a9227b205beaff0966241c92688b54	kri
040000 tree bf26cbec7b3a99878eea5fe64236fa8c6693da97	login
040000 tree 34070b594ee288a11b0566d8196c0548e3b5ddf5	propertie
040000 tree 8494db4705a8620c9116e70e5f31fa4b042d135f	register
040000 tree b454c700c6d89699270ad15a6872a4b09a34e62b	risk
040000 tree 2f47ccb2e200d0e41df57356190e2cc8bfd87708	type
040000 tree 51b4f483439170ce1f66b8dc07444e95bac424b7	user
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/34/070b594ee288a11b0566d8196c0548e3b5ddf5
  Tamaño: 53        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293899    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.316257606 -0500
Modificación: 2023-10-18 16:45:46.033708563 -0500
      Cambio: 2023-10-20 16:46:06.739995575 -0500
    Creación: 2023-10-20 16:46:06.739995575 -0500
100644 blob a1bc43fcc63384545a6785add8650244012f2a88	index.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/34/9cd442ae9b53536afae36e7d9922f3fe84b1b9
  Tamaño: 1474      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293898    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.316257606 -0500
Modificación: 2023-04-06 11:42:20.682717369 -0500
      Cambio: 2023-10-20 16:46:06.739995575 -0500
    Creación: 2023-10-20 16:46:06.739995575 -0500
<?php 
class Model{
	public $db;
	private $data;
	private $process_data;

	public function __construct($second_database = FALSE){
		$this->db=Connection::connect($second_database);
		$this->data_max=[];
	}

	public function getCustom($sql,$param=0){
		$this->execute($sql,$this->table,$param);
		return $this->data;
	}

	/* toma todos los usuarios de la base de datos */
	/* 	retorna un lista con usuarios */
	/* puede recibir un array de nobres de tablas para generar una relacion de uno a muchos */
	public function getAll(){
		/* relacion de tablas */
		$sql = "SELECT *,$this->table.id as id_master FROM $this->table ";
		if(count($this->relations)<>0){
			foreach($this->relations as $join){
				$column = substr($join,0,-1) . "_id";
				$sql = $sql . "INNER JOIN $join ON $this->table.$column=$join.id ";
			}
		}
		/* ejecucion de query */
		$this->execute($sql,$this->table);
		return $this->data;
	}

	/* toma un usuario por id de la base de datos */
	/* 	retorna una lista con el usuario */

	public function selectById($id){
		$sql = "SELECT *,$this->table.id as master_id FROM $this->table WHERE $this->table.id=:id";
		$this->execute($sql,$this->table,$id);
		if(count($this->much_to_much)<>0){
			$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
			foreach(array_keys($this->much_to_much) as $join){
				$relation= substr($this->much_to_much[$join],0,-1);
				$table_relation = substr($join,0,-1) . "_" . $relation;
				$column_1 = $relation . "_id";
				$column_2 = substr($join,0,-1) . "_id";
				$join_table = $this->much_to_much[$join];
				$sql = $sql . "INNER JOIN $table_relation ON $join.id=$table_relation.$column_2 ";
				$sql = $sql . "INNER JOIN $join_table ON $table_relation.$column_1=$join_table.id ";
				$sql = $sql . "WHERE $this->table.id=:id";
				$this->execute($sql,$join_table,$id);
				$sql = str_replace("WHERE $this->table.id=:id","",$sql);
			}
		}
		return $this->data;
	}


	/* public function selectById($id){ */
	/* 	$sql = "SELECT *,$this->table.id as master_id FROM $this->table "; */
	/* 	if(count($this->much_to_much)<>0){ */
	/* 		foreach(array_keys($this->much_to_much) as $join){ */
	/* 			$table_1 = substr($join,0,-1); */
	/* 			$table_2 = substr($this->much_to_much[$join],0,-1); */
	/* 			$table_relation = $table_1 . "_" . $table_2; */
	/* 			$column_1 = $table_2 . "_id"; */
	/* 			$column_2 = $table_1 . "_id"; */
	/* 			$test = $this->much_to_much[$join]; */
	/* 			$sql = $sql . "INNER JOIN $table_relation ON $join.id=$table_relation.$column_2 "; */
	/* 			$sql = $sql . "INNER JOIN $test ON $table_relation.$column_1=$test.id "; */
	/* 		} */
	/* 	} */
	/* 	$sql = $sql . "WHERE $this->table.id=:id"; */
	/* 	$state = $this->db->prepare($sql); */
	/* 	$state->bindParam(":id",$id); */
	/* 	if($state->execute()){ */
	/* 		while($row=$state->fetch(PDO::FETCH_ASSOC)){ */
	/* 			$this->data[]=$row; */
	/* 		} */
	/* 		return $this->data; */
	/* 	} */
	/* } */

	/* inserta un usuario en la base de datos */
	/* 	retorna el numero de id de el usuario registrado */
	public function insert(){
		$columns = implode(",",$this->columns);
		$args = implode(",",$this->args);
		$sql = "INSERT INTO $this->table($columns) values($args)";
		$state = $this->db->prepare($sql);
		$this->setParams($state);
		$state->execute();
		return $this->db->lastInsertId();
	}


	public function update(){
		$prepare_sql = "";
		for($i=0;$i < count($this->args);$i++){
			if((count($this->args)-1)==$i){
				$prepare_sql = $prepare_sql . $this->columns[$i] . "=" . $this->args[$i];
			}else{
				$prepare_sql = $prepare_sql . $this->columns[$i] . "=" . $this->args[$i] . ",";
			}
		}
		$sql = "UPDATE $this->table set $prepare_sql WHERE id=:id";
		$state = $this->db->prepare($sql);
		$this->setParams($state);
		$state->bindParam(":id",$this->id);
		$state->execute();
		return $this->db->lastInsertId();
	}

	public function delete($id){
		$sql = "DELETE FROM $this->table WHERE id=:id";
		$state = $this->db->prepare($sql);
		$state->bindParam(":id",$id);
		$state->execute();
	}

	private function setParams($state){
		for($i=0;$i < count($this->args);$i++){
			if($this->args[$i]==":password"){
				$password = password_hash($this->password,PASSWORD_BCRYPT);
				$state->bindParam($this->args[$i],$password);
			}else{
				$state->bindParam($this->args[$i],$this->{$this->columns[$i]});
			}
		}
	}

	private function execute($sql,$key,$id=0){
		$state = $this->db->prepare($sql);
		if($id<>0){
			$state->bindParam(":id",$id);
		}
		if($state->execute()){
			while($row=$state->fetch(PDO::FETCH_ASSOC)){
				$this->process_data[]=$row;
			}
			$this->data[$key]=$this->process_data;
			$this->process_data=[];
		}
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/34/dcbd5666a9705354669066f464e69bdd63f1f5
  Tamaño: 180       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293897    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.316257606 -0500
Modificación: 2023-04-06 11:42:20.672717369 -0500
      Cambio: 2023-10-20 16:46:06.739995575 -0500
    Creación: 2023-10-20 16:46:06.739995575 -0500
<?php 
class EventModel extends Model{
	protected $table = "events";
	protected $columns = ["event","type","source_id","event_id"];
	protected $args= [":event",":type",":source_id",":event_id"];

	public function __construct(){
		parent::__construct();
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/35/05ebb9924e03928d63b84ba645cb3e6ff1789a
  Tamaño: 46        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293443    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.046261327 -0500
Modificación: 2023-04-06 11:42:36.019384315 -0500
      Cambio: 2023-10-20 16:46:06.536667600 -0500
    Creación: 2023-10-20 16:46:06.533334355 -0500
040000 tree 92adc7983a61eba4116caeb0c710d7b316d5ab86	css
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/35/ba8647a01b93a9470941f4276df9afa68f334e
  Tamaño: 161       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293442    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.046261327 -0500
Modificación: 2023-03-28 17:22:24.344644514 -0500
      Cambio: 2023-10-20 16:46:06.533334355 -0500
    Creación: 2023-10-20 16:46:06.533334355 -0500
040000 tree 4a50142398d9b17b7464afff51695fbefea76c13	kri
040000 tree c239fc53c58bda758970f22d883078bb441f7f9e	login
040000 tree 8494db4705a8620c9116e70e5f31fa4b042d135f	register
040000 tree 512e8c220715a8d7fa3201961b1af71bfdd47ef0	risk
040000 tree 51b4f483439170ce1f66b8dc07444e95bac424b7	user
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/36/14f12e907d47d42bb32f1e6d3c594f12a65b20
  Tamaño: 437       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293484    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.066261051 -0500
Modificación: 2023-05-14 08:14:49.445308445 -0500
      Cambio: 2023-10-20 16:46:06.553333828 -0500
    Creación: 2023-10-20 16:46:06.553333828 -0500
100644 blob 46141854b6c4aac2047018836b3340f5f62dd0c2	.htaccess
100644 blob da437ed708de7ea2d1ed5bb37dc51d00740740f6	Dockerfile
040000 tree 39d44e28008599bd02bb3f75303394c5c0707cd5	assets
040000 tree 0994b646c5cf6fe1259596f6e540c6055d0d4e1c	components
100644 blob fc5c9dceab7ea6a3e92e9e475208d3d4a4402846	config.php
040000 tree 1bb8bfb26dcbad31d92f0d06e45d2ca9e2950579	controllers
100644 blob 8dadb53d86e692a9145d4db33bc19d31c3303116	data.sql
100644 blob 82c1b06cf8655c3159204f46dafb691aa3fe03c0	database.php
100644 blob 27dae4899dda3ef6df80d4bdc4ec9c52248ccb59	index.php
040000 tree 8fb1efa6322ddbb014c1355a8eae953f59208ef4	models
100644 blob 30cca64a0adebfcd8627b0ae4cd71f260a04b1d0	router.php
100644 blob dc9cfb9c2e93b41acbe9d8bcc6932aa67031e82d	seeder.sql
040000 tree e7b4164ff2349c065930802e765066958bcda685	views
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/36/f6da7a3c9a1c848c393789cb588431b45b1f44
  Tamaño: 206       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293483    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.066261051 -0500
Modificación: 2023-03-16 15:57:33.071727880 -0500
      Cambio: 2023-10-20 16:46:06.553333828 -0500
    Creación: 2023-10-20 16:46:06.553333828 -0500
<?php
require_once("database.php");
/* var_dump($_GET); */
$controller = $_GET["controller"];
$action = $_GET["action"];
$id = $_GET["id"];

if(empty($action)){
	$action = "index";
}
$controller = ucfirst($controller) . "Controller";
include "controllers/$controller.php";
$ctrl = new $controller;
$ctrl->{$action}();
?>

---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/37/9ee99587344673b6d14dd4eed529953cf9b11d
  Tamaño: 116       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293785    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.216258984 -0500
Modificación: 2023-10-07 12:37:25.813816735 -0500
      Cambio: 2023-10-20 16:46:06.686663647 -0500
    Creación: 2023-10-20 16:46:06.686663647 -0500
100644 blob e69de29bb2d1d6434b8b29ae775ad8c2e48c5391	create.php
100644 blob 58223b3ab325f17adfc1d5c6fde6ab930b39f82e	index.php
100644 blob 23aceaabb11dba079e2e4032b13463e21062eed3	show.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/38/79d1d4659eb6b9c63dd2d83bbc6ffe124a9a0b
  Tamaño: 173       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293759    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.202925835 -0500
Modificación: 2023-05-14 07:33:53.885373117 -0500
      Cambio: 2023-10-20 16:46:06.676663910 -0500
    Creación: 2023-10-20 16:46:06.676663910 -0500
<?php
require_once("models/EventModel.php");
class EventController extends Controller{

	public $autosave = true;

	public function __construct(){
		parent::__construct();
		$this->model = new EventModel();
	}

}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/39/d44e28008599bd02bb3f75303394c5c0707cd5
  Tamaño: 72        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293710    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.182926109 -0500
Modificación: 2023-05-14 07:37:26.345367517 -0500
      Cambio: 2023-10-20 16:46:06.653331192 -0500
    Creación: 2023-10-20 16:46:06.653331192 -0500
040000 tree bcf616d3942cc000681f5c65d3cabf8bb6701ce3	css
040000 tree c17619f39e32fd2794c6f06fe11b9e65958b669b	js
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/39/edb8eb928c77e8fafaa1e956c0864b32e60038
  Tamaño: 55        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293709    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.179592822 -0500
Modificación: 2023-10-14 17:45:49.005662410 -0500
      Cambio: 2023-10-20 16:46:06.653331192 -0500
    Creación: 2023-10-20 16:46:06.653331192 -0500
100644 blob 86082de18bfcc18ed173b875f429390382aa8cc0	styles.css
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/3a/b77b78586ed176ad4a45bb4f96f519f97090eb
  Tamaño: 1583      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293645    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.149593236 -0500
Modificación: 2023-06-24 08:01:27.573126757 -0500
      Cambio: 2023-10-20 16:46:06.626665228 -0500
    Creación: 2023-10-20 16:46:06.626665228 -0500
<?php  
include_once("components/header.php");
?>
<div class="card">
	<div class="card-header">
		<div class="row">
			<div class="col-6">
				<div class="row">
					<div class="input-group mb-3">
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalCreate">
	+
</button>
						<input id="searchEvent" type="text" class="form-control" placeholder="Buscar evento" aria-label="Example text with button addon" aria-describedby="button-addon1">
					</div>
				</div>
			</div>
			<div class="col-6">
				<div class="row">
					<div class="col-6">
						<input class="form-control" name="from" type="datetime-local">
					</div>
					<div class="col-6">
						<input class="form-control d-flex" name="to" type="datetime-local">
					</div>
				</div>
			</div>
		</div>
	</div>

	<table class="table table-borderless">
		<thead>
			<tr>
				<th scope="col">#</th>
				<th scope="col">Evento</th>
				<th scope="col">Tipo</th>
			</tr>
		</thead>
		<tbody id="events">
			<?php  foreach($data["events"] as $risk): ?>
			<tr>
				<th scope="row"><?= $risk["id_master"] ?></th>
				<td>
					<a class="link-dark" href="/event/show/<?= $risk['id_master'] ?>">
						<?= $risk["event"] ?>
					</a>
				</td>
				<td><?= $risk["propertie"] ?></td>
				<td><?= $risk["type"] ?></td>
			</tr>
			<?php  endforeach; ?>
		</tbody>
	</table>
</div>
<!-- ///////////////// -->
<!-- Formulario modal para creacion de eventos --> 
<div id="modalCreate" class="modal" tabindex="-1">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Crear evento</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<!-- formulario de inicio de sesion -->
				<form action="/event/insert" method="POST" class="needs-validation">
					<!-- TEMPLATE -->
					<div class="form-floating mb-3">
						<input type="text" class="form-control" list="datalistOptions" id="template" placeholder="Type to search...">
						<datalist id="datalistOptions">
						</datalist>
						<label for="floatingInput">Selecciona y busca una platilla</label>
					</div>

					<!-- NOMBRE -->
					<div class="form-floating mb-3">
						<input type="text" required class="form-control" name="event" id="floatingInput" placeholder="Insegra un nombre">
						<label for="floatingInput">Ingresa un nombre</label>
					</div>
					<!-- TIPO DE EVENTO -->
					<div class="form-floating mb-3">
						<select name="type" class="form-select" id="floatingSelect" aria-label="Floating label select example">
							<option selected value="automatic">Automatico</option>
							<option value="manual">Manual</option>
						</select>
						<label for="floatingSelect">Tipo de evento</label>
					</div>
					<!-- ID DE LA FUENTE -->
					<div class="form-floating mb-3">
						<input type="text" name="source_id" class="form-control disabled" id="source_id">
						<label for="floatingInput">ID de la fuente</label>
					</div>
					<!-- IDE DEL EVENTO -->
					<div class="form-floating mb-3">
						<input name="event_id" type="text" class="form-control disabled" id="event_id">
						<label for="floatingInput">ID del evento</label>
					</div>
					<!-- FUENTE -->
					<div class="form-floating mb-3">
						<input type="text" disabled class="form-control" id="source">
						<label for="floatingInput">Fuente</label>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
						<button type="submit" class="btn btn-primary">Enviar</button>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
<script src="assets/js/search.js"></script>
<script>
	/* searchEvent({ */
	/* componentEvent: "template", */
	/* 	listOptions: "datalistOptions", */
	/* 	search: "template", */
	/* 	components: new Map([ */
	/* 		["source_id","plugin_id"], */
	/* 		["source","vendor"], */
	/* 		["event_id","sid"] */
	/* 	]), */
	/* 	value: "name" */
	/* }) */
	searchEvent({
		componentEvent: "template",
		listOptions: "datalistOptions",
		search: "template",
		components: new Map([
			["source_id","plugin_id"],
			["source","vendor"],
			["event_id","sid"]
		]),
		value: "name",
		table: "plugin_sid",
		tag: "option"
	})
	searchTable({
		componentEvent: "searchEvent",
		listOptions: "events",
		search: "event",
		components: [
			"type",
		],
		value: "event",
		table: "events",
	})
</script>
</script>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/3b/74a7b2ff84c733dc5074553dda75cb66b3a132
  Tamaño: 844       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293522    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.092927350 -0500
Modificación: 2023-10-17 16:03:10.424597791 -0500
      Cambio: 2023-10-20 16:46:06.573333301 -0500
    Creación: 2023-10-20 16:46:06.573333301 -0500
<?php  
include_once("components/header.php");
?>
<!-- FORMULARIO DE CREACION DE eventS -->
<div class="container">
	<?php  foreach($data["events"] as $event): ?>
	<form action="/event/update/<?= $event['master_id'] ?>" method="POST" class="needs-validation">
		<div class="card my-5">
			<div class="card-header">
				<h5><b><?=$event['master_id']?> | </b><?=$event['event']?></h5>
			</div>
			<div class="card-body">
				<!-- EVENTO -->
				<div class="form-floating mb-3">
					<input type="text" value="<?= $event['event'] ?>" required class="form-control" name="event" id="floatingInput" placeholder="Insegra un nombre">
					<label for="floatingInput">Nombre del evento</label>
				</div>
				<div class="row">
					<div class="col-4">
						<!-- TIPO -->
						<div class="form-floating mb-3">
							<select name="type" class="form-select" id="datalistOptions" aria-label="">
								<option value="automatic">automatic</option>
								<option value="manual">manual</option>
							</select>
							<label for="floatingSelect">Tipo de evento</label>
						</div>
					</div>
					<div class="col-4">
						<!-- FUENTE ID OSIEM -->
						<div class="form-floating mb-3">
							<input name="source_id" type="number" value="<?= $event['source_id'] ?>" class="form-control">
							<label for="floatingInput">Fuente OSIEM</label>
						</div>
					</div>
					<div class="col-4">
						<!-- EVENT ID-->
						<div class="form-floating mb-3">
							<input name="event_id" type="number" value="<?= $event['event_id'] ?>" class="form-control">
							<label for="floatingInput">Evento OSIEM</label>
						</div>
					</div>
				</div>
				<?php  endforeach; ?>
			</div>
			<div class="card-footer">
				<!-- END FIELD -->
				<div class="row">
					<div class="col-4">
						<button type="reset" class="btn btn-outline-secondary form-control">Limpiar</button>
					</div>
					<div class="col-4">
						<button type="submit" class="btn btn-primary form-control">Actualizar</button>
					</div>
				</div>
			</div>
		</div>
	</form>
</div>
<script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/3c/749a5bb13fa3437b0c8116ac00cf18af1e6f5b
  Tamaño: 195       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293771    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.209592409 -0500
Modificación: 2023-03-23 13:20:08.675631069 -0500
      Cambio: 2023-10-20 16:46:06.683330401 -0500
    Creación: 2023-10-20 16:46:06.683330401 -0500
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title></title>
</head>
<body>
	<ul>
		<li><a href="http://localhost:9090/user/show/1">1</a></li>
		<li><a href="http://localhost:9090/user/show/2">2</a></li>
		<li><a href="localhost:9090/user/show/3">3</a></li>
		<li><a href="localhost:9090/user/show/4">4</a></li>
		<li><a href="localhost:9090/user/show/5">5</a></li>
	</ul>
</form>
</body>
</html>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/3d/cb4e7d0cab28a5b30b4f34fff055b9f1ccf477
  Tamaño: 361       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293575    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.116260362 -0500
Modificación: 2023-10-18 16:45:46.000376137 -0500
      Cambio: 2023-10-20 16:46:06.596666019 -0500
    Creación: 2023-10-20 16:46:06.593332773 -0500
100644 blob f5fbcc6ec8eff868d90ec3a3664548402436f1e5	Controller.php
100644 blob 43b66da7c98ec0406611ebd66751eba7be411194	EventController.php
100644 blob c81d35df6c60b54d1c416b7487f81156beff6d61	KriController.php
100644 blob ab88d0b50b2f02ca6a63488e849280128184eafb	LoginController.php
100644 blob e222df3b1877efd3ae1266aed9f28cf79fec14b1	PropertieController.php
100644 blob 12620ce4178e3b649067d4a02a366ef83bb8d47e	RegisterController.php
100644 blob 67846ec79bfff23183249bb6f016fd90f343e2fa	RiskController.php
100644 blob 8c1bb57955e07f847b2b8e617e4db6218f8ced28	SourceController.php
100644 blob 07a9d2abeb523436c2863c3129e2c4f1fd26c654	TemplateController.php
100644 blob 9948526e371ec84f39ad45662721203603f6abf6	TypeController.php
100644 blob fb02603f5e1e778c1b626de544c3f0834532d3e1	UserController.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/3e/63814567a93a8f386235f79383aa0364a3aae8
  Tamaño: 438       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293666    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.159593098 -0500
Modificación: 2023-06-12 07:27:15.021352279 -0500
      Cambio: 2023-10-20 16:46:06.636664965 -0500
    Creación: 2023-10-20 16:46:06.636664965 -0500
100644 blob 46141854b6c4aac2047018836b3340f5f62dd0c2	.htaccess
100644 blob da437ed708de7ea2d1ed5bb37dc51d00740740f6	Dockerfile
040000 tree 39d44e28008599bd02bb3f75303394c5c0707cd5	assets
040000 tree 0994b646c5cf6fe1259596f6e540c6055d0d4e1c	components
100644 blob 886fe19262e1dcc9bc5827b9b360744e6fe4cf58	config.php
040000 tree 7f31c2d738a050ff614bc61451911174a722a76d	controllers
100644 blob 8dadb53d86e692a9145d4db33bc19d31c3303116	data.sql
100644 blob 82c1b06cf8655c3159204f46dafb691aa3fe03c0	database.php
100644 blob 27dae4899dda3ef6df80d4bdc4ec9c52248ccb59	index.php
040000 tree 1a3e6de70fbc9cace200d68e22b4fcd3b277ae75	models
100644 blob 5b9a73936584eabcb55fd9e03862f7c4e6eab1b1	router.php
100644 blob dc9cfb9c2e93b41acbe9d8bcc6932aa67031e82d	seeder.sql
040000 tree a6a44f11eb9bc3ca6af966bef5829251025521f6	views
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/3f/1b0652c58d85e5f040d0bdcac7e833fff8fb9c
  Tamaño: 63        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293895    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.316257606 -0500
Modificación: 2023-03-09 13:44:00.559096102 -0500
      Cambio: 2023-10-20 16:46:06.736662329 -0500
    Creación: 2023-10-20 16:46:06.736662329 -0500
100644 blob bb1d6970a29b7f77631c4fdd3df8f977777ea8af	UserController.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/3f/36dc91c903e4be4239b127f4d48a9f11011911
  Tamaño: 179       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293893    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.312924318 -0500
Modificación: 2023-03-28 17:22:06.611311644 -0500
      Cambio: 2023-10-20 16:46:06.736662329 -0500
    Creación: 2023-10-20 16:46:06.736662329 -0500
<?php 
class RecordModel extends Model{
	protected $table = "records";
	protected $columns = ["source_id","event_id","reported_at"];
	protected $args = [":source_id",":event_id",":reported_at"];

	public function __construct(){
		parent::__construct();
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/3f/996d487c0a5063b1b018a35ccab9e527738db6
  Tamaño: 83        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293894    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.312924318 -0500
Modificación: 2023-04-06 11:42:36.059384316 -0500
      Cambio: 2023-10-20 16:46:06.736662329 -0500
    Creación: 2023-10-20 16:46:06.736662329 -0500
100644 blob 9f72b3ce3fdb35d03bf3b2c96c525cd8ccfe83e5	index.php
100644 blob d75d75e151582b4db833148749f3bd47db469140	show.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/40/2d8de9d28001806fc15bea3122fea8ba856d96
  Tamaño: 202       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293757    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.202925835 -0500
Modificación: 2023-03-28 17:22:06.567978311 -0500
      Cambio: 2023-10-20 16:46:06.676663910 -0500
    Creación: 2023-10-20 16:46:06.676663910 -0500
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title></title>
</head>
<body>
	<ul>
		<?php foreach($data as $user): ?>
		<li><a href="/user/show/<?= $user["id"] ?>"><?= $user["email"] ?></a></li>
		<?php endforeach; ?>
	</ul>
</form>
</body>
</html>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/40/cf13e2e9105df27d498d6be62b4c67bbabfdd1
  Tamaño: 115       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293756    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.202925835 -0500
Modificación: 2023-06-24 08:01:49.923126170 -0500
      Cambio: 2023-10-20 16:46:06.676663910 -0500
    Creación: 2023-10-20 16:46:06.676663910 -0500
100644 blob 97b1828d19670ca13dd69f3270dd0eac7ec6fe5b	create.php
100644 blob cf08f28d8f82235f4e9a7f4bff674b0fd4cc38cb	index.php
100644 blob 81eba4d7f8df8a34e72c4aa34ef10adaa1243a24	show.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/41/f0b8abe193d55fd96162fac82d261582034c0a
  Tamaño: 2132      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293637    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.146259948 -0500
Modificación: 2023-10-07 13:37:49.776257082 -0500
      Cambio: 2023-10-20 16:46:06.623331983 -0500
    Creación: 2023-10-20 16:46:06.623331983 -0500
<?php 
class Model{
	public $db;
	public $data;
	private $process_data;

	public function __construct($second_database = FALSE){
		$this->db=Connection::connect($second_database);
	}

	/* permite ejecutar consultas sql customizadas a cada modelo */
	/* 	retorna la informacion consultada o registrada */
	public function getCustom($sql,$param=0){
		$this->execute($sql,$this->table,$param);
		return $this->data;
	}

	/* toma todos los usuarios de la base de datos */
	/* 	retorna un lista con usuarios */
	/* puede recibir un array de nobres de tablas para generar una relacion de uno a muchos */
	public function getAll(){
		/* relacion de tablas */
		$sql = "SELECT *,$this->table.id as id_master FROM $this->table ";
		if(count($this->one_to_one)<>0){
			foreach($this->one_to_one as $join){
				$column = substr($join,0,-1) . "_id";
				$sql = $sql . "INNER JOIN $join ON $this->table.$column=$join.id ";
			}
		}
		/* ejecucion de query */
		$this->execute($sql,$this->table);
		return $this->data;
	}

	/* toma un usuario por id de la base de datos */
	/* 	retorna una lista con el usuario */
	public function selectById($id){
		$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
		//RELACION 1 A 1
		if(count($this->one_to_one)<>0){
			foreach($this->one_to_one as $join){
				$column = substr($join,0,-1) . "_id";
				$sql = $sql . "INNER JOIN $join ON $this->table.$column=$join.id ";
			}
		}
		$sql = $sql . "WHERE $this->table.id=:id";
		$this->execute($sql,$this->table,$id);
		//RELACION 1 A MUCHOS
		if(count($this->one_to_much)<>0){
			$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
			foreach(array_keys($this->one_to_much) as $join){
				$relation= $this->one_to_much[$join];//QUALIFIERS;
				$column_2 = substr($join,0,-1) . "_id"; //KRI_ID;
				$sql = $sql . "INNER JOIN $relation ON $join.id=$relation.$column_2 ";
				$sql = $sql . "WHERE $this->table.id=:id";
				$this->data["sql"]=$sql;
				$this->execute($sql,$relation,$id);
				$sql = str_replace("WHERE $this->table.id=:id","",$sql);
			}
		}
		//RELACION MUCHOS A MUCHOS
		if(count($this->much_to_much)<>0){
			$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
			foreach(array_keys($this->much_to_much) as $join){
				$relation= substr($this->much_to_much[$join],0,-1);
				$table_relation = substr($join,0,-1) . "_" . $relation;
				$column_1 = $relation . "_id";
				$column_2 = substr($join,0,-1) . "_id";
				$join_table = $this->much_to_much[$join];
				$sql = $sql . "INNER JOIN $table_relation ON $join.id=$table_relation.$column_2 ";
				$sql = $sql . "INNER JOIN $join_table ON $table_relation.$column_1=$join_table.id ";
				$sql = $sql . "WHERE $this->table.id=:id";
				$this->execute($sql,$join_table,$id);
			}
		}
		return $this->data;
	}

	/* inserta un registro a la base de datos con sus respectivas relaciones */
	/* 	retorna el id del elemento registrado */
	public function insert(){
		try{
			if(!$this->db->inTransaction()){
				$this->db->beginTransaction();
			}
			$columns = implode(",",$this->columns);
			$args = implode(",",$this->args);
			$sql = "INSERT INTO $this->table($columns) values($args)";
			$state = $this->db->prepare($sql);
			$this->setParams($state);
			$state->execute();
			$id = $this->db->lastInsertId();
			if(count($this->much_to_much)>0){
				foreach(array_keys($this->much_to_much) as $join){
					$relation= substr($this->much_to_much[$join],0,-1);//event
					$table_relation = substr($join,0,-1) . "_" . $relation;//kri_event
					$column_2 = substr($join,0,-1) . "_id";//kri_id
					$column_1 = $relation . "_id";//event_id
					$sql = "INSERT INTO $table_relation($column_1,$column_2) VALUES(:$column_1,:$column_2)";
					for($i=0;$i< count($_POST[$relation]);$i++){
						$state = $this->db->prepare($sql);
						$state->bindParam(":$column_1",$_POST[$relation][$i]);
						$state->bindParam(":$column_2",$id);
						$state->execute();
					}
				}

			}
			return $id;
		}catch(PDOException $e){
			echo $e->getMessage();
			$this->db->rollBack();
		}
	}

	/* modifica un elemento en la base de datos */
	/* 	retorna el ultimo in elemento de la tabla */
	public function update(){
		try{
			if(!$this->db->inTransaction()){
				$this->db->beginTransaction();
			}
			$prepare_sql = "";
			for($i=0;$i < count($this->args);$i++){
				if((count($this->args)-1)==$i){
					$prepare_sql = $prepare_sql . $this->columns[$i] . "=" . $this->args[$i];
				}else{
					$prepare_sql = $prepare_sql . $this->columns[$i] . "=" . $this->args[$i] . ",";
				}
			}
			$sql = "UPDATE $this->table set $prepare_sql WHERE id=:id";
			$state = $this->db->prepare($sql);
			$this->setParams($state);
			$state->bindParam(":id",$this->id);
			$state->execute();
			return $this->db->lastInsertId();
		}catch(PDOException $e){
			$this->db->rollBack();
		}
	}

	/* borra un elemento de la base de datos */
	/* 	no retorna informacion */
	public function delete($id){
		try{
			if(!$this->db->inTransaction()){
				$this->db->beginTransaction();
			}
			$sql = "DELETE FROM $this->table WHERE id=:id";
			$state = $this->db->prepare($sql);
			$state->bindParam(":id",$id);
			$state->execute();
		}catch(PDOException $e){
			$this->db->rollBack();
		}
	}

	/* busca elementos en la base de datos */
	/* 	retorna un array con los elementos encontrados */
	public function search($search){
		$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
		if(count($this->one_to_one)<>0){
			foreach($this->one_to_one as $join){
				$column = substr($join,0,-1) . "_id";
				$sql = $sql . "INNER JOIN $join ON $this->table.$column=$join.id ";
			}
		}
		$column = substr($this->table,0,-1);
		$sql=$sql . " WHERE $column LIKE '%$search%'";
		$this->execute($sql,$this->table);
		return $this->data;
	}

	/* escribe los cambios en la base de datos si el dml esta en una transaccion */
	/* 	no retorna informacion pero termina la transaccion actual */
	public function saveChanges(){
		$this->db->commit();
	}

	/* establece las variables de las consultas preparadas */
	/* 	no retorna informacion pero deja la consulta preparada lista para su ejecucion */
	private function setParams($state){
		for($i=0;$i < count($this->args);$i++){
			if($this->args[$i]==":password"){
				$password = password_hash($this->password,PASSWORD_BCRYPT);
				$state->bindParam($this->args[$i],$password);
			}else{
				$state->bindParam($this->args[$i],$this->{$this->columns[$i]});
			}
		}
	}

	/* ejecuta la consulta preparada */
	/* modifica la variable data adjuntando la informacion en esta variable */
	public function execute($sql,$key,$id=0){
		$state = $this->db->prepare($sql);
		if($id<>0){
			$state->bindParam(":id",$id);
		}
		if($state->execute()){
			while($row=$state->fetch(PDO::FETCH_ASSOC)){
				$this->process_data[]=$row;
			}
			$this->data[$key]=$this->process_data;
			$this->process_data=[];
		}
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/42/a5b042b534855b510393d47c6c21950a941734
  Tamaño: 437       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293467    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.056261189 -0500
Modificación: 2023-10-15 17:00:52.009323610 -0500
      Cambio: 2023-10-20 16:46:06.546667337 -0500
    Creación: 2023-10-20 16:46:06.546667337 -0500
100644 blob 46141854b6c4aac2047018836b3340f5f62dd0c2	.htaccess
100644 blob da437ed708de7ea2d1ed5bb37dc51d00740740f6	Dockerfile
040000 tree dd6218d45158d9a2b0981c704e5c5c0d3130c418	assets
040000 tree ee84c1fda671963354e74a972bfc478930dd45c8	components
100644 blob 886fe19262e1dcc9bc5827b9b360744e6fe4cf58	config.php
040000 tree 54f14b2926b0bdda1c5a57eee29d52801f0fc298	controllers
100644 blob 8dadb53d86e692a9145d4db33bc19d31c3303116	data.sql
100644 blob 82c1b06cf8655c3159204f46dafb691aa3fe03c0	database.php
100644 blob 27dae4899dda3ef6df80d4bdc4ec9c52248ccb59	index.php
040000 tree 885e839812b7a9084d0c50a98a9b4c0bca55c233	models
100644 blob d9a4ec66dfeb45d52c58647f352aaaae6b84cd28	router.php
100644 blob b82cea160f9cfcea3268f5371dbfc4fff71c4b97	seeder.sql
040000 tree d3e13d48b66ef96b3ec7c46c90db83f1014dd3e6	views
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/43/af1793a772d21ede6991f1e3e9894f097f9f89
  Tamaño: 2377      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293504    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.082927488 -0500
Modificación: 2023-10-16 16:47:24.003166532 -0500
      Cambio: 2023-10-20 16:46:06.563333564 -0500
    Creación: 2023-10-20 16:46:06.563333564 -0500
<?php  
include_once("components/header.php");
?>
<div class="container">
	
	<!-- ----------------------------------- -->
	<div class="card">
		<form action="/risk/update" method="POST" class="needs-validation">
			<?php foreach($data["risks"] as $risk): ?>
			<div class="row">
				<div class="col-xl-4 col-lg-6 mb-4">
					<div class="bg-white rounded-lg p-5 shadow">
						<h2 class="h6 font-weight-bold text-center mb-4">Valoración del Riesgo</h2>
						<!-- Progress bar 1 -->
						<div class="progress" role="progressbar" aria-label="Example with label" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">
							<div class="progress-bar" style="width: 25%">Bajo</div>
						</div>
						<!-- END -->

						<!-- Demo info -->
						<div class="row text-center mt-4">
							<div class="col-6 border-right">
								<div class="h4 font-weight-bold mb-0"><?= $data['score'] ?> P.</div><span class="small text-gray">Puntaje calculado</span>
							</div>
							<div class="col-6">
								<div class="h4 font-weight-bold mb-0"><?= $data["score_qualified"]["value"] ?></div><span class="small text-gray"><?= $data["score_qualified"]["type"] ?></span>
							</div>
						</div>
						<!-- END -->
					</div>
				</div>
				<div class="col-xl-8 col-lg-8 mb-8">
					<div class="bg-white rounded-lg p-5 shadow">
						<h2 class="h6 font-weight-bold text-center mb-4">Mapa relacional</h2>
						<div class="row align-items-center my-2">
							<div class="col-4">
								<button class="btn btn-outline-dark btn-sm form-control">
									<?= $risk["risk"] ?>
								</button>
							</div>
							<div class="col-4">
								<?php  foreach($data["kris"] as $kri): ?>
								<button class="btn btn-outline-dark btn-sm form-control my-2" data-bs-toggle="popover" data-bs-title="Descripcion del evento" data-bs-content="">
									<?= $kri["kri"]?>
								</button>
								<?php  endforeach; ?>
							</div>
							<div class="col-4">
								<?php  foreach($data["events"] as $event): ?>
								<button class="btn btn-outline-dark btn-sm form-control my-2" data-bs-toggle="popover" data-bs-title="Descripcion del evento" data-bs-content="">
									<?= $event["event"]?>
								</button>
								<?php  endforeach; ?>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- PRIMERA FILA -->
			<div class="card-header">
				<h5><b><?=$risk['master_id']?> | </b><?=$risk['risk']?></h5>
			</div>
			<div class="card-body">
				<!-- KRI -->
				<div class="form-floating mb-3">
					<input type="text" value="<?= $risk['risk'] ?>" required class="form-control" name="risk" id="floatingInput" placeholder="Insegra un nombre">
					<label for="floatingInput">Nombre del riesgo</label>
				</div>
				<div class="row">
					<div class="col-6">
						<!-- PROPIEDAD -->
						<div class="form-floating mb-3">
							<select name="propertie_id" class="form-select" id="datalistOptions" aria-label="">
								<option value="<?= $risk['propertie_id'] ?>" selected><?= $risk['propertie']?></option>
							</select>
							<label for="floatingSelect">Propiedad</label>
						</div>
					</div>
					<div class="col-6">
						<!-- TIPO -->
						<div class="form-floating mb-3">
							<select name="propertie_id" class="form-select" id="datalistOptions" aria-label="">
								<option value="<?= $risk['type_id'] ?>" selected><?= $risk['type']?></option>
							</select>
							<label for="floatingSelect">Tipo</label>
						</div>
					</div>
				</div>
				<div class="accordion accordion-flush" id="accordionFlushExample">
					<!-- KRI -->
					<div class="accordion-item">
						<h2 class="accordion-header">
							<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#event-collapse" aria-expanded="false" aria-controls="flush-collapseOne">
								KRIs	
							</button>
						</h2>
						<div id="event-collapse" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
							<div class="my-2">
								<button name="events" type="button" class="form-control btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addKri">
									Añadir KRI
								</button>
								<div class="form-check" id="kris"> 
									<?php  foreach($data["kris"] as $kri): ?>
									<div>
										<input type="checkbox" name="kri[]" value="<?= $kri['id'] ?>" class="btn-check" id="<?= $kri['kri'] ?>" autocomplete="off" checked>
										<label class="btn btn-sm btn-outline-danger my-2 form-control" for="<?= $kri['kri'] ?>"><?= $kri['kri'] ?> <span class="badge bg-secondary"><?= $kri['percentage'] ?>%</span></label>
									</div>
									<?php  endforeach; ?>
								</div>
							</div>
						</div>
					</div>
					<?php  endforeach; ?>
				</div>
				<div class="card-footer">
					<!-- END FIELD -->
					<div class="row">
						<div class="col-6">
							<button type="reset" class="btn btn-outline-secondary form-control">Limpiar</button>
						</div>
						<div class="col-6">
							<button type="submit" class="btn btn-primary form-control">Actualizar</button>
						</div>
					</div>
		</form>
				</div>
			</div>
			<!-- FORMULARIO DE ADICION DE KRIS -->
			<div class="modal fade" id="addKri" tabindex="-1" aria-labelledby="addKriLabel" aria-hidden="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h1 class="modal-title fs-5" id="addKriLabel">Buscar Evento</h1>
							<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
						</div>
						<div class="modal-body">
							<div class="form-floating mb-3">
								<input type="text" required class="form-control" id="searchKRI" placeholder="Insegra un nombre">
								<label for="floatingInput">Buscar evento</label>
							</div>
							<div class="justify-content-center" id="datalistOptionsKRI">
							</div>
						</div>
					</div>
				</div>
			</div>
	</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
<script src="/assets/js/search.js"></script>
<script>
	function customFunction(e){
		console.log(e)
		kris = document.getElementById("kris")
		html = kris.innerHTML
		html += "<div><input name='kri[]' value='"+e.id+"' type='checkbox' class='btn-check' id='"+e.kri+"' autocomplete='off' checked><label class='btn btn-sm btn-outline-danger my-2 form-control' for='"+e.kri+"'>"+e.kri+" <span class='badge bg-secondary'>"+e.percentage+"%</span></label></div>"
		kris.innerHTML = html
		modal = document.getElementById("addKri")
		modal.hide()
	}
	//EVENTOS
	searchEvent({
		componentEvent: "searchKRI",
		listOptions: "datalistOptionsKRI",
		search: "kri",
		components: new Map([
			["id","master_id"],
			["kri","kri"],
			["percentage","percentage"]
		]),
		value: "kri",
		table: "kris",
		tag: "button",
		customFunction: "customFunction",
		class: "btn btn-outline-primary form-control m-2' data-bs-dismiss='modal",
	})
</script>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/43/b66da7c98ec0406611ebd66751eba7be411194
  Tamaño: 173       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293505    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.082927488 -0500
Modificación: 2023-10-08 19:55:08.167278357 -0500
      Cambio: 2023-10-20 16:46:06.566666810 -0500
    Creación: 2023-10-20 16:46:06.566666810 -0500
<?php
require_once("models/EventModel.php");
class EventController extends Controller{

	public $autosave = true;

	public function __construct(){
		parent::__construct();
		$this->model = new EventModel();
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/45/1577bd049f836b07b10907d0cd862efcd8dbb2
  Tamaño: 432       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293973    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.386256641 -0500
Modificación: 2023-10-14 17:45:42.395851391 -0500
      Cambio: 2023-10-20 16:46:06.799993993 -0500
    Creación: 2023-10-20 16:46:06.799993993 -0500
<?php 
class QualifierModel extends Model{
	protected $table = "qualifiers";
	protected $columns = ["type","value","kri_id"];
	protected $args= [":type",":value",":kri_id"];

	public function __construct(){
		parent::__construct();
	}

	public function getQualifierScore($kri_id,$score){
		$sql = "SELECT * FROM $this->table WHERE kri_id=$kri_id AND value >=$score ORDER BY value LIMIT 1";
	 	$this->getCustom($sql,"score_qualified");
		$type = ($this->data["qualifiers"][0]["type"]);
		$value = ($this->data["qualifiers"][0]["value"]);
		return ["type"=>$type,"value"=>$value];
	}

	public function insertQualifiers($id,$db){
		$this->db = $db;
		$this->kri_id=$id;
		for($i=0;$i < count($_POST["qualifiers"]);$i++){
			$this->type=$_POST["qualifiers"][$i];
			$this->value=$_POST["qualifiers_values"][$i];
			$this->insert();
		}
	}

}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/45/31288b596791d10f2177fa8493cf79bb86123c
  Tamaño: 360       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293972    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.386256641 -0500
Modificación: 2023-10-16 17:33:29.678925368 -0500
      Cambio: 2023-10-20 16:46:06.799993993 -0500
    Creación: 2023-10-20 16:46:06.796660748 -0500
100644 blob f5fbcc6ec8eff868d90ec3a3664548402436f1e5	Controller.php
100644 blob 43b66da7c98ec0406611ebd66751eba7be411194	EventController.php
100644 blob 8fadc7a627eea16c36528f45d360b17d0cee6b5e	KriController.php
100644 blob ab88d0b50b2f02ca6a63488e849280128184eafb	LoginController.php
100644 blob 56b41c3c0b81d3e213654e2b64a9e8e43e0c8b30	PropertieController.php
100644 blob 12620ce4178e3b649067d4a02a366ef83bb8d47e	RegisterController.php
100644 blob 49aedabe24402bb06934d43ae75a8bfd21e9a880	RiskController.php
100644 blob 8c1bb57955e07f847b2b8e617e4db6218f8ced28	SourceController.php
100644 blob 07a9d2abeb523436c2863c3129e2c4f1fd26c654	TemplateController.php
100644 blob 9948526e371ec84f39ad45662721203603f6abf6	TypeController.php
100644 blob fb02603f5e1e778c1b626de544c3f0834532d3e1	UserController.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/45/84348f8f2f92259a422852c81040f3a76b8a76
  Tamaño: 54        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293971    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.386256641 -0500
Modificación: 2023-10-07 12:37:25.673820562 -0500
      Cambio: 2023-10-20 16:46:06.793327503 -0500
    Creación: 2023-10-20 16:46:06.793327503 -0500
100644 blob 1597f2dc1f4c9ab76dff55722a3b37bd24fe643c	search.js
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/46/141854b6c4aac2047018836b3340f5f62dd0c2
  Tamaño: 152       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293669    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.162926385 -0500
Modificación: 2023-04-06 11:42:20.629384035 -0500
      Cambio: 2023-10-20 16:46:06.636664965 -0500
    Creación: 2023-10-20 16:46:06.636664965 -0500
RewriteEngine On
# RewriteRule ^([a-z]+)\/?([a-z]*)\/?([0-9]*)$ router.php?controller=$1&action=$2&id=$3
# RewriteRule ^([a-z]+)\/?([a-z]*)\/?([0-9]*)\/?([a-z]*)$ router.php?controller=$1&action=$2&id=$3&search=$4
#RewriteRule ^([a-z]+)\/?([a-z]*)\/?([0-9]*)\/?([a-zA-Z0-9_-]*)$ router.php?controller=$1&action=$2&id=$3&search=$4
RewriteRule ^([a-z]+)\/?([a-z]*)\/?([a-zA-Z0-9_-]*)$ router.php?controller=$1&action=$2&id=$3
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/46/dfb9c57e8457a46bcf674b8b4097ac91049470
  Tamaño: 3897      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293668    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.159593098 -0500
Modificación: 2023-10-17 15:55:29.946538714 -0500
      Cambio: 2023-10-20 16:46:06.636664965 -0500
    Creación: 2023-10-20 16:46:06.636664965 -0500
-- MySQL dump 10.13  Distrib 5.7.41, for Linux (x86_64)
--
-- Host: localhost    Database: csra
-- ------------------------------------------------------
-- Server version	5.7.41

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

--
-- Table structure for table `events`
--

DROP TABLE IF EXISTS `events`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `events` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `event` varchar(255) DEFAULT NULL,
  `type` enum('automatic','manual') DEFAULT NULL,
  `source_id` int(11) DEFAULT NULL,
  `event_id` int(11) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=30 DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `events`
--

LOCK TABLES `events` WRITE;
/*!40000 ALTER TABLE `events` DISABLE KEYS */;
INSERT INTO `events` VALUES (1,'Escaneo de puertos','automatic',NULL,NULL,'2023-03-30 18:07:33'),(2,'Inundacin de paquetes (synFlood)','automatic',NULL,NULL,'2023-03-30 18:07:33'),(3,'Ataque de fuerza bruta','automatic',NULL,NULL,'2023-03-30 18:07:33'),(4,'Deteccin de malware en estacin de trabajo','automatic',NULL,NULL,'2023-03-30 18:07:33'),(5,'Deteccin de trfico malicioso','automatic',NULL,NULL,'2023-03-30 18:07:33'),(6,'PUA detectada','automatic',NULL,NULL,'2023-03-30 18:07:33'),(7,'PUA limpiada','automatic',NULL,NULL,'2023-03-30 18:07:33'),(8,'Proteccin en tiempo real desactivado','automatic',NULL,NULL,'2023-03-30 18:07:33'),(9,'Deteccin de datos personales','automatic',NULL,NULL,'2023-03-30 18:07:33'),(10,'Correos a buzones personales con informacin restringida','automatic',NULL,NULL,'2023-03-30 18:07:33'),(11,'Compartir informacin restringida en onedrive con usuarios externos','automatic',NULL,NULL,'2023-03-30 18:07:33'),(12,'Deteccin de archivos malilciosos - malware','automatic',NULL,NULL,'2023-03-30 18:07:33'),(13,'Privilegios especiales asignados al nuevo inicio de sesin','automatic',NULL,NULL,'2023-03-30 18:07:33'),(14,'Creacin o desactivacin de usuarios fuera de horario laboral','automatic',NULL,NULL,'2023-03-30 18:07:33'),(15,'Vulnerabilidades detectadas','automatic',NULL,NULL,'2023-03-30 18:07:33'),(16,'Prdida/robo de porttiles','automatic',NULL,NULL,'2023-03-30 18:07:34'),(19,'Malware encontrado','automatic',1861,5,'2023-04-05 10:50:56'),(20,'Display bloqueado','automatic',1738,3,'2023-04-06 12:43:32'),(24,'TEST','automatic',121,1212,'2023-04-17 10:48:05'),(27,'test4','automatic',121,1212,'2023-05-13 18:40:43'),(28,'Test1','automatic',123,123,'2023-10-07 17:27:53'),(29,'Test2','automatic',321,321,'2023-10-07 17:28:10');
/*!40000 ALTER TABLE `events` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `kri_event`
--

DROP TABLE IF EXISTS `kri_event`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `kri_event` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `kri_id` int(11) DEFAULT NULL,
  `event_id` int(11) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=19 DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `kri_event`
--

LOCK TABLES `kri_event` WRITE;
/*!40000 ALTER TABLE `kri_event` DISABLE KEYS */;
INSERT INTO `kri_event` VALUES (10,6,9,'2023-05-14 13:11:41'),(11,6,12,'2023-05-14 13:11:41'),(14,7,28,'2023-10-07 18:04:36'),(15,7,29,'2023-10-07 18:04:36'),(16,8,1,'2023-10-15 20:29:47'),(17,8,28,'2023-10-15 20:29:47'),(18,9,1,'2023-10-16 23:11:24');
/*!40000 ALTER TABLE `kri_event` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `kris`
--

DROP TABLE IF EXISTS `kris`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `kris` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `kri` varchar(255) DEFAULT NULL,
  `objective` varchar(255) DEFAULT NULL,
  `propertie_id` int(11) DEFAULT NULL,
  `percentage` int(3) DEFAULT NULL,
  `syntax` varchar(255) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=10 DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `kris`
--

LOCK TABLES `kris` WRITE;
/*!40000 ALTER TABLE `kris` DISABLE KEYS */;
INSERT INTO `kris` VALUES (6,'Deteccion de archivos','Detectar archivos maliciosos y compararlos con los archivos privados de los usuarios de sophos',2,20,'9-12','2023-05-14 13:11:41'),(7,'Kri Test Vulnerabilidad Calculada','Determinar logica necesaria para calculo de kris a partir de la ecuacion dada por el usuario',1,20,'28+29','2023-10-07 17:33:48'),(8,' 	Kri Test Vulnerabilidad Calculada 2','Determinar logica necesaria para calculo de kris a partir de la ecuacion dada por el usuario',1,80,'28-1','2023-10-15 20:29:47'),(9,'Sophos 3','Quieres que te guise un chicharron',1,20,'1','2023-10-16 23:11:24');
/*!40000 ALTER TABLE `kris` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `master_qualifier`
--

DROP TABLE IF EXISTS `master_qualifier`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `master_qualifier` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `high` int(11) DEFAULT NULL,
  `medium` int(11) DEFAULT NULL,
  `low` int(11) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `master_qualifier`
--

LOCK TABLES `master_qualifier` WRITE;
/*!40000 ALTER TABLE `master_qualifier` DISABLE KEYS */;
/*!40000 ALTER TABLE `master_qualifier` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `properties`
--

DROP TABLE IF EXISTS `properties`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `properties` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `propertie` varchar(255) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `properties`
--

LOCK TABLES `properties` WRITE;
/*!40000 ALTER TABLE `properties` DISABLE KEYS */;
INSERT INTO `properties` VALUES (1,'confidencialidad','2023-03-28 21:29:32'),(2,'disponibilidad','2023-03-28 21:29:32'),(3,'integridad','2023-03-28 21:29:32');
/*!40000 ALTER TABLE `properties` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `qualifiers`
--

DROP TABLE IF EXISTS `qualifiers`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `qualifiers` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `type` varchar(255) DEFAULT NULL,
  `value` int(11) DEFAULT NULL,
  `kri_id` int(11) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=24 DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `qualifiers`
--

LOCK TABLES `qualifiers` WRITE;
/*!40000 ALTER TABLE `qualifiers` DISABLE KEYS */;
INSERT INTO `qualifiers` VALUES (11,'Bajo',1,6,'2023-05-14 13:11:41'),(12,'Medio',3,6,'2023-05-14 13:11:41'),(13,'Alto',5,6,'2023-05-14 13:11:41'),(14,'Extremo',7,6,'2023-05-14 13:11:41'),(15,'Alto',50,7,'2023-10-07 17:33:48'),(16,'Medio',12,7,'2023-10-07 17:33:48'),(17,'Bajo',5,7,'2023-10-07 17:33:48'),(18,'Bajo',5,8,'2023-10-15 20:29:47'),(19,'Medio',4,8,'2023-10-15 20:29:47'),(20,'Alto',10,8,'2023-10-15 20:29:47'),(21,'Alto',50,9,'2023-10-16 23:11:24'),(22,'Media',20,9,'2023-10-16 23:11:24'),(23,'Bajo',5,9,'2023-10-16 23:11:24');
/*!40000 ALTER TABLE `qualifiers` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `records`
--

DROP TABLE IF EXISTS `records`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `records` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `source_id` int(11) DEFAULT NULL,
  `event_id` int(11) DEFAULT NULL,
  `reported_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=38 DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `records`
--

LOCK TABLES `records` WRITE;
/*!40000 ALTER TABLE `records` DISABLE KEYS */;
INSERT INTO `records` VALUES (1,1861,5,'2023-01-21 12:00:00','2023-05-14 14:38:08'),(2,1861,5,'2023-01-21 12:00:00','2023-05-14 14:42:31'),(3,1738,3,'2023-01-23 13:00:00','2023-05-14 14:42:31'),(4,1861,5,'2023-01-21 12:00:00','2023-05-14 14:42:34'),(5,1738,3,'2023-01-23 13:00:00','2023-05-14 14:42:34'),(6,1861,5,'2023-01-21 12:00:00','2023-05-14 14:42:35'),(7,1738,3,'2023-01-23 13:00:00','2023-05-14 14:42:35'),(8,1861,5,'2023-01-21 12:00:00','2023-05-14 14:42:36'),(9,1738,3,'2023-01-23 13:00:00','2023-05-14 14:42:36'),(10,1861,5,'2023-01-21 12:00:00','2023-05-14 14:42:44'),(11,121,1212,'2023-01-21 12:00:00','2023-05-14 14:43:24'),(12,121,1212,'2023-01-21 12:00:00','2023-05-14 14:43:25'),(13,121,1212,'2023-01-21 12:00:00','2023-05-14 14:43:26'),(14,121,1212,'2023-01-21 12:00:00','2023-05-14 14:43:26'),(15,121,1212,'2023-01-21 12:00:00','2023-05-14 14:43:27'),(16,56456,46,'2023-01-21 12:00:00','2023-05-14 14:43:46'),(17,56456,46,'2023-01-21 12:00:00','2023-05-14 14:43:47'),(18,56456,46,'2023-01-21 12:00:00','2023-05-14 14:43:47'),(19,56456,46,'2023-01-21 12:00:00','2023-05-14 14:43:48'),(20,56456,46,'2023-01-21 12:00:00','2023-05-14 14:43:48'),(21,56456,466,'2023-01-21 12:00:00','2023-05-14 14:45:50'),(22,123,123,'2023-10-08 00:00:00','2023-10-07 17:31:17'),(23,123,123,'2023-10-08 00:00:00','2023-10-07 17:31:22'),(24,123,123,'2023-10-08 00:00:00','2023-10-07 17:31:32'),(25,123,123,'2023-10-08 00:00:00','2023-10-07 17:31:33'),(26,321,321,'2023-10-08 00:00:00','2023-10-07 17:31:50'),(27,321,321,'2023-10-08 00:00:00','2023-10-07 17:31:51'),(28,321,321,'2023-10-08 00:00:00','2023-10-07 17:31:51'),(29,321,321,'2023-10-08 00:00:00','2023-10-07 17:31:52'),(30,321,321,'2023-10-08 00:00:00','2023-10-07 17:31:52'),(31,321,321,'2023-10-08 00:00:00','2023-10-07 17:31:53'),(32,321,321,'2023-10-08 00:00:00','2023-10-07 17:31:53'),(33,321,321,'2023-10-08 00:00:00','2023-10-07 17:31:54'),(34,321,321,'2023-10-08 00:00:00','2023-10-07 17:31:54'),(35,321,321,'2023-10-08 00:00:00','2023-10-07 17:31:55'),(36,321,321,'2023-10-08 00:00:00','2023-10-07 17:31:55'),(37,321,321,'2023-10-08 00:00:00','2023-10-07 17:31:56');
/*!40000 ALTER TABLE `records` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `risk_kri`
--

DROP TABLE IF EXISTS `risk_kri`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `risk_kri` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `risk_id` int(11) DEFAULT NULL,
  `kri_id` int(11) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=7 DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `risk_kri`
--

LOCK TABLES `risk_kri` WRITE;
/*!40000 ALTER TABLE `risk_kri` DISABLE KEYS */;
INSERT INTO `risk_kri` VALUES (1,1,7,'2023-03-30 19:34:49'),(2,1,6,'2023-03-30 19:34:49'),(5,25,7,'2023-10-15 22:18:28'),(6,25,8,'2023-10-15 22:18:28');
/*!40000 ALTER TABLE `risk_kri` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `risks`
--

DROP TABLE IF EXISTS `risks`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `risks` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `type_id` int(11) DEFAULT NULL,
  `propertie_id` int(11) DEFAULT NULL,
  `risk` varchar(255) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=26 DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `risks`
--

LOCK TABLES `risks` WRITE;
/*!40000 ALTER TABLE `risks` DISABLE KEYS */;
INSERT INTO `risks` VALUES (1,3,3,'Prdida financiera causada por Acceso no autorizado','2023-03-30 18:06:22'),(2,3,2,'Sancin legal causada por Fuga de informacin malintencionada','2023-03-30 18:06:22'),(3,3,3,'Prdida financiera causada por Fuga de informacin por error involuntario','2023-03-30 18:06:22'),(4,2,1,'Prdida operativa causada por Ingeniera social/Spear Phising, Cryptojacking/Cryptomining, Cloud-Jacking, Ramsonware, Cyber espionaje, IoT, Hacktivism, Crimen organizado, Fearware, Coordinated attack, Cyber warfare','2023-03-30 18:06:22'),(5,4,1,'Prdida operativa causada por Ataque Fuerza bruta, Desbordamiento buffer, XSS, MiM, Spoof, Inyeccion SQL','2023-03-30 18:06:22'),(6,4,1,'Perdida de capacidad tecnolgica causada por Suplantacin de identidad','2023-03-30 18:06:22'),(7,5,1,'Perdida de capacidad tecnolgica causada por Abuso o elevacin de privilegios','2023-03-30 18:06:22'),(8,5,3,'Prdida financiera causada por Modificacin de la informacin por error involuntario','2023-03-30 18:06:22'),(9,1,3,'Sancin legal causada por Modificacin de la informacin malintencionada','2023-03-30 18:06:22'),(10,4,2,'Prdida financiera causada por Robo','2023-03-30 18:06:22'),(11,2,1,'Prdida operativa causada por Ataque informtico (Malware, APT, BackDoor, DoS)','2023-03-30 18:06:22'),(12,3,2,'Prdida operativa causada por Corte o fallas en el suministro elctrico','2023-03-30 18:06:22'),(13,4,1,'Prdida operativa causada por Dao por agua, humedad o lquidos','2023-03-30 18:06:22'),(14,3,2,'Perdida de capacidad tecnolgica causada por Denegacin de servicio malintencionado','2023-03-30 18:06:22'),(15,2,2,'Perdida de capacidad tecnolgica causada por Denegacin de servicio por error involuntario','2023-03-30 18:06:22'),(16,2,3,'Prdida operativa causada por Descarga elctrica','2023-03-30 18:06:22'),(17,3,2,'Prdida estratgica causada por Destruccin de la informacin por error involuntario','2023-03-30 18:06:22'),(18,2,2,'Prdida financiera causada por Destruccin o eliminacin de la informacin malintencionada','2023-03-30 18:06:22'),(19,4,2,'Prdida financiera causada por Fuego','2023-03-30 18:06:22'),(20,3,1,'Prdida operativa causada por Interferencia electromagntica','2023-03-30 18:06:22'),(21,3,3,'Prdida operativa causada por Paro','2023-03-30 18:06:23'),(22,2,1,'Prdida operativa causada por Pandemias (Covid-19, emergentes)','2023-03-30 18:06:23'),(23,4,1,'Prdida operativa causada por Terremoto','2023-03-30 18:06:24'),(25,1,1,'Perdida Legal Test','2023-10-15 22:18:28');
/*!40000 ALTER TABLE `risks` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `sources`
--

DROP TABLE IF EXISTS `sources`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `sources` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `source` varchar(255) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `sources`
--

LOCK TABLES `sources` WRITE;
/*!40000 ALTER TABLE `sources` DISABLE KEYS */;
/*!40000 ALTER TABLE `sources` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `types`
--

DROP TABLE IF EXISTS `types`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `types` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `type` varchar(255) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `types`
--

LOCK TABLES `types` WRITE;
/*!40000 ALTER TABLE `types` DISABLE KEYS */;
INSERT INTO `types` VALUES (1,'estrategico','2023-03-28 22:02:20'),(2,'financiero','2023-03-28 22:02:20'),(3,'legal','2023-03-28 22:02:20'),(4,'operacional','2023-03-30 17:27:18'),(5,'tecnologico','2023-03-30 17:27:18');
/*!40000 ALTER TABLE `types` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `users`
--

DROP TABLE IF EXISTS `users`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `users` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(255) DEFAULT NULL,
  `email` varchar(255) DEFAULT NULL,
  `password` varchar(255) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `users`
--

LOCK TABLES `users` WRITE;
/*!40000 ALTER TABLE `users` DISABLE KEYS */;
INSERT INTO `users` VALUES (1,'DragonyteEvol','acuarionevol@outlook.com','$2y$10$Ws65FRcPjyK6eSI0bDcPIurUe.QlzLG6zctOAuwIzXBcsWI./7GSq','2023-03-26 10:26:18');
/*!40000 ALTER TABLE `users` ENABLE KEYS */;
UNLOCK TABLES;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;

-- Dump completed on 2023-10-17 17:07:18
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/47/ffcc953f9139a5dc77e07e0409298e6bfbdc1d
  Tamaño: 1053      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293601    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.129593511 -0500
Modificación: 2023-05-14 07:33:53.962039781 -0500
      Cambio: 2023-10-20 16:46:06.606665755 -0500
    Creación: 2023-10-20 16:46:06.606665755 -0500
// crea los eventos necesarios para una busqueda y sus consecuencias
// recibe como parametro de entra un json con la configuracion de la busqueda

// componenetEvent = El componente que recibira los eventos de cambio y keyup
// listOptions = la lista de opciones que se modificara cuando el servidor arroge respuesta
// searh = el nombre del modelo sin "controller" sobre el cual se realizara la busqueda
// componnets = el arreglo de componenetes que se quiere modificar cuando el evento arroje respuesta
// value = el valor que se quiere representar en la opcion de listOptions
	// EJEMPLO
// ({
// componentEvent: "template",
// 	listOptions: "datalistOptions",
// 	search: "template",
// 	components: new Map([
// 		["source_id","plugin_id"],
// 		["source","vendor"],
// 		["event_id","sid"]
// 	]),
// 	value: "name",
// 	table: "plugin_sid"
// })
function searchEvent(args){
	// Tomar los elementos pricipales de la busqueda
	var componentEvent = document.getElementById(args.componentEvent)
	var options = document.getElementById(args.listOptions)
	if(componentEvent==null){
		axios_get(args,options)
	}else{
		// evento de keyup y axios
		componentEvent.addEventListener('keyup',(e) =>{
			search = componentEvent.value;
			axios_get(args,options,search)
		})
		//evento de cambio
		componentEvent.addEventListener("change", (e)=>{
			for(var option of options.childNodes){
				if(option.value==componentEvent.value){
					for(c of args.components.keys()){
						var com = document.getElementById(c)
						com.value = option.attributes[c].value
					}
				}
			}

		})
	}
}

function axios_get(args,options,search=""){
	axios({
		method: "GET",
		url: "/"+args.search+"/search/" + (search.replace(" ","_"))
	}).then(res =>{
		options.innerHTML = ""
		select_options = ""
		for(var p of res.data[args.table]){
			select_options += "<"+args.tag+" "
			for(var pa of args.components){
				var val = pa[1]
				select_options += pa[0] + "='"+p[val]+"' "
			}
			var internalValue = args.value
			select_options += "value='"+p[internalValue]+"' class='"+args.class+"' onclick='"+args.customFunction+"({"
			for(var pa of args.components){
				var val = pa[1]
				select_options += pa[0] + ": "+ '"'+p[val]+'",'
			}
			select_options += "})'>"+p[internalValue]+"</"+args.tag+">"
			console.log(select_options)
		}
		options.innerHTML = select_options
	}).catch(e => {
		console.log("DEBUG:" + e)
	})
}
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/49/aedabe24402bb06934d43ae75a8bfd21e9a880
  Tamaño: 171       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293965    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.366256917 -0500
Modificación: 2023-10-16 16:47:23.829837435 -0500
      Cambio: 2023-10-20 16:46:06.789994257 -0500
    Creación: 2023-10-20 16:46:06.789994257 -0500
<?php
require_once("models/RiskModel.php");
class RiskController extends Controller{
	public $autosave = true;	

	public function __construct(){
		parent::__construct();
		$this->model = new RiskModel();
}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/4a/50142398d9b17b7464afff51695fbefea76c13
  Tamaño: 54        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293507    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.082927488 -0500
Modificación: 2023-03-28 17:22:24.331311181 -0500
      Cambio: 2023-10-20 16:46:06.566666810 -0500
    Creación: 2023-10-20 16:46:06.566666810 -0500
100644 blob e69de29bb2d1d6434b8b29ae775ad8c2e48c5391	index.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/4c/b5dcd58c33e1976ff95689059a5f38b4a0dd68
  Tamaño: 84        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293754    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.202925835 -0500
Modificación: 2023-04-06 11:42:36.052717650 -0500
      Cambio: 2023-10-20 16:46:06.673330665 -0500
    Creación: 2023-10-20 16:46:06.673330665 -0500
100644 blob dfc63cc3d8ba1f499d4cceaeb0bb7d89bf4900ef	index.php
100644 blob a304f375bdf785e19cc02369d54ea893fe1b9fc5	show.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/4d/17a1f804549e5391f2e10983a9f8becdd63319
  Tamaño: 114       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293630    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.142926661 -0500
Modificación: 2023-10-16 16:47:28.066400587 -0500
      Cambio: 2023-10-20 16:46:06.619998737 -0500
    Creación: 2023-10-20 16:46:06.619998737 -0500
100644 blob 92a1678b166fe022589d6cf0180b95b2e44c6dd0	create.php
100644 blob 9b890f6c8ac64acf510924d30015a38d4b5bd9d0	index.php
100644 blob 43af1793a772d21ede6991f1e3e9894f097f9f89	show.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/4e/5307607b853a090094f466239af64662013f01
  Tamaño: 358       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293446    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.046261327 -0500
Modificación: 2023-10-17 15:55:34.926409580 -0500
      Cambio: 2023-10-20 16:46:06.536667600 -0500
    Creación: 2023-10-20 16:46:06.536667600 -0500
100644 blob 6ec0742d4cbf2bc6d52e80e97f0954b9ba429d27	EventModel.php
100644 blob fcee99b97e460cc55341d071a423b702cb3fee91	KriModel.php
100644 blob 0cab3362e83d0c6f59de5574d70883a4bae432e2	Model.php
100644 blob cf27b3beec50366ce112f05e7a070bf6cf045070	PropertieModel.php
100644 blob f1562673fb0c495c4bdf7a70a6c59f834216445c	QualifierModel.php
100644 blob 3f36dc91c903e4be4239b127f4d48a9f11011911	RecordModel.php
100644 blob 730a24116f0181eadde3a5c5ca6e2d03d57ba8f7	RiskModel.php
100644 blob 05d7d4d8f9670e0e5b2c24fe3469c804e2f0f4b4	SourceModel.php
100644 blob 94c0b90d03c95b7e9484842795b32a9d4a3eacb3	TemplateModel.php
100644 blob 95085117329d973fd6c36029b44293bcedd69742	TypeModel.php
100644 blob 98bcd9d15ece27bab02c81584e6e0b10ed3cfd21	UserModel.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/4e/9ff9d183419e4aa77905cf007c5d6271f57466
  Tamaño: 728       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293445    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.046261327 -0500
Modificación: 2023-03-28 17:22:06.567978311 -0500
      Cambio: 2023-10-20 16:46:06.536667600 -0500
    Creación: 2023-10-20 16:46:06.536667600 -0500
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
<nav class="navbar navbar-expand-lg bg-body-tertiary">
  <div class="container-fluid">
    <a class="navbar-brand" href="#"></a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavDropdown">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" aria-current="page" href="/risk">Inicio</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Riesgos</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">KRI's</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Eventos</a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">Mas</a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#">Usuarios</a></li>
            <li><a class="dropdown-item" href="#">Fuentes</a></li>
            <li><a class="dropdown-item" href="#">Propiedades</a></li>
            <li><a class="dropdown-item" href="#">Tipos</a></li>
            <li><a class="dropdown-item" href="#">Configuracion</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/4f/27caa9c5680f7c74a99a1cc1eb3911d428c67f
  Tamaño: 54        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293439    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.046261327 -0500
Modificación: 2023-06-24 08:01:49.933126171 -0500
      Cambio: 2023-10-20 16:46:06.533334355 -0500
    Creación: 2023-10-20 16:46:06.533334355 -0500
100644 blob b5dc003002c204b8331b8443d6f9d7e541614508	index.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/4f/2928d7b9b4aca44b962da4f8f6e48973a56713
  Tamaño: 55        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293440    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.046261327 -0500
Modificación: 2023-02-24 01:39:43.517402201 -0500
      Cambio: 2023-10-20 16:46:06.533334355 -0500
    Creación: 2023-10-20 16:46:06.533334355 -0500
100644 blob a81df8bea5b9f59d72ccd16417f9c84d54826be8	styles.css
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/51/2e8c220715a8d7fa3201961b1af71bfdd47ef0
  Tamaño: 54        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293916    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.322924180 -0500
Modificación: 2023-03-28 17:22:24.341311180 -0500
      Cambio: 2023-10-20 16:46:06.766661539 -0500
    Creación: 2023-10-20 16:46:06.766661539 -0500
100644 blob 9f35d3bf36480ff638991e78cb116ad31464bdb6	index.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/51/8e0b10de2304163e8239495cd07c0bfdeaf0db
  Tamaño: 177       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293918    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.326257467 -0500
Modificación: 2023-03-09 13:43:50.275762584 -0500
      Cambio: 2023-10-20 16:46:06.769994784 -0500
    Creación: 2023-10-20 16:46:06.769994784 -0500
<?php
	/* base de datos anfitrion */
	$server = "mysql";
	$username = "root";
	$password = "1234";
	$database = "csra";

	/* base de datos remota */
	$server2 = "192.168.1.199";
	$username2 = "bot";
	$password2 = "@Globaltek@2022";
	$database2 = "alienvault_siem";
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/51/b4f483439170ce1f66b8dc07444e95bac424b7
  Tamaño: 83        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293917    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.326257467 -0500
Modificación: 2023-03-28 17:22:24.341311180 -0500
      Cambio: 2023-10-20 16:46:06.766661539 -0500
    Creación: 2023-10-20 16:46:06.766661539 -0500
100644 blob 402d8de9d28001806fc15bea3122fea8ba856d96	index.php
100644 blob 837639cb99e6a4197e74b0e4362e74a79486c518	show.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/52/ae8e0575e94c109bb55c4e02f37c1b59087917
  Tamaño: 2421      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293705    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.179592822 -0500
Modificación: 2023-10-17 16:44:09.867769344 -0500
      Cambio: 2023-10-20 16:46:06.653331192 -0500
    Creación: 2023-10-20 16:46:06.653331192 -0500
<?php  
include_once("components/header.php");
?>
<div class="container">
	<!-- ----------------------------------- -->
	<?php foreach($data["risks"] as $risk): ?>
	<div class="card">
		<form action="/risk/update/<?= $risk['master_id'] ?>" method="POST" class="needs-validation">
			<div class="row">
				<div class="col-xl-4 col-lg-6 mb-4">
					<div class="bg-white rounded-lg p-5 shadow">
						<h2 class="h6 font-weight-bold text-center mb-4">Valoración del Riesgo</h2>
						<!-- Progress bar 1 -->
						<div class="progress" role="progressbar" aria-label="Example with label" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">
							<div class="progress-bar" style="width: 25%">Bajo</div>
						</div>
						<!-- END -->

						<!-- Demo info -->
						<div class="row text-center mt-4">
							<div class="col-6 border-right">
								<div class="h4 font-weight-bold mb-0"><?= $data['score'] ?> P.</div><span class="small text-gray">Puntaje calculado</span>
							</div>
							<div class="col-6">
								<div class="h4 font-weight-bold mb-0"><?= $data["score_qualified"]["value"] ?></div><span class="small text-gray"><?= $data["score_qualified"]["type"] ?></span>
							</div>
						</div>
						<!-- END -->
					</div>
				</div>
				<div class="col-xl-8 col-lg-8 mb-8">
					<div class="bg-white rounded-lg p-5 shadow">
						<h2 class="h6 font-weight-bold text-center mb-4">Mapa relacional</h2>
						<div class="row align-items-center my-2">
							<div class="col-4">
								<button class="btn btn-outline-dark btn-sm form-control">
									<?= $risk["risk"] ?>
								</button>
							</div>
							<div class="col-4">
								<?php  foreach($data["kris"] as $kri): ?>
								<button class="btn btn-outline-dark btn-sm form-control my-2" data-bs-toggle="popover" data-bs-title="Descripcion del evento" data-bs-content="">
									<?= $kri["kri"]?>
								</button>
								<?php  endforeach; ?>
							</div>
							<div class="col-4">
								<?php  foreach($data["events"] as $event): ?>
								<button class="btn btn-outline-dark btn-sm form-control my-2" data-bs-toggle="popover" data-bs-title="Descripcion del evento" data-bs-content="">
									<?= $event["event"]?>
								</button>
								<?php  endforeach; ?>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- PRIMERA FILA -->
			<div class="card-header">
				<h5><b><?=$risk['master_id']?> | </b><?=$risk['risk']?></h5>
			</div>
			<div class="card-body">
				<!-- KRI -->
				<div class="form-floating mb-3">
					<input type="text" value="<?= $risk['risk'] ?>" required class="form-control" name="risk" id="floatingInput" placeholder="Insegra un nombre">
					<label for="floatingInput">Nombre del riesgo</label>
				</div>
				<div class="row">
					<div class="col-6">
						<!-- PROPIEDAD -->
						<div class="form-floating mb-3">
							<select name="propertie_id" class="form-select" id="datalistOptionsProperty" aria-label="">
							</select>
							<label for="floatingSelect">Propiedad</label>
						</div>
					</div>
					<div class="col-6">
						<!-- TIPO -->
						<div class="form-floating mb-3">
							<select name="type_id" class="form-select" id="datalistOptionsType" aria-label="">
							</select>
							<label for="floatingSelect">Tipo</label>
						</div>
					</div>
				</div>
				<div class="accordion accordion-flush" id="accordionFlushExample">
					<!-- KRI -->
					<div class="accordion-item">
						<h2 class="accordion-header">
							<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#event-collapse" aria-expanded="false" aria-controls="flush-collapseOne">
								KRIs	
							</button>
						</h2>
						<div id="event-collapse" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
							<div class="my-2">
								<button name="events" type="button" class="form-control btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addKri">
									Añadir KRI
								</button>
								<div class="form-check" id="kris"> 
									<?php  foreach($data["kris"] as $kri): ?>
									<div>
										<input type="checkbox" name="kri[]" value="<?= $kri['id'] ?>" class="btn-check" id="<?= $kri['kri'] ?>" autocomplete="off" checked>
										<label class="btn btn-sm btn-outline-danger my-2 form-control" for="<?= $kri['kri'] ?>"><?= $kri['kri'] ?> <span class="badge bg-secondary"><?= $kri['percentage'] ?>%</span></label>
									</div>
									<?php  endforeach; ?>
								</div>
							</div>
						</div>
					</div>
					<?php  endforeach; ?>
				</div>
				<div class="card-footer">
					<!-- END FIELD -->
					<div class="row">
						<div class="col-6">
							<button type="reset" class="btn btn-outline-secondary form-control">Limpiar</button>
						</div>
						<div class="col-6">
							<button type="submit" class="btn btn-primary form-control">Actualizar</button>
						</div>
					</div>
		</form>
				</div>
			</div>
			<!-- FORMULARIO DE ADICION DE KRIS -->
			<div class="modal fade" id="addKri" tabindex="-1" aria-labelledby="addKriLabel" aria-hidden="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h1 class="modal-title fs-5" id="addKriLabel">Buscar Evento</h1>
							<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
						</div>
						<div class="modal-body">
							<div class="form-floating mb-3">
								<input type="text" required class="form-control" id="searchKRI" placeholder="Insegra un nombre">
								<label for="floatingInput">Buscar evento</label>
							</div>
							<div class="justify-content-center" id="datalistOptionsKRI">
							</div>
						</div>
					</div>
				</div>
			</div>
	</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
<script src="/assets/js/search.js"></script>
<script>
	function customFunction(e){
		console.log(e)
		kris = document.getElementById("kris")
		html = kris.innerHTML
		html += "<div><input name='kri[]' value='"+e.id+"' type='checkbox' class='btn-check' id='"+e.kri+"' autocomplete='off' checked><label class='btn btn-sm btn-outline-danger my-2 form-control' for='"+e.kri+"'>"+e.kri+" <span class='badge bg-secondary'>"+e.percentage+"%</span></label></div>"
		kris.innerHTML = html
		modal = document.getElementById("addKri")
		modal.hide()
	}
	//EVENTOS
	searchEvent({
		componentEvent: "searchKRI",
		listOptions: "datalistOptionsKRI",
		search: "kri",
		components: new Map([
			["id","master_id"],
			["kri","kri"],
			["percentage","percentage"]
		]),
		value: "kri",
		table: "kris",
		tag: "button",
		customFunction: "customFunction",
		class: "btn btn-outline-primary form-control m-2' data-bs-dismiss='modal",
	})
	//PROPERTIES
	searchEvent({
		listOptions: "datalistOptionsProperty",
		search: "propertie",
		components: new Map([
			["value","id"]
		]),
		value: "propertie",
		table: "properties",
		tag: "option"
	})
	//TYPES
	searchEvent({
		listOptions: "datalistOptionsType",
		search: "type",
		components: new Map([
			["value","id"]
		]),
		value: "type",
		table: "types",
		tag: "option"
	})
</script>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/53/6d83aa5fd66d851be4f0a317aeb6fe0ad42670
  Tamaño: 177       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293717    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.182926109 -0500
Modificación: 2023-04-06 11:42:36.092717651 -0500
      Cambio: 2023-10-20 16:46:06.656664437 -0500
    Creación: 2023-10-20 16:46:06.656664437 -0500
tree 7d882fce29a4bcb24d325d9142a8ddd970eb0aa2
parent ee0167b87622e62a458b69dfe977561d4250c004
author DragonyteEvol <acuarionevol@outlook.com> 1680799356 +0000
committer DragonyteEvol <acuarionevol@outlook.com> 1680799356 +0000

event create axios template
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/53/8a7c847966fd929cc6e4e99f6df2acb042e3eb
  Tamaño: 437       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293718    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.186259398 -0500
Modificación: 2023-10-14 17:45:50.155629531 -0500
      Cambio: 2023-10-20 16:46:06.656664437 -0500
    Creación: 2023-10-20 16:46:06.656664437 -0500
100644 blob 46141854b6c4aac2047018836b3340f5f62dd0c2	.htaccess
100644 blob da437ed708de7ea2d1ed5bb37dc51d00740740f6	Dockerfile
040000 tree dd6218d45158d9a2b0981c704e5c5c0d3130c418	assets
040000 tree ee84c1fda671963354e74a972bfc478930dd45c8	components
100644 blob 886fe19262e1dcc9bc5827b9b360744e6fe4cf58	config.php
040000 tree 54f14b2926b0bdda1c5a57eee29d52801f0fc298	controllers
100644 blob 8dadb53d86e692a9145d4db33bc19d31c3303116	data.sql
100644 blob 82c1b06cf8655c3159204f46dafb691aa3fe03c0	database.php
100644 blob 27dae4899dda3ef6df80d4bdc4ec9c52248ccb59	index.php
040000 tree 2b71774bdfa2d355d194de2161bbbeaf4f696d21	models
100644 blob d9a4ec66dfeb45d52c58647f352aaaae6b84cd28	router.php
100644 blob b82cea160f9cfcea3268f5371dbfc4fff71c4b97	seeder.sql
040000 tree 7dc24e32b0ebad87ef1d9b80fefd38629fa75087	views
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/54/f14b2926b0bdda1c5a57eee29d52801f0fc298
  Tamaño: 360       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293675    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.162926385 -0500
Modificación: 2023-10-15 17:00:51.805995570 -0500
      Cambio: 2023-10-20 16:46:06.639998210 -0500
    Creación: 2023-10-20 16:46:06.639998210 -0500
100644 blob 916405f23887474176f88d1c45f7fa7fdbcdd9e2	Controller.php
100644 blob 43b66da7c98ec0406611ebd66751eba7be411194	EventController.php
100644 blob 8fadc7a627eea16c36528f45d360b17d0cee6b5e	KriController.php
100644 blob ab88d0b50b2f02ca6a63488e849280128184eafb	LoginController.php
100644 blob 56b41c3c0b81d3e213654e2b64a9e8e43e0c8b30	PropertieController.php
100644 blob 12620ce4178e3b649067d4a02a366ef83bb8d47e	RegisterController.php
100644 blob 5fa1c0a8e82b84d03e204b24bdde9483e720aba0	RiskController.php
100644 blob 8c1bb57955e07f847b2b8e617e4db6218f8ced28	SourceController.php
100644 blob 07a9d2abeb523436c2863c3129e2c4f1fd26c654	TemplateController.php
100644 blob 9948526e371ec84f39ad45662721203603f6abf6	TypeController.php
100644 blob fb02603f5e1e778c1b626de544c3f0834532d3e1	UserController.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/56/97b2eb23a3494a8eb9d52636ba7abb5339bf03
  Tamaño: 300       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293962    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.366256917 -0500
Modificación: 2023-04-06 11:42:36.046050983 -0500
      Cambio: 2023-10-20 16:46:06.789994257 -0500
    Creación: 2023-10-20 16:46:06.789994257 -0500
100644 blob 675ca80493965d2db9a143d34f10ae7c5abe31c2	Controller.php
100644 blob 7b7d7e81e8468da6cd329024af7e5eb90d11e3a1	EventController.php
100644 blob 03d434714b9c4aeca68bd623c8ac65e1998fea2e	KriController.php
100644 blob ab88d0b50b2f02ca6a63488e849280128184eafb	LoginController.php
100644 blob 12620ce4178e3b649067d4a02a366ef83bb8d47e	RegisterController.php
100644 blob 5fa1c0a8e82b84d03e204b24bdde9483e720aba0	RiskController.php
100644 blob 8c1bb57955e07f847b2b8e617e4db6218f8ced28	SourceController.php
100644 blob 07a9d2abeb523436c2863c3129e2c4f1fd26c654	TemplateController.php
100644 blob fb02603f5e1e778c1b626de544c3f0834532d3e1	UserController.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/56/b41c3c0b81d3e213654e2b64a9e8e43e0c8b30
  Tamaño: 161       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293963    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.366256917 -0500
Modificación: 2023-05-14 07:33:53.985373113 -0500
      Cambio: 2023-10-20 16:46:06.789994257 -0500
    Creación: 2023-10-20 16:46:06.789994257 -0500
<?php
require_once("models/PropertieModel.php");
class PropertieController extends Controller{

	public function __construct(){
		parent::__construct();
		$this->model = new PropertieModel();
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/58/223b3ab325f17adfc1d5c6fde6ab930b39f82e
  Tamaño: 1625      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293715    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.182926109 -0500
Modificación: 2023-07-30 06:50:09.588334234 -0500
      Cambio: 2023-10-20 16:46:06.656664437 -0500
    Creación: 2023-10-20 16:46:06.656664437 -0500
<?php  
include_once("components/header.php");
?>
<div class="card">
	<div class="card-header">
		<div class="row">
			<div class="col-6">
				<div class="row">
					<div class="input-group mb-3">
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalCreate">
	+
</button>
						<input id="searchEvent" type="text" class="form-control" placeholder="Buscar evento" aria-label="Example text with button addon" aria-describedby="button-addon1">
					</div>
				</div>
			</div>
			<div class="col-6">
				<div class="row">
					<div class="col-6">
						<input class="form-control" name="from" type="datetime-local">
					</div>
					<div class="col-6">
						<input class="form-control d-flex" name="to" type="datetime-local">
					</div>
				</div>
			</div>
		</div>
	</div>

	<table class="table table-borderless">
		<thead>
			<tr>
				<th scope="col">#</th>
				<th scope="col">Evento</th>
				<th scope="col">Tipo</th>
				<th scope="col">Puntaje</th>
			</tr>
		</thead>
		<tbody id="events">
			<?php  foreach($data["events"] as $risk): ?>
			<tr>
				<th scope="row"><?= $risk["id_master"] ?></th>
				<td>
					<a class="link-dark" href="/event/show/<?= $risk['id_master'] ?>">
						<?= $risk["event"] ?>
					</a>
				</td>
				<td><?= $risk["type"] ?></td>
				<td>
					<span class="badge text-bg-primary">
						<?= $risk["score"] ?>
					</span>
				</td>
			</tr>
			<?php  endforeach; ?>
		</tbody>
	</table>
</div>
<!-- ///////////////// -->
<!-- Formulario modal para creacion de eventos --> 
<div id="modalCreate" class="modal" tabindex="-1">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Crear evento</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<!-- formulario de inicio de sesion -->
				<form action="/event/insert" method="POST" class="needs-validation">
					<!-- TEMPLATE -->
					<div class="form-floating mb-3">
						<input type="text" class="form-control" list="datalistOptions" id="template" placeholder="Type to search...">
						<datalist id="datalistOptions">
						</datalist>
						<label for="floatingInput">Selecciona y busca una platilla</label>
					</div>

					<!-- NOMBRE -->
					<div class="form-floating mb-3">
						<input type="text" required class="form-control" name="event" id="floatingInput" placeholder="Insegra un nombre">
						<label for="floatingInput">Ingresa un nombre</label>
					</div>
					<!-- TIPO DE EVENTO -->
					<div class="form-floating mb-3">
						<select name="type" class="form-select" id="floatingSelect" aria-label="Floating label select example">
							<option selected value="automatic">Automatico</option>
							<option value="manual">Manual</option>
						</select>
						<label for="floatingSelect">Tipo de evento</label>
					</div>
					<!-- ID DE LA FUENTE -->
					<div class="form-floating mb-3">
						<input type="text" name="source_id" class="form-control disabled" id="source_id">
						<label for="floatingInput">ID de la fuente</label>
					</div>
					<!-- IDE DEL EVENTO -->
					<div class="form-floating mb-3">
						<input name="event_id" type="text" class="form-control disabled" id="event_id">
						<label for="floatingInput">ID del evento</label>
					</div>
					<!-- FUENTE -->
					<div class="form-floating mb-3">
						<input type="text" disabled class="form-control" id="source">
						<label for="floatingInput">Fuente</label>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
						<button type="submit" class="btn btn-primary">Enviar</button>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
<script src="assets/js/search.js"></script>
<script>
	/* searchEvent({ */
	/* componentEvent: "template", */
	/* 	listOptions: "datalistOptions", */
	/* 	search: "template", */
	/* 	components: new Map([ */
	/* 		["source_id","plugin_id"], */
	/* 		["source","vendor"], */
	/* 		["event_id","sid"] */
	/* 	]), */
	/* 	value: "name" */
	/* }) */
	searchEvent({
		componentEvent: "template",
		listOptions: "datalistOptions",
		search: "template",
		components: new Map([
			["source_id","plugin_id"],
			["source","vendor"],
			["event_id","sid"]
		]),
		value: "name",
		table: "plugin_sid",
		tag: "option"
	})
	searchTable({
		componentEvent: "searchEvent",
		listOptions: "events",
		search: "event",
		components: [
			"type",
			"score"
		],
		value: "event",
		table: "events",
	})
</script>
</script>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/58/72beebdeac6f4243f191582c95a25dfeeb9613
  Tamaño: 115       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293714    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.182926109 -0500
Modificación: 2023-10-07 13:37:54.449464790 -0500
      Cambio: 2023-10-20 16:46:06.656664437 -0500
    Creación: 2023-10-20 16:46:06.653331192 -0500
100644 blob b87f3bc3e2670a781ac9265c829fccc2617c9ac8	create.php
100644 blob cf08f28d8f82235f4e9a7f4bff674b0fd4cc38cb	index.php
100644 blob 81eba4d7f8df8a34e72c4aa34ef10adaa1243a24	show.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/59/363740fbc4c10281feab067f31e2914102b29a
  Tamaño: 729       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293680    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.166259672 -0500
Modificación: 2023-03-09 13:43:50.272429250 -0500
      Cambio: 2023-10-20 16:46:06.639998210 -0500
    Creación: 2023-10-20 16:46:06.639998210 -0500
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
<nav class="navbar navbar-expand-lg bg-body-tertiary">
  <div class="container-fluid">
    <a class="navbar-brand" href="#"></a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavDropdown">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" aria-current="page" href="/">Inicio</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Riesgos</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Indicadores clave de riesgo (kri)</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Eventos</a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">Mas</a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#">Usuarios</a></li>
            <li><a class="dropdown-item" href="#">Fuentes</a></li>
            <li><a class="dropdown-item" href="#">Configuracion</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/5a/74ab5739f45e3121c04922d1f722230066f590
  Tamaño: 655       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293559    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.109593787 -0500
Modificación: 2023-04-13 16:00:20.353748983 -0500
      Cambio: 2023-10-20 16:46:06.586666282 -0500
    Creación: 2023-10-20 16:46:06.586666282 -0500
<?php
class Controller{

	public $controller;

	/* el contructor trae el controllador al que se accede desde la url y lo aloja en la clase */
	public function __construct()
	{
		$this->controller = $_GET["controller"];
	}

	/* retona la vista de inicio y trae sus datos en lista */
	public function index(){
		$data=$this->model->getAll();
		require_once("views/$this->controller/index.php");
	}

	/* despliega el formulario de creacion */
	public function create(){
		require_once("views/$this->controller/create.php");
	}

	/* retorna la vista de mostrar un solo elemento con la informacion del elemnto */
	public function show(){
		$id = $_GET["id"]; 
		$data=$this->model->selectById($id);
		require_once("views/$this->controller/show.php");
	}

	/* crea un elemento y redirecciona al inicio */
	public function insert(){
		$this->modelParams();
		$this->model->insert();
		header("Location: /$this->controller");
	}

	/* modifica un elemento y redirecciona al inicio */
	public function update(){
		$this->model->id = $_GET["id"];
		$this->modelParams();
		$this->model->update();
		header("Location: /$this->controller");
	}

	/* borra un elemento y redireccion al inicio */
	public function delete(){
		$id = $_GET["id"];
		$this->model->delete($id);
		header("Location: /$this->controller");
	}

	/* relaciona los parametros de entrado por POST con parametros de la clase */
	private function modelParams(){
		foreach(array_keys($_POST) as $key){
			$this->model->{$key} = $_POST[$key];
		}
	}

	/* index - lista todos los elementos */
	/* show - muestra un elemento por su id */
	/* create - crea un elemento */
	/* update - modifica un elemento */
	/* delete - borra un elemento */
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/5a/9960d2de861e2959d8deffcddbedc07c7eb2f2
  Tamaño: 360       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293560    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.109593787 -0500
Modificación: 2023-10-08 19:55:10.913874588 -0500
      Cambio: 2023-10-20 16:46:06.586666282 -0500
    Creación: 2023-10-20 16:46:06.586666282 -0500
100644 blob 916405f23887474176f88d1c45f7fa7fdbcdd9e2	Controller.php
100644 blob 43b66da7c98ec0406611ebd66751eba7be411194	EventController.php
100644 blob db0400e2c51cbb721276811d9c198a82b538572e	KriController.php
100644 blob ab88d0b50b2f02ca6a63488e849280128184eafb	LoginController.php
100644 blob 56b41c3c0b81d3e213654e2b64a9e8e43e0c8b30	PropertieController.php
100644 blob 12620ce4178e3b649067d4a02a366ef83bb8d47e	RegisterController.php
100644 blob 5fa1c0a8e82b84d03e204b24bdde9483e720aba0	RiskController.php
100644 blob 8c1bb57955e07f847b2b8e617e4db6218f8ced28	SourceController.php
100644 blob 07a9d2abeb523436c2863c3129e2c4f1fd26c654	TemplateController.php
100644 blob 9948526e371ec84f39ad45662721203603f6abf6	TypeController.php
100644 blob fb02603f5e1e778c1b626de544c3f0834532d3e1	UserController.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/5b/9a73936584eabcb55fd9e03862f7c4e6eab1b1
  Tamaño: 402       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293498    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.079594201 -0500
Modificación: 2023-05-15 15:43:00.066708524 -0500
      Cambio: 2023-10-20 16:46:06.560000319 -0500
    Creación: 2023-10-20 16:46:06.560000319 -0500
<?php
require_once("database.php");
require("models/Model.php");
require("controllers/Controller.php");

/* var_dump($_GET); */
/* extrae el nombre del controlador de la uri de la url*/
/* http://sy.com/mycontroller =====>>> mycontroller */
$controller = $_GET["controller"];
/* extrae el nombre de la funcion a llamar de la uri de la url */
/* http://sy.com/mycontroller/show =====>>> show*/
$action = $_GET["action"];
/* extrae el id o parametro personalizado en la funcion de la uri de la url */
/* http://sy.com/mycontroller/show/1 =====>>> 1*/
$id = $_GET["id"];


if(empty($action)){
	$action = "index";
}

$controller = ucfirst($controller) . "Controller";

/* referencia el controlador accedido por la uri y crea una instancia */
include "controllers/$controller.php";
$ctrl = new $controller;
/* llama a la funcion de la uri */
$ctrl->{$action}();
?>

---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/5c/5cd40bf28fe21614fb3545708dc1b54af06774
  Tamaño: 252       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293433    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.039594752 -0500
Modificación: 2023-10-16 16:47:28.079733595 -0500
      Cambio: 2023-10-20 16:46:06.530001109 -0500
    Creación: 2023-10-20 16:46:06.530001109 -0500
040000 tree c6fcef640a78c9903fb6370e39da1c2dad660112	event
040000 tree 12e9e38aa524c73274e5c41f3f465df3a3835029	kri
040000 tree bf26cbec7b3a99878eea5fe64236fa8c6693da97	login
040000 tree 4f27caa9c5680f7c74a99a1cc1eb3911d428c67f	propertie
040000 tree 8494db4705a8620c9116e70e5f31fa4b042d135f	register
040000 tree 4d17a1f804549e5391f2e10983a9f8becdd63319	risk
040000 tree 2f47ccb2e200d0e41df57356190e2cc8bfd87708	type
040000 tree 51b4f483439170ce1f66b8dc07444e95bac424b7	user
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/5c/7237e50bdf5fdcb1d03c9795d76e0fb64029ea
  Tamaño: 185       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293434    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.042928040 -0500
Modificación: 2023-03-30 15:50:16.840976186 -0500
      Cambio: 2023-10-20 16:46:06.530001109 -0500
    Creación: 2023-10-20 16:46:06.530001109 -0500
<?php
require_once("models/RiskModel.php");
class RiskController extends Controller{

	public function __construct(){
		parent::__construct();
		$this->model = new RiskModel();
	}

	public function show(){
		$this->model->selectById(1);
	}
	
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/5d/6389fde30c3d682f559aaa5916f900c3e7adaf
  Tamaño: 2103      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293472    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.059594477 -0500
Modificación: 2023-05-19 15:57:22.436142505 -0500
      Cambio: 2023-10-20 16:46:06.550000582 -0500
    Creación: 2023-10-20 16:46:06.546667337 -0500
<?php 
class Model{
	public $db;
	private $data;
	private $process_data;

	public function __construct($second_database = FALSE){
		$this->db=Connection::connect($second_database);
	}

	/* permite ejecutar consultas sql customizadas a cada modelo */
	/* 	retorna la informacion consultada o registrada */
	public function getCustom($sql,$param=0){
		$this->execute($sql,$this->table,$param);
		return $this->data;
	}

	/* toma todos los usuarios de la base de datos */
	/* 	retorna un lista con usuarios */
	/* puede recibir un array de nobres de tablas para generar una relacion de uno a muchos */
	public function getAll(){
		/* relacion de tablas */
		$sql = "SELECT *,$this->table.id as id_master FROM $this->table ";
		if(count($this->one_to_one)<>0){
			foreach($this->one_to_one as $join){
				$column = substr($join,0,-1) . "_id";
				$sql = $sql . "INNER JOIN $join ON $this->table.$column=$join.id ";
			}
		}
		/* ejecucion de query */
		$this->execute($sql,$this->table);
		return $this->data;
	}

	/* toma un usuario por id de la base de datos */
	/* 	retorna una lista con el usuario */
	public function selectById($id){
		$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
		//RELACION 1 A 1
		if(count($this->one_to_one)<>0){
			foreach($this->one_to_one as $join){
				$column = substr($join,0,-1) . "_id";
				$sql = $sql . "INNER JOIN $join ON $this->table.$column=$join.id ";
			}
		}
		$sql = $sql . "WHERE $this->table.id=:id";
		$this->execute($sql,$this->table,$id);
		//RELACION 1 A MUCHOS
		if(count($this->one_to_much)<>0){
			$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
			foreach(array_keys($this->one_to_much) as $join){
				$relation= $this->one_to_much[$join];//QUALIFIERS;
				$column_2 = substr($join,0,-1) . "_id"; //KRI_ID;
				$sql = $sql . "INNER JOIN $relation ON $join.id=$relation.$column_2 ";
				$sql = $sql . "WHERE $this->table.id=:id";
				$this->data["sql"]=$sql;
				$this->execute($sql,$relation,$id);
				$sql = str_replace("WHERE $this->table.id=:id","",$sql);
			}
		}
		//RELACION MUCHOS A MUCHOS
		if(count($this->much_to_much)<>0){
			$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
			foreach(array_keys($this->much_to_much) as $join){
				$relation= substr($this->much_to_much[$join],0,-1);
				$table_relation = substr($join,0,-1) . "_" . $relation;
				$column_1 = $relation . "_id";
				$column_2 = substr($join,0,-1) . "_id";
				$join_table = $this->much_to_much[$join];
				$sql = $sql . "INNER JOIN $table_relation ON $join.id=$table_relation.$column_2 ";
				$sql = $sql . "INNER JOIN $join_table ON $table_relation.$column_1=$join_table.id ";
				$sql = $sql . "WHERE $this->table.id=:id";
				$this->execute($sql,$join_table,$id);
				$sql = str_replace("WHERE $this->table.id=:id","",$sql);
			}
		}
		return $this->data;
	}

	/* inserta un registro a la base de datos con sus respectivas relaciones */
	/* 	retorna el id del elemento registrado */
	public function insert(){
		try{
			if(!$this->db->inTransaction()){
				$this->db->beginTransaction();
			}
			$columns = implode(",",$this->columns);
			$args = implode(",",$this->args);
			$sql = "INSERT INTO $this->table($columns) values($args)";
			$state = $this->db->prepare($sql);
			$this->setParams($state);
			$state->execute();
			$id = $this->db->lastInsertId();
			if(count($this->much_to_much)>0){
				foreach(array_keys($this->much_to_much) as $join){
					$relation= substr($this->much_to_much[$join],0,-1);//event
					$table_relation = substr($join,0,-1) . "_" . $relation;//kri_event
					$column_2 = substr($join,0,-1) . "_id";//kri_id
					$column_1 = $relation . "_id";//event_id
					$sql = "INSERT INTO $table_relation($column_1,$column_2) VALUES(:$column_1,:$column_2)";
					for($i=0;$i< count($_POST[$relation]);$i++){
						$state = $this->db->prepare($sql);
						$state->bindParam(":$column_1",$_POST[$relation][$i]);
						$state->bindParam(":$column_2",$id);
						$state->execute();
					}
				}

			}
			return $id;
		}catch(PDOException $e){
			echo $e->getMessage();
			$this->db->rollBack();
		}
	}

	/* modifica un elemento en la base de datos */
	/* 	retorna el ultimo in elemento de la tabla */
	public function update(){
		try{
			if(!$this->db->inTransaction()){
				$this->db->beginTransaction();
			}
			$prepare_sql = "";
			for($i=0;$i < count($this->args);$i++){
				if((count($this->args)-1)==$i){
					$prepare_sql = $prepare_sql . $this->columns[$i] . "=" . $this->args[$i];
				}else{
					$prepare_sql = $prepare_sql . $this->columns[$i] . "=" . $this->args[$i] . ",";
				}
			}
			$sql = "UPDATE $this->table set $prepare_sql WHERE id=:id";
			$state = $this->db->prepare($sql);
			$this->setParams($state);
			$state->bindParam(":id",$this->id);
			$state->execute();
			return $this->db->lastInsertId();
		}catch(PDOException $e){
			$this->db->rollBack();
		}
	}

	/* borra un elemento de la base de datos */
	/* 	no retorna informacion */
	public function delete($id){
		try{
			if(!$this->db->inTransaction()){
				$this->db->beginTransaction();
			}
			$sql = "DELETE FROM $this->table WHERE id=:id";
			$state = $this->db->prepare($sql);
			$state->bindParam(":id",$id);
			$state->execute();
		}catch(PDOException $e){
			$this->db->rollBack();
		}
	}

	/* busca elementos en la base de datos */
	/* 	retorna un array con los elementos encontrados */
	public function search($search){
		$column = substr($this->table,0,-1);
		$sql = "SELECT * FROM $this->table WHERE $column LIKE '%$search%'";
		$this->execute($sql,$this->table);
		return $this->data;
	}

	/* escribe los cambios en la base de datos si el dml esta en una transaccion */
	/* 	no retorna informacion pero termina la transaccion actual */
	public function saveChanges(){
		$this->db->commit();
	}

	/* establece las variables de las consultas preparadas */
	/* 	no retorna informacion pero deja la consulta preparada lista para su ejecucion */
	private function setParams($state){
		for($i=0;$i < count($this->args);$i++){
			if($this->args[$i]==":password"){
				$password = password_hash($this->password,PASSWORD_BCRYPT);
				$state->bindParam($this->args[$i],$password);
			}else{
				$state->bindParam($this->args[$i],$this->{$this->columns[$i]});
			}
		}
	}

	/* ejecuta la consulta preparada */
	/* modifica la variable data adjuntando la informacion en esta variable */
	private function execute($sql,$key,$id=0){
		$state = $this->db->prepare($sql);
		if($id<>0){
			$state->bindParam(":id",$id);
		}
		if($state->execute()){
			while($row=$state->fetch(PDO::FETCH_ASSOC)){
				$this->process_data[]=$row;
			}
			$this->data[$key]=$this->process_data;
			$this->process_data=[];
		}
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/5d/b7a8714b2cc20d8e3700c23151e666ca60e818
  Tamaño: 703       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293475    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.059594477 -0500
Modificación: 2023-10-14 17:45:42.142525300 -0500
      Cambio: 2023-10-20 16:46:06.550000582 -0500
    Creación: 2023-10-20 16:46:06.550000582 -0500
<?php 
require_once("models/QualifierModel.php");
require_once("models/EventModel.php");
class KriModel extends Model{
	protected $table = "kris";
	protected $columns = ["kri","objective","propertie_id","percentage","syntax"];
	protected $args= [":kri",":objective",":propertie_id",":percentage",":syntax"];
	protected $one_to_one= ["kris"=>"properties"];
	protected $one_to_much= ["kris"=>"qualifiers"];
	protected $much_to_much= ["kris"=>"events"];

	public function __construct(){
		parent::__construct();
		$this->event_model = new EventModel(); //AFECTA LA TABLA EVENTS
		$this->qualifier_model = new QualifierModel(); //AFECTA A LA TABLA QUALIFIERS
	}

	/* selecciona un kri de la base de datos calcula su puntaje */
	/* retorna un array de elementos con los datos del kri y su puntje */
	/* recibe un id de kri */
	public function getByIdScore($id){
		$this->selectById($id);
		/* CALCULAR PUNTAJE DE KRI */
		$syntax = $this->data["kris"][0]["syntax"];
		$this->getScore($id,$syntax);
		return $this->data;
	}

	/* calcula el puntaje ponderado y calificado de un kri */
	/* adjunta los resultados al array principal del modelo */
	/* requiere como datos de entrada un id de kri y una syntax o ecuacion ejemplo 2+4 */
	public function getScore($id,$syntax){
		/* puntaje calculado por ecuacion */
		$this->data["score"] = $this->event_model->getScore($syntax);
		/* puntaje ponderado por calificadores */
		$this->data["score_qualified"]=$this->qualifier_model->getQualifierScore($id,$this->data["score"]);
	}

}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/5d/cce7af4cfc3edba4fbcf6e1c7f70959382404a
  Tamaño: 171       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293473    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.059594477 -0500
Modificación: 2023-03-28 17:22:24.441311176 -0500
      Cambio: 2023-10-20 16:46:06.550000582 -0500
    Creación: 2023-10-20 16:46:06.550000582 -0500
tree eb80b910725f6fedef9abb25fa52368623ff15c1
parent 67f18ef7aaa6bb050d08ac4df4031645d21eef7b
author DragonyteEvol <acuarionevol@outlook.com> 1680042144 +0000
committer DragonyteEvol <acuarionevol@outlook.com> 1680042144 +0000

relation 1 by N
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/5d/dd49437dbda282e8e56f199a604c40734658fc
  Tamaño: 263       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293474    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.059594477 -0500
Modificación: 2023-10-08 19:55:08.183944596 -0500
      Cambio: 2023-10-20 16:46:06.550000582 -0500
    Creación: 2023-10-20 16:46:06.550000582 -0500
<?php 
require_once("models/EventModel.php");
class KriModel extends Model{
	protected $table = "kris";
	protected $columns = ["kri","objective","propertie_id","percentage","syntax"];
	protected $args= [":kri",":objective",":propertie_id",":percentage",":syntax"];
	protected $one_to_one= ["kris"=>"properties"];
	protected $one_to_much= ["kris"=>"qualifiers"];
	protected $much_to_much= ["kris"=>"events"];

	public function __construct(){
		parent::__construct();
	}

}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/5e/1507f2327128680002b912ed9fb91c37a4ae0a
  Tamaño: 55        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293891    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.312924318 -0500
Modificación: 2023-02-24 01:39:43.517402201 -0500
      Cambio: 2023-10-20 16:46:06.736662329 -0500
    Creación: 2023-10-20 16:46:06.736662329 -0500
100644 blob 96fe6fc4049c3c1fbd6e3c04a2c9b6246643d7f2	header.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/5e/b9f411a41319031b190a1ffd1564f0dfb94ee2
  Tamaño: 1210      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293890    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.312924318 -0500
Modificación: 2023-04-13 16:00:20.353748983 -0500
      Cambio: 2023-10-20 16:46:06.736662329 -0500
    Creación: 2023-10-20 16:46:06.736662329 -0500
<?php  
include_once("components/header.php");
?>
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalCreate">
	X
</button>
<table class="table table-borderless">
	<thead>
		<tr>
			<th scope="col">#</th>
			<th scope="col">KRI</th>
			<th scope="col">Objetivo</th>
			<th scope="col">Propiedad</th>
			<th scope="col">Porcentage</th>
			<th scope="col">Calculo</th>
		</tr>
	</thead>
	<tbody>
		<?php  foreach($data["kris"] as $kri): ?>
		<tr>
			<th scope="row"><?= $kri["id_master"] ?></th>
			<td>
				<a href="/kri/show/<?= $kri['id_master'] ?>">
					<?= $kri["kri"] ?>
				</a>
			</td>
			<td><?= $kri["objective"] ?></td>
			<td><?= $kri["propertie"] ?></td>
			<td><?= $kri["percentage"] ?>%</td>
			<td><?= $kri["syntax"] ?></td>
		</tr>
		<?php  endforeach; ?>
	</tbody>
</table>

<!-- Formulario modal para creacion de eventos --> 
<div id="modalCreate" class="modal" tabindex="-1">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Crear evento</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<!-- formulario de inicio de sesion -->
				<form action="/event/create" method="POST" class="needs-validation">

					<!-- KRI -->
					<div class="form-floating mb-3">
						<input type="text" required class="form-control" name="kri" id="floatingInput" placeholder="Insegra un nombre">
						<label for="floatingInput">Nombre del KRI</label>
					</div>
					<!-- OBJECTIVO -->
					<div class="form-floating">
						<textarea class="form-control mb-3" name="objective" placeholder="Leave a comment here" id="floatingTextarea2" style="height: 100px"></textarea>
						<label for="floatingTextarea2">Objetivo</label>
					</div>
					<!-- ID DE LA FUENTE -->
					<div class="form-floating mb-3">
						<input type="number" required class="form-control" name="kri" id="floatingInput" placeholder="Insegra un nombre">
						<label for="floatingInput">Porcentaje</label>
					</div>
					<!-- IDE DEL EVENTO -->
					<div class="form-floating mb-3">
						<input name="event_id" type="text" class="form-control disabled" id="event_id">
						<label for="floatingInput">ID del evento</label>
					</div>
					<!-- FUENTE -->
					<div class="form-floating mb-3">
						<input type="text" disabled class="form-control" id="source">
						<label for="floatingInput">Fuente</label>
					</div>
					<!-- asldkfjaslkdfj -->
					<select class="form-select" multiple data-mdb-filter="true">
						<option onclick="pepe()" value="1">One</option>
						<option value="2">Two</option>
						<option value="3">Three</option>
						<option value="4">Four</option>
						<option value="5">Five</option>
						<option value="6">Six</option>
						<option value="7">Seven</option>
						<option value="8">Eight</option>
						<option value="9">Nine</option>
						<option value="10">Ten</option>
					</select>
					<!-- /// -->
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
						<button type="submit" class="btn btn-primary">Enviar</button>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
<script>
	function pepe(){
		console.log("OK")
	}
</script>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/5f/a1c0a8e82b84d03e204b24bdde9483e720aba0
  Tamaño: 160       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293991    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.396256502 -0500
Modificación: 2023-10-15 17:00:48.602745624 -0500
      Cambio: 2023-10-20 16:46:06.806660484 -0500
    Creación: 2023-10-20 16:46:06.806660484 -0500
<?php
require_once("models/RiskModel.php");
class RiskController extends Controller{

	public function __construct(){
		parent::__construct();
		$this->model = new RiskModel();
	}

}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/5f/cc2bc439f2a2043f7e2104bb1f50d3f8d9935e
  Tamaño: 1419      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293992    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.396256502 -0500
Modificación: 2023-10-08 19:55:08.170611605 -0500
      Cambio: 2023-10-20 16:46:06.806660484 -0500
    Creación: 2023-10-20 16:46:06.806660484 -0500
<?php 
class EventModel extends Model{
	protected $table = "events";
	protected $columns = ["event","type","source_id","event_id"];
	protected $args= [":event",":type",":source_id",":event_id"];
	protected $record_table="records";
	protected $search_criteria="event";

	public function __construct(){
		parent::__construct();
	}

	/* Consulta todos los elementos del modelo en base en datos */
	/* retorna un array con los elementos consultados */
	public function getAll(){
		//optencion de query
		$sql = $this->getSelectQuery(TRUE);
		/* ejecucion de query */
		$this->execute($sql,$this->table);
		return $this->data;
	}

	/* Calcula el valor de un ecuacion relacionando los numeros a id de eventos y consultando su repeticion de aparicion en OSIEM en un tiempo determinado */
	/* recibe como entrada una ecuacion en formato string */
	/* retorna un numero con el valor de la ecuacion en un tiempo determinado */
	public function calculateScore($syntax){
		/* generar array de numeros */
		$array_events= $this->extractNumberEvents($syntax);
		/* consultar eventos y aparicion */
		foreach($array_events as $event_id){
			$events = $this->selectById($event_id);
			foreach($events["events"] as $event){
				$score = $event["score"];
				$syntax = str_replace($event_id,$score,$syntax);
			}
		}
		/* evaluar ecuacion */
		/* !!!!!!IMPORTANTE!!!!!!!!! */
		/* Aplicar tecnicas de sanitizacion debido a que la funcion eval puede ser muy peligrosa y poner en riesgo la informacion */
		eval("\$score = $syntax;");
		return $score;
	}

	/* extrae el numero de evento de evento a partir de un ecuacion */
	/* recibe como entrada una ecuacion en formato string */
	/* ej. (25-56)/24 => Array(25,56,24) */
	/* retorna un array con los eventos identificados */
	private function extractNumberEvents($syntax){
		$array_number = array();
		$number = "";
		for($i=0;$i<strlen($syntax);$i++){
			if(is_numeric($syntax[$i])){
				$number = $number . $syntax[$i];
			}else{
				if($number!=""){
					array_push($array_number,$number);
					$number = "";
				}	
			}
		}
		if($number!=""){
			array_push($array_number,$number);
		}	
		return $array_number;
	}

	
	/* busca elementos en la base de datos */
	/* 	retorna un array con los elementos encontrados */
	public function selectById($id){
		$sql = $this->getSelectQuery(FALSE);
		$sql=$sql . " WHERE $this->table.id='$id' ";
		//AGRUPACION POR ID DE OSIEM Y FUENTE PARA EVITAR CRUCES DE EVENTOS
		$sql = $sql . "GROUP BY $this->table.id,$this->table.event_id,$this->table.source_id";
		$this->execute($sql,$this->table);
		return $this->data;
	}

	/* busca elementos en la base de datos */
	/* 	retorna un array con los elementos encontrados */
	public function search($search){
		$sql = $this->getSelectQuery(FALSE);
		$sql=$sql . " WHERE $this->search_criteria LIKE '%$search%' ";
		//AGRUPACION POR ID DE OSIEM Y FUENTE PARA EVITAR CRUCES DE EVENTOS
		$sql = $sql . "GROUP BY $this->table.id,$this->table.event_id,$this->table.source_id";
		$this->execute($sql,$this->table);
		return $this->data;
	}

	//genera el query principal de la seleccion de eventos
	//recibe como paremetros un booleano para inyectar al query la agrupacion por evento y fuente
	//retorna un string con la query a ejecutar
	private function getSelectQuery($group){
		$sql = "SELECT *,count($this->table.event_id) as score,$this->table.id as master_id FROM $this->table ";
		//UNION A CALCULO DE PUNTAJE 
		$sql = $sql . "LEFT JOIN $this->record_table ON $this->table.event_id=$this->record_table.event_id AND $this->table.source_id=$this->record_table.source_id ";
		//AGRUPACION POR ID DE OSIEM Y FUENTE PARA EVITAR CRUCES DE EVENTOS
		if($group){
			$sql = $sql . "GROUP BY $this->table.id,$this->table.event_id,$this->table.source_id";
		}
		return $sql;
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/60/24df72a5b90f682353b1268b652a837ec9fc26
  Tamaño: 437       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293994    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.396256502 -0500
Modificación: 2023-05-14 07:37:26.692034174 -0500
      Cambio: 2023-10-20 16:46:06.809993730 -0500
    Creación: 2023-10-20 16:46:06.809993730 -0500
100644 blob 46141854b6c4aac2047018836b3340f5f62dd0c2	.htaccess
100644 blob da437ed708de7ea2d1ed5bb37dc51d00740740f6	Dockerfile
040000 tree 39d44e28008599bd02bb3f75303394c5c0707cd5	assets
040000 tree 0994b646c5cf6fe1259596f6e540c6055d0d4e1c	components
100644 blob fc5c9dceab7ea6a3e92e9e475208d3d4a4402846	config.php
040000 tree 1bb8bfb26dcbad31d92f0d06e45d2ca9e2950579	controllers
100644 blob 8dadb53d86e692a9145d4db33bc19d31c3303116	data.sql
100644 blob 82c1b06cf8655c3159204f46dafb691aa3fe03c0	database.php
100644 blob 27dae4899dda3ef6df80d4bdc4ec9c52248ccb59	index.php
040000 tree 8fb1efa6322ddbb014c1355a8eae953f59208ef4	models
100644 blob 30cca64a0adebfcd8627b0ae4cd71f260a04b1d0	router.php
100644 blob dc9cfb9c2e93b41acbe9d8bcc6932aa67031e82d	seeder.sql
040000 tree 29d1c35262abc81cd85e6995651d71a6876cc247	views
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/60/7aa6961b0ba3f41a301c9e8a084cfd27d31d30
  Tamaño: 181       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293995    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.396256502 -0500
Modificación: 2023-10-20 11:59:31.303828443 -0500
      Cambio: 2023-10-20 16:46:06.809993730 -0500
    Creación: 2023-10-20 16:46:06.809993730 -0500
tree 3e63814567a93a8f386235f79383aa0364a3aae8
parent c046e77dec8f8548b2d3988bd00fcccc880fe757
author DragonyteEvol <acuarionevol@outlook.com> 1686572861 +0000
committer DragonyteEvol <acuarionevol@outlook.com> 1697821104 -0500

feat: update view
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/63/20883040fcc985f2ac32c5aa844826a093d35d
  Tamaño: 244       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293518    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.089594063 -0500
Modificación: 2023-03-28 17:22:06.617978310 -0500
      Cambio: 2023-10-20 16:46:06.570000055 -0500
    Creación: 2023-10-20 16:46:06.570000055 -0500
<?php 
class SourceModel extends Model{
	protected $table = "plugin";
	protected $columns = ["vendor"];
	protected $args= [":vendor"];

	public function __construct(){
		parent::__construct(TRUE);
	}

	public function getAll()
	{
		$sql = "SELECT vendor FROM $this->table GROUP BY 1";
		$data =$this->getCustom($sql);
		return $data;
	}

}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/63/5b7d7aab4396cf4131da75f5e3e1b0b44053ee
  Tamaño: 171       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293517    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.089594063 -0500
Modificación: 2023-03-23 13:20:31.315631477 -0500
      Cambio: 2023-10-20 16:46:06.570000055 -0500
    Creación: 2023-10-20 16:46:06.570000055 -0500
tree 685bdc43c2d9fcfb8bb77c8a60466c54fc4acdec
parent bf5097b23f98e15ac7c6c3302674281da19c5d4c
author DragonyteEvol <acuarionevol@outlook.com> 1679595631 +0000
committer DragonyteEvol <acuarionevol@outlook.com> 1679595631 +0000

model base created
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/64/bb9e326f281cd95fb75d48fcd34fb5e03091cf
  Tamaño: 84        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293986    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.392923215 -0500
Modificación: 2023-05-14 08:14:49.431975112 -0500
      Cambio: 2023-10-20 16:46:06.806660484 -0500
    Creación: 2023-10-20 16:46:06.803327239 -0500
100644 blob 97b1828d19670ca13dd69f3270dd0eac7ec6fe5b	create.php
100644 blob c27ef1419872057a0e6427d628d815166b454b22	index.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/65/ae35ed2cd2fc7d2a4662c479a937e2c04dd6b9
  Tamaño: 58        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293619    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.139593374 -0500
Modificación: 2023-03-09 13:44:00.559096102 -0500
      Cambio: 2023-10-20 16:46:06.616665492 -0500
    Creación: 2023-10-20 16:46:06.616665492 -0500
100644 blob ec6972a4e4b0a2325c44ca8e11d0f43be31ff4bc	UserModel.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/66/64345e7c9f4d964dbaff1cb0aca2ee5b622992
  Tamaño: 1934      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293592    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.126260224 -0500
Modificación: 2023-05-15 15:43:00.066708524 -0500
      Cambio: 2023-10-20 16:46:06.603332510 -0500
    Creación: 2023-10-20 16:46:06.603332510 -0500
<?php 
class Model{
	public $db;
	private $data;
	private $process_data;

	public function __construct($second_database = FALSE){
		$this->db=Connection::connect($second_database);
	}

	/* permite ejecutar consultas sql customizadas a cada modelo */
	/* 	retorna la informacion consultada o registrada */
	public function getCustom($sql,$param=0){
		$this->execute($sql,$this->table,$param);
		return $this->data;
	}

	/* toma todos los usuarios de la base de datos */
	/* 	retorna un lista con usuarios */
	/* puede recibir un array de nobres de tablas para generar una relacion de uno a muchos */
	public function getAll(){
		/* relacion de tablas */
		$sql = "SELECT *,$this->table.id as id_master FROM $this->table ";
		if(count($this->relations)<>0){
			foreach($this->relations as $join){
				$column = substr($join,0,-1) . "_id";
				$sql = $sql . "INNER JOIN $join ON $this->table.$column=$join.id ";
			}
		}
		/* ejecucion de query */
		$this->execute($sql,$this->table);
		return $this->data;
	}

	/* toma un usuario por id de la base de datos */
	/* 	retorna una lista con el usuario */
	public function selectById($id){
		$sql = "SELECT *,$this->table.id as master_id FROM $this->table WHERE $this->table.id=:id";
		$this->execute($sql,$this->table,$id);
		if(count($this->much_to_much)<>0){
			$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
			foreach(array_keys($this->much_to_much) as $join){
				$relation= substr($this->much_to_much[$join],0,-1);
				$table_relation = substr($join,0,-1) . "_" . $relation;
				$column_1 = $relation . "_id";
				$column_2 = substr($join,0,-1) . "_id";
				$join_table = $this->much_to_much[$join];
				$sql = $sql . "INNER JOIN $table_relation ON $join.id=$table_relation.$column_2 ";
				$sql = $sql . "INNER JOIN $join_table ON $table_relation.$column_1=$join_table.id ";
				$sql = $sql . "WHERE $this->table.id=:id";
				$this->execute($sql,$join_table,$id);
				$sql = str_replace("WHERE $this->table.id=:id","",$sql);
			}
		}
		return $this->data;
	}

	/* inserta un registro a la base de datos con sus respectivas relaciones */
	/* 	retorna el id del elemento registrado */
	public function insert(){
		try{
			if(!$this->db->inTransaction()){
				$this->db->beginTransaction();
			}
			$columns = implode(",",$this->columns);
			$args = implode(",",$this->args);
			$sql = "INSERT INTO $this->table($columns) values($args)";
			$state = $this->db->prepare($sql);
			$this->setParams($state);
			$state->execute();
			$id = $this->db->lastInsertId();
			if(count($this->much_to_much)>0){
				foreach(array_keys($this->much_to_much) as $join){
					$relation= substr($this->much_to_much[$join],0,-1);//event
					$table_relation = substr($join,0,-1) . "_" . $relation;//kri_event
					$column_2 = substr($join,0,-1) . "_id";//kri_id
					$column_1 = $relation . "_id";//event_id
					$sql = "INSERT INTO $table_relation($column_1,$column_2) VALUES(:$column_1,:$column_2)";
					for($i=0;$i< count($_POST[$relation]);$i++){
						$state = $this->db->prepare($sql);
						$state->bindParam(":$column_1",$_POST[$relation][$i]);
						$state->bindParam(":$column_2",$id);
						$state->execute();
					}
				}

			}
			return $id;
		}catch(PDOException $e){
			echo $e->getMessage();
			$this->db->rollBack();
		}
	}

	/* modifica un elemento en la base de datos */
	/* 	retorna el ultimo in elemento de la tabla */
	public function update(){
		try{
			if(!$this->db->inTransaction()){
				$this->db->beginTransaction();
			}
			$prepare_sql = "";
			for($i=0;$i < count($this->args);$i++){
				if((count($this->args)-1)==$i){
					$prepare_sql = $prepare_sql . $this->columns[$i] . "=" . $this->args[$i];
				}else{
					$prepare_sql = $prepare_sql . $this->columns[$i] . "=" . $this->args[$i] . ",";
				}
			}
			$sql = "UPDATE $this->table set $prepare_sql WHERE id=:id";
			$state = $this->db->prepare($sql);
			$this->setParams($state);
			$state->bindParam(":id",$this->id);
			$state->execute();
			return $this->db->lastInsertId();
		}catch(PDOException $e){
			$this->db->rollBack();
		}
	}

	/* borra un elemento de la base de datos */
	/* 	no retorna informacion */
	public function delete($id){
		try{
			if(!$this->db->inTransaction()){
				$this->db->beginTransaction();
			}
			$sql = "DELETE FROM $this->table WHERE id=:id";
			$state = $this->db->prepare($sql);
			$state->bindParam(":id",$id);
			$state->execute();
		}catch(PDOException $e){
			$this->db->rollBack();
		}
	}

	/* busca elementos en la base de datos */
	/* 	retorna un array con los elementos encontrados */
	public function search($search){
		$column = substr($this->table,0,-1);
		$sql = "SELECT * FROM $this->table WHERE $column LIKE '%$search%'";
		$this->execute($sql,$this->table);
		return $this->data;
	}

	/* escribe los cambios en la base de datos si el dml esta en una transaccion */
	/* 	no retorna informacion pero termina la transaccion actual */
	public function saveChanges(){
		$this->db->commit();
	}

	/* establece las variables de las consultas preparadas */
	/* 	no retorna informacion pero deja la consulta preparada lista para su ejecucion */
	private function setParams($state){
		for($i=0;$i < count($this->args);$i++){
			if($this->args[$i]==":password"){
				$password = password_hash($this->password,PASSWORD_BCRYPT);
				$state->bindParam($this->args[$i],$password);
			}else{
				$state->bindParam($this->args[$i],$this->{$this->columns[$i]});
			}
		}
	}

	/* ejecuta la consulta preparada */
	/* modifica la variable data adjuntando la informacion en esta variable */
	private function execute($sql,$key,$id=0){
		$state = $this->db->prepare($sql);
		if($id<>0){
			$state->bindParam(":id",$id);
		}
		if($state->execute()){
			while($row=$state->fetch(PDO::FETCH_ASSOC)){
				$this->process_data[]=$row;
			}
			$this->data[$key]=$this->process_data;
			$this->process_data=[];
		}
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/67/5ca80493965d2db9a143d34f10ae7c5abe31c2
  Tamaño: 618       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293873    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.299591169 -0500
Modificación: 2023-04-06 11:42:20.629384035 -0500
      Cambio: 2023-10-20 16:46:06.723329347 -0500
    Creación: 2023-10-20 16:46:06.723329347 -0500
<?php
class Controller{

	public $controller;

	/* el contructor trae el controllador al que se accede desde la url y lo aloja en la clase */
	public function __construct()
	{
		$this->controller = $_GET["controller"];
	}

	/* retona la vista de inicio y trae sus datos en lista */
	public function index(){
		$data=$this->model->getAll();
		require_once("views/$this->controller/index.php");
	}

	/* retorna la vista de mostrar un solo elemento con la informacion del elemnto */
	public function show(){
		$id = $_GET["id"]; 
		$data=$this->model->selectById($id);
		require_once("views/$this->controller/show.php");
	}

	/* crea un elemento y redirecciona al inicio */
	public function create(){
		$this->modelParams();
		$this->model->insert();
		header("Location: /$this->controller");
	}

	/* modifica un elemento y redirecciona al inicio */
	public function update(){
		$this->model->id = $_GET["id"];
		$this->modelParams();
		$this->model->update();
		header("Location: /$this->controller");
	}

	/* borra un elemento y redireccion al inicio */
	public function delete(){
		$id = $_GET["id"];
		$this->model->delete($id);
		header("Location: /$this->controller");
	}

	/* relaciona los parametros de entrado por POST con parametros de la clase */
	private function modelParams(){
		foreach(array_keys($_POST) as $key){
			$this->model->{$key} = $_POST[$key];
		}
	}

	/* index - lista todos los elementos */
	/* show - muestra un elemento por su id */
	/* create - crea un elemento */
	/* update - modifica un elemento */
	/* delete - borra un elemento */
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/67/846ec79bfff23183249bb6f016fd90f343e2fa
  Tamaño: 319       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293872    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.299591169 -0500
Modificación: 2023-10-18 16:45:38.157256572 -0500
      Cambio: 2023-10-20 16:46:06.723329347 -0500
    Creación: 2023-10-20 16:46:06.723329347 -0500
<?php
require_once("models/RiskModel.php");
class RiskController extends Controller{
	public $autosave = true;	

	public function __construct(){
		parent::__construct();
		$this->model = new RiskModel();
	}

	/* retorna la vista de mostrar un solo elemento con la informacion del elemnto */
	public function show(){
		$id = $_GET["id"]; 
		$data=$this->model->selectById($id);
		$data["score"] = $this->model->getScore($data["kris"]);
		require_once("views/$this->controller/show.php");
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/67/f18ef7aaa6bb050d08ac4df4031645d21eef7b
  Tamaño: 173       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293871    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.299591169 -0500
Modificación: 2023-03-23 13:25:17.762303304 -0500
      Cambio: 2023-10-20 16:46:06.723329347 -0500
    Creación: 2023-10-20 16:46:06.723329347 -0500
tree fd00205ddb919bd4a04be65a1bb9b173163fcb47
parent 635b7d7aab4396cf4131da75f5e3e1b0b44053ee
author DragonyteEvol <acuarionevol@outlook.com> 1679595917 +0000
committer DragonyteEvol <acuarionevol@outlook.com> 1679595917 +0000

added sql to database
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/68/0552f6418b4128d1cc3d8cb3d9424f074bb802
  Tamaño: 285       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293936    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.332924043 -0500
Modificación: 2023-02-24 01:39:43.517402201 -0500
      Cambio: 2023-10-20 16:46:06.779994521 -0500
    Creación: 2023-10-20 16:46:06.776661275 -0500
100644 blob da437ed708de7ea2d1ed5bb37dc51d00740740f6	Dockerfile
040000 tree 24da435abea8fd62be16fe6701640f7684131640	assets
040000 tree 5e1507f2327128680002b912ed9fb91c37a4ae0a	components
100644 blob f23d45901fe22a0ccdb21bfc95f1a231bd06a2bc	database.php
100644 blob a705a4041e04e9d51bf01a1dbecf59723e4b2207	index.php
100755 blob af6a408238a3b36b96585539420161af30c42234	init.vim
100644 blob ee06d43b65d5e5df0c182c099e95ea2f00eaf2e1	login.php
100644 blob c83546b1aa08d5e6e76f4b74b1ea2499011b801e	singup.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/68/19d61481e38d0edb2ff89b3235ec0aae360f80
  Tamaño: 71        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293938    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.332924043 -0500
Modificación: 2023-10-07 12:37:25.677153803 -0500
      Cambio: 2023-10-20 16:46:06.783327766 -0500
    Creación: 2023-10-20 16:46:06.779994521 -0500
040000 tree bcf616d3942cc000681f5c65d3cabf8bb6701ce3	css
040000 tree 4584348f8f2f92259a422852c81040f3a76b8a76	js
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/68/5bdc43c2d9fcfb8bb77c8a60466c54fc4acdec
  Tamaño: 371       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293937    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.332924043 -0500
Modificación: 2023-03-23 13:20:22.572297986 -0500
      Cambio: 2023-10-20 16:46:06.779994521 -0500
    Creación: 2023-10-20 16:46:06.779994521 -0500
100644 blob 6d6439aba4747c1cef248b31d8b285cea7edaec4	.htaccess
100644 blob da437ed708de7ea2d1ed5bb37dc51d00740740f6	Dockerfile
040000 tree 0d92498866d4f8052aa2042686156a488dbc030e	assets
040000 tree b055b0905a34aea1429e2e0a15223facdb174cd3	components
100644 blob 518e0b10de2304163e8239495cd07c0bfdeaf0db	config.php
040000 tree 0956b0e17c0dca01d2d22e6dcfff983d8e0308cd	controllers
100644 blob f4c57c999b6b5ffebe3bfab3989f0c379c3ba691	database.php
100644 blob 819b8069ed804d4494505e0b6b43eb9db46c3990	database2.php
040000 tree 995e0e7b2db8556e80640a1994f1f8ab4a62fbc4	models
100644 blob f0eb5f89aa31e90b7e9053415fef8096016728bf	router.php
040000 tree 2f5d7e49cca0b3a746dded8d83c025c0948a170b	views
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/68/d2742ff568a94249750498eeb49e73fcfef7ec
  Tamaño: 436       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293935    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.332924043 -0500
Modificación: 2023-10-16 16:47:28.123065869 -0500
      Cambio: 2023-10-20 16:46:06.776661275 -0500
    Creación: 2023-10-20 16:46:06.776661275 -0500
100644 blob 46141854b6c4aac2047018836b3340f5f62dd0c2	.htaccess
100644 blob da437ed708de7ea2d1ed5bb37dc51d00740740f6	Dockerfile
040000 tree dd6218d45158d9a2b0981c704e5c5c0d3130c418	assets
040000 tree ee84c1fda671963354e74a972bfc478930dd45c8	components
100644 blob 886fe19262e1dcc9bc5827b9b360744e6fe4cf58	config.php
040000 tree e5ae2b993393e809756d4609d0ff2a23a307be1e	controllers
100644 blob 8dadb53d86e692a9145d4db33bc19d31c3303116	data.sql
100644 blob 82c1b06cf8655c3159204f46dafb691aa3fe03c0	database.php
100644 blob 27dae4899dda3ef6df80d4bdc4ec9c52248ccb59	index.php
040000 tree 885e839812b7a9084d0c50a98a9b4c0bca55c233	models
100644 blob d9a4ec66dfeb45d52c58647f352aaaae6b84cd28	router.php
100644 blob b82cea160f9cfcea3268f5371dbfc4fff71c4b97	seeder.sql
040000 tree 5c5cd40bf28fe21614fb3545708dc1b54af06774	views
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/6c/a66bf5ccfd8ea4b7f12dac3a50c97ec6b567de
  Tamaño: 437       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293859    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.246258570 -0500
Modificación: 2023-09-04 05:41:56.393352310 -0500
      Cambio: 2023-10-20 16:46:06.719996103 -0500
    Creación: 2023-10-20 16:46:06.719996103 -0500
100644 blob 46141854b6c4aac2047018836b3340f5f62dd0c2	.htaccess
100644 blob da437ed708de7ea2d1ed5bb37dc51d00740740f6	Dockerfile
040000 tree 0003946c5eabca436e7fc8bbc56df7cb281ad82f	assets
040000 tree 0994b646c5cf6fe1259596f6e540c6055d0d4e1c	components
100644 blob 886fe19262e1dcc9bc5827b9b360744e6fe4cf58	config.php
040000 tree 3329768bb423a41c591994dd10004b955cd995aa	controllers
100644 blob 8dadb53d86e692a9145d4db33bc19d31c3303116	data.sql
100644 blob 82c1b06cf8655c3159204f46dafb691aa3fe03c0	database.php
100644 blob 27dae4899dda3ef6df80d4bdc4ec9c52248ccb59	index.php
040000 tree 7046280d0cc412fea068f988e20ecff02660c27a	models
100644 blob d9a4ec66dfeb45d52c58647f352aaaae6b84cd28	router.php
100644 blob b82cea160f9cfcea3268f5371dbfc4fff71c4b97	seeder.sql
040000 tree f0884e35b716d60b93b38a60c1e8868a6f6f9cea	views
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/6d/6439aba4747c1cef248b31d8b285cea7edaec4
  Tamaño: 106       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293707    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.179592822 -0500
Modificación: 2023-03-23 13:20:08.658964402 -0500
      Cambio: 2023-10-20 16:46:06.653331192 -0500
    Creación: 2023-10-20 16:46:06.653331192 -0500
RewriteEngine On
RewriteRule ^([a-z]+)\/?([a-z]*)\/?([0-9]*)$ router.php?controller=$1&action=$2&id=$3
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/6e/c0742d4cbf2bc6d52e80e97f0954b9ba429d27
  Tamaño: 1415      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293549    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.102927213 -0500
Modificación: 2023-10-17 15:55:29.879873775 -0500
      Cambio: 2023-10-20 16:46:06.583333037 -0500
    Creación: 2023-10-20 16:46:06.583333037 -0500
<?php 
class EventModel extends Model{
	protected $table = "events";
	protected $columns = ["event","type","source_id","event_id"];
	protected $args= [":event",":type",":source_id",":event_id"];
	protected $record_table="records";
	protected $search_criteria="event";

	public function __construct(){
		parent::__construct();
	}

	/* Consulta todos los elementos del modelo en base en datos */
	/* retorna un array con los elementos consultados */
	public function getAll(){
		//optencion de query
		$sql = $this->getSelectQuery(TRUE);
		/* ejecucion de query */
		$this->execute($sql,$this->table);
		return $this->data;
	}

	/* Calcula el valor de un ecuacion relacionando los numeros a id de eventos y consultando su repeticion de aparicion en OSIEM en un tiempo determinado */
	/* recibe como entrada una ecuacion en formato string */
	/* retorna un numero con el valor de la ecuacion en un tiempo determinado */
	public function getScore($syntax){
		/* generar array de numeros */
		$array_events= $this->extractNumberEvents($syntax);
		/* consultar eventos y aparicion */
		foreach($array_events as $event_id){
			$events = $this->selectById($event_id);
			foreach($events["events"] as $event){
				$score = $event["score"];
				$syntax = str_replace($event_id,$score,$syntax);
			}
		}
		/* evaluar ecuacion */
		/* !!!!!!IMPORTANTE!!!!!!!!! */
		/* Aplicar tecnicas de sanitizacion debido a que la funcion eval puede ser muy peligrosa y poner en riesgo la informacion */
		eval("\$score = $syntax;");
		return $score;
	}

	/* extrae el numero de evento de evento a partir de un ecuacion */
	/* recibe como entrada una ecuacion en formato string */
	/* ej. (25-56)/24 => Array(25,56,24) */
	/* retorna un array con los eventos identificados */
	private function extractNumberEvents($syntax){
		$array_number = array();
		$number = "";
		for($i=0;$i<strlen($syntax);$i++){
			if(is_numeric($syntax[$i])){
				$number = $number . $syntax[$i];
			}else{
				if($number!=""){
					array_push($array_number,$number);
					$number = "";
				}	
			}
		}
		if($number!=""){
			array_push($array_number,$number);
		}	
		return $array_number;
	}

	
	/* busca elementos en la base de datos */
	/* 	retorna un array con los elementos encontrados */
	public function selectById($id){
		$sql = $this->getSelectQuery(FALSE);
		$sql=$sql . " WHERE $this->table.id='$id' ";
		//AGRUPACION POR ID DE OSIEM Y FUENTE PARA EVITAR CRUCES DE EVENTOS
		$sql = $sql . "GROUP BY $this->table.id,$this->table.event_id,$this->table.source_id";
		$this->execute($sql,$this->table);
		return $this->data;
	}

	/* busca elementos en la base de datos */
	/* 	retorna un array con los elementos encontrados */
	public function search($search){
		$sql = $this->getSelectQuery(FALSE);
		$sql=$sql . " WHERE $this->search_criteria LIKE '%$search%' ";
		//AGRUPACION POR ID DE OSIEM Y FUENTE PARA EVITAR CRUCES DE EVENTOS
		$sql = $sql . "GROUP BY $this->table.id,$this->table.event_id,$this->table.source_id";
		$this->execute($sql,$this->table);
		return $this->data;
	}

	//genera el query principal de la seleccion de eventos
	//recibe como paremetros un booleano para inyectar al query la agrupacion por evento y fuente
	//retorna un string con la query a ejecutar
	private function getSelectQuery($group){
		$sql = "SELECT *,count($this->table.event_id) as score,$this->table.id as master_id FROM $this->table ";
		//UNION A CALCULO DE PUNTAJE 
		$sql = $sql . "LEFT JOIN $this->record_table ON $this->table.event_id=$this->record_table.event_id AND $this->table.source_id=$this->record_table.source_id ";
		//AGRUPACION POR ID DE OSIEM Y FUENTE PARA EVITAR CRUCES DE EVENTOS
		if($group){
			$sql = $sql . "GROUP BY $this->table.id,$this->table.event_id,$this->table.source_id";
		}
		return $sql;
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/70/1c934864ebd8c1a7624167e84da4fa42653d2f
  Tamaño: 2157      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293458    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.052927902 -0500
Modificación: 2023-10-16 17:33:26.035681053 -0500
      Cambio: 2023-10-20 16:46:06.540000846 -0500
    Creación: 2023-10-20 16:46:06.540000846 -0500
<?php 
class Model{
	public $db;
	public $data;
	private $process_data;

	public function __construct($second_database = FALSE){
		$this->db=Connection::connect($second_database);
	}

	/* permite ejecutar consultas sql customizadas a cada modelo */
	/* 	retorna la informacion consultada o registrada */
	public function getCustom($sql,$param=0){
		$this->execute($sql,$this->table,$param);
	}

	/* toma todos los usuarios de la base de datos */
	/* 	retorna un lista con usuarios */
	/* puede recibir un array de nobres de tablas para generar una relacion de uno a muchos */
	public function getAll(){
		/* relacion de tablas */
		$sql = "SELECT *,$this->table.id as id_master FROM $this->table ";
		if(count($this->one_to_one)<>0){
			foreach($this->one_to_one as $join){
				$column = substr($join,0,-1) . "_id";
				$sql = $sql . "INNER JOIN $join ON $this->table.$column=$join.id ";
			}
		}
		/* ejecucion de query */
		$this->execute($sql,$this->table);
		return $this->data;
	}

	/* toma un usuario por id de la base de datos */
	/* 	retorna una lista con el usuario */
	public function selectById($id){
		$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
		//RELACION 1 A 1
		if(count($this->one_to_one)<>0){
			foreach($this->one_to_one as $join){
				$column = substr($join,0,-1) . "_id";
				$sql = $sql . "INNER JOIN $join ON $this->table.$column=$join.id ";
			}
		}
		$sql = $sql . "WHERE $this->table.id=:id";
		$this->execute($sql,$this->table,$id);
		//RELACION 1 A MUCHOS
		if(count($this->one_to_much)<>0){
			$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
			foreach(array_keys($this->one_to_much) as $join){
				$relation= $this->one_to_much[$join];//QUALIFIERS;
				$column_2 = substr($join,0,-1) . "_id"; //KRI_ID;
				$sql = $sql . "INNER JOIN $relation ON $join.id=$relation.$column_2 ";
				$sql = $sql . "WHERE $this->table.id=:id";
				$this->data["sql"]=$sql;
				$this->execute($sql,$relation,$id);
				$sql = str_replace("WHERE $this->table.id=:id","",$sql);
			}
		}
		//RELACION MUCHOS A MUCHOS
		if(count($this->much_to_much)<>0){
			$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
			foreach(array_keys($this->much_to_much) as $join){
				$relation= substr($this->much_to_much[$join],0,-1);
				$table_relation = substr($join,0,-1) . "_" . $relation;
				$column_1 = $relation . "_id";
				$column_2 = substr($join,0,-1) . "_id";
				$join_table = $this->much_to_much[$join];
				$sql = $sql . " INNER JOIN $table_relation ON $join.id=$table_relation.$column_2 ";
				$sql = $sql . " INNER JOIN $join_table ON $table_relation.$column_1=$join_table.id ";
				$sql = $sql . "WHERE $this->table.id=:id";
				$this->execute($sql,$join_table,$id);
				$sql = str_replace("WHERE $this->table.id=:id","",$sql);
			}
		}
		return $this->data;
	}

	/* inserta un registro a la base de datos con sus respectivas relaciones */
	/* 	retorna el id del elemento registrado */
	public function insert(){
		try{
			if(!$this->db->inTransaction()){
				$this->db->beginTransaction();
			}
			$columns = implode(",",$this->columns);
			$args = implode(",",$this->args);
			$sql = "INSERT INTO $this->table($columns) values($args)";
			$state = $this->db->prepare($sql);
			$this->setParams($state);
			$state->execute();
			$id = $this->db->lastInsertId();
			if(count($this->much_to_much)>0){
				foreach(array_keys($this->much_to_much) as $join){
					$relation= substr($this->much_to_much[$join],0,-1);//event
					$table_relation = substr($join,0,-1) . "_" . $relation;//kri_event
					$column_2 = substr($join,0,-1) . "_id";//kri_id
					$column_1 = $relation . "_id";//event_id
					$sql = "INSERT INTO $table_relation($column_1,$column_2) VALUES(:$column_1,:$column_2)";
					for($i=0;$i< count($_POST[$relation]);$i++){
						$state = $this->db->prepare($sql);
						$state->bindParam(":$column_1",$_POST[$relation][$i]);
						$state->bindParam(":$column_2",$id);
						$state->execute();
					}
				}

			}
			return $id;
		}catch(PDOException $e){
			echo $e->getMessage();
			$this->db->rollBack();
		}
	}

	/* modifica un elemento en la base de datos */
	/* 	retorna el ultimo in elemento de la tabla */
	public function update($id){
		try{
			if(!$this->db->inTransaction()){
				$this->db->beginTransaction();
			}
			$prepare_sql = "";
			for($i=0;$i < count($this->args);$i++){
				if((count($this->args)-1)==$i){
					$prepare_sql = $prepare_sql . $this->columns[$i] . "=" . $this->args[$i];
				}else{
					$prepare_sql = $prepare_sql . $this->columns[$i] . "=" . $this->args[$i] . ",";
				}
			}
			$sql = "UPDATE $this->table set $prepare_sql WHERE id=:id";
			$state = $this->db->prepare($sql);
			$state = $this->setParams($state);
			$state->bindParam(":id",$id);
			$state->execute();
		}catch(PDOException $e){
			var_dump($e);
			$this->db->rollBack();
		}
	}

	/* borra un elemento de la base de datos */
	/* 	no retorna informacion */
	public function delete($id){
		try{
			if(!$this->db->inTransaction()){
				$this->db->beginTransaction();
			}
			$sql = "DELETE FROM $this->table WHERE id=:id";
			$state = $this->db->prepare($sql);
			$state->bindParam(":id",$id);
			$state->execute();
		}catch(PDOException $e){
			$this->db->rollBack();
		}
	}

	/* busca elementos en la base de datos */
	/* 	retorna un array con los elementos encontrados */
	public function search($search){
		$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
		if(count($this->one_to_one)<>0){
			foreach($this->one_to_one as $join){
				$column = substr($join,0,-1) . "_id";
				$sql = $sql . "INNER JOIN $join ON $this->table.$column=$join.id ";
			}
		}
		$column = substr($this->table,0,-1);
		$sql=$sql . " WHERE $column LIKE '%$search%'";
		$this->execute($sql,$this->table);
		return $this->data;
	}

	/* escribe los cambios en la base de datos si el dml esta en una transaccion */
	/* 	no retorna informacion pero termina la transaccion actual */
	public function saveChanges(){
		$this->db->commit();
	}

	/* establece las variables de las consultas preparadas */
	/* 	no retorna informacion pero deja la consulta preparada lista para su ejecucion */
	private function setParams($state){
		for($i=0;$i < count($this->args);$i++){
			if($this->args[$i]==":password"){
				$password = password_hash($this->password,PASSWORD_BCRYPT);
				$state->bindParam($this->args[$i],$password);
			}else{
				$state->bindParam($this->args[$i],$this->{$this->columns[$i]});
			}
		}
		return $state;
	}

	/* ejecuta la consulta preparada */
	/* modifica la variable data adjuntando la informacion en esta variable con llave especifica*/
	public function execute($sql,$key,$id=0){
		$state = $this->db->prepare($sql);
		if($id<>0){
			$state->bindParam(":id",$id);
		}
		if($state->execute()){
			while($row=$state->fetch(PDO::FETCH_ASSOC)){
				$this->process_data[]=$row;
			}
			$this->data[$key]=$this->process_data;
			$this->process_data=[];
		}
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/70/3c36d27c25912aa212a39ec145f446855afdbb
  Tamaño: 2133      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293461    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.056261189 -0500
Modificación: 2023-07-30 06:50:09.568334233 -0500
      Cambio: 2023-10-20 16:46:06.543334091 -0500
    Creación: 2023-10-20 16:46:06.543334091 -0500
<?php 
class Model{
	public $db;
	public $data;
	private $process_data;

	public function __construct($second_database = FALSE){
		$this->db=Connection::connect($second_database);
	}

	/* permite ejecutar consultas sql customizadas a cada modelo */
	/* 	retorna la informacion consultada o registrada */
	public function getCustom($sql,$param=0){
		$this->execute($sql,$this->table,$param);
		return $this->data;
	}

	/* toma todos los usuarios de la base de datos */
	/* 	retorna un lista con usuarios */
	/* puede recibir un array de nobres de tablas para generar una relacion de uno a muchos */
	public function getAll(){
		/* relacion de tablas */
		$sql = "SELECT *,$this->table.id as id_master FROM $this->table ";
		if(count($this->one_to_one)<>0){
			foreach($this->one_to_one as $join){
				$column = substr($join,0,-1) . "_id";
				$sql = $sql . "INNER JOIN $join ON $this->table.$column=$join.id ";
			}
		}
		/* ejecucion de query */
		$this->execute($sql,$this->table);
		return $this->data;
	}

	/* toma un usuario por id de la base de datos */
	/* 	retorna una lista con el usuario */
	public function selectById($id){
		$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
		//RELACION 1 A 1
		if(count($this->one_to_one)<>0){
			foreach($this->one_to_one as $join){
				$column = substr($join,0,-1) . "_id";
				$sql = $sql . "INNER JOIN $join ON $this->table.$column=$join.id ";
			}
		}
		$sql = $sql . "WHERE $this->table.id=:id";
		$this->execute($sql,$this->table,$id);
		//RELACION 1 A MUCHOS
		if(count($this->one_to_much)<>0){
			$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
			foreach(array_keys($this->one_to_much) as $join){
				$relation= $this->one_to_much[$join];//QUALIFIERS;
				$column_2 = substr($join,0,-1) . "_id"; //KRI_ID;
				$sql = $sql . "INNER JOIN $relation ON $join.id=$relation.$column_2 ";
				$sql = $sql . "WHERE $this->table.id=:id";
				$this->data["sql"]=$sql;
				$this->execute($sql,$relation,$id);
				$sql = str_replace("WHERE $this->table.id=:id","",$sql);
			}
		}
		//RELACION MUCHOS A MUCHOS
		if(count($this->much_to_much)<>0){
			$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
			foreach(array_keys($this->much_to_much) as $join){
				$relation= substr($this->much_to_much[$join],0,-1);
				$table_relation = substr($join,0,-1) . "_" . $relation;
				$column_1 = $relation . "_id";
				$column_2 = substr($join,0,-1) . "_id";
				$join_table = $this->much_to_much[$join];
				$sql = $sql . "INNER JOIN $table_relation ON $join.id=$table_relation.$column_2 ";
				$sql = $sql . "INNER JOIN $join_table ON $table_relation.$column_1=$join_table.id ";
				$sql = $sql . "WHERE $this->table.id=:id";
				$this->execute($sql,$join_table,$id);
				$sql = str_replace("WHERE $this->table.id=:id","",$sql);
			}
		}
		return $this->data;
	}

	/* inserta un registro a la base de datos con sus respectivas relaciones */
	/* 	retorna el id del elemento registrado */
	public function insert(){
		try{
			if(!$this->db->inTransaction()){
				$this->db->beginTransaction();
			}
			$columns = implode(",",$this->columns);
			$args = implode(",",$this->args);
			$sql = "INSERT INTO $this->table($columns) values($args)";
			$state = $this->db->prepare($sql);
			$this->setParams($state);
			$state->execute();
			$id = $this->db->lastInsertId();
			if(count($this->much_to_much)>0){
				foreach(array_keys($this->much_to_much) as $join){
					$relation= substr($this->much_to_much[$join],0,-1);//event
					$table_relation = substr($join,0,-1) . "_" . $relation;//kri_event
					$column_2 = substr($join,0,-1) . "_id";//kri_id
					$column_1 = $relation . "_id";//event_id
					$sql = "INSERT INTO $table_relation($column_1,$column_2) VALUES(:$column_1,:$column_2)";
					for($i=0;$i< count($_POST[$relation]);$i++){
						$state = $this->db->prepare($sql);
						$state->bindParam(":$column_1",$_POST[$relation][$i]);
						$state->bindParam(":$column_2",$id);
						$state->execute();
					}
				}

			}
			return $id;
		}catch(PDOException $e){
			echo $e->getMessage();
			$this->db->rollBack();
		}
	}

	/* modifica un elemento en la base de datos */
	/* 	retorna el ultimo in elemento de la tabla */
	public function update(){
		try{
			if(!$this->db->inTransaction()){
				$this->db->beginTransaction();
			}
			$prepare_sql = "";
			for($i=0;$i < count($this->args);$i++){
				if((count($this->args)-1)==$i){
					$prepare_sql = $prepare_sql . $this->columns[$i] . "=" . $this->args[$i];
				}else{
					$prepare_sql = $prepare_sql . $this->columns[$i] . "=" . $this->args[$i] . ",";
				}
			}
			$sql = "UPDATE $this->table set $prepare_sql WHERE id=:id";
			$state = $this->db->prepare($sql);
			$this->setParams($state);
			$state->bindParam(":id",$this->id);
			$state->execute();
			return $this->db->lastInsertId();
		}catch(PDOException $e){
			$this->db->rollBack();
		}
	}

	/* borra un elemento de la base de datos */
	/* 	no retorna informacion */
	public function delete($id){
		try{
			if(!$this->db->inTransaction()){
				$this->db->beginTransaction();
			}
			$sql = "DELETE FROM $this->table WHERE id=:id";
			$state = $this->db->prepare($sql);
			$state->bindParam(":id",$id);
			$state->execute();
		}catch(PDOException $e){
			$this->db->rollBack();
		}
	}

	/* busca elementos en la base de datos */
	/* 	retorna un array con los elementos encontrados */
	public function search($search){
		$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
		if(count($this->one_to_one)<>0){
			foreach($this->one_to_one as $join){
				$column = substr($join,0,-1) . "_id";
				$sql = $sql . "INNER JOIN $join ON $this->table.$column=$join.id ";
			}
		}
		$column = substr($this->table,0,-1);
		$sql=$sql . " WHERE $column LIKE '%$search%'";
		$this->execute($sql,$this->table);
		return $this->data;
	}

	/* escribe los cambios en la base de datos si el dml esta en una transaccion */
	/* 	no retorna informacion pero termina la transaccion actual */
	public function saveChanges(){
		$this->db->commit();
	}

	/* establece las variables de las consultas preparadas */
	/* 	no retorna informacion pero deja la consulta preparada lista para su ejecucion */
	private function setParams($state){
		for($i=0;$i < count($this->args);$i++){
			if($this->args[$i]==":password"){
				$password = password_hash($this->password,PASSWORD_BCRYPT);
				$state->bindParam($this->args[$i],$password);
			}else{
				$state->bindParam($this->args[$i],$this->{$this->columns[$i]});
			}
		}
	}

	/* ejecuta la consulta preparada */
	/* modifica la variable data adjuntando la informacion en esta variable */
	public function execute($sql,$key,$id=0){
		$state = $this->db->prepare($sql);
		if($id<>0){
			$state->bindParam(":id",$id);
		}
		if($state->execute()){
			while($row=$state->fetch(PDO::FETCH_ASSOC)){
				$this->process_data[]=$row;
			}
			$this->data[$key]=$this->process_data;
			$this->process_data=[];
		}
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/70/46280d0cc412fea068f988e20ecff02660c27a
  Tamaño: 358       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293459    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.052927902 -0500
Modificación: 2023-07-30 06:50:22.968333886 -0500
      Cambio: 2023-10-20 16:46:06.540000846 -0500
    Creación: 2023-10-20 16:46:06.540000846 -0500
100644 blob 849a4f10bd730fb0634e702ded7516e5042e4a59	EventModel.php
100644 blob 75ecfefcec79175ffb210f3fcbbe5c8b2e773879	KriModel.php
100644 blob 703c36d27c25912aa212a39ec145f446855afdbb	Model.php
100644 blob cf27b3beec50366ce112f05e7a070bf6cf045070	PropertieModel.php
100644 blob 2b7e2e2a08d9bfe6fc287d1eadf68a3ae2bef753	QualifierModel.php
100644 blob 3f36dc91c903e4be4239b127f4d48a9f11011911	RecordModel.php
100644 blob 730a24116f0181eadde3a5c5ca6e2d03d57ba8f7	RiskModel.php
100644 blob 05d7d4d8f9670e0e5b2c24fe3469c804e2f0f4b4	SourceModel.php
100644 blob 94c0b90d03c95b7e9484842795b32a9d4a3eacb3	TemplateModel.php
100644 blob 95085117329d973fd6c36029b44293bcedd69742	TypeModel.php
100644 blob 98bcd9d15ece27bab02c81584e6e0b10ed3cfd21	UserModel.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/70/e45ceb47c7d15dbfedbd1057dddd618a3faab6
  Tamaño: 437       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293460    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.056261189 -0500
Modificación: 2023-04-13 16:00:40.157082669 -0500
      Cambio: 2023-10-20 16:46:06.543334091 -0500
    Creación: 2023-10-20 16:46:06.540000846 -0500
100644 blob 46141854b6c4aac2047018836b3340f5f62dd0c2	.htaccess
100644 blob da437ed708de7ea2d1ed5bb37dc51d00740740f6	Dockerfile
040000 tree 3505ebb9924e03928d63b84ba645cb3e6ff1789a	assets
040000 tree 9c4a38e4261dc3f0ad3cb12e32ec9b1eaa1b8d09	components
100644 blob fc5c9dceab7ea6a3e92e9e475208d3d4a4402846	config.php
040000 tree b6fa123dd2d1eb37adeb02519451012042267d5b	controllers
100644 blob 8dadb53d86e692a9145d4db33bc19d31c3303116	data.sql
100644 blob 82c1b06cf8655c3159204f46dafb691aa3fe03c0	database.php
100644 blob 27dae4899dda3ef6df80d4bdc4ec9c52248ccb59	index.php
040000 tree 31f58096a38b58d43d09cd81149deb69aef0499d	models
100644 blob 30cca64a0adebfcd8627b0ae4cd71f260a04b1d0	router.php
100644 blob dc9cfb9c2e93b41acbe9d8bcc6932aa67031e82d	seeder.sql
040000 tree ac69238dfdd0f359374904173e88ce9601c3964f	views
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/72/0f58d6a022d4a25d56d8c93eaa65129da71568
  Tamaño: 237       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293479    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.062927764 -0500
Modificación: 2023-03-30 15:50:29.517642373 -0500
      Cambio: 2023-10-20 16:46:06.553333828 -0500
    Creación: 2023-10-20 16:46:06.550000582 -0500
100644 blob 675ca80493965d2db9a143d34f10ae7c5abe31c2	Controller.php
100644 blob 03d434714b9c4aeca68bd623c8ac65e1998fea2e	KriController.php
100644 blob ab88d0b50b2f02ca6a63488e849280128184eafb	LoginController.php
100644 blob 12620ce4178e3b649067d4a02a366ef83bb8d47e	RegisterController.php
100644 blob 5c7237e50bdf5fdcb1d03c9795d76e0fb64029ea	RiskController.php
100644 blob 8c1bb57955e07f847b2b8e617e4db6218f8ced28	SourceController.php
100644 blob fb02603f5e1e778c1b626de544c3f0834532d3e1	UserController.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/72/1b4670d38476502dea63998126110f4bea64a3
  Tamaño: 826       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293480    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.062927764 -0500
Modificación: 2023-10-16 17:33:26.035681053 -0500
      Cambio: 2023-10-20 16:46:06.553333828 -0500
    Creación: 2023-10-20 16:46:06.553333828 -0500
<?php  
include_once("components/header.php");
?>
<!-- FORMULARIO DE CREACION DE eventS -->
<div class="container">
	<form action="/event/update/27" method="POST" class="needs-validation">
		<div class="card my-5">
			<?php  foreach($data["events"] as $event): ?>
			<div class="card-header">
				<h5><b><?=$event['master_id']?> | </b><?=$event['event']?></h5>
			</div>
			<div class="card-body">
				<!-- EVENTO -->
				<div class="form-floating mb-3">
					<input type="text" value="<?= $event['event'] ?>" required class="form-control" name="event" id="floatingInput" placeholder="Insegra un nombre">
					<label for="floatingInput">Nombre del evento</label>
				</div>
				<div class="row">
					<div class="col-4">
						<!-- TIPO -->
						<div class="form-floating mb-3">
							<select name="type" class="form-select" id="datalistOptions" aria-label="">
								<option value="automatic">automatic</option>
								<option value="manual">manual</option>
							</select>
							<label for="floatingSelect">Tipo de evento</label>
						</div>
					</div>
					<div class="col-4">
						<!-- FUENTE ID OSIEM -->
						<div class="form-floating mb-3">
							<input name="source_id" type="number" value="<?= $event['source_id'] ?>" class="form-control">
							<label for="floatingInput">Fuente OSIEM</label>
						</div>
					</div>
					<div class="col-4">
						<!-- EVENT ID-->
						<div class="form-floating mb-3">
							<input name="event_id" type="number" value="<?= $event['event_id'] ?>" class="form-control">
							<label for="floatingInput">Evento OSIEM</label>
						</div>
					</div>
				</div>
				<?php  endforeach; ?>
			</div>
			<div class="card-footer">
				<!-- END FIELD -->
				<div class="row">
					<div class="col-4">
						<button type="reset" class="btn btn-outline-secondary form-control">Limpiar</button>
					</div>
					<div class="col-4">
						<button type="submit" class="btn btn-primary form-control">Actualizar</button>
					</div>
				</div>
			</div>
		</div>
	</form>
</div>
<script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/72/ad5b308420b3ad889e1e6f205d834a1313f45e
  Tamaño: 436       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293478    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.062927764 -0500
Modificación: 2023-05-14 07:33:53.945373115 -0500
      Cambio: 2023-10-20 16:46:06.550000582 -0500
    Creación: 2023-10-20 16:46:06.550000582 -0500
<?php  
include_once("components/header.php");
?>
<a href="/kri/create" class="btn pmd-btn-fab pmd-ripple-effect btn-secondary"><box-icon name='plus-medical' color='#ffffff'></box-icon></a>
<table class="table table-borderless">
	<thead>
		<tr>
			<th scope="col">#</th>
			<th scope="col">KRI</th>
			<th scope="col">Objetivo</th>
			<th scope="col">Propiedad</th>
			<th scope="col">Porcentage</th>
		</tr>
	</thead>
	<tbody>
		<?php  foreach($data["kris"] as $kri): ?>
		<tr>
			<th scope="row"><?= $kri["id_master"] ?></th>
			<td>
				<a href="/kri/show/<?= $kri['id_master'] ?>">
					<?= $kri["kri"] ?>
				</a>
			</td>
			<td><?= $kri["objective"] ?></td>
			<td><?= $kri["propertie"] ?></td>
			<td><?= $kri["percentage"] ?>%</td>
		</tr>
		<?php  endforeach; ?>
	</tbody>
</table>
<script>
	function pepe(){
		console.log("OK")
	}
</script>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/72/ca36875c175d1b4272f5da51d4cf39f6b260d4
  Tamaño: 2378      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293477    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.062927764 -0500
Modificación: 2023-10-15 17:00:48.706076267 -0500
      Cambio: 2023-10-20 16:46:06.550000582 -0500
    Creación: 2023-10-20 16:46:06.550000582 -0500
<?php  
include_once("components/header.php");
?>
<div class="container">
	
	<!-- ----------------------------------- -->
	<div class="card">
		<form action="/risk/update" method="POST" class="needs-validation">
			<?php foreach($data["risks"] as $risk): ?>
			<div class="row">
				<div class="col-xl-4 col-lg-6 mb-4">
					<div class="bg-white rounded-lg p-5 shadow">
						<h2 class="h6 font-weight-bold text-center mb-4">Valoración del Riesgo</h2>
						<!-- Progress bar 1 -->
						<div class="progress" role="progressbar" aria-label="Example with label" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">
							<div class="progress-bar" style="width: 25%">Bajo</div>
						</div>
						<!-- END -->

						<!-- Demo info -->
						<div class="row text-center mt-4">
							<div class="col-6 border-right">
								<div class="h4 font-weight-bold mb-0"><?= $data['score'] ?> P.</div><span class="small text-gray">Puntaje calculado</span>
							</div>
							<div class="col-6">
								<div class="h4 font-weight-bold mb-0"><?= $data["score_qualified"]["value"] ?></div><span class="small text-gray"><?= $data["score_qualified"]["type"] ?></span>
							</div>
						</div>
						<!-- END -->
					</div>
				</div>
				<div class="col-xl-8 col-lg-8 mb-8">
					<div class="bg-white rounded-lg p-5 shadow">
						<h2 class="h6 font-weight-bold text-center mb-4">Mapa relacional</h2>
						<div class="row align-items-center my-2">
							<div class="col-4">
								<button class="btn btn-outline-dark btn-sm form-control">
									<?= $risk["risk"] ?>
								</button>
							</div>
							<div class="col-4">
								<?php  foreach($data["kris"] as $kri): ?>
								<button class="btn btn-outline-dark btn-sm form-control my-2" data-bs-toggle="popover" data-bs-title="Descripcion del evento" data-bs-content="">
									<?= $kri["kri"]?>
								</button>
								<?php  endforeach; ?>
							</div>
							<div class="col-4">
								<?php  foreach($data["events"] as $event): ?>
								<button class="btn btn-outline-dark btn-sm form-control my-2" data-bs-toggle="popover" data-bs-title="Descripcion del evento" data-bs-content="">
									<?= $event["event"]?>
								</button>
								<?php  endforeach; ?>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- PRIMERA FILA -->
			<div class="card-header">
				<h5><b><?=$risk['master_id']?> | </b><?=$risk['risk']?></h5>
			</div>
			<div class="card-body">
				<!-- KRI -->
				<div class="form-floating mb-3">
					<input type="text" value="<?= $risk['risk'] ?>" required class="form-control" name="risk" id="floatingInput" placeholder="Insegra un nombre">
					<label for="floatingInput">Nombre del riesgo</label>
				</div>
				<div class="row">
					<div class="col-6">
						<!-- PROPIEDAD -->
						<div class="form-floating mb-3">
							<select name="propertie_id" class="form-select" id="datalistOptions" aria-label="">
								<option value="<?= $risk['propertie_id'] ?>" selected><?= $risk['propertie']?></option>
							</select>
							<label for="floatingSelect">Propiedad</label>
						</div>
					</div>
					<div class="col-6">
						<!-- TIPO -->
						<div class="form-floating mb-3">
							<select name="propertie_id" class="form-select" id="datalistOptions" aria-label="">
								<option value="<?= $risk['type_id'] ?>" selected><?= $risk['type']?></option>
							</select>
							<label for="floatingSelect">Tipo</label>
						</div>
					</div>
				</div>
				<div class="accordion accordion-flush" id="accordionFlushExample">
					<!-- KRI -->
					<div class="accordion-item">
						<h2 class="accordion-header">
							<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#event-collapse" aria-expanded="false" aria-controls="flush-collapseOne">
								KRIs	
							</button>
						</h2>
						<div id="event-collapse" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
							<div class="my-2">
								<button name="events" type="button" class="form-control btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addKri">
									Añadir KRI
								</button>
								<div class="form-check" id="kris"> 
									<?php  foreach($data["kris"] as $kri): ?>
									<div>
										<input type="checkbox" name="kris[]" value="<?= $kri['id'] ?>" class="btn-check" id="<?= $kri['kri'] ?>" autocomplete="off" checked>
										<label class="btn btn-sm btn-outline-danger my-2 form-control" for="<?= $kri['kri'] ?>"><?= $kri['kri'] ?> <span class="badge bg-secondary"><?= $kri['percentage'] ?>%</span></label>
									</div>
									<?php  endforeach; ?>
								</div>
							</div>
						</div>
					</div>
					<?php  endforeach; ?>
				</div>
				<div class="card-footer">
					<!-- END FIELD -->
					<div class="row">
						<div class="col-6">
							<button type="reset" class="btn btn-outline-secondary form-control">Limpiar</button>
						</div>
						<div class="col-6">
							<button type="submit" class="btn btn-primary form-control">Actualizar</button>
						</div>
					</div>
		</form>
				</div>
			</div>
			<!-- FORMULARIO DE ADICION DE KRIS -->
			<div class="modal fade" id="addKri" tabindex="-1" aria-labelledby="addKriLabel" aria-hidden="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h1 class="modal-title fs-5" id="addKriLabel">Buscar Evento</h1>
							<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
						</div>
						<div class="modal-body">
							<div class="form-floating mb-3">
								<input type="text" required class="form-control" id="searchKRI" placeholder="Insegra un nombre">
								<label for="floatingInput">Buscar evento</label>
							</div>
							<div class="justify-content-center" id="datalistOptionsKRI">
							</div>
						</div>
					</div>
				</div>
			</div>
	</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
<script src="/assets/js/search.js"></script>
<script>
	function customFunction(e){
		console.log(e)
		kris = document.getElementById("kris")
		html = kris.innerHTML
		html += "<div><input name='kri[]' value='"+e.id+"' type='checkbox' class='btn-check' id='"+e.kri+"' autocomplete='off' checked><label class='btn btn-sm btn-outline-danger my-2 form-control' for='"+e.kri+"'>"+e.kri+" <span class='badge bg-secondary'>"+e.percentage+"%</span></label></div>"
		kris.innerHTML = html
		modal = document.getElementById("addKri")
		modal.hide()
	}
	//EVENTOS
	searchEvent({
		componentEvent: "searchKRI",
		listOptions: "datalistOptionsKRI",
		search: "kri",
		components: new Map([
			["id","master_id"],
			["kri","kri"],
			["percentage","percentage"]
		]),
		value: "kri",
		table: "kris",
		tag: "button",
		customFunction: "customFunction",
		class: "btn btn-outline-primary form-control m-2' data-bs-dismiss='modal",
	})
</script>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/72/db1ddc4814f69b58761817564eff5936959b0b
  Tamaño: 346       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293481    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.062927764 -0500
Modificación: 2023-03-09 13:44:00.572429436 -0500
      Cambio: 2023-10-20 16:46:06.553333828 -0500
    Creación: 2023-10-20 16:46:06.553333828 -0500
100644 blob 6d6439aba4747c1cef248b31d8b285cea7edaec4	.htaccess
100644 blob da437ed708de7ea2d1ed5bb37dc51d00740740f6	Dockerfile
040000 tree 0d92498866d4f8052aa2042686156a488dbc030e	assets
040000 tree b055b0905a34aea1429e2e0a15223facdb174cd3	components
100644 blob 518e0b10de2304163e8239495cd07c0bfdeaf0db	config.php
040000 tree 3f1b0652c58d85e5f040d0bdcac7e833fff8fb9c	controllers
100644 blob c30106bebe8e4c8d15269163413d17eb08e94520	database.php
040000 tree 65ae35ed2cd2fc7d2a4662c479a937e2c04dd6b9	models
100644 blob 8359ecc5b1cd03bfa875e8aabff99fa22b232bd1	router.php
040000 tree efa9648e148a5040e3f1dc1466a9603935db2b25	views
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/73/0a24116f0181eadde3a5c5ca6e2d03d57ba8f7
  Tamaño: 352       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293942    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.336257330 -0500
Modificación: 2023-10-15 17:00:48.626078349 -0500
      Cambio: 2023-10-20 16:46:06.783327766 -0500
    Creación: 2023-10-20 16:46:06.783327766 -0500
<?php 
class RiskModel extends Model{
	/* tabla en la que actua  este modelo en base de datos */
	protected $table = "risks";

	/* columns que modifica el modelo en base de datos */
	protected $columns = ["type_id","propertie_id","risk",];

	/* columnas para modificacion en base de datos con consulta preparada */
	protected $args= [":type_id",":propertie_id",":risk"];

	/* relaciones entre bases de datos uno a muchos */
	protected $one_to_one= ["properties","types"];

	/* relaciones entre bases de datos de muchos a muchos se debe definir las dos tablas que se desean relacionar */
	protected $much_to_much= ["risks"=>"kris","kris"=>"events"];

	public function __construct(){
		parent::__construct();
	}

}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/74/863a65588c18ada0a0b8aec8f70bb06a61be29
  Tamaño: 1350      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293980    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.389589928 -0500
Modificación: 2023-04-13 16:00:20.353748983 -0500
      Cambio: 2023-10-20 16:46:06.803327239 -0500
    Creación: 2023-10-20 16:46:06.803327239 -0500
<?php  
include_once("components/header.php");
?>

<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalCreate">
  Launch static backdrop modal
</button>

<table class="table table-borderless">
  <thead>
    <tr>
      <th scope="col">#</th>
      <th scope="col">Evento</th>
      <th scope="col">Tipo</th>
    </tr>
  </thead>
  <tbody>
	  <?php  foreach($data["events"] as $risk): ?>
	  <tr>
		  <th scope="row"><?= $risk["id_master"] ?></th>
		  <td>
			  <a href="/event/show/<?= $risk['id_master'] ?>">
			  <?= $risk["event"] ?>
			  </a>
		  </td>
		  <td><?= $risk["propertie"] ?></td>
		  <td><?= $risk["type"] ?></td>
	  </tr>
	  <?php  endforeach; ?>
  </tbody>
</table>
<!-- ///////////////// -->
 <!-- Formulario modal para creacion de eventos --> 
<div id="modalCreate" class="modal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Crear evento</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
	  <div class="modal-body">
		  <!-- formulario de inicio de sesion -->
		  <form action="/event/insert" method="POST" class="needs-validation">
			<!-- TEMPLATE -->
			  <div class="form-floating mb-3">
				  <input type="text" class="form-control" list="datalistOptions" id="template" placeholder="Type to search...">
				  <datalist id="datalistOptions">
				  </datalist>
				  <label for="floatingInput">Selecciona y busca una platilla</label>
			  </div>

			  <!-- NOMBRE -->
			  <div class="form-floating mb-3">
				  <input type="text" required class="form-control" name="event" id="floatingInput" placeholder="Insegra un nombre">
				  <label for="floatingInput">Ingresa un nombre</label>
			  </div>
			  <!-- TIPO DE EVENTO -->
			  <div class="form-floating mb-3">
				  <select name="type" class="form-select" id="floatingSelect" aria-label="Floating label select example">
					  <option selected value="automatic">Automatico</option>
					  <option value="manual">Manual</option>
				  </select>
				  <label for="floatingSelect">Tipo de evento</label>
			  </div>
			  <!-- ID DE LA FUENTE -->
			  <div class="form-floating mb-3">
				  <input type="text" name="source_id" class="form-control disabled" id="source_id">
				  <label for="floatingInput">ID de la fuente</label>
			  </div>
			  <!-- IDE DEL EVENTO -->
			  <div class="form-floating mb-3">
				  <input name="event_id" type="text" class="form-control disabled" id="event_id">
				  <label for="floatingInput">ID del evento</label>
			  </div>
			  <!-- FUENTE -->
			  <div class="form-floating mb-3">
				  <input type="text" disabled class="form-control" id="source">
				  <label for="floatingInput">Fuente</label>
			  </div>
			  <div class="modal-footer">
				  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
				  <button type="submit" class="btn btn-primary">Enviar</button>
			  </div>
		  </form>
	  </div>
	</div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
<script src="assets/css/js/search.js"></script>
<script>
/* searchEvent({ */
/* componentEvent: "template", */
/* 	listOptions: "datalistOptions", */
/* 	search: "template", */
/* 	components: new Map([ */
/* 		["source_id","plugin_id"], */
/* 		["source","vendor"], */
/* 		["event_id","sid"] */
/* 	]), */
/* 	value: "name" */
/* }) */
searchEvent({
componentEvent: "template",
	listOptions: "datalistOptions",
	search: "template",
	components: new Map([
		["source_id","plugin_id"],
		["source","vendor"],
		["event_id","sid"]
	]),
	value: "name"
})
</script>
</script>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/74/88404deb644d5c52e3dde927adbcf90e43ae7f
  Tamaño: 333       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293979    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.389589928 -0500
Modificación: 2023-05-18 14:55:49.858630304 -0500
      Cambio: 2023-10-20 16:46:06.803327239 -0500
    Creación: 2023-10-20 16:46:06.803327239 -0500
100644 blob 916405f23887474176f88d1c45f7fa7fdbcdd9e2	Controller.php
100644 blob cf46f779337d6837f9e61d3a5217427646cefcc9	EventController.php
100644 blob ecf8f46cfad0e4507c5dfe2f10a592c1afe9bb35	KriController.php
100644 blob ab88d0b50b2f02ca6a63488e849280128184eafb	LoginController.php
100644 blob 56b41c3c0b81d3e213654e2b64a9e8e43e0c8b30	PropertieController.php
100644 blob 12620ce4178e3b649067d4a02a366ef83bb8d47e	RegisterController.php
100644 blob 5fa1c0a8e82b84d03e204b24bdde9483e720aba0	RiskController.php
100644 blob 8c1bb57955e07f847b2b8e617e4db6218f8ced28	SourceController.php
100644 blob 07a9d2abeb523436c2863c3129e2c4f1fd26c654	TemplateController.php
100644 blob fb02603f5e1e778c1b626de544c3f0834532d3e1	UserController.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/75/0346687b919f27ee4e68db696766e80324e699
  Tamaño: 1645      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293910    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.322924180 -0500
Modificación: 2023-07-30 06:50:09.498334235 -0500
      Cambio: 2023-10-20 16:46:06.759995048 -0500
    Creación: 2023-10-20 16:46:06.759995048 -0500
 // crea los eventos necesarios para una busqueda y sus consecuencias
// recibe como parametro de entra un json con la configuracion de la busqueda

// componenetEvent = El componente que recibira los eventos de cambio y keyup
// listOptions = la lista de opciones que se modificara cuando el servidor arroge respuesta
// searh = el nombre del modelo sin "controller" sobre el cual se realizara la busqueda
// componnets = el arreglo de componenetes que se quiere modificar cuando el evento arroje respuesta
// value = el valor que se quiere representar en la opcion de listOptions
	// EJEMPLO
// ({
// componentEvent: "template",
// 	listOptions: "datalistOptions",
// 	search: "template",
// 	components: new Map([
// 		["source_id","plugin_id"],
// 		["source","vendor"],
// 		["event_id","sid"]
// 	]),
// 	value: "name",
// 	table: "plugin_sid"
// })
function searchEvent(args){
	// Tomar los elementos pricipales de la busqueda
	var componentEvent = document.getElementById(args.componentEvent)
	var options = document.getElementById(args.listOptions)
	if(componentEvent==null){
		axios_get(args,options)
	}else{
		// evento de keyup y axios
		componentEvent.addEventListener('keyup',(e) =>{
			search = componentEvent.value;
			axios_get(args,options,search)
		})
		//evento de cambio
		componentEvent.addEventListener("change", (e)=>{
			for(var option of options.childNodes){
				if(option.value==componentEvent.value){
					for(c of args.components.keys()){
						var com = document.getElementById(c)
						com.value = option.attributes[c].value
					}
				}
			}

		})
	}
}

function axios_get(args,options,search=""){
	axios({
		method: "GET",
		url: "/"+args.search+"/search/" + (search.replace(" ","_"))
	}).then(res =>{
		options.innerHTML = ""
		select_options = ""
		for(var p of res.data[args.table]){
			select_options += "<"+args.tag+" "
			for(var pa of args.components){
				var val = pa[1]
				select_options += pa[0] + "='"+p[val]+"' "
			}
			var internalValue = args.value
			select_options += "value='"+p[internalValue]+"' class='"+args.class+"' onclick='"+args.customFunction+"({"
			for(var pa of args.components){
				var val = pa[1]
				select_options += pa[0] + ": "+ '"'+p[val]+'",'
			}
			select_options += "})'>"+p[internalValue]+"</"+args.tag+">"
			console.log(select_options)
		}
		options.innerHTML = select_options
	}).catch(e => {
		console.log("DEBUG:" + e)
	})
}

//-------------------------------------------------------------------------------
//Busca de forma asincrona en una tabla de base de datos para representarl la informacion consultada en una tabla
//resibe como entrada un argumento de tipo json de la siguiente forma:
//
/*{
componentevent: "search",
	listoptions: "kris",
	search: "kri",
	components: [
		"objective",
		"propertie",
		"percentage"
	],
	value: "kri",
	table: "kris",
}*/
//donde componentEvent es el cuadro de texto sobre el cual se realiza la busqueda
//listOptions es el cuerpo del elemento sobre el cual se van a mostrar los datos
//componenets es un array lista o elemeto iterable que contiene todos los datos a representar en la fila de informacion
//value es el campo principal del registro que generalmente es el nombre y que tiene un link asociado a el
//tabla es la tabla en base de datos sobre la cual se realizara la consulta
function searchTable(args){
	// Tomar los elementos pricipales de la busqueda
	var componentEvent = document.getElementById(args.componentEvent)
	var options = document.getElementById(args.listOptions)
	// evento de keyup y axios
	componentEvent.addEventListener('keyup',(e) =>{
		search = componentEvent.value;
		axios({
			method: "GET",
			url: "/"+args.search+"/search/" + (search.replace(" ","_"))
		}).then(res =>{
			var html = ""
			for(var p of res.data[args.table]){
				html+="<tr><th scope='row'>"+p.master_id+"</th>"
				html+="<td><a href='/"+args.value+"/show/"+p.master_id+"'>"+p[args.value]+"</a></td>"
				for(o of args.components){
					if(o=="score"){
						html+="<td><span class='badge text-bg-primary'>"+p[o]+"</span></td>"
					}else{
						html+="<td>"+p[o]+"</td>"
					}
				}
				html+="</tr>"
				options.innerHTML=html
			}
		}).catch(e => {
			console.log("DEBUG:" + e)
		})
	})
}
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/75/9b277e3e4bdc5b2df80cfb3f2e0ab099274429
  Tamaño: 54        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293909    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.319590893 -0500
Modificación: 2023-04-13 16:00:40.143749336 -0500
      Cambio: 2023-10-20 16:46:06.759995048 -0500
    Creación: 2023-10-20 16:46:06.759995048 -0500
100644 blob 5eb9f411a41319031b190a1ffd1564f0dfb94ee2	index.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/75/ecfefcec79175ffb210f3fcbbe5c8b2e773879
  Tamaño: 272       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293911    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.322924180 -0500
Modificación: 2023-05-18 14:54:53.491962623 -0500
      Cambio: 2023-10-20 16:46:06.766661539 -0500
    Creación: 2023-10-20 16:46:06.759995048 -0500
<?php 
class KriModel extends Model{
	protected $table = "kris";
	protected $columns = ["kri","objective","propertie_id","percentage","syntax"];
	protected $args= [":kri",":objective",":propertie_id",":percentage",":syntax"];
	protected $one_to_one= ["kris"=>"properties"];
	protected $one_to_much= ["kris"=>"qualifiers"];
	protected $much_to_much= ["kris"=>"events"];

	public function __construct(){
		parent::__construct();
	}

	/* public function insertKri(){ */
	/* 	$this->insert(); */
	/* } */
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/77/9bbcc808b53a8b23f509f871bc21fc3533a9b0
  Tamaño: 63        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293886    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.309591030 -0500
Modificación: 2023-03-16 15:57:44.938394760 -0500
      Cambio: 2023-10-20 16:46:06.733329084 -0500
    Creación: 2023-10-20 16:46:06.733329084 -0500
100644 blob ecc8de047fcd81f87dbe5154a3eb4eb70a1c1c8c	UserController.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/78/0543dcae704ef6c15ec37832c97da633668f99
  Tamaño: 161       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293567    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.112927074 -0500
Modificación: 2023-03-28 17:22:06.567978311 -0500
      Cambio: 2023-10-20 16:46:06.589999528 -0500
    Creación: 2023-10-20 16:46:06.589999528 -0500
<?php
require_once("models/RiskModel.php");
class RiskController extends Controller{

	public function __construct(){
		parent::__construct();
		$this->model = new RiskModel();
	}
	
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/78/592a30421dcdff168e2dce95c70bb2613607ec
  Tamaño: 161       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293568    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.112927074 -0500
Modificación: 2023-03-30 15:50:29.530975707 -0500
      Cambio: 2023-10-20 16:46:06.589999528 -0500
    Creación: 2023-10-20 16:46:06.589999528 -0500
040000 tree 4a50142398d9b17b7464afff51695fbefea76c13	kri
040000 tree c239fc53c58bda758970f22d883078bb441f7f9e	login
040000 tree 8494db4705a8620c9116e70e5f31fa4b042d135f	register
040000 tree 2f6c5691cd7fa5ac4aa9c09ebb3092d82aeffa1d	risk
040000 tree 51b4f483439170ce1f66b8dc07444e95bac424b7	user
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/79/11ccbc461079c54ffea2f1b7b6eea9a1cd2ade
  Tamaño: 400       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293552    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.106260500 -0500
Modificación: 2023-03-23 13:20:08.658964402 -0500
      Cambio: 2023-10-20 16:46:06.586666282 -0500
    Creación: 2023-10-20 16:46:06.583333037 -0500
<?php
require_once("models/UserModel.php");
class UserController{
	private $model;

	public function __construct(){
		$this->model = new UserModel();
	}
	public function index(){
		$data=$this->model->getUsers();
		var_dump($data);
	}

	public function show(){
		$id = $_GET["id"];
		$data=$this->model->getUserById($id);
		var_dump($data);
	}

	public function create(){
		$this->model->name = "test";
		$this->model->email = "test@hotmail.com";
		$this->model->password= "1234";
		$this->model->insert();
	}

	public function update(){
		$this->model->id = 1;
		$this->model->name = "pablo";
		$this->model->email = "test12@hotmail.com";
		$this->model->password= "1234";
		$this->model->update();
	}

	/* index - lista todos los elementos */
	/* show - muestra un elemento por su id */
	/* create - crea un elemento */
	/* update - modifica un elemento */
	/* delete - borra un elemento */
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/79/1f9a574ee5bedc8e5af3a5b6bf1650683c4ae7
  Tamaño: 191       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293551    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.102927213 -0500
Modificación: 2023-05-14 10:25:27.601768837 -0500
      Cambio: 2023-10-20 16:46:06.583333037 -0500
    Creación: 2023-10-20 16:46:06.583333037 -0500
040000 tree e7163dc73857b94aef2fd3bef6b5c904a4c4abb1	event
040000 tree 9c5b3be6a56702f475029584600dc7afd3cf8596	kri
040000 tree bf26cbec7b3a99878eea5fe64236fa8c6693da97	login
040000 tree 8494db4705a8620c9116e70e5f31fa4b042d135f	register
040000 tree 3f996d487c0a5063b1b018a35ccab9e527738db6	risk
040000 tree 51b4f483439170ce1f66b8dc07444e95bac424b7	user
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/7a/0130545fcf43ae1a38b7fd5aff33962568c03b
  Tamaño: 918       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293488    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.066261051 -0500
Modificación: 2023-03-28 17:22:06.617978310 -0500
      Cambio: 2023-10-20 16:46:06.556667073 -0500
    Creación: 2023-10-20 16:46:06.556667073 -0500
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Iniciar sesion - Csra</title>
		<link rel="stylesheet" href="assets/css/styles.css">
		<!-- cdn bootstrap -->
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
	</head>
	<body>
		<div class="container text-center">
			<div class="row justify-content-center">
				<div class="col-sm-10 col-md-8 col-lg-4">
					<h1>Iniciar sesion</h1>
					<span>o <a href="/register">Registrarse</a></span>
					<!-- formulario de inicio de sesion -->
					<form action="/login/login" method="POST" class="needs-validation">
						<?php if($_SESSION["error"]){?>
						<div class="p-3 text-danger-emphasis bg-danger-subtle border border-danger-subtle rounded-3">
							credenciales incorrectas
						</div>
						<?php } ?>
						<input required type="text" id="validationDefault01" oninvalid="this.setCustomValidity('Ingresa un correo')" class="form-control my-2" placeholder="Ingresa tu correo" name="email">
						<input required type="password" id="validationDefault01" class="form-control my-2" placeholder="Ingresa tu contraseña" oninvalid="this.setCustomValidity('Ingresa una contraseña')" name="password">
						<input class="form-control my-2 btn btn-primary" type="submit" value="Enviar">
					</form>
				</div>
			</div>
		</div>
	</body>
	<!-- javascript de bootstrap -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
</html>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/7a/818480691e7e22afb1c6955896ba963accda6c
  Tamaño: 438       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293489    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.066261051 -0500
Modificación: 2023-05-14 10:25:27.611768836 -0500
      Cambio: 2023-10-20 16:46:06.556667073 -0500
    Creación: 2023-10-20 16:46:06.556667073 -0500
100644 blob 46141854b6c4aac2047018836b3340f5f62dd0c2	.htaccess
100644 blob da437ed708de7ea2d1ed5bb37dc51d00740740f6	Dockerfile
040000 tree 39d44e28008599bd02bb3f75303394c5c0707cd5	assets
040000 tree 0994b646c5cf6fe1259596f6e540c6055d0d4e1c	components
100644 blob 886fe19262e1dcc9bc5827b9b360744e6fe4cf58	config.php
040000 tree c0fae699e8c80695907e038ab3b366c594d0172a	controllers
100644 blob 8dadb53d86e692a9145d4db33bc19d31c3303116	data.sql
100644 blob 82c1b06cf8655c3159204f46dafb691aa3fe03c0	database.php
100644 blob 27dae4899dda3ef6df80d4bdc4ec9c52248ccb59	index.php
040000 tree 8fb1efa6322ddbb014c1355a8eae953f59208ef4	models
100644 blob 30cca64a0adebfcd8627b0ae4cd71f260a04b1d0	router.php
100644 blob dc9cfb9c2e93b41acbe9d8bcc6932aa67031e82d	seeder.sql
040000 tree 791f9a574ee5bedc8e5af3a5b6bf1650683c4ae7	views
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/7b/74c1e96388286637549e7317254312e8cc99ff
  Tamaño: 358       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293565    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.112927074 -0500
Modificación: 2023-10-18 16:45:46.023708836 -0500
      Cambio: 2023-10-20 16:46:06.589999528 -0500
    Creación: 2023-10-20 16:46:06.589999528 -0500
100644 blob 6ec0742d4cbf2bc6d52e80e97f0954b9ba429d27	EventModel.php
100644 blob fcee99b97e460cc55341d071a423b702cb3fee91	KriModel.php
100644 blob b86d6040e2ff33646684be75e19a09975f41468b	Model.php
100644 blob cf27b3beec50366ce112f05e7a070bf6cf045070	PropertieModel.php
100644 blob f1562673fb0c495c4bdf7a70a6c59f834216445c	QualifierModel.php
100644 blob 3f36dc91c903e4be4239b127f4d48a9f11011911	RecordModel.php
100644 blob a4ee322d5a433d75e6860d9873973da73ab88b12	RiskModel.php
100644 blob 05d7d4d8f9670e0e5b2c24fe3469c804e2f0f4b4	SourceModel.php
100644 blob 94c0b90d03c95b7e9484842795b32a9d4a3eacb3	TemplateModel.php
100644 blob 95085117329d973fd6c36029b44293bcedd69742	TypeModel.php
100644 blob 98bcd9d15ece27bab02c81584e6e0b10ed3cfd21	UserModel.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/7b/7d7e81e8468da6cd329024af7e5eb90d11e3a1
  Tamaño: 161       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293564    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.112927074 -0500
Modificación: 2023-04-06 11:42:20.719384036 -0500
      Cambio: 2023-10-20 16:46:06.589999528 -0500
    Creación: 2023-10-20 16:46:06.589999528 -0500
<?php
require_once("models/EventModel.php");
class EventController extends Controller{

	public function __construct(){
		parent::__construct();
		$this->model = new EventModel();
	}

}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/7d/800670bf70416503ae27c25067f7f3d069b2c4
  Tamaño: 115       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293903    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.319590893 -0500
Modificación: 2023-10-17 16:44:13.004357953 -0500
      Cambio: 2023-10-20 16:46:06.739995575 -0500
    Creación: 2023-10-20 16:46:06.739995575 -0500
100644 blob f1981ec9a329fa949247d4e820570503dbc2c090	create.php
100644 blob 9b890f6c8ac64acf510924d30015a38d4b5bd9d0	index.php
100644 blob 52ae8e0575e94c109bb55c4e02f37c1b59087917	show.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/7d/882fce29a4bcb24d325d9142a8ddd970eb0aa2
  Tamaño: 436       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293902    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.319590893 -0500
Modificación: 2023-04-06 11:42:36.066050983 -0500
      Cambio: 2023-10-20 16:46:06.739995575 -0500
    Creación: 2023-10-20 16:46:06.739995575 -0500
100644 blob 46141854b6c4aac2047018836b3340f5f62dd0c2	.htaccess
100644 blob da437ed708de7ea2d1ed5bb37dc51d00740740f6	Dockerfile
040000 tree 3505ebb9924e03928d63b84ba645cb3e6ff1789a	assets
040000 tree 9c4a38e4261dc3f0ad3cb12e32ec9b1eaa1b8d09	components
100644 blob fc5c9dceab7ea6a3e92e9e475208d3d4a4402846	config.php
040000 tree 5697b2eb23a3494a8eb9d52636ba7abb5339bf03	controllers
100644 blob 8dadb53d86e692a9145d4db33bc19d31c3303116	data.sql
100644 blob 82c1b06cf8655c3159204f46dafb691aa3fe03c0	database.php
100644 blob 27dae4899dda3ef6df80d4bdc4ec9c52248ccb59	index.php
040000 tree 868b2b7d8fc0b00fc44f6b8125a73c0781c1db28	models
100644 blob 30cca64a0adebfcd8627b0ae4cd71f260a04b1d0	router.php
100644 blob dc9cfb9c2e93b41acbe9d8bcc6932aa67031e82d	seeder.sql
040000 tree 0f35fb8414fdd10a605776566afb2f822b56754b	views
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/7d/c24e32b0ebad87ef1d9b80fefd38629fa75087
  Tamaño: 251       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293901    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.316257606 -0500
Modificación: 2023-10-14 17:45:49.792306585 -0500
      Cambio: 2023-10-20 16:46:06.739995575 -0500
    Creación: 2023-10-20 16:46:06.739995575 -0500
040000 tree c6fcef640a78c9903fb6370e39da1c2dad660112	event
040000 tree 2f8936d52152af3cdddd42764f2beecc76060c4e	kri
040000 tree bf26cbec7b3a99878eea5fe64236fa8c6693da97	login
040000 tree 4f27caa9c5680f7c74a99a1cc1eb3911d428c67f	propertie
040000 tree 8494db4705a8620c9116e70e5f31fa4b042d135f	register
040000 tree b52e2a473825ac2719a6deeec6908576f3458f73	risk
040000 tree 2f47ccb2e200d0e41df57356190e2cc8bfd87708	type
040000 tree 51b4f483439170ce1f66b8dc07444e95bac424b7	user
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/7f/31c2d738a050ff614bc61451911174a722a76d
  Tamaño: 333       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293796    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.222925559 -0500
Modificación: 2023-05-19 15:57:49.852809675 -0500
      Cambio: 2023-10-20 16:46:06.693330138 -0500
    Creación: 2023-10-20 16:46:06.693330138 -0500
100644 blob 916405f23887474176f88d1c45f7fa7fdbcdd9e2	Controller.php
100644 blob cf46f779337d6837f9e61d3a5217427646cefcc9	EventController.php
100644 blob 98c3ca2672d8e18092c781648a6d6974b6295825	KriController.php
100644 blob ab88d0b50b2f02ca6a63488e849280128184eafb	LoginController.php
100644 blob 56b41c3c0b81d3e213654e2b64a9e8e43e0c8b30	PropertieController.php
100644 blob 12620ce4178e3b649067d4a02a366ef83bb8d47e	RegisterController.php
100644 blob 5fa1c0a8e82b84d03e204b24bdde9483e720aba0	RiskController.php
100644 blob 8c1bb57955e07f847b2b8e617e4db6218f8ced28	SourceController.php
100644 blob 07a9d2abeb523436c2863c3129e2c4f1fd26c654	TemplateController.php
100644 blob fb02603f5e1e778c1b626de544c3f0834532d3e1	UserController.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/81/21c7787359d46d481a87aaf188f7804f5cd62c
  Tamaño: 333       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293643    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.149593236 -0500
Modificación: 2023-05-15 15:43:32.870042406 -0500
      Cambio: 2023-10-20 16:46:06.626665228 -0500
    Creación: 2023-10-20 16:46:06.623331983 -0500
100644 blob 916405f23887474176f88d1c45f7fa7fdbcdd9e2	Controller.php
100644 blob cf46f779337d6837f9e61d3a5217427646cefcc9	EventController.php
100644 blob c3b0a2f0013cd03222fe73764d39cd1d0ced1df7	KriController.php
100644 blob ab88d0b50b2f02ca6a63488e849280128184eafb	LoginController.php
100644 blob 56b41c3c0b81d3e213654e2b64a9e8e43e0c8b30	PropertieController.php
100644 blob 12620ce4178e3b649067d4a02a366ef83bb8d47e	RegisterController.php
100644 blob 5fa1c0a8e82b84d03e204b24bdde9483e720aba0	RiskController.php
100644 blob 8c1bb57955e07f847b2b8e617e4db6218f8ced28	SourceController.php
100644 blob 07a9d2abeb523436c2863c3129e2c4f1fd26c654	TemplateController.php
100644 blob fb02603f5e1e778c1b626de544c3f0834532d3e1	UserController.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/81/9b8069ed804d4494505e0b6b43eb9db46c3990
  Tamaño: 264       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293642    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.149593236 -0500
Modificación: 2023-03-23 13:20:08.675631069 -0500
      Cambio: 2023-10-20 16:46:06.623331983 -0500
    Creación: 2023-10-20 16:46:06.623331983 -0500
<?php
/* variables de configuracion */
/* require_once("config.php"); */
class Connection{

	public static function connect(){
		include "config.php" ;
		try{
			$conn = new PDO("mysql:host=$server2;dbname=$database2",$username2,$password2);
			return $conn;
		}catch(PDOException $e){
			die("Connection Failed: " . $e->getMessage());
		}
	}
}
?>

---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/81/eba4d7f8df8a34e72c4aa34ef10adaa1243a24
  Tamaño: 2027      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293641    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.149593236 -0500
Modificación: 2023-06-24 08:01:27.619793423 -0500
      Cambio: 2023-10-20 16:46:06.623331983 -0500
    Creación: 2023-10-20 16:46:06.623331983 -0500
<?php  
include_once("components/header.php");
?>
<!-- FORMULARIO DE CREACION DE KRIS -->
<div class="container">
	<form action="/kri/update" method="POST" class="needs-validation">
		<div class="card my-5">
			<?php  foreach($data["kris"] as $kri): ?>
			<div class="card-header">
				<h5><b><?=$kri['master_id']?> | </b><?=$kri['kri']?></h5>
			</div>
			<div class="card-body">
				<!-- KRI -->
				<div class="form-floating mb-3">
					<input type="text" value="<?= $kri['kri'] ?>" required class="form-control" name="kri" id="floatingInput" placeholder="Insegra un nombre">
					<label for="floatingInput">Nombre del KRI</label>
				</div>
				<!-- OBJECTIVO -->
				<div class="form-floating">
					<textarea class="form-control mb-3" name="objective" id="floatingTextarea2"><?= $kri["objective"] ?></textarea>
					<label for="floatingTextarea2">Objetivo</label>
				</div>
				<div class="row">
					<div class="col-6">
						<!-- PROPIEDAD -->
						<div class="form-floating mb-3">
							<select name="propertie_id" class="form-select" id="datalistOptions" aria-label="">
								<option value="<?= $kri['propertie_id'] ?>" selected><?= $kri['propertie']?></option>
							</select>
							<label for="floatingSelect">Propiedad</label>
						</div>
					</div>
					<div class="col-6">
						<!-- PORCENTAJE -->
						<div class="form-floating mb-3">
							<input name="percentage" type="number" value="<?= $kri['percentage'] ?>" class="form-control">
							<label for="floatingInput">Porcentaje</label>
						</div>
					</div>
				</div>
				<!-- SYNTAX-->
				<div class="form-floating mb-3">
					<input name="syntax" type="text" value="<?= $kri['syntax'] ?>" class="form-control disabled">
					<label for="floatingInput">Sintaxis / Operacion de kri</label>
				</div>
				<div class="accordion accordion-flush" id="accordionFlushExample">
					<!-- EVENTOS -->
					<div class="accordion-item">
						<h2 class="accordion-header">
							<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#event-collapse" aria-expanded="false" aria-controls="flush-collapseOne">
								Eventos	
							</button>
						</h2>
						<div id="event-collapse" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
							<div class="my-2">
								<button name="events" type="button" class="form-control btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#exampleModal">
									Añadir evento
								</button>
								<?php  foreach($data["events"] as $event): ?>
								<div class="form-check">
									<input type="checkbox" checked id="<?= $event['event'] ?>" value="<?= $event['id'] ?>" name="event[]" class="form-check-input">
									<label class="form-check-label" for="<?= $event['event'] ?>"><?= $event['id']." | ".$event['event'] ?></label>
								</div>
								<?php  endforeach; ?>
							</div>
						</div>
					</div>
					<!-- QUALIFIERS -->
					<div class="accordion-item">
						<h2 class="accordion-header">
							<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#qualifier-collapse" aria-expanded="false" aria-controls="flush-collapseOne">
								Calificadores
							</button>
						</h2>
						<div id="qualifier-collapse" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
								<?php  foreach($data["qualifiers"] as $qualifier): ?>
								<div class="input-group mb-3">
									<div class="form-floating">
										<input type="text" value="<?= $qualifier['type'] ?>" class="form-control" name="qualifiers[]" id="floatingInputGroup1">
										<label for="floatingInputGroup1">Nombre Calificador</label>
									</div>
									<div class="form-floating">
										<input type="text" class="form-control" value="<?= $qualifier['value'] ?>" name="qualifiers_values[]" id="floatingInputGroup1">
										<label for="floatingInputGroup1">Valor</label>
									</div>
								</div>
								<?php  endforeach; ?>
								<button type="button" onclick="addQualifier()" class="form-control btn btn-outline-primary btn-sm">
									Agregar
								</button>
						</div>
					</div>
					<div class="accordion-item">
						<h2 class="accordion-header">
							<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#map-collapse" aria-expanded="false" aria-controls="flush-collapseOne">
								Mapa relacional
							</button>
						</h2>
						<div id="map-collapse" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
							<div class="row align-items-center my-2">
								<div class="col-6">
									<button class="btn btn-outline-dark btn-sm form-control">
										<?= $kri["kri"] ?>
									</button>
								</div>
								<div class="col-6">
									<?php  foreach($data["events"] as $event): ?>
									<button class="btn btn-outline-dark btn-sm form-control my-2" data-bs-toggle="popover" data-bs-title="Descripcion del evento" data-bs-content="">
										<?= $event["event"]?>
									</button>
									<?php  endforeach; ?>
								</div>
							</div>
						</div>
					</div>
				</div>
				<?php  endforeach; ?>
			</div>
			<div class="card-footer">
				<!-- END FIELD -->
				<div class="row">
					<div class="col-6">
						<button type="reset" class="btn btn-outline-secondary form-control">Limpiar</button>
					</div>
					<div class="col-6">
						<button type="submit" class="btn btn-primary form-control">Actualizar</button>
					</div>
				</div>
			</div>
	</form>
		</div>

		<!-- FORMULARIO DE ADICION DE EVENTOS -->
		<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h1 class="modal-title fs-5" id="exampleModalLabel">Buscar Evento</h1>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<div class="form-floating mb-3">
							<input type="text" required class="form-control" id="searchEvent" placeholder="Insegra un nombre">
							<label for="floatingInput">Buscar evento</label>
						</div>
						<div class="justify-content-center" id="datalistOptionsEvent">
						</div>
					</div>
				</div>
			</div>
		</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
<script src="/assets/js/search.js"></script>
<script>
	searchEvent({
		listOptions: "datalistOptions",
		search: "propertie",
		components: new Map([
			["value","id"]
		]),
		value: "propertie",
		table: "properties",
		tag: "option"
	})
</script>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/82/c1b06cf8655c3159204f46dafb691aa3fe03c0
  Tamaño: 298       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293554    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.106260500 -0500
Modificación: 2023-03-28 17:22:06.567978311 -0500
      Cambio: 2023-10-20 16:46:06.586666282 -0500
    Creación: 2023-10-20 16:46:06.586666282 -0500
<?php
/* variables de configuracion */
/* require_once("config.php"); */
class Connection{

	public static function connect($second_database){
		include "config.php" ;
		try{
			if($second_database){
				$conn = new PDO("mysql:host=$server2;dbname=$database2",$username2,$password2);
			}else{
				$conn = new PDO("mysql:host=$server;dbname=$database",$username,$password);
			}
			return $conn;
		}catch(PDOException $e){
			die("Connection Failed: " . $e->getMessage());
		}
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/83/002027fc0d31216b0a79e85e19fd40efaa5e6d
  Tamaño: 360       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293907    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.319590893 -0500
Modificación: 2023-10-07 13:37:54.402799378 -0500
      Cambio: 2023-10-20 16:46:06.759995048 -0500
    Creación: 2023-10-20 16:46:06.759995048 -0500
100644 blob 916405f23887474176f88d1c45f7fa7fdbcdd9e2	Controller.php
100644 blob c2e419c28d43ba1407fde4e413cdaab74e81544c	EventController.php
100644 blob 98c3ca2672d8e18092c781648a6d6974b6295825	KriController.php
100644 blob ab88d0b50b2f02ca6a63488e849280128184eafb	LoginController.php
100644 blob 56b41c3c0b81d3e213654e2b64a9e8e43e0c8b30	PropertieController.php
100644 blob 12620ce4178e3b649067d4a02a366ef83bb8d47e	RegisterController.php
100644 blob 5fa1c0a8e82b84d03e204b24bdde9483e720aba0	RiskController.php
100644 blob 8c1bb57955e07f847b2b8e617e4db6218f8ced28	SourceController.php
100644 blob 07a9d2abeb523436c2863c3129e2c4f1fd26c654	TemplateController.php
100644 blob 9948526e371ec84f39ad45662721203603f6abf6	TypeController.php
100644 blob fb02603f5e1e778c1b626de544c3f0834532d3e1	UserController.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/83/59ecc5b1cd03bfa875e8aabff99fa22b232bd1
  Tamaño: 184       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293905    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.319590893 -0500
Modificación: 2023-03-09 13:43:50.275762584 -0500
      Cambio: 2023-10-20 16:46:06.756661802 -0500
    Creación: 2023-10-20 16:46:06.739995575 -0500
<?php
	var_dump($_GET);
	$controller = $_GET["controller"];
	$action = $_GET["action"];
	$id = $_GET["id"];

	if(empty($action)){
		$action = "index";
	}
	$controller = ucfirst($controller) . "Controller";
	include "controllers/$controller.php";
	$ctrl = new $controller;
	$ctrl->{$action}();
?>

---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/83/7639cb99e6a4197e74b0e4362e74a79486c518
  Tamaño: 244       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293906    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.319590893 -0500
Modificación: 2023-03-28 17:22:06.621311644 -0500
      Cambio: 2023-10-20 16:46:06.759995048 -0500
    Creación: 2023-10-20 16:46:06.756661802 -0500
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title></title>
</head>
<body>
	<div class="container">
		<form class="form-control" action="">
			<input type="name" name="name" class="form-control" value="<?= $data[0]["name"] ?>">
			<input type="email" name="email" class="form-control" value="<?= $data[0]["email"] ?>">
			<input type="password" name="name" class="form-control" value="sea sapo">
		</form>
	</div>
</body>
</html>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/84/41109a06b6984f8ca8f81b5b38b979e7cda8d2
  Tamaño: 71        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293977    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.389589928 -0500
Modificación: 2023-10-07 13:37:54.402799378 -0500
      Cambio: 2023-10-20 16:46:06.799993993 -0500
    Creación: 2023-10-20 16:46:06.799993993 -0500
040000 tree bcf616d3942cc000681f5c65d3cabf8bb6701ce3	css
040000 tree e74a82b92004eeed6e65f046e35653162b6e982c	js
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/84/94db4705a8620c9116e70e5f31fa4b042d135f
  Tamaño: 54        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293976    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.389589928 -0500
Modificación: 2023-03-28 17:22:24.331311181 -0500
      Cambio: 2023-10-20 16:46:06.799993993 -0500
    Creación: 2023-10-20 16:46:06.799993993 -0500
100644 blob 0f5442a076633333fb6ee66e06bf9af94fd24f7c	index.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/84/9a4f10bd730fb0634e702ded7516e5042e4a59
  Tamaño: 675       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293975    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.386256641 -0500
Modificación: 2023-07-30 06:50:09.538334234 -0500
      Cambio: 2023-10-20 16:46:06.799993993 -0500
    Creación: 2023-10-20 16:46:06.799993993 -0500
<?php 
class EventModel extends Model{
	protected $table = "events";
	protected $columns = ["event","type","source_id","event_id"];
	protected $args= [":event",":type",":source_id",":event_id"];
	protected $record_table="records";

	public function __construct(){
		parent::__construct();
	}

	public function getAll(){
		/* relacion de tablas */
		$sql = "SELECT *,count($this->table.event_id) as score,$this->table.id as id_master FROM $this->table ";
		if(count($this->one_to_one)<>0){
			foreach($this->one_to_one as $join){
				$column = substr($join,0,-1) . "_id";
				$sql = $sql . "LEFT JOIN $join ON $this->table.$column=$join.id ";
			}
		}
		//UNION A CALCULO DE PUNTAJE 
		$sql = $sql . "LEFT JOIN $this->record_table ON $this->table.event_id=$this->record_table.event_id AND $this->table.source_id=$this->record_table.source_id ";
		//AGRUPACION POR ID DE OSIEM Y FUENTE PARA EVITAR CRUCES DE EVENTOS
		$sql = $sql . "GROUP BY $this->table.event_id,$this->table.source_id";
		/* ejecucion de query */
		$this->execute($sql,$this->table);
		return $this->data;
	}

	/* busca elementos en la base de datos */
	/* 	retorna un array con los elementos encontrados */
	public function search($search){
		$sql = "SELECT *,count($this->table.event_id) as score,$this->table.id as master_id FROM $this->table ";
		if(count($this->one_to_one)<>0){
			foreach($this->one_to_one as $join){
				$column = substr($join,0,-1) . "_id";
				$sql = $sql . "LEFT JOIN $join ON $this->table.$column=$join.id ";
			}
		}
		//UNION A CALCULO DE PUNTAJE 
		$sql = $sql . "LEFT JOIN $this->record_table ON $this->table.event_id=$this->record_table.event_id AND $this->table.source_id=$this->record_table.source_id ";
		$column = substr($this->table,0,-1);
		$sql=$sql . " WHERE $column LIKE '%$search%' ";
		//AGRUPACION POR ID DE OSIEM Y FUENTE PARA EVITAR CRUCES DE EVENTOS
		$sql = $sql . "GROUP BY $this->table.event_id,$this->table.source_id";
		$this->execute($sql,$this->table);
		return $this->data;
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/85/f9bb9a95b032e5df4c7055896bad5c0e2bf2bf
  Tamaño: 209       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293769    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.209592409 -0500
Modificación: 2023-04-13 16:00:20.353748983 -0500
      Cambio: 2023-10-20 16:46:06.683330401 -0500
    Creación: 2023-10-20 16:46:06.683330401 -0500
<?php 
class KriModel extends Model{
	protected $table = "kris";
	protected $columns = ["kri","objective","propertie_id","percentage","syntax"];
	protected $args= [":kri",":objective",":propertie_id",":percentage",":syntax"];
	protected $relations= ["kris"=>"properties"];

	public function __construct(){
		parent::__construct();
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/86/082de18bfcc18ed173b875f429390382aa8cc0
  Tamaño: 632       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293682    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.166259672 -0500
Modificación: 2023-10-14 17:45:41.852533592 -0500
      Cambio: 2023-10-20 16:46:06.643331456 -0500
    Creación: 2023-10-20 16:46:06.639998210 -0500
body{
	margin: 0;
	padding: 0;
	text-align: center;
	font-family: 'Roboto', sans-serif;
}
header{
	border-bottom: 2px solid #eee;
	padding: 20px 0;
	margin-bottom: 10px;
	width: 100%;
	text-align: center;
}
header a{
	text-decoration: none;
	color: #333;
}
.progress {
  width: 150px;
  height: 150px;
  background: none;
  position: relative;
}

.progress::after {
  content: "";
  width: 100%;
  height: 100%;
  border-radius: 50%;
  border: 6px solid #eee;
  position: absolute;
  top: 0;
  left: 0;
}

.progress>span {
  width: 50%;
  height: 100%;
  overflow: hidden;
  position: absolute;
  top: 0;
  z-index: 1;
}

.progress .progress-left {
  left: 0;
}

.progress .progress-bar {
  width: 100%;
  height: 100%;
  background: none;
  border-width: 6px;
  border-style: solid;
  position: absolute;
  top: 0;
}

.progress .progress-left .progress-bar {
  left: 100%;
  border-top-right-radius: 80px;
  border-bottom-right-radius: 80px;
  border-left: 0;
  -webkit-transform-origin: center left;
  transform-origin: center left;
}

.progress .progress-right {
  right: 0;
}

.progress .progress-right .progress-bar {
  left: -100%;
  border-top-left-radius: 80px;
  border-bottom-left-radius: 80px;
  border-right: 0;
  -webkit-transform-origin: center right;
  transform-origin: center right;
}

.progress .progress-value {
  position: absolute;
  top: 0;
  left: 0;
}

/*
*
* ==========================================
* FOR DEMO PURPOSE
* ==========================================
*
*/

body {
  background: #ff7e5f;
  background: -webkit-linear-gradient(to right, #ff7e5f, #feb47b);
  background: linear-gradient(to right, #ff7e5f, #feb47b);
  min-height: 100vh;
}

.rounded-lg {
  border-radius: 1rem;
}

.text-gray {
  color: #aaa;
}

div.h4 {
  line-height: 1rem;
}

---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/86/18fc15415a02efb22777cf80b5c28f37726a59
  Tamaño: 1433      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293684    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.166259672 -0500
Modificación: 2023-10-16 17:33:26.019014794 -0500
      Cambio: 2023-10-20 16:46:06.643331456 -0500
    Creación: 2023-10-20 16:46:06.643331456 -0500
<?php 
class EventModel extends Model{

	public $autosave = true;

	protected $table = "events";
	protected $columns = ["event","type","source_id","event_id"];
	protected $args= [":event",":type",":source_id",":event_id"];
	protected $record_table="records";
	protected $search_criteria="event";

	public function __construct(){
		parent::__construct();
	}

	/* Consulta todos los elementos del modelo en base en datos */
	/* retorna un array con los elementos consultados */
	public function getAll(){
		//optencion de query
		$sql = $this->getSelectQuery(TRUE);
		/* ejecucion de query */
		$this->execute($sql,$this->table);
		return $this->data;
	}

	/* Calcula el valor de un ecuacion relacionando los numeros a id de eventos y consultando su repeticion de aparicion en OSIEM en un tiempo determinado */
	/* recibe como entrada una ecuacion en formato string */
	/* retorna un numero con el valor de la ecuacion en un tiempo determinado */
	public function getScore($syntax){
		/* generar array de numeros */
		$array_events= $this->extractNumberEvents($syntax);
		/* consultar eventos y aparicion */
		foreach($array_events as $event_id){
			$events = $this->selectById($event_id);
			foreach($events["events"] as $event){
				$score = $event["score"];
				$syntax = str_replace($event_id,$score,$syntax);
			}
		}
		/* evaluar ecuacion */
		/* !!!!!!IMPORTANTE!!!!!!!!! */
		/* Aplicar tecnicas de sanitizacion debido a que la funcion eval puede ser muy peligrosa y poner en riesgo la informacion */
		eval("\$score = $syntax;");
		return $score;
	}

	/* extrae el numero de evento de evento a partir de un ecuacion */
	/* recibe como entrada una ecuacion en formato string */
	/* ej. (25-56)/24 => Array(25,56,24) */
	/* retorna un array con los eventos identificados */
	private function extractNumberEvents($syntax){
		$array_number = array();
		$number = "";
		for($i=0;$i<strlen($syntax);$i++){
			if(is_numeric($syntax[$i])){
				$number = $number . $syntax[$i];
			}else{
				if($number!=""){
					array_push($array_number,$number);
					$number = "";
				}	
			}
		}
		if($number!=""){
			array_push($array_number,$number);
		}	
		return $array_number;
	}

	
	/* busca elementos en la base de datos */
	/* 	retorna un array con los elementos encontrados */
	public function selectById($id){
		$sql = $this->getSelectQuery(FALSE);
		$sql=$sql . " WHERE $this->table.id='$id' ";
		//AGRUPACION POR ID DE OSIEM Y FUENTE PARA EVITAR CRUCES DE EVENTOS
		$sql = $sql . "GROUP BY $this->table.id,$this->table.event_id,$this->table.source_id";
		$this->execute($sql,$this->table);
		return $this->data;
	}

	/* busca elementos en la base de datos */
	/* 	retorna un array con los elementos encontrados */
	public function search($search){
		$sql = $this->getSelectQuery(FALSE);
		$sql=$sql . " WHERE $this->search_criteria LIKE '%$search%' ";
		//AGRUPACION POR ID DE OSIEM Y FUENTE PARA EVITAR CRUCES DE EVENTOS
		$sql = $sql . "GROUP BY $this->table.id,$this->table.event_id,$this->table.source_id";
		$this->execute($sql,$this->table);
		return $this->data;
	}

	//genera el query principal de la seleccion de eventos
	//recibe como paremetros un booleano para inyectar al query la agrupacion por evento y fuente
	//retorna un string con la query a ejecutar
	private function getSelectQuery($group){
		$sql = "SELECT *,count($this->table.event_id) as score,$this->table.id as master_id FROM $this->table ";
		//UNION A CALCULO DE PUNTAJE 
		$sql = $sql . "LEFT JOIN $this->record_table ON $this->table.event_id=$this->record_table.event_id AND $this->table.source_id=$this->record_table.source_id ";
		//AGRUPACION POR ID DE OSIEM Y FUENTE PARA EVITAR CRUCES DE EVENTOS
		if($group){
			$sql = $sql . "GROUP BY $this->table.id,$this->table.event_id,$this->table.source_id";
		}
		return $sql;
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/86/8b2b7d8fc0b00fc44f6b8125a73c0781c1db28
  Tamaño: 359       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293683    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.166259672 -0500
Modificación: 2023-04-06 11:42:36.052717650 -0500
      Cambio: 2023-10-20 16:46:06.643331456 -0500
    Creación: 2023-10-20 16:46:06.643331456 -0500
100644 blob 34dcbd5666a9705354669066f464e69bdd63f1f5	EventModel.php
100644 blob b3c9286a163b4b0860a0fb6bf721ff41da998359	KriModel.php
100644 blob 349cd442ae9b53536afae36e7d9922f3fe84b1b9	Model.php
100644 blob cf27b3beec50366ce112f05e7a070bf6cf045070	PropertieModel.php
100644 blob efa9faad575764b049d5e235a17f25c991dd5a2d	QualifierModel.php
100644 blob 3f36dc91c903e4be4239b127f4d48a9f11011911	RecordModel.php
100644 blob da44e54bc0a27b71b4025e2ec66691e9e08ae0d1	RiskModel.php
100644 blob 05d7d4d8f9670e0e5b2c24fe3469c804e2f0f4b4	SourceModel.php
100644 blob 94c0b90d03c95b7e9484842795b32a9d4a3eacb3	TemplateModel.php
100644 blob 95085117329d973fd6c36029b44293bcedd69742	TypeModel.php
100644 blob 98bcd9d15ece27bab02c81584e6e0b10ed3cfd21	UserModel.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/86/e430f7640a9b71b2c32da5c1612f2bf04d0700
  Tamaño: 437       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293685    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.166259672 -0500
Modificación: 2023-05-19 15:57:49.916143009 -0500
      Cambio: 2023-10-20 16:46:06.643331456 -0500
    Creación: 2023-10-20 16:46:06.643331456 -0500
100644 blob 46141854b6c4aac2047018836b3340f5f62dd0c2	.htaccess
100644 blob da437ed708de7ea2d1ed5bb37dc51d00740740f6	Dockerfile
040000 tree 39d44e28008599bd02bb3f75303394c5c0707cd5	assets
040000 tree 0994b646c5cf6fe1259596f6e540c6055d0d4e1c	components
100644 blob 886fe19262e1dcc9bc5827b9b360744e6fe4cf58	config.php
040000 tree 7f31c2d738a050ff614bc61451911174a722a76d	controllers
100644 blob 8dadb53d86e692a9145d4db33bc19d31c3303116	data.sql
100644 blob 82c1b06cf8655c3159204f46dafb691aa3fe03c0	database.php
100644 blob 27dae4899dda3ef6df80d4bdc4ec9c52248ccb59	index.php
040000 tree 1a3e6de70fbc9cace200d68e22b4fcd3b277ae75	models
100644 blob 5b9a73936584eabcb55fd9e03862f7c4e6eab1b1	router.php
100644 blob dc9cfb9c2e93b41acbe9d8bcc6932aa67031e82d	seeder.sql
040000 tree f96a4f7f7a0644a989321e07c6e80f192ef770cd	views
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/88/5e839812b7a9084d0c50a98a9b4c0bca55c233
  Tamaño: 358       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293983    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.392923215 -0500
Modificación: 2023-10-16 16:47:28.046401075 -0500
      Cambio: 2023-10-20 16:46:06.803327239 -0500
    Creación: 2023-10-20 16:46:06.803327239 -0500
100644 blob 6ec0742d4cbf2bc6d52e80e97f0954b9ba429d27	EventModel.php
100644 blob 05849fd380fdaae9648c991784a066c1360b099e	KriModel.php
100644 blob 28990a16edb396c569dbe70e310a1594ac70d185	Model.php
100644 blob cf27b3beec50366ce112f05e7a070bf6cf045070	PropertieModel.php
100644 blob 451577bd049f836b07b10907d0cd862efcd8dbb2	QualifierModel.php
100644 blob 3f36dc91c903e4be4239b127f4d48a9f11011911	RecordModel.php
100644 blob 730a24116f0181eadde3a5c5ca6e2d03d57ba8f7	RiskModel.php
100644 blob 05d7d4d8f9670e0e5b2c24fe3469c804e2f0f4b4	SourceModel.php
100644 blob 94c0b90d03c95b7e9484842795b32a9d4a3eacb3	TemplateModel.php
100644 blob 95085117329d973fd6c36029b44293bcedd69742	TypeModel.php
100644 blob 98bcd9d15ece27bab02c81584e6e0b10ed3cfd21	UserModel.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/88/6fe19262e1dcc9bc5827b9b360744e6fe4cf58
  Tamaño: 315       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293982    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.389589928 -0500
Modificación: 2023-09-03 08:49:59.637031097 -0500
      Cambio: 2023-10-20 16:46:06.803327239 -0500
    Creación: 2023-10-20 16:46:06.803327239 -0500
<?php
	/* base de datos anfitrion */
	$server = "mysql";
	$username = "root";
	$password = "1234";
	$database = "csra";

	/* base de datos remota */
	$server2 = "192.168.1.199";
	$username2 = "bot";
	$password2 = "@Globaltek@2022";
	$database2 = "alienvault";

	//DATABASE DISABLE ONLY FULL GROUP BY MODE
	/* [mysqld] */
	/* sql_mode = STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION */
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/88/8248a73fe883e3982223d1a84670bdf1a19641
  Tamaño: 267       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293984    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.392923215 -0500
Modificación: 2023-06-24 08:01:27.543126759 -0500
      Cambio: 2023-10-20 16:46:06.803327239 -0500
    Creación: 2023-10-20 16:46:06.803327239 -0500
<?php
require_once("models/EventModel.php");
class EventController extends Controller{

	public $autosave = true;

	public function __construct(){
		parent::__construct();
		$this->model = new EventModel();
	}

	public function show(){
		$numbers = [0,1,2,3,4,5,6,7,8,9];
		$syntax = "(22+3)+(4*825)";
		$z=4;
		if(is_numeric($syntax[$z])){
			echo $syntax[$z];
		}
	}

}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/89/49a5ae499c81ef2ce2fb9336af3a0b5ee227de
  Tamaño: 237       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293648    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.152926524 -0500
Modificación: 2023-03-28 17:22:24.331311181 -0500
      Cambio: 2023-10-20 16:46:06.629998474 -0500
    Creación: 2023-10-20 16:46:06.629998474 -0500
100644 blob 675ca80493965d2db9a143d34f10ae7c5abe31c2	Controller.php
100644 blob 03d434714b9c4aeca68bd623c8ac65e1998fea2e	KriController.php
100644 blob ab88d0b50b2f02ca6a63488e849280128184eafb	LoginController.php
100644 blob 12620ce4178e3b649067d4a02a366ef83bb8d47e	RegisterController.php
100644 blob 780543dcae704ef6c15ec37832c97da633668f99	RiskController.php
100644 blob 8c1bb57955e07f847b2b8e617e4db6218f8ced28	SourceController.php
100644 blob fb02603f5e1e778c1b626de544c3f0834532d3e1	UserController.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/89/650d49c24a4c78508f834c6d911c0813a3fd3c
  Tamaño: 343       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293647    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.149593236 -0500
Modificación: 2023-03-30 15:50:16.840976186 -0500
      Cambio: 2023-10-20 16:46:06.626665228 -0500
    Creación: 2023-10-20 16:46:06.626665228 -0500
<?php 
class RiskModel extends Model{
	/* tabla en la que actua  este modelo en base de datos */
	protected $table = "risks";

	/* columns que modifica el modelo en base de datos */
	protected $columns = ["type_id","propertie_id","risk",];

	/* columnas para modificacion en base de datos con consulta preparada */
	protected $args= [":type_id",":propertie_id",":risk"];

	/* relaciones entre bases de datos uno a muchos */
	protected $relations= ["properties","types"];

	/* relaciones entre bases de datos de muchos a muchos se debe definir las dos tablas que se desean relacionar */
	protected $much_to_much= ["risks"=>"kris"];

	public function __construct(){
		parent::__construct();
	}

}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/89/db20e052349da0522caad9fc862a4b611216e3
  Tamaño: 116       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293649    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.152926524 -0500
Modificación: 2023-07-30 06:50:22.985000551 -0500
      Cambio: 2023-10-20 16:46:06.629998474 -0500
    Creación: 2023-10-20 16:46:06.629998474 -0500
100644 blob e69de29bb2d1d6434b8b29ae775ad8c2e48c5391	create.php
100644 blob 58223b3ab325f17adfc1d5c6fde6ab930b39f82e	index.php
100644 blob a304f375bdf785e19cc02369d54ea893fe1b9fc5	show.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/8a/6006886b17d01bfdb198e794f800f01cc7f305
  Tamaño: 436       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293486    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.066261051 -0500
Modificación: 2023-10-18 16:45:46.097040172 -0500
      Cambio: 2023-10-20 16:46:06.553333828 -0500
    Creación: 2023-10-20 16:46:06.553333828 -0500
100644 blob 46141854b6c4aac2047018836b3340f5f62dd0c2	.htaccess
100644 blob da437ed708de7ea2d1ed5bb37dc51d00740740f6	Dockerfile
040000 tree dd6218d45158d9a2b0981c704e5c5c0d3130c418	assets
040000 tree ee84c1fda671963354e74a972bfc478930dd45c8	components
100644 blob 886fe19262e1dcc9bc5827b9b360744e6fe4cf58	config.php
040000 tree 3dcb4e7d0cab28a5b30b4f34fff055b9f1ccf477	controllers
100644 blob 8dadb53d86e692a9145d4db33bc19d31c3303116	data.sql
100644 blob 82c1b06cf8655c3159204f46dafb691aa3fe03c0	database.php
100644 blob 27dae4899dda3ef6df80d4bdc4ec9c52248ccb59	index.php
040000 tree 7b74c1e96388286637549e7317254312e8cc99ff	models
100644 blob d9a4ec66dfeb45d52c58647f352aaaae6b84cd28	router.php
100644 blob 46dfb9c57e8457a46bcf674b8b4097ac91049470	seeder.sql
040000 tree 33c82f5ce99cd7573eee526bf228c0a717b9b359	views
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/8b/2fee42809e3e76b99cae94e2fe48921669caa3
  Tamaño: 115       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293828    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.232925421 -0500
Modificación: 2023-05-18 14:55:49.871963638 -0500
      Cambio: 2023-10-20 16:46:06.706663120 -0500
    Creación: 2023-10-20 16:46:06.706663120 -0500
100644 blob 97b1828d19670ca13dd69f3270dd0eac7ec6fe5b	create.php
100644 blob 95db84274bcdf088a7f0c9914dcd9b4f8926be36	index.php
100644 blob b960b19842af71267007b64da8867db867e259e5	show.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/8c/0ed5853a4e83a0647c777c0bdba5db22dbd7b4
  Tamaño: 542       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293779    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.212925696 -0500
Modificación: 2023-03-16 15:57:33.071727880 -0500
      Cambio: 2023-10-20 16:46:06.686663647 -0500
    Creación: 2023-10-20 16:46:06.686663647 -0500
<?php 
class UserModel{
	private $db;
	private $users;

	public function __construct(){
		$this->db=Connection::connect();
		$this->users=array();
	}

	public function getUsers(){
		$sql = "SELECT * FROM users;";
		$state = $this->db->prepare($sql);
		if($state->execute()){
			while($row=$state->fetch(PDO::FETCH_ASSOC)){
				$this->users[]=$row;
			}
			return $this->users;
		}
	}

	public function getUserById($id){
		$sql = "SELECT * FROM users WHERE id=:id";
		$state = $this->db->prepare($sql);
		$state->bindParam(":id",$id);
		if($state->execute()){
			while($row=$state->fetch(PDO::FETCH_ASSOC)){
				$this->users[]=$row;
			}
			return $this->users;
		}
	}
}
/* if(!empty($_POST["email"]) && !empty($_POST["password"]) && !empty($_POST["name"])){ */
/* 	$sql = "INSERT INTO users(name,email,password) values(:name,:email,:password)"; */
/* 	$state = $conn->prepare($sql); */
/* 	$state->bindParam(":name",$_POST["name"]); */
/* 	$state->bindParam(":email",$_POST["email"]); */
/* 	$password = password_hash($_POST["password"],PASSWORD_BCRYPT); */
/* 	$state->bindParam(":password",$password); */
/* 	if($state->execute()){ */
/* 		$message = "Succesfully created new user"; */
/* 	}else{ */
/* 		$message = "Sorry, We cant create the user"; */
/* 	} */
/* } */
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/8c/1bb57955e07f847b2b8e617e4db6218f8ced28
  Tamaño: 231       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293778    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.209592409 -0500
Modificación: 2023-03-28 17:22:06.604644979 -0500
      Cambio: 2023-10-20 16:46:06.686663647 -0500
    Creación: 2023-10-20 16:46:06.686663647 -0500
<?php
require_once("models/SourceModel.php");
class SourceController extends Controller{

	public function __construct(){
		parent::__construct();
		$this->model = new SourceModel();
	}

	public function index()
	{
		$data = $this->model->getAll();
		foreach($data as $source){
			echo $source["vendor"] . "<BR>";
		}
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/8d/a63fbf74cf835ff158729337f1e8159f2a805e
  Tamaño: 184       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293673    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.162926385 -0500
Modificación: 2023-03-01 15:25:39.046143824 -0500
      Cambio: 2023-10-20 16:46:06.639998210 -0500
    Creación: 2023-10-20 16:46:06.639998210 -0500
body{
	margin: 0;
	padding: 0;
	text-align: center;
	font-family: 'Roboto', sans-serif;
}
header{
	border-bottom: 2px solid #eee;
	padding: 20px 0;
	margin-bottom: 10px;
	width: 100%;
	text-align: center;
}
header a{
	text-decoration: none;
	color: #333;
}
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/8d/adb53d86e692a9145d4db33bc19d31c3303116
  Tamaño: 1555      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293672    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.162926385 -0500
Modificación: 2023-03-23 13:25:03.478969710 -0500
      Cambio: 2023-10-20 16:46:06.636664965 -0500
    Creación: 2023-10-20 16:46:06.636664965 -0500
-- MariaDB dump 10.19  Distrib 10.11.2-MariaDB, for Linux (x86_64)
--
-- Host: 172.17.0.2    Database: csra
-- ------------------------------------------------------
-- Server version	5.7.41

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8mb4 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

--
-- Table structure for table `events`
--

DROP TABLE IF EXISTS `events`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `events` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `event` varchar(255) DEFAULT NULL,
  `type` enum('automatic','manual') DEFAULT NULL,
  `source_id` int(11) DEFAULT NULL,
  `event_id` int(11) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `events`
--

LOCK TABLES `events` WRITE;
/*!40000 ALTER TABLE `events` DISABLE KEYS */;
/*!40000 ALTER TABLE `events` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `kri_event`
--

DROP TABLE IF EXISTS `kri_event`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `kri_event` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `kri_id` int(11) DEFAULT NULL,
  `event_id` int(11) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `kri_event`
--

LOCK TABLES `kri_event` WRITE;
/*!40000 ALTER TABLE `kri_event` DISABLE KEYS */;
/*!40000 ALTER TABLE `kri_event` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `kris`
--

DROP TABLE IF EXISTS `kris`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `kris` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `kri` varchar(255) DEFAULT NULL,
  `objective` varchar(255) DEFAULT NULL,
  `propertie_id` int(11) DEFAULT NULL,
  `percentage` int(3) DEFAULT NULL,
  `syntax` varchar(255) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `kris`
--

LOCK TABLES `kris` WRITE;
/*!40000 ALTER TABLE `kris` DISABLE KEYS */;
/*!40000 ALTER TABLE `kris` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `master_qualifier`
--

DROP TABLE IF EXISTS `master_qualifier`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `master_qualifier` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `high` int(11) DEFAULT NULL,
  `medium` int(11) DEFAULT NULL,
  `low` int(11) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `master_qualifier`
--

LOCK TABLES `master_qualifier` WRITE;
/*!40000 ALTER TABLE `master_qualifier` DISABLE KEYS */;
/*!40000 ALTER TABLE `master_qualifier` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `properties`
--

DROP TABLE IF EXISTS `properties`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `properties` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `propertie` varchar(255) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `properties`
--

LOCK TABLES `properties` WRITE;
/*!40000 ALTER TABLE `properties` DISABLE KEYS */;
/*!40000 ALTER TABLE `properties` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `qualifiers`
--

DROP TABLE IF EXISTS `qualifiers`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `qualifiers` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `type` enum('alto','medio','bajo') DEFAULT NULL,
  `value` int(11) DEFAULT NULL,
  `kri_id` int(11) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `qualifiers`
--

LOCK TABLES `qualifiers` WRITE;
/*!40000 ALTER TABLE `qualifiers` DISABLE KEYS */;
/*!40000 ALTER TABLE `qualifiers` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `records`
--

DROP TABLE IF EXISTS `records`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `records` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `source_id` int(11) DEFAULT NULL,
  `event_id` int(11) DEFAULT NULL,
  `reported_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `records`
--

LOCK TABLES `records` WRITE;
/*!40000 ALTER TABLE `records` DISABLE KEYS */;
/*!40000 ALTER TABLE `records` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `risk_kri`
--

DROP TABLE IF EXISTS `risk_kri`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `risk_kri` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `risk_id` int(11) DEFAULT NULL,
  `kri_id` int(11) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `risk_kri`
--

LOCK TABLES `risk_kri` WRITE;
/*!40000 ALTER TABLE `risk_kri` DISABLE KEYS */;
/*!40000 ALTER TABLE `risk_kri` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `risks`
--

DROP TABLE IF EXISTS `risks`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `risks` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `type_id` int(11) DEFAULT NULL,
  `propertie_id` int(11) DEFAULT NULL,
  `risk` varchar(255) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `risks`
--

LOCK TABLES `risks` WRITE;
/*!40000 ALTER TABLE `risks` DISABLE KEYS */;
/*!40000 ALTER TABLE `risks` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `sources`
--

DROP TABLE IF EXISTS `sources`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `sources` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `source` varchar(255) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `sources`
--

LOCK TABLES `sources` WRITE;
/*!40000 ALTER TABLE `sources` DISABLE KEYS */;
/*!40000 ALTER TABLE `sources` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `types`
--

DROP TABLE IF EXISTS `types`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `types` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `type` varchar(255) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `types`
--

LOCK TABLES `types` WRITE;
/*!40000 ALTER TABLE `types` DISABLE KEYS */;
/*!40000 ALTER TABLE `types` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `users`
--

DROP TABLE IF EXISTS `users`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `users` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(255) DEFAULT NULL,
  `email` varchar(255) DEFAULT NULL,
  `password` varchar(255) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `users`
--

LOCK TABLES `users` WRITE;
/*!40000 ALTER TABLE `users` DISABLE KEYS */;
INSERT INTO `users` VALUES
(1,'pablo','test12@hotmail.com','$2y$10$oUnMRxxZHhoZfQb2EYCaJudVm6JvRMk0u8MARRlVKWtSAkeIxTrEi','2023-03-23 16:33:20');
/*!40000 ALTER TABLE `users` ENABLE KEYS */;
UNLOCK TABLES;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;

-- Dump completed on 2023-03-23 18:24:17
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/8d/b106e4fcead894868ee6ce55586238103d9803
  Tamaño: 170       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293671    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.162926385 -0500
Modificación: 2023-03-23 13:20:08.675631069 -0500
      Cambio: 2023-10-20 16:46:06.636664965 -0500
    Creación: 2023-10-20 16:46:06.636664965 -0500
<?php 
class UserModel extends Model{
	protected $table = "users";
	protected $columns = ["name","email","password"];
	protected $args = [":name",":email",":password"];

	public function __construct(){
		parent::__construct();
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/8f/adc7a627eea16c36528f45d360b17d0cee6b5e
  Tamaño: 568       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293844    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.242925283 -0500
Modificación: 2023-10-14 17:45:42.002529303 -0500
      Cambio: 2023-10-20 16:46:06.716662857 -0500
    Creación: 2023-10-20 16:46:06.716662857 -0500
<?php
require_once("models/KriModel.php");
require_once("models/QualifierModel.php");
require_once("models/EventModel.php");
class KriController extends Controller{

	public $autosave = false;

	public function __construct(){
		parent::__construct();
		/* modelos */
		$this->model = new KriModel(); //AFECTA A LA TABLA KRIS
		$this->event_model = new EventModel(); //AFECTA LA TABLA EVENTS
		$this->qualifier_model = new QualifierModel(); //AFECTA A LA TABLA QUALIFIERS
	}

	/* inserta un kri en base de datos y sus calificadores */
	/* 	retorna una redireccion al index de kri */
	public function insert(){
		$this->modelParams();
		$id = $this->model->insert();
		$this->qualifier_model->insertQualifiers($id,$this->model->db);
		$this->model->saveChanges();
		header("Location: /$this->controller");
	}

	/* consulta un kri a apartir de su id y despliega la vista de modificacion de kri */
	/* calcula el puntaje del kri */
	/* returna una vista con la informacion del kri y su puntaje*/
	public function show(){
		$id = $_GET["id"]; 
		$data = $this->model->getByIdScore($id);
		/* VISTA */
		require_once("views/$this->controller/show.php");
	}

}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/8f/b1efa6322ddbb014c1355a8eae953f59208ef4
  Tamaño: 359       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293843    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.239591996 -0500
Modificación: 2023-05-14 07:37:26.492034179 -0500
      Cambio: 2023-10-20 16:46:06.713329611 -0500
    Creación: 2023-10-20 16:46:06.713329611 -0500
100644 blob 34dcbd5666a9705354669066f464e69bdd63f1f5	EventModel.php
100644 blob 0012f9ae90c3e8d5ae8bfea1873c7a7de1ca77fe	KriModel.php
100644 blob e84f4a94a8e57fb3cf003f895465e525249203d6	Model.php
100644 blob cf27b3beec50366ce112f05e7a070bf6cf045070	PropertieModel.php
100644 blob 2b7e2e2a08d9bfe6fc287d1eadf68a3ae2bef753	QualifierModel.php
100644 blob 3f36dc91c903e4be4239b127f4d48a9f11011911	RecordModel.php
100644 blob da44e54bc0a27b71b4025e2ec66691e9e08ae0d1	RiskModel.php
100644 blob 05d7d4d8f9670e0e5b2c24fe3469c804e2f0f4b4	SourceModel.php
100644 blob 94c0b90d03c95b7e9484842795b32a9d4a3eacb3	TemplateModel.php
100644 blob 95085117329d973fd6c36029b44293bcedd69742	TypeModel.php
100644 blob 98bcd9d15ece27bab02c81584e6e0b10ed3cfd21	UserModel.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/91/6405f23887474176f88d1c45f7fa7fdbcdd9e2
  Tamaño: 733       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293823    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.232925421 -0500
Modificación: 2023-10-07 13:37:49.696259233 -0500
      Cambio: 2023-10-20 16:46:06.706663120 -0500
    Creación: 2023-10-20 16:46:06.706663120 -0500
<?php
class Controller{

	public $controller;

	/* el contructor trae el controllador al que se accede desde la url y lo aloja en la clase */
	public function __construct()
	{
		$this->controller = $_GET["controller"];
	}

	/* retona la vista de inicio y trae sus datos en lista */
	public function index(){
		$data=$this->model->getAll();
		require_once("views/$this->controller/index.php");
	}

	/* despliega el formulario de creacion */
	public function create(){
		require_once("views/$this->controller/create.php");
	}

	/* retorna la vista de mostrar un solo elemento con la informacion del elemnto */
	public function show(){
		$id = $_GET["id"]; 
		$data=$this->model->selectById($id);
		require_once("views/$this->controller/show.php");
	}

	/* crea un elemento y redirecciona al inicio */
	public function insert(){
		$this->modelParams();
		$id = $this->model->insert();
		if($this->autosave){
			$this->model->saveChanges();
			header("Location: /$this->controller");
		}
		return $id;
	}

	/* modifica un elemento y redirecciona al inicio */
	public function update(){
		$this->model->id = $_GET["id"];
		$this->modelParams();
		$this->model->update();
		header("Location: /$this->controller");
	}

	/* borra un elemento y redireccion al inicio */
	public function delete(){
		$id = $_GET["id"];
		$this->model->delete($id);
		header("Location: /$this->controller");
	}

	public function search(){
		$search = $_GET["id"];
		$data = $this->model->search($search);
		echo json_encode($data);
	}

	/* relaciona los parametros de entrado por POST con parametros de la clase */
	public function modelParams(){
		foreach(array_keys($_POST) as $key){
			$this->model->{$key} = $_POST[$key];
		}
	}

	/* index - lista todos los elementos */
	/* show - muestra un elemento por su id */
	/* create - crea un elemento */
	/* update - modifica un elemento */
	/* delete - borra un elemento */
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/92/a1678b166fe022589d6cf0180b95b2e44c6dd0
  Tamaño: 1667      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293812    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.229592133 -0500
Modificación: 2023-10-16 16:47:24.039832305 -0500
      Cambio: 2023-10-20 16:46:06.703329875 -0500
    Creación: 2023-10-20 16:46:06.699996629 -0500
<?php  
include_once("components/header.php");
?>
<div class="container">
	
	<!-- ----------------------------------- -->
	<div class="card">
		<form action="/risk/insert" method="POST" class="needs-validation">
			<!-- PRIMERA FILA -->
			<div class="card-header">
				<h5>Crear Riesgo</h5>
			</div>
			<div class="card-body">
				<!-- KRI -->
				<div class="form-floating mb-3">
					<input type="text" value="<?= $risk['risk'] ?>" required class="form-control" name="risk" id="floatingInput" placeholder="Insegra un nombre">
					<label for="floatingInput">Nombre del riesgo</label>
				</div>
				<div class="row">
					<div class="col-6">
						<!-- PROPIEDAD -->
						<div class="form-floating mb-3">
							<select name="propertie_id" class="form-select" id="datalistOptionsProperty" aria-label="">
							</select>
							<label for="floatingSelect">Propiedad</label>
						</div>
					</div>
					<div class="col-6">
						<!-- TIPO -->
						<div class="form-floating mb-3">
							<select name="propertie_id" class="form-select" id="datalistOptionsType" aria-label="">
							</select>
							<label for="floatingSelect">Tipo</label>
						</div>
					</div>
				</div>
				<div class="accordion accordion-flush" id="accordionFlushExample">
					<!-- KRI -->
					<div class="accordion-item">
						<h2 class="accordion-header">
							<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#event-collapse" aria-expanded="false" aria-controls="flush-collapseOne">
								KRIs	
							</button>
						</h2>
						<div id="event-collapse" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
							<div class="my-2">
								<button name="events" type="button" class="form-control btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addKri">
									Añadir KRI
								</button>
								<div class="form-check" id="kris"> 
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="card-footer">
					<!-- END FIELD -->
					<div class="row">
						<div class="col-6">
							<button type="reset" class="btn btn-outline-secondary form-control">Limpiar</button>
						</div>
						<div class="col-6">
							<button type="submit" class="btn btn-primary form-control">Enviar</button>
						</div>
					</div>
		</form>
				</div>
			</div>
			<!-- FORMULARIO DE ADICION DE KRIS -->
			<div class="modal fade" id="addKri" tabindex="-1" aria-labelledby="addKriLabel" aria-hidden="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h1 class="modal-title fs-5" id="addKriLabel">Buscar Evento</h1>
							<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
						</div>
						<div class="modal-body">
							<div class="form-floating mb-3">
								<input type="text" required class="form-control" id="searchKRI" placeholder="Insegra un nombre">
								<label for="floatingInput">Buscar evento</label>
							</div>
							<div class="justify-content-center" id="datalistOptionsKRI">
							</div>
						</div>
					</div>
				</div>
			</div>
	</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
<script src="/assets/js/search.js"></script>
<script>
	function customFunction(e){
		console.log(e)
		kris = document.getElementById("kris")
		html = kris.innerHTML
		html += "<div><input name='kri[]' value='"+e.id+"' type='checkbox' class='btn-check' id='"+e.kri+"' autocomplete='off' checked><label class='btn btn-sm btn-outline-danger my-2 form-control' for='"+e.kri+"'>"+e.kri+" <span class='badge bg-secondary'>"+e.percentage+"%</span></label></div>"
		kris.innerHTML = html
		modal = document.getElementById("addKri")
		modal.hide()
	}
	//EVENTOS
	searchEvent({
		componentEvent: "searchKRI",
		listOptions: "datalistOptionsKRI",
		search: "kri",
		components: new Map([
			["id","master_id"],
			["kri","kri"],
			["percentage","percentage"]
		]),
		value: "kri",
		table: "kris",
		tag: "button",
		customFunction: "customFunction",
		class: "btn btn-outline-primary form-control m-2' data-bs-dismiss='modal",
	})
	//PROPERTIES
	searchEvent({
		listOptions: "datalistOptionsProperty",
		search: "propertie",
		components: new Map([
			["value","id"]
		]),
		value: "propertie",
		table: "properties",
		tag: "option"
	})
	//TYPES
	searchEvent({
		listOptions: "datalistOptionsType",
		search: "type",
		components: new Map([
			["value","id"]
		]),
		value: "type",
		table: "types",
		tag: "option"
	})
</script>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/92/adc7983a61eba4116caeb0c710d7b316d5ab86
  Tamaño: 83        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293813    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.229592133 -0500
Modificación: 2023-04-06 11:42:36.002717648 -0500
      Cambio: 2023-10-20 16:46:06.703329875 -0500
    Creación: 2023-10-20 16:46:06.703329875 -0500
040000 tree 066edf40e2ec64bd78e8d33055d1ee59740d29fe	js
100644 blob 8da63fbf74cf835ff158729337f1e8159f2a805e	styles.css
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/93/e6a6655f30025a91414dd9a8f092be58f467bf
  Tamaño: 53        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293502    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.079594201 -0500
Modificación: 2023-03-23 13:20:22.548964652 -0500
      Cambio: 2023-10-20 16:46:06.563333564 -0500
    Creación: 2023-10-20 16:46:06.563333564 -0500
100644 blob 3c749a5bb13fa3437b0c8116ac00cf18af1e6f5b	index.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/94/c0b90d03c95b7e9484842795b32a9d4a3eacb3
  Tamaño: 302       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293590    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.126260224 -0500
Modificación: 2023-05-18 14:54:53.511962623 -0500
      Cambio: 2023-10-20 16:46:06.603332510 -0500
    Creación: 2023-10-20 16:46:06.603332510 -0500
<?php 
class TemplateModel extends Model{
	protected $table = "plugin_sid";
	protected $columns = ["name"];
	protected $args= [":name"];

	public function __construct(){
		parent::__construct(TRUE);
	}

	public function search($search)
	{
		$sql = "SELECT $this->table.name,plugin_id,sid,vendor from $this->table inner join plugin on plugin.id=plugin_sid.plugin_id where $this->table.name like '%$search%' limit 10";
		$data = $this->getCustom($sql);
		return ($data);
	}

}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/95/085117329d973fd6c36029b44293bcedd69742
  Tamaño: 151       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293776    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.209592409 -0500
Modificación: 2023-10-16 16:47:23.893169220 -0500
      Cambio: 2023-10-20 16:46:06.683330401 -0500
    Creación: 2023-10-20 16:46:06.683330401 -0500
<?php 
class TypeModel extends Model{
	protected $table = "types";
	protected $columns = ["type"];
	protected $args= [":type"];

	public function __construct(){
		parent::__construct();
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/95/db84274bcdf088a7f0c9914dcd9b4f8926be36
  Tamaño: 583       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293775    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.209592409 -0500
Modificación: 2023-05-14 10:24:31.931770298 -0500
      Cambio: 2023-10-20 16:46:06.683330401 -0500
    Creación: 2023-10-20 16:46:06.683330401 -0500
<?php  
include_once("components/header.php");
?>
<div class="card">
	<div class="card-header">
		<div class="row">
			<div class="col-6">
				<div class="row">
					<div class="input-group mb-3">
						<a href="/kri/create" class="btn btn-primary" type="button" id="button-addon1">+</a>
						<input id="search" type="text" class="form-control" placeholder="Buscar Kri" aria-label="Example text with button addon" aria-describedby="button-addon1">
					</div>
				</div>
			</div>
			<div class="col-6">
				<div class="row">
					<div class="col-6">
						<input class="form-control" name="from" type="datetime-local">
					</div>
					<div class="col-6">
						<input class="form-control d-flex" name="to" type="datetime-local">
					</div>
				</div>
			</div>
		</div>
	</div>
	<table class="table table-borderless">
		<thead>
			<tr>
				<th scope="col">#</th>
				<th scope="col">KRI</th>
				<th scope="col">Objetivo</th>
				<th scope="col">Propiedad</th>
				<th scope="col">Porcentage</th>
			</tr>
		</thead>
		<tbody id="kris">
			<?php  foreach($data["kris"] as $kri): ?>
			<tr>
				<th scope="row"><?= $kri["id_master"] ?></th>
				<td>
					<a href="/kri/show/<?= $kri['id_master'] ?>">
						<?= $kri["kri"] ?>
					</a>
				</td>
				<td><?= $kri["objective"] ?></td>
				<td><?= $kri["propertie"] ?></td>
				<td><?= $kri["percentage"] ?>%</td>
			</tr>
			<?php  endforeach; ?>
		</tbody>
	</table>
</div>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/96/bf1251ea04f805d6d1265aa4d4b0d62c6a3743
  Tamaño: 2502      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293532    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.096260638 -0500
Modificación: 2023-10-14 17:45:42.405851104 -0500
      Cambio: 2023-10-20 16:46:06.576666547 -0500
    Creación: 2023-10-20 16:46:06.576666547 -0500
<?php  
include_once("components/header.php");
?>

<!-- FORMULARIO DE CREACION DE KRIS -->
<div class="container">
	
	<form action="/kri/update" method="POST" class="needs-validation">
			<?php  foreach($data["kris"] as $kri): ?>
			<!-- PRIMERA FILA -->
			<div class="row">
				<div class="col-xl-4 col-lg-6 mb-4">
					<div class="bg-white rounded-lg p-5 shadow">
						<h2 class="h6 font-weight-bold text-center mb-4">Valoración del Indicador</h2>
						<!-- Progress bar 1 -->
						<div class="progress" role="progressbar" aria-label="Example with label" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">
							<div class="progress-bar" style="width: 25%">Bajo</div>
						</div>
						<!-- END -->

						<!-- Demo info -->
						<div class="row text-center mt-4">
							<div class="col-6 border-right">
								<div class="h4 font-weight-bold mb-0"><?= $data['score'] ?> P.</div><span class="small text-gray">Puntaje calculado</span>
							</div>
							<div class="col-6">
								<div class="h4 font-weight-bold mb-0"><?= $data["score_qualified"]["value"] ?></div><span class="small text-gray"><?= $data["score_qualified"]["type"] ?></span>
							</div>
						</div>
						<!-- END -->
					</div>
				</div>
				<div class="col-xl-4 col-lg-4 mb-4">
					<div class="bg-white rounded-lg p-5 shadow">
						<h2 class="h6 font-weight-bold text-center mb-4">Mapa relacional</h2>
						<div class="row align-items-center my-2">
							<div class="col-6">
								<button class="btn btn-outline-dark btn-sm form-control">
									<?= $kri["kri"] ?>
								</button>
							</div>
							<div class="col-6">
								<?php  foreach($data["events"] as $event): ?>
								<button class="btn btn-outline-dark btn-sm form-control my-2" data-bs-toggle="popover" data-bs-title="Descripcion del evento" data-bs-content="">
									<?= $event["event"]?>
								</button>
								<?php  endforeach; ?>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="card-header">
				<h5><b><?=$kri['master_id']?> | </b><?=$kri['kri']?></h5>
			</div>
			<div class="card-body">
				<!-- KRI -->
				<div class="form-floating mb-3">
					<input type="text" value="<?= $kri['kri'] ?>" required class="form-control" name="kri" id="floatingInput" placeholder="Insegra un nombre">
					<label for="floatingInput">Nombre del KRI</label>
				</div>
				<!-- OBJECTIVO -->
				<div class="form-floating">
					<textarea class="form-control mb-3" name="objective" id="floatingTextarea2"><?= $kri["objective"] ?></textarea>
					<label for="floatingTextarea2">Objetivo</label>
				</div>
				<div class="row">
					<div class="col-6">
						<!-- PROPIEDAD -->
						<div class="form-floating mb-3">
							<select name="propertie_id" class="form-select" id="datalistOptions" aria-label="">
								<option value="<?= $kri['propertie_id'] ?>" selected><?= $kri['propertie']?></option>
							</select>
							<label for="floatingSelect">Propiedad</label>
						</div>
					</div>
					<div class="col-6">
						<!-- PORCENTAJE -->
						<div class="form-floating mb-3">
							<input name="percentage" type="number" value="<?= $kri['percentage'] ?>" class="form-control">
							<label for="floatingInput">Porcentaje</label>
						</div>
					</div>
				</div>
				<!-- SYNTAX-->
				<div class="form-floating mb-3">
					<input name="syntax" type="text" value="<?= $kri['syntax'] ?>" class="form-control disabled">
					<label for="floatingInput">Sintaxis / Operacion de kri</label>
				</div>
				<div class="accordion accordion-flush" id="accordionFlushExample">
					<!-- EVENTOS -->
					<div class="accordion-item">
						<h2 class="accordion-header">
							<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#event-collapse" aria-expanded="false" aria-controls="flush-collapseOne">
								Eventos	
							</button>
						</h2>
						<div id="event-collapse" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
							<div class="my-2">
								<button name="events" type="button" class="form-control btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#exampleModal">
									Añadir evento
								</button>
								<?php  foreach($data["events"] as $event): ?>
								<div class="form-check">
									<input type="checkbox" checked id="<?= $event['event'] ?>" value="<?= $event['id'] ?>" name="event[]" class="form-check-input">
									<label class="form-check-label" for="<?= $event['event'] ?>"><?= $event['id']." | ".$event['event'] ?></label>
								</div>
								<?php  endforeach; ?>
							</div>
						</div>
					</div>
					<!-- QUALIFIERS -->
					<div class="accordion-item">
						<h2 class="accordion-header">
							<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#qualifier-collapse" aria-expanded="false" aria-controls="flush-collapseOne">
										   Calificadores
							</button>
						</h2>
						<div id="qualifier-collapse" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
							<?php  foreach($data["qualifiers"] as $qualifier): ?>
							<div class="input-group mb-3">
								<div class="form-floating">
									<input type="text" value="<?= $qualifier['type'] ?>" class="form-control" name="qualifiers[]" id="floatingInputGroup1">
									<label for="floatingInputGroup1">Nombre Calificador</label>
								</div>
								<div class="form-floating">
									<input type="text" class="form-control" value="<?= $qualifier['value'] ?>" name="qualifiers_values[]" id="floatingInputGroup1">
									<label for="floatingInputGroup1">Valor</label>
								</div>
							</div>
							<?php  endforeach; ?>
							<button type="button" onclick="addQualifier()" class="form-control btn btn-outline-primary btn-sm">
								Agregar
							</button>
						</div>
					</div>
					<div class="accordion-item">
						<h2 class="accordion-header">
							<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#map-collapse" aria-expanded="false" aria-controls="flush-collapseOne">
								Mapa relacional
							</button>
						</h2>
						<div id="map-collapse" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
							<div class="row align-items-center my-2">
								<div class="col-6">
									<button class="btn btn-outline-dark btn-sm form-control">
										<?= $kri["kri"] ?>
									</button>
								</div>
								<div class="col-6">
									<?php  foreach($data["events"] as $event): ?>
									<button class="btn btn-outline-dark btn-sm form-control my-2" data-bs-toggle="popover" data-bs-title="Descripcion del evento" data-bs-content="">
										<?= $event["event"]?>
									</button>
									<?php  endforeach; ?>
								</div>
							</div>
						</div>
					</div>
				</div>
				<?php  endforeach; ?>
			</div>
			<div class="card-footer">
				<!-- END FIELD -->
				<div class="row">
					<div class="col-6">
						<button type="reset" class="btn btn-outline-secondary form-control">Limpiar</button>
					</div>
					<div class="col-6">
						<button type="submit" class="btn btn-primary form-control">Actualizar</button>
					</div>
				</div>
	</form>
			</div>

			<!-- FORMULARIO DE ADICION DE EVENTOS -->
			<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h1 class="modal-title fs-5" id="exampleModalLabel">Buscar Evento</h1>
							<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
						</div>
						<div class="modal-body">
							<div class="form-floating mb-3">
								<input type="text" required class="form-control" id="searchEvent" placeholder="Insegra un nombre">
								<label for="floatingInput">Buscar evento</label>
							</div>
							<div class="justify-content-center" id="datalistOptionsEvent">
							</div>
						</div>
					</div>
				</div>
			</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
<script src="/assets/js/search.js"></script>
<script>
	searchEvent({
		listOptions: "datalistOptions",
		search: "propertie",
		components: new Map([
			["value","id"]
		]),
		value: "propertie",
		table: "properties",
		tag: "option"
	})
</script>

---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/96/fe6fc4049c3c1fbd6e3c04a2c9b6246643d7f2
  Tamaño: 63        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293533    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.096260638 -0500
Modificación: 2023-02-24 01:39:28.840735280 -0500
      Cambio: 2023-10-20 16:46:06.576666547 -0500
    Creación: 2023-10-20 16:46:06.576666547 -0500
<header>
	<a href="/">Home aplicaction</a>
</header>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/97/b1828d19670ca13dd69f3270dd0eac7ec6fe5b
  Tamaño: 1773      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293728    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.189592685 -0500
Modificación: 2023-05-14 07:33:54.002039780 -0500
      Cambio: 2023-10-20 16:46:06.663330928 -0500
    Creación: 2023-10-20 16:46:06.663330928 -0500
<?php  
include_once("components/header.php");
?>
<!-- FORMULARIO DE CREACION DE KRIS -->
<div class="container">
	<form action="/kri/insert" method="POST" class="needs-validation">
		<div class="card">
			<div class="card-header">
				<h2 class="my-3">Creacion de KRI</h2>
			</div>
			<div class="card-body">
				<!-- KRI -->
				<div class="form-floating mb-3">
					<input type="text"Crear KRI required class="form-control" name="kri" id="floatingInput" placeholder="Insegra un nombre">
					<label for="floatingInput">Nombre del KRI</label>
				</div>
				<!-- OBJECTIVO -->
				<div class="form-floating">
					<textarea class="form-control mb-3" name="objective" placeholder="Leave a comment here" id="floatingTextarea2" style="height: 100px"></textarea>
					<label for="floatingTextarea2">Objetivo</label>
				</div>
				<div class="row">
					<div class="col-6">
						<!-- PROPIEDAD -->
						<div class="form-floating mb-3">
							<select name="propertie_id" class="form-select" id="datalistOptions" aria-label="">
							</select>
							<label for="floatingSelect">Propiedad</label>
						</div>
					</div>
					<div class="col-6">
						<!-- PORCENTAJE -->
						<div class="form-floating mb-3">
							<input name="percentage" type="number" class="form-control">
							<label for="floatingInput">Porcentaje</label>
						</div>
					</div>
				</div>
				<!-- EVENTOS -->
				<button name="events" type="button" class="form-control btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
					Añadir evento
				</button>
				<select name="event[]" id="events" class="form-select mb-3" multiple>
				</select>
				<!-- SYNTAX-->
				<div class="form-floating mb-3">
					<input name="syntax" type="text" class="form-control disabled">
					<label for="floatingInput">Sintaxis / Operacion de kri</label>
				</div>
				<!-- QUALIFIERS -->
				<div class="card">
					<div class="card-header">
						<h5 class="mt-2">Calificadores</h5>
					</div>
					<div class="card-body" id="qualifiers">
						<div class="input-group mb-3">
							<div class="form-floating">
								<input type="text" class="form-control" name="qualifiers[]" id="floatingInputGroup1">
								<label for="floatingInputGroup1">Nombre Calificador</label>
							</div>
							<div class="form-floating">
								<input type="text" class="form-control" name="qualifiers_values[]" id="floatingInputGroup1">
								<label for="floatingInputGroup1">Valor</label>
							</div>
						</div>
					</div>
					<div class="card-footer">
						<button type="button" onclick="addQualifier()" class="form-control btn btn-primary">
							Agregar
						</button>
					</div>
				</div>
			</div>
			<div class="card-footer">
				<!-- END FIELD -->
				<button type="submit" class="btn btn-primary">Enviar</button>
			</div>
		</div>
	</form>
</div>
<!-- FORMULARIO DE ADICION DE EVENTOS -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h1 class="modal-title fs-5" id="exampleModalLabel">Buscar Evento</h1>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<div class="form-floating mb-3">
					<input type="text" required class="form-control" id="searchEvent" placeholder="Insegra un nombre">
					<label for="floatingInput">Buscar evento</label>
				</div>
				<div class="justify-content-center" id="datalistOptionsEvent">

				</div>
			</div>
		</div>
	</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
<script src="/assets/js/search.js"></script>
<script>
	function addQualifier(){
		qualifiers_list = document.getElementById("qualifiers")
		html = ' <div class="input-group mb-3"> <div class="form-floating"> <input type="text" class="form-control" name="qualifiers[]" id="floatingInputGroup1"> <label for="floatingInputGroup1">Nombre Calificador</label> </div> <div class="form-floating"> <input type="text" class="form-control" name="qualifiers_values[]" id="floatingInputGroup1"> <label for="floatingInputGroup1">Valor</label> </div> </div> '
		qualifiers_list.insertAdjacentHTML("beforeend",html)
	}
	function customFunction(e){
		console.log(e)
		events = document.getElementById("events")
		html = events.innerHTML
		html += "<option selected value=" + e.id + ">["+e.id+"]."+e.event+"</option>"
		events.innerHTML = html
		modal = document.getElementById("exampleModal")
		modal.hide()
	}
	//PROPIEDADES
	searchEvent({
		listOptions: "datalistOptions",
		search: "propertie",
		components: new Map([
			["value","id"]
		]),
		value: "propertie",
		table: "properties",
		tag: "option"
	})
	//EVENTOS
	searchEvent({
		componentEvent: "searchEvent",
		listOptions: "datalistOptionsEvent",
		search: "event",
		components: new Map([
			["id","id"],
			["event","event"]
		]),
		value: "event",
		table: "events",
		tag: "button",
		customFunction: "customFunction",
		class: "btn btn-outline-primary form-control m-2' data-bs-dismiss='modal",
	})
</script>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/98/bcd9d15ece27bab02c81584e6e0b10ed3cfd21
  Tamaño: 338       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293816    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.229592133 -0500
Modificación: 2023-05-18 14:54:53.525295957 -0500
      Cambio: 2023-10-20 16:46:06.703329875 -0500
    Creación: 2023-10-20 16:46:06.703329875 -0500
<?php 
class UserModel extends Model{
	protected $table = "users";
	protected $columns = ["name","email","password"];
	protected $args = [":name",":email",":password"];

	public function __construct(){
		parent::__construct();
	}

	public function selectByEmail(){
		$sql = "SELECT * FROM $this->table WHERE email=:email";
		$state = $this->db->prepare($sql);
		$state->bindParam(":email",$this->email);
		if($state->execute()){
			while($row=$state->fetch(PDO::FETCH_ASSOC)){
				$this->data[]=$row;
			}
			return $this->data;
		}
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/98/c3ca2672d8e18092c781648a6d6974b6295825
  Tamaño: 371       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293815    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.229592133 -0500
Modificación: 2023-05-19 15:57:22.432809172 -0500
      Cambio: 2023-10-20 16:46:06.703329875 -0500
    Creación: 2023-10-20 16:46:06.703329875 -0500
<?php
require_once("models/KriModel.php");
require_once("models/QualifierModel.php");
class KriController extends Controller{

	public $autosave = false;

	public function __construct(){
		parent::__construct();
		/* modelos */
		$this->model = new KriModel();
		$this->qualifier_model = new QualifierModel();
	}

	/* inserta un kri en base de datos y sus calificadores */
	/* 	retorna una redireccion al index de kri */
	public function insert(){
		$this->modelParams();
		$id = $this->model->insert();
		$this->qualifier_model->insertQualifiers($id,$this->model->db);
		$this->model->saveChanges();
		header("Location: /$this->controller");
	}

	public function update(){
		var_dump($_POST);
	}

}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/99/48526e371ec84f39ad45662721203603f6abf6
  Tamaño: 159       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293761    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.202925835 -0500
Modificación: 2023-06-24 08:01:27.649793423 -0500
      Cambio: 2023-10-20 16:46:06.679997156 -0500
    Creación: 2023-10-20 16:46:06.676663910 -0500
<?php
require_once("models/TypeModel.php");
class TypeController extends Controller{

	public function __construct(){
		parent::__construct();
		$this->model = new TypeModel();
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/99/5e0e7b2db8556e80640a1994f1f8ab4a62fbc4
  Tamaño: 83        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293762    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.202925835 -0500
Modificación: 2023-03-23 13:20:22.548964652 -0500
      Cambio: 2023-10-20 16:46:06.679997156 -0500
    Creación: 2023-10-20 16:46:06.679997156 -0500
100644 blob e77dba7e36ef5f99bd55874141d89b923c8bd3b3	Model.php
100644 blob 8db106e4fcead894868ee6ce55586238103d9803	UserModel.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/9a/48b8638822e29e44378877ec56ed75c75f25a4
  Tamaño: 191       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293948    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.359590341 -0500
Modificación: 2023-05-18 14:55:49.871963638 -0500
      Cambio: 2023-10-20 16:46:06.783327766 -0500
    Creación: 2023-10-20 16:46:06.783327766 -0500
040000 tree e7163dc73857b94aef2fd3bef6b5c904a4c4abb1	event
040000 tree 8b2fee42809e3e76b99cae94e2fe48921669caa3	kri
040000 tree bf26cbec7b3a99878eea5fe64236fa8c6693da97	login
040000 tree 8494db4705a8620c9116e70e5f31fa4b042d135f	register
040000 tree 3f996d487c0a5063b1b018a35ccab9e527738db6	risk
040000 tree 51b4f483439170ce1f66b8dc07444e95bac424b7	user
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/9a/bf0dc8c60c71c9f78d57243f8530cea132319a
  Tamaño: 789       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293949    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.359590341 -0500
Modificación: 2023-05-14 07:33:53.885373117 -0500
      Cambio: 2023-10-20 16:46:06.783327766 -0500
    Creación: 2023-10-20 16:46:06.783327766 -0500
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
<nav class="navbar navbar-expand-lg bg-body-tertiary">
  <div class="container-fluid">
    <a class="navbar-brand" href="#"></a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavDropdown">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" aria-current="page" href="/risk">Inicio</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/risk">Riesgos</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/kri">KRI's</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/event">Eventos</a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">Mas</a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="/user">Usuarios</a></li>
            <li><a class="dropdown-item" href="/source">Fuentes</a></li>
            <li><a class="dropdown-item" href="/propertie">Propiedades</a></li>
            <li><a class="dropdown-item" href="/type">Tipos</a></li>
            <li><a class="dropdown-item" href="/configuration">Configuracion</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
 <script src="https://unpkg.com/boxicons@2.1.4/dist/boxicons.js"></script>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/9b/890f6c8ac64acf510924d30015a38d4b5bd9d0
  Tamaño: 721       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293841    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.239591996 -0500
Modificación: 2023-10-16 16:47:23.946501251 -0500
      Cambio: 2023-10-20 16:46:06.713329611 -0500
    Creación: 2023-10-20 16:46:06.713329611 -0500
<?php  
include_once("components/header.php");
?>
<div class="card">
	<div class="card-header">
		<div class="row">
			<div class="col-6">
				<div class="row">
					<div class="input-group mb-3">
						<a href="/risk/create" class="btn btn-primary" type="button" id="button-addon1">+</a>
						<input id="search" type="text" class="form-control" placeholder="Buscar riesgo" aria-label="Example text with button addon" aria-describedby="button-addon1">
					</div>
				</div>
			</div>
			<div class="col-6">
				<div class="row">
					<div class="col-6">
						<input class="form-control" name="from" type="datetime-local">
					</div>
					<div class="col-6">
						<input class="form-control d-flex" name="to" type="datetime-local">
					</div>
				</div>
			</div>
		</div>
	</div>
<table class="table table-borderless">
  <thead>
    <tr>
      <th scope="col">#</th>
      <th scope="col">Riesgo</th>
      <th scope="col">Propiedad</th>
      <th scope="col">Tipo</th>
    </tr>
  </thead>
  <tbody id="risks">
	  <?php  foreach($data["risks"] as $risk): ?>
	  <tr>
		  <th scope="row"><?= $risk["id_master"] ?></th>
		  <td>
			  <a href="/risk/show/<?= $risk['id_master'] ?>">
			  <?= $risk["risk"] ?>
			  </a>
		  </td>
		  <td><?= $risk["propertie"] ?></td>
		  <td><?= $risk["type"] ?></td>
	  </tr>
	  <?php  endforeach; ?>
  </tbody>
</table>
</div>
<script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
<script src="assets/js/search.js"></script>
<script>
searchTable({
	componentEvent: "search",
	listOptions: "risks",
	search: "risk",
	components: [
		"propertie",
		"type"
	],
	value: "risk",
	table: "risks",
})
</script>
</script>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/9b/a768c45d69a7218257028a9de73ccb8c28d2f7
  Tamaño: 169       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293840    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.239591996 -0500
Modificación: 2023-03-09 13:44:07.445762895 -0500
      Cambio: 2023-10-20 16:46:06.713329611 -0500
    Creación: 2023-10-20 16:46:06.713329611 -0500
tree 72db1ddc4814f69b58761817564eff5936959b0b
parent eb0f19e0d5d94c25e293bbc27cf8e48b233322f9
author DragonyteEvol <acuarionevol@outlook.com> 1678387447 +0000
committer DragonyteEvol <acuarionevol@outlook.com> 1678387447 +0000

route and redirect
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/9c/4a38e4261dc3f0ad3cb12e32ec9b1eaa1b8d09
  Tamaño: 55        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293570    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.116260362 -0500
Modificación: 2023-03-28 17:22:24.331311181 -0500
      Cambio: 2023-10-20 16:46:06.593332773 -0500
    Creación: 2023-10-20 16:46:06.589999528 -0500
100644 blob 4e9ff9d183419e4aa77905cf007c5d6271f57466	header.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/9c/5b3be6a56702f475029584600dc7afd3cf8596
  Tamaño: 85        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293571    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.116260362 -0500
Modificación: 2023-05-14 10:25:27.585102171 -0500
      Cambio: 2023-10-20 16:46:06.593332773 -0500
    Creación: 2023-10-20 16:46:06.593332773 -0500
100644 blob 97b1828d19670ca13dd69f3270dd0eac7ec6fe5b	create.php
100644 blob 95db84274bcdf088a7f0c9914dcd9b4f8926be36	index.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/9f/35d3bf36480ff638991e78cb116ad31464bdb6
  Tamaño: 265       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293544    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.102927213 -0500
Modificación: 2023-03-28 17:22:06.621311644 -0500
      Cambio: 2023-10-20 16:46:06.583333037 -0500
    Creación: 2023-10-20 16:46:06.583333037 -0500
<?php  
include_once("components/header.php");
?>

<table class="table table-borderless">
  <thead>
    <tr>
      <th scope="col">#</th>
      <th scope="col">Riesgo</th>
      <th scope="col">Propiedad</th>
      <th scope="col">Tipo</th>
    </tr>
  </thead>
  <tbody>
	  <?php  foreach($data as $risk): ?>
	  <tr>
		  <th scope="row"><?= $risk["id_master"] ?></th>
		  <td><?= $risk["risk"] ?></td>
		  <td><?= $risk["propertie"] ?></td>
		  <td><?= $risk["type"] ?></td>
	  </tr>
	  <?php  endforeach; ?>
  </tbody>
</table>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/9f/72b3ce3fdb35d03bf3b2c96c525cd8ccfe83e5
  Tamaño: 310       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293545    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.102927213 -0500
Modificación: 2023-04-06 11:42:20.709384036 -0500
      Cambio: 2023-10-20 16:46:06.583333037 -0500
    Creación: 2023-10-20 16:46:06.583333037 -0500
<?php  
include_once("components/header.php");
?>

<table class="table table-borderless">
  <thead>
    <tr>
      <th scope="col">#</th>
      <th scope="col">Riesgo</th>
      <th scope="col">Propiedad</th>
      <th scope="col">Tipo</th>
    </tr>
  </thead>
  <tbody>
	  <?php  foreach($data["risks"] as $risk): ?>
	  <tr>
		  <th scope="row"><?= $risk["id_master"] ?></th>
		  <td>
			  <a href="/risk/show/<?= $risk['id_master'] ?>">
			  <?= $risk["risk"] ?>
			  </a>
		  </td>
		  <td><?= $risk["propertie"] ?></td>
		  <td><?= $risk["type"] ?></td>
	  </tr>
	  <?php  endforeach; ?>
  </tbody>
</table>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/9f/a84c6af2c461ad4bdcf7fb3776f5d3b20bd00f
  Tamaño: 236       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293543    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.099593925 -0500
Modificación: 2023-10-07 13:37:49.776257082 -0500
      Cambio: 2023-10-20 16:46:06.583333037 -0500
    Creación: 2023-10-20 16:46:06.579999791 -0500
<?php 
class KriModel extends Model{
	protected $table = "kris";
	protected $columns = ["kri","objective","propertie_id","percentage","syntax"];
	protected $args= [":kri",":objective",":propertie_id",":percentage",":syntax"];
	protected $one_to_one= ["kris"=>"properties"];
	protected $one_to_much= ["kris"=>"qualifiers"];
	protected $much_to_much= ["kris"=>"events"];

	public function __construct(){
		parent::__construct();
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/a0/5d527cf3bbdee68cb6677fda6174823fa5d6f8
  Tamaño: 115       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293881    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.306257743 -0500
Modificación: 2023-10-16 17:33:29.722257643 -0500
      Cambio: 2023-10-20 16:46:06.733329084 -0500
    Creación: 2023-10-20 16:46:06.729995838 -0500
100644 blob e69de29bb2d1d6434b8b29ae775ad8c2e48c5391	create.php
100644 blob 1d46055131350fa0ce58e3fe2f796772ad5d5acc	index.php
100644 blob 721b4670d38476502dea63998126110f4bea64a3	show.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/a1/898242470f4afb2306690ead8fd07775ac4e1f
  Tamaño: 279       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293853    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.242925283 -0500
Modificación: 2023-03-01 15:26:02.482809872 -0500
      Cambio: 2023-10-20 16:46:06.716662857 -0500
    Creación: 2023-10-20 16:46:06.716662857 -0500
100644 blob da437ed708de7ea2d1ed5bb37dc51d00740740f6	Dockerfile
040000 tree 0d92498866d4f8052aa2042686156a488dbc030e	assets
040000 tree 5e1507f2327128680002b912ed9fb91c37a4ae0a	components
100644 blob f23d45901fe22a0ccdb21bfc95f1a231bd06a2bc	database.php
100644 blob a705a4041e04e9d51bf01a1dbecf59723e4b2207	index.php
100644 blob ee06d43b65d5e5df0c182c099e95ea2f00eaf2e1	login.php
040000 tree 2982a119945b4383064e25822f964deac0ddab5f	models
100644 blob 111a60c27b7d7b9858e2520b499e3002750cbf57	singup.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/a1/bc43fcc63384545a6785add8650244012f2a88
  Tamaño: 1025      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293854    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.246258570 -0500
Modificación: 2023-10-18 16:45:38.173922784 -0500
      Cambio: 2023-10-20 16:46:06.719996103 -0500
    Creación: 2023-10-20 16:46:06.719996103 -0500
<?php  
include_once("components/header.php");
?>
<div class="card">
	<div class="card-header">
		<div class="row">
			<div class="col-12">
				<div class="row">
					<div class="input-group mb-3">
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalCreate">+</button>
						<input id="search" type="text" class="form-control" placeholder="Buscar propiedades" aria-label="Example text with button addon" aria-describedby="button-addon1">
					</div>
				</div>
			</div>
		</div>
	</div>
	<table class="table table-borderless">
		<thead>
			<tr>
				<th scope="col">#</th>
				<th scope="col">Propiedad</th>
				<th scope="col">Fecha de creacion</th>
			</tr>
		</thead>
		<tbody id="properties">
			<?php  foreach($data["properties"] as $kri): ?>
			<tr>
				<th scope="row"><?= $kri["id_master"] ?></th>
				<td>
					<a href="/propertie/show/<?= $kri['id_master'] ?>">
						<?= $kri["propertie"] ?>
					</a>
				</td>
				<td><?= $kri["created_at"] ?></td>
			</tr>
			<?php  endforeach; ?>
		</tbody>
	</table>
</div>
<!-- FORMULARIO PARA CREACION DE PROPIEDADES -->
<div id="modalCreate" class="modal" tabindex="-1">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Crear Propiedad</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<form action="/propertie/insert" method="POST" class="needs-validation">
					<!-- NOMBRE -->
					<div class="form-floating mb-3">
						<input type="text" required class="form-control" name="propertie" id="floatingInput" placeholder="Insegra un nombre">
						<label for="floatingInput">Ingresa un nombre</label>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
						<button type="submit" class="btn btn-primary">Enviar</button>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
<script src="assets/js/search.js"></script>
<script>
	searchTable({
		componentEvent: "search",
		listOptions: "properties",
		search: "propertie",
		components: [
			"created_at"
		],
		value: "propertie",
		table: "properties",
	})
</script>
</script>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/a3/04f375bdf785e19cc02369d54ea893fe1b9fc5
  Tamaño: 42        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293614    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.136260087 -0500
Modificación: 2023-04-06 11:42:20.736050703 -0500
      Cambio: 2023-10-20 16:46:06.613332246 -0500
    Creación: 2023-10-20 16:46:06.613332246 -0500
<?php  var_dump($data) ?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/a3/785474108091d2559af2c5269385d497e69172
  Tamaño: 170       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293613    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.132926799 -0500
Modificación: 2023-07-30 06:50:23.081667216 -0500
      Cambio: 2023-10-20 16:46:06.613332246 -0500
    Creación: 2023-10-20 16:46:06.613332246 -0500
tree 23f8bdff58d74ec621f202e8ac5effcdfa20803e
parent af77fcd36e03290becefe4d75cd91cf4891b6884
author DragonyteEvol <acuarionevol@outlook.com> 1690717823 +0000
committer DragonyteEvol <acuarionevol@outlook.com> 1690717823 +0000

feat: edit view
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/a3/c245af4c9ef315b8ed5df7e7f1f775fd76b243
  Tamaño: 71        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293612    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.132926799 -0500
Modificación: 2023-06-24 08:01:49.773126175 -0500
      Cambio: 2023-10-20 16:46:06.613332246 -0500
    Creación: 2023-10-20 16:46:06.613332246 -0500
040000 tree bcf616d3942cc000681f5c65d3cabf8bb6701ce3	css
040000 tree e113041fe89261410d0353ec84abb48d128f4c7c	js
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/a4/ee322d5a433d75e6860d9873973da73ab88b12
  Tamaño: 518       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293603    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.129593511 -0500
Modificación: 2023-10-18 16:45:38.157256572 -0500
      Cambio: 2023-10-20 16:46:06.606665755 -0500
    Creación: 2023-10-20 16:46:06.606665755 -0500
<?php 
require_once("models/KriModel.php");
class RiskModel extends Model{
	/* tabla en la que actua  este modelo en base de datos */
	protected $table = "risks";

	/* columns que modifica el modelo en base de datos */
	protected $columns = ["type_id","propertie_id","risk",];

	/* columnas para modificacion en base de datos con consulta preparada */
	protected $args= [":type_id",":propertie_id",":risk"];

	/* relaciones entre bases de datos uno a muchos */
	protected $one_to_one= ["properties","types"];

	/* relaciones entre bases de datos de muchos a muchos se debe definir las dos tablas que se desean relacionar */
	protected $much_to_much= ["risks"=>"kris","kris"=>"events"];

	public function __construct(){
		parent::__construct();
		$this->kri_model = new KriModel();
	}

	public function getScore($kris){
		$score = 0;
		foreach($this->data["kris"] as $kri){
			$kri_score = $this->kri_model->getScore($kri["id"],$kri["syntax"]);
			$kri_score = $kri_score["value"] * ($kri["percentage"]/100);
			$score += $kri_score;
		};
		return $score;
	}

}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/a5/d7c91d4eec0b59c42c1a0b1c146ea1111d2624
  Tamaño: 219       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293562    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.112927074 -0500
Modificación: 2023-10-16 16:48:09.228728171 -0500
      Cambio: 2023-10-20 16:46:06.589999528 -0500
    Creación: 2023-10-20 16:46:06.589999528 -0500
tree 68d2742ff568a94249750498eeb49e73fcfef7ec
parent d5194d1e6de2888c8bd40e995811876acc35db19
author DragonyteEvol <acuarionevol@outlook.com> 1697492848 -0500
committer DragonyteEvol <acuarionevol@outlook.com> 1697492848 -0500

feat: View to create rysk and modify rysk
-View implemented
- Funtion unitary to calculate kri
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/a6/a44f11eb9bc3ca6af966bef5829251025521f6
  Tamaño: 190       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293662    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.159593098 -0500
Modificación: 2023-06-12 07:27:14.918018943 -0500
      Cambio: 2023-10-20 16:46:06.636664965 -0500
    Creación: 2023-10-20 16:46:06.636664965 -0500
040000 tree e7163dc73857b94aef2fd3bef6b5c904a4c4abb1	event
040000 tree 27dc0da7ed422a8aad877a4acc5a5e070e17887d	kri
040000 tree bf26cbec7b3a99878eea5fe64236fa8c6693da97	login
040000 tree 8494db4705a8620c9116e70e5f31fa4b042d135f	register
040000 tree 3f996d487c0a5063b1b018a35ccab9e527738db6	risk
040000 tree 51b4f483439170ce1f66b8dc07444e95bac424b7	user
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/a7/05a4041e04e9d51bf01a1dbecf59723e4b2207
  Tamaño: 318       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293656    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.156259811 -0500
Modificación: 2023-02-24 01:39:28.934068614 -0500
      Cambio: 2023-10-20 16:46:06.633331719 -0500
    Creación: 2023-10-20 16:46:06.633331719 -0500
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="assets/css/styles.css">
	<title></title>
</head>
<body>
<?php
	require("components/header.php");
?>
<h1>Please Login or SingUp</h1>
<a href="login.php">Login</a>
<a href="singup.php">Register</a>
</body>
</html>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/a7/766349f98c6f1e8f360cb711d5fe799c94b10c
  Tamaño: 83        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293655    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.156259811 -0500
Modificación: 2023-10-15 17:00:51.939325433 -0500
      Cambio: 2023-10-20 16:46:06.633331719 -0500
    Creación: 2023-10-20 16:46:06.633331719 -0500
100644 blob b054a03610071be553b00cf4009c922470061c80	index.php
100644 blob 72ca36875c175d1b4272f5da51d4cf39f6b260d4	show.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/a8/1df8bea5b9f59d72ccd16417f9c84d54826be8
  Tamaño: 351       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293773    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.209592409 -0500
Modificación: 2023-02-24 01:39:28.817401944 -0500
      Cambio: 2023-10-20 16:46:06.683330401 -0500
    Creación: 2023-10-20 16:46:06.683330401 -0500
body{
	margin: 0;
	padding: 0;
	text-align: center;
	font-family: 'Roboto', sans-serif;
}
input[type="text"], input[type="password"]{
	outline: none;
	padding: 20px;
	display: block;
	width: 300px;
	border-radius: 3px;
	border: 1px solid #eee;
	margin: 20px auto;
}

input[type="submit"]{
	padding: 10px;
	color: #fff;
	background: #0098cb;
	width: 320px;
	margin: 20px auto;
	margin-top: 0;
	border: 0;
	border-radius: 3px;
	cursor: pointer;
}
input[type="submit"]:hover{
	background-color: #00b8eb;
}
header{
	border-bottom: 2px solid #eee;
	padding: 20px 0;
	margin-bottom: 10px;
	width: 100%;
	text-align: center;
}
header a{
	text-decoration: none;
	color: #333;
}
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/a9/6238e7ad3f434f44f64b7b694876c08568b9e8
  Tamaño: 935       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293736    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.192925972 -0500
Modificación: 2023-04-06 11:42:20.709384036 -0500
      Cambio: 2023-10-20 16:46:06.666664174 -0500
    Creación: 2023-10-20 16:46:06.666664174 -0500
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Iniciar sesion - Csra</title>
		<link rel="stylesheet" href="assets/css/styles.css">
		<!-- cdn bootstrap -->
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
	</head>
	<body>
		<div class="container text-center">
			<div class="row justify-content-center">
				<div class="col-sm-10 col-md-8 col-lg-4">
					<h1>Iniciar sesion</h1>
					<span>o <a href="/register">Registrarse</a></span>
					<!-- formulario de inicio de sesion -->
					<form action="/login/login" method="POST" class="needs-validation">
						<?php if($_SESSION["error"]){?>
						<div class="p-3 text-danger-emphasis bg-danger-subtle border border-danger-subtle rounded-3">
							credenciales incorrectas
						</div>
						<?php } ?>
						<div class="form-floating mb-3">
							<input type="text" id="validationDefault01" required oninvalid="this.setCustomValidity('Ingresa un correo')" name="email" class="form-control">
							<label for="floatingInput">Ingresa tu correo</label>
						</div>
						<div class="form-floating mb-3">
							<input type="text" id="validationDefault01" required oninvalid="this.setCustomValidity('Ingresa un contraseña valida')" name="password" class="form-control">
							<label for="floatingInput">Ingresa tu correo</label>
						</div>
						<input class="form-control my-2 btn btn-primary" type="submit" value="Enviar">
					</form>
				</div>
			</div>
		</div>
	</body>
	<!-- javascript de bootstrap -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
</html>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/aa/db44394094a8e225cda6941d94e0ce387e3f8a
  Tamaño: 326       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293801    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.222925559 -0500
Modificación: 2023-03-01 15:25:39.066143825 -0500
      Cambio: 2023-10-20 16:46:06.696663383 -0500
    Creación: 2023-10-20 16:46:06.696663383 -0500
<?php 
require("database.php");
$message= "";
if(!empty($_POST["email"]) && !empty($_POST["password"]) && !empty($_POST["name"])){
	$sql = "INSERT INTO users(name,email,password) values(:name,:email,:password)";
	$state = $conn->prepare($sql);
	$state->bindParam(":name",$_POST["name"]);
	$state->bindParam(":email",$_POST["email"]);
	$password = password_hash($_POST["password"],PASSWORD_BCRYPT);
	$state->bindParam(":password",$password);
	if($state->execute()){
		$message = "Succesfully created new user";
	}else{
		$message = "Sorry, We cant create the user";
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/ab/88d0b50b2f02ca6a63488e849280128184eafb
  Tamaño: 441       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293496    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.079594201 -0500
Modificación: 2023-03-28 17:22:06.567978311 -0500
      Cambio: 2023-10-20 16:46:06.560000319 -0500
    Creación: 2023-10-20 16:46:06.556667073 -0500
<?php
require_once("models/UserModel.php");
class LoginController extends Controller{

	public function __construct(){
		session_start();
		$this->model = new UserModel();
		parent::__construct();
	}

	/* valdia si los datos ingresador en el formulario de inicio de sesion */ 
	/* 	coinciden y crea una sesion si es asi */
	public function login(){
		foreach(array_keys($_POST) as $key){
			$this->model->{$key} = $_POST[$key];
		}
		$user = $this->model->selectByEmail();
		if(count($user)>0){
			if(password_verify($this->model->password,$user[0]["password"])){
				$_SESSION["user"] = $user[0]->name;
			}else{
				$_SESSION["error"] = "error";
				header("Location: /login");
			}
		}else{
			$_SESSION["error"] = "error";
			header("Location: /login");
		}
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/ac/69238dfdd0f359374904173e88ce9601c3964f
  Tamaño: 190       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293846    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.242925283 -0500
Modificación: 2023-04-13 16:00:40.143749336 -0500
      Cambio: 2023-10-20 16:46:06.716662857 -0500
    Creación: 2023-10-20 16:46:06.716662857 -0500
040000 tree d42377cb3fad9128901b030b8e9d16d2e3cb4167	event
040000 tree 759b277e3e4bdc5b2df80cfb3f2e0ab099274429	kri
040000 tree bf26cbec7b3a99878eea5fe64236fa8c6693da97	login
040000 tree 8494db4705a8620c9116e70e5f31fa4b042d135f	register
040000 tree 3f996d487c0a5063b1b018a35ccab9e527738db6	risk
040000 tree 51b4f483439170ce1f66b8dc07444e95bac424b7	user
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/ae/5a124334db6294ffbfd0851e3036f54250a9b4
  Tamaño: 239       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293573    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.116260362 -0500
Modificación: 2023-10-08 19:56:50.361312560 -0500
      Cambio: 2023-10-20 16:46:06.593332773 -0500
    Creación: 2023-10-20 16:46:06.593332773 -0500
tree b363bf2008becadb1b096dbca02a4cd2b7b42232
parent 12161e6b1e0c15ee72b6b3faad08a3c52505e53d
author DragonyteEvol <acuarionevol@outlook.com> 1696812911 -0500
committer DragonyteEvol <acuarionevol@outlook.com> 1696812911 -0500

feat: Syntax eval to score kris
- Event function to evan syntax
- Function to show kri in controller with score
- Documentation code
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/af/1b8f6d28b35162f5418a733301b8b66d43081d
  Tamaño: 2023      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293660    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.159593098 -0500
Modificación: 2023-05-19 15:57:22.436142505 -0500
      Cambio: 2023-10-20 16:46:06.636664965 -0500
    Creación: 2023-10-20 16:46:06.636664965 -0500
<?php  
include_once("components/header.php");
?>
<!-- FORMULARIO DE CREACION DE KRIS -->
<div class="container">
	<form action="/kri/update" method="POST" class="needs-validation">
		<div class="card my-5">
			<?php  foreach($data["kris"] as $kri): ?>
			<div class="card-header">
				<h5><b><?=$kri['master_id']?>.</b>Visualizacion de KRI <?=$kri['kri']?></h5>
			</div>
			<div class="card-body">
				<!-- KRI -->
				<div class="form-floating mb-3">
					<input type="text" value="<?= $kri['kri'] ?>" required class="form-control" name="kri" id="floatingInput" placeholder="Insegra un nombre">
					<label for="floatingInput">Nombre del KRI</label>
				</div>
				<!-- OBJECTIVO -->
				<div class="form-floating">
					<textarea class="form-control mb-3" name="objective" id="floatingTextarea2"><?= $kri["objective"] ?></textarea>
					<label for="floatingTextarea2">Objetivo</label>
				</div>
				<div class="row">
					<div class="col-6">
						<!-- PROPIEDAD -->
						<div class="form-floating mb-3">
							<select name="propertie_id" class="form-select" id="datalistOptions" aria-label="">
								<option value="<?= $kri['propertie_id'] ?>" selected><?= $kri['propertie']?></option>
							</select>
							<label for="floatingSelect">Propiedad</label>
						</div>
					</div>
					<div class="col-6">
						<!-- PORCENTAJE -->
						<div class="form-floating mb-3">
							<input name="percentage" type="number" value="<?= $kri['percentage'] ?>" class="form-control">
							<label for="floatingInput">Porcentaje</label>
						</div>
					</div>
				</div>
				<!-- SYNTAX-->
				<div class="form-floating mb-3">
					<input name="syntax" type="text" value="<?= $kri['syntax'] ?>" class="form-control disabled">
					<label for="floatingInput">Sintaxis / Operacion de kri</label>
				</div>
				<div class="accordion accordion-flush" id="accordionFlushExample">
					<!-- EVENTOS -->
					<div class="accordion-item">
						<h2 class="accordion-header">
							<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#event-collapse" aria-expanded="false" aria-controls="flush-collapseOne">
								Eventos	
							</button>
						</h2>
						<div id="event-collapse" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
							<div class="my-2">
								<button name="events" type="button" class="form-control btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#exampleModal">
									Añadir evento
								</button>
								<?php  foreach($data["events"] as $event): ?>
								<div class="form-check">
									<input type="checkbox" checked id="<?= $event['event'] ?>" value="<?= $event['id'] ?>" name="event[]" class="form-check-input">
									<label class="form-check-label" for="<?= $event['event'] ?>"><?= $event['event'] ?></label>
								</div>
								<?php  endforeach; ?>
							</div>
						</div>
					</div>
					<!-- QUALIFIERS -->
					<div class="accordion-item">
						<h2 class="accordion-header">
							<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#qualifier-collapse" aria-expanded="false" aria-controls="flush-collapseOne">
								Calificadores
							</button>
						</h2>
						<div id="qualifier-collapse" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
								<?php  foreach($data["qualifiers"] as $qualifier): ?>
								<div class="input-group mb-3">
									<div class="form-floating">
										<input type="text" value="<?= $qualifier['type'] ?>" class="form-control" name="qualifiers[]" id="floatingInputGroup1">
										<label for="floatingInputGroup1">Nombre Calificador</label>
									</div>
									<div class="form-floating">
										<input type="text" class="form-control" value="<?= $qualifier['value'] ?>" name="qualifiers_values[]" id="floatingInputGroup1">
										<label for="floatingInputGroup1">Valor</label>
									</div>
								</div>
								<?php  endforeach; ?>
								<button type="button" onclick="addQualifier()" class="form-control btn btn-outline-primary btn-sm">
									Agregar
								</button>
						</div>
					</div>
					<div class="accordion-item">
						<h2 class="accordion-header">
							<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#map-collapse" aria-expanded="false" aria-controls="flush-collapseOne">
								Mapa relacional
							</button>
						</h2>
						<div id="map-collapse" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
							<div class="row align-items-center my-2">
								<div class="col-6">
									<button class="btn btn-outline-dark btn-sm form-control">
										<?= $kri["kri"] ?>
									</button>
								</div>
								<div class="col-6">
									<?php  foreach($data["events"] as $event): ?>
									<button class="btn btn-outline-dark btn-sm form-control my-2" data-bs-toggle="popover" data-bs-title="Descripcion del evento" data-bs-content="">
										<?= $event["event"]?>
									</button>
									<?php  endforeach; ?>
								</div>
							</div>
						</div>
					</div>
				</div>
				<?php  endforeach; ?>
			</div>
			<div class="card-footer">
				<!-- END FIELD -->
				<div class="row">
					<div class="col-6">
						<button type="reset" class="btn btn-outline-secondary form-control">Limpiar</button>
					</div>
					<div class="col-6">
						<button type="submit" class="btn btn-primary form-control">Actualizar</button>
					</div>
				</div>
			</div>
	</form>
		</div>

		<!-- FORMULARIO DE ADICION DE EVENTOS -->
		<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h1 class="modal-title fs-5" id="exampleModalLabel">Buscar Evento</h1>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<div class="form-floating mb-3">
							<input type="text" required class="form-control" id="searchEvent" placeholder="Insegra un nombre">
							<label for="floatingInput">Buscar evento</label>
						</div>
						<div class="justify-content-center" id="datalistOptionsEvent">
						</div>
					</div>
				</div>
			</div>
		</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
<script src="/assets/js/search.js"></script>
<script>
	searchEvent({
		listOptions: "datalistOptions",
		search: "propertie",
		components: new Map([
			["value","id"]
		]),
		value: "propertie",
		table: "properties",
		tag: "option"
	})
</script>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/af/6a408238a3b36b96585539420161af30c42234
  Tamaño: 3420      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293658    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.156259811 -0500
Modificación: 2023-02-24 01:39:28.934068614 -0500
      Cambio: 2023-10-20 16:46:06.633331719 -0500
    Creación: 2023-10-20 16:46:06.633331719 -0500
call plug#begin('~/.local/share/nvim/plugged')
Plug 'neoclide/coc.nvim', {'branch': 'release'} 
Plug 'mattn/emmet-vim'
Plug 'leafOfTree/vim-vue-plugin'
Plug 'junegunn/fzf', { 'do': { -> fzf#install() } }
Plug 'junegunn/fzf.vim'
Plug 'alvan/vim-closetag'
Plug 'preservim/nerdtree'
Plug 'mg979/vim-visual-multi', {'branch': 'master'}
Plug 'tpope/vim-commentary'
Plug 'tpope/vim-fugitive'
Plug 'neoclide/coc-eslint'
Plug 'tpope/vim-surround'
Plug 'easymotion/vim-easymotion'
call plug#end()

"--------FZF-----------------------
let $FZF_DEFAULT_COMMAND='find . \! \( -type d -path ./.git -prune \) \! -type d \! -name ''*.tags'' -printf ''%P\n'''

"-------CONFIG -------------------------
set ts=4 sw=4
set wildmenu
set relativenumber

"-------CUSTOM MAP ----------------------
inoremap " ""<Esc>i
inoremap ( ()<Esc>i
inoremap [ []<Esc>i
inoremap ' ''<Esc>i
inoremap { {}<Esc>i
"-------CUSTOM MAP ----------------------
imap <C-h> <Esc>ha
imap <C-l> <Esc>la
imap <C-j> <Esc>A;<Esc>
nmap <C-j> A;<Esc>
nmap <C-p> a<?php   ?><Esc>2hi
imap ff <Esc>
imap ; ;<Esc>
vmap ff <Esc> 
let mapleader= " "
nmap <Leader>t :Files<CR>
nmap <Leader>b :Buffers<CR>
nmap <Leader>ñ :NERDTree<CR>
nmap <Leader>q :NERDTreeClose<CR>
nmap <Leader>} :MinifyJS<CR>
nmap <Leader>} :UnMinifyJS<CR>
nmap <Leader><Leader>y <C-y>,
nmap <Leader>w :w<CR> 
inoremap <A-h> <C-o>h
inoremap <A-j> <C-o>j
inoremap <A-k> <C-o>k
inoremap <A-l> <C-o>l

"-------CLOSE TAG ------------------------
let g:closetag_filetypes = 'html,xhtml,phtml,js,vue'


"-------------------COC--------------------------
" Set internal encoding of vim, not needed on neovim, since coc.nvim using some
" unicode characters in the file autoload/float.vim
set encoding=utf-8

" TextEdit might fail if hidden is not set.
set hidden

" Some servers have issues with backup files, see #649.
set nobackup
set nowritebackup

" Give more space for displaying messages.
set cmdheight=2

" Having longer updatetime (default is 4000 ms = 4 s) leads to noticeable
" delays and poor user experience.
set updatetime=300

" Don't pass messages to |ins-completion-menu|.
set shortmess+=c

" Always show the signcolumn, otherwise it would shift the text each time
" diagnostics appear/become resolved.
if has("nvim-0.5.0") || has("patch-8.1.1564")
	" Recently vim can merge signcolumn and number column into one
	set signcolumn=number
else
	set signcolumn=yes
endif

" Use tab for trigger completion with characters ahead and navigate.
" NOTE: Use command ':verbose imap <tab>' to make sure tab is not mapped by
" other plugin before putting this into your config.
inoremap <silent><expr> <TAB>
			\ pumvisible() ? "\<C-n>" :
			\ <SID>check_back_space() ? "\<TAB>" :
			\ coc#refresh()
inoremap <expr><S-TAB> pumvisible() ? "\<C-p>" : "\<C-h>"

function! s:check_back_space() abort
	let col = col('.') - 1
	return !col || getline('.')[col - 1]  =~# '\s'
endfunction

" Use <c-space> to trigger completion.
if has('nvim')
	inoremap <silent><expr> <c-space> coc#refresh()
else
	inoremap <silent><expr> <c-@> coc#refresh()
endif

" Make <CR> auto-select the first completion item and notify coc.nvim to
" format on enter, <cr> could be remapped by other vim plugin
inoremap <silent><expr> <cr> pumvisible() ? coc#_select_confirm()
			\: "\<C-g>u\<CR>\<c-r>=coc#on_enter()\<CR>"

" Use `[g` and `]g` to navigate diagnostics
" Use `:CocDiagnostics` to get all diagnostics of current buffer in location list.
nmap <silent> [g <Plug>(coc-diagnostic-prev)
nmap <silent> ]g <Plug>(coc-diagnostic-next)

" GoTo code navigation.
nmap <silent> gd <Plug>(coc-definition)
nmap <silent> gy <Plug>(coc-type-definition)
nmap <silent> gr <Plug>(coc-references)

" Use K to show documentation in preview window.
nnoremap <silent> K :call <SID>show_documentation()<CR>

function! s:show_documentation()
	if (index(['vim','help'], &filetype) >= 0)
		execute 'h '.expand('<cword>')
	elseif (coc#rpc#ready())
		call CocActionAsync('doHover')
	else
		execute '!' . &keywordprg . " " . expand('<cword>')
	endif
endfunction

" Highlight the symbol and its references when holding the cursor.
autocmd CursorHold * silent call CocActionAsync('highlight')

" Symbol renaming.
nmap <leader>rn <Plug>(coc-rename)

" Formatting selected code.
xmap <leader>f  <Plug>(coc-format-selected)
nmap <leader>f  <Plug>(coc-format-selected)

augroup mygroup
	autocmd!
	" Setup formatexpr specified filetype(s).
	autocmd FileType typescript,json setl formatexpr=CocAction('formatSelected')
	" Update signature help on jump placeholder.
	autocmd User CocJumpPlaceholder call CocActionAsync('showSignatureHelp')
augroup end

" Applying codeAction to the selected region.
" Example: `<leader>aap` for current paragraph
xmap <leader>a  <Plug>(coc-codeaction-selected)
nmap <leader>a  <Plug>(coc-codeaction-selected)

" Remap keys for applying codeAction to the current buffer.
nmap <leader>ac  <Plug>(coc-codeaction)
" Apply AutoFix to problem on the current line.
nmap <leader>qf  <Plug>(coc-fix-current)

" Map function and class text objects
" NOTE: Requires 'textDocument.documentSymbol' support from the language server.
xmap if <Plug>(coc-funcobj-i)
omap if <Plug>(coc-funcobj-i)
xmap af <Plug>(coc-funcobj-a)
omap af <Plug>(coc-funcobj-a)
xmap ic <Plug>(coc-classobj-i)
omap ic <Plug>(coc-classobj-i)
xmap ac <Plug>(coc-classobj-a)
omap ac <Plug>(coc-classobj-a)

" Remap <C-f> and <C-b> for scroll float windows/popups.
if has('nvim-0.4.0') || has('patch-8.2.0750')
	nnoremap <silent><nowait><expr> <C-f> coc#float#has_scroll() ? coc#float#scroll(1) : "\<C-f>"
	nnoremap <silent><nowait><expr> <C-b> coc#float#has_scroll() ? coc#float#scroll(0) : "\<C-b>"
	inoremap <silent><nowait><expr> <C-f> coc#float#has_scroll() ? "\<c-r>=coc#float#scroll(1)\<cr>" : "\<Right>"
	inoremap <silent><nowait><expr> <C-b> coc#float#has_scroll() ? "\<c-r>=coc#float#scroll(0)\<cr>" : "\<Left>"
	vnoremap <silent><nowait><expr> <C-f> coc#float#has_scroll() ? coc#float#scroll(1) : "\<C-f>"
	vnoremap <silent><nowait><expr> <C-b> coc#float#has_scroll() ? coc#float#scroll(0) : "\<C-b>"
endif

" Use CTRL-S for selections ranges.
" Requires 'textDocument/selectionRange' support of language server.
nmap <silent> <C-s> <Plug>(coc-range-select)
xmap <silent> <C-s> <Plug>(coc-range-select)

" Add `:Format` command to format current buffer.
command! -nargs=0 Format :call CocAction('format')

" Add `:Fold` command to fold current buffer.
command! -nargs=? Fold :call     CocAction('fold', <f-args>)

" Add `:OR` command for organize imports of the current buffer.
command! -nargs=0 OR   :call     CocAction('runCommand', 'editor.action.organizeImport')

" Add (Neo)Vim's native statusline support.
" NOTE: Please see `:h coc-status` for integrations with external plugins that
" provide custom statusline: lightline.vim, vim-airline.
set statusline^=%{coc#status()}%{get(b:,'coc_current_function','')}

" Mappings for CoCList
" Show all diagnostics.
nnoremap <silent><nowait> <space>a  :<C-u>CocList diagnostics<cr>
" Manage extensions.
nnoremap <silent><nowait> <space>e  :<C-u>CocList extensions<cr>
" Show commands.
nnoremap <silent><nowait> <space>c  :<C-u>CocList commands<cr>
" Find symbol of current document.
nnoremap <silent><nowait> <space>o  :<C-u>CocList outline<cr>
" Search workspace symbols.
nnoremap <silent><nowait> <space>s  :<C-u>CocList -I symbols<cr>
nnoremap <silent><nowait> <space>s  :<C-u>CocList -I symbols<cr>
" Do default action for next item.
nnoremap <silent><nowait> <space>j  :<C-u>CocNext<CR>
" Do default action for previous item.
nnoremap <silent><nowait> <space>k  :<C-u>CocPrev<CR>
" Resume latest coc list.
nnoremap <silent><nowait> <space>p  :<C-u>CocListResume<CR>

" Vim Saoko
let g:vim_vue_plugin_config = { 
      \'syntax': {
      \   'template': ['html'],
      \   'script': ['javascript'],
      \   'style': ['css'],
      \},
      \'full_syntax': [],
      \'initial_indent': [],
      \'attribute': 0,
      \'keyword': 0,
      \'foldexpr': 0,
      \'debug': 0,
      \}

"Emet
let g:user_emmet_mode='n'    "only enable normal mode functions.
let g:user_emmet_mode='inv'  "enable all functions, which is equal to
let g:user_emmet_mode='a'    "enable all function in all mode.

" TABS
inoremap <expr> <Tab> pumvisible() ? "\<C-n>" : "\<Tab>"
inoremap <expr> <S-Tab> pumvisible() ? "\<C-p>" : "\<S-Tab>"
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/af/77fcd36e03290becefe4d75cd91cf4891b6884
  Tamaño: 178       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293659    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.156259811 -0500
Modificación: 2023-06-24 08:01:49.993126169 -0500
      Cambio: 2023-10-20 16:46:06.633331719 -0500
    Creación: 2023-10-20 16:46:06.633331719 -0500
tree e5e9dd20b527b3d1ecc0ae70151f50b5803c41b0
parent e4cfa66a43780ef08ffbbed9999051a08ca6be8c
author DragonyteEvol <acuarionevol@outlook.com> 1687611709 +0000
committer DragonyteEvol <acuarionevol@outlook.com> 1687611709 +0000

feat: dinamic search of objects
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/b0/54a03610071be553b00cf4009c922470061c80
  Tamaño: 723       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293798    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.222925559 -0500
Modificación: 2023-06-24 08:01:27.643126756 -0500
      Cambio: 2023-10-20 16:46:06.693330138 -0500
    Creación: 2023-10-20 16:46:06.693330138 -0500
<?php  
include_once("components/header.php");
?>
<div class="card">
	<div class="card-header">
		<div class="row">
			<div class="col-6">
				<div class="row">
					<div class="input-group mb-3">
						<a href="/kri/create" class="btn btn-primary" type="button" id="button-addon1">+</a>
						<input id="search" type="text" class="form-control" placeholder="Buscar riesgo" aria-label="Example text with button addon" aria-describedby="button-addon1">
					</div>
				</div>
			</div>
			<div class="col-6">
				<div class="row">
					<div class="col-6">
						<input class="form-control" name="from" type="datetime-local">
					</div>
					<div class="col-6">
						<input class="form-control d-flex" name="to" type="datetime-local">
					</div>
				</div>
			</div>
		</div>
	</div>
<table class="table table-borderless">
  <thead>
    <tr>
      <th scope="col">#</th>
      <th scope="col">Riesgo</th>
      <th scope="col">Propiedad</th>
      <th scope="col">Tipo</th>
    </tr>
  </thead>
  <tbody id="risks">
	  <?php  foreach($data["risks"] as $risk): ?>
	  <tr>
		  <th scope="row"><?= $risk["id_master"] ?></th>
		  <td>
			  <a href="/risk/show/<?= $risk['id_master'] ?>">
			  <?= $risk["risk"] ?>
			  </a>
		  </td>
		  <td><?= $risk["propertie"] ?></td>
		  <td><?= $risk["type"] ?></td>
	  </tr>
	  <?php  endforeach; ?>
  </tbody>
</table>
</div>
<script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
<script src="assets/js/search.js"></script>
<script>
searchTable({
	componentEvent: "search",
	listOptions: "risks",
	search: "risk",
	components: [
		"propertie",
		"type"
	],
	value: "risk",
	table: "risks",
})
</script>
</script>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/b0/55b0905a34aea1429e2e0a15223facdb174cd3
  Tamaño: 55        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293799    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.222925559 -0500
Modificación: 2023-03-09 13:44:00.559096102 -0500
      Cambio: 2023-10-20 16:46:06.693330138 -0500
    Creación: 2023-10-20 16:46:06.693330138 -0500
100644 blob 59363740fbc4c10281feab067f31e2914102b29a	header.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/b3/63bf2008becadb1b096dbca02a4cd2b7b42232
  Tamaño: 438       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293624    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.139593374 -0500
Modificación: 2023-10-08 19:55:11.043871255 -0500
      Cambio: 2023-10-20 16:46:06.619998737 -0500
    Creación: 2023-10-20 16:46:06.616665492 -0500
100644 blob 46141854b6c4aac2047018836b3340f5f62dd0c2	.htaccess
100644 blob da437ed708de7ea2d1ed5bb37dc51d00740740f6	Dockerfile
040000 tree 8441109a06b6984f8ca8f81b5b38b979e7cda8d2	assets
040000 tree 0994b646c5cf6fe1259596f6e540c6055d0d4e1c	components
100644 blob 886fe19262e1dcc9bc5827b9b360744e6fe4cf58	config.php
040000 tree 5a9960d2de861e2959d8deffcddbedc07c7eb2f2	controllers
100644 blob 8dadb53d86e692a9145d4db33bc19d31c3303116	data.sql
100644 blob 82c1b06cf8655c3159204f46dafb691aa3fe03c0	database.php
100644 blob 27dae4899dda3ef6df80d4bdc4ec9c52248ccb59	index.php
040000 tree e81f05bbeda163e0e39501b8f78efcb7ca7ea64f	models
100644 blob d9a4ec66dfeb45d52c58647f352aaaae6b84cd28	router.php
100644 blob b82cea160f9cfcea3268f5371dbfc4fff71c4b97	seeder.sql
040000 tree 03af754393850698c31d45a634f08c29dd9b28bf	views
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/b3/9c25f566b37f522483a453100653f3ae7b3ad9
  Tamaño: 727       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293625    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.142926661 -0500
Modificación: 2023-03-09 13:43:50.295762584 -0500
      Cambio: 2023-10-20 16:46:06.619998737 -0500
    Creación: 2023-10-20 16:46:06.619998737 -0500
<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<link rel="stylesheet" href="assets/css/styles.css">
	<title>Registrarse - Csra</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
</head>
<body>
	<div class="container text-center">
		<div class="row justify-content-center">
			<div class="col-sm-10 col-md-8 col-lg-4">
				<h1>Registrarse</h1>
				<span>o <a href="login.php">Iniciar sesion</a></span>
				<!-- formulario para creacion de usuarios -->
				<form action="" method="POST">
					<input type="text" class="form-control my-2" placeholder="Ingresa tu nombre" name="name">
					<input type="text" class="form-control my-2" placeholder="Ingresa tu email" name="email">
					<input type="password" class="form-control my-2" placeholder="Ingresa tu contraseña" name="password">
					<input type="password" class="form-control my-2" placeholder="Confirma tu contraseña" name="confirm_password">
					<input class="form-control my-2 btn btn-primary" type="submit" value="Enviar">
				</form>
			</div>
		</div>
	</div>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
</body>
</html>




---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/b3/c9286a163b4b0860a0fb6bf721ff41da998359
  Tamaño: 190       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293626    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.142926661 -0500
Modificación: 2023-03-30 15:50:16.840976186 -0500
      Cambio: 2023-10-20 16:46:06.619998737 -0500
    Creación: 2023-10-20 16:46:06.619998737 -0500
<?php 
class KriModel extends Model{
	protected $table = "kris";
	protected $columns = ["kri","objective","propertie_id","percentage","syntax"];
	protected $args= [":kri",":objective",":propertie_id",":percentage",":syntax"];

	public function __construct(){
		parent::__construct();
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/b4/54c700c6d89699270ad15a6872a4b09a34e62b
  Tamaño: 115       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293598    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.129593511 -0500
Modificación: 2023-10-18 16:45:46.043708291 -0500
      Cambio: 2023-10-20 16:46:06.606665755 -0500
    Creación: 2023-10-20 16:46:06.606665755 -0500
100644 blob f1981ec9a329fa949247d4e820570503dbc2c090	create.php
100644 blob 9b890f6c8ac64acf510924d30015a38d4b5bd9d0	index.php
100644 blob eafe13d3607c0e02c8d4c6ed9f30f268234fe113	show.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/b4/6076eb67ae791c25565c159aa7c1ea1e16ee1c
  Tamaño: 2018      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293599    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.129593511 -0500
Modificación: 2023-06-12 07:26:58.504685315 -0500
      Cambio: 2023-10-20 16:46:06.606665755 -0500
    Creación: 2023-10-20 16:46:06.606665755 -0500
<?php  
include_once("components/header.php");
?>
<!-- FORMULARIO DE CREACION DE KRIS -->
<div class="container">
	<form action="/kri/update" method="POST" class="needs-validation">
		<div class="card my-5">
			<?php  foreach($data["kris"] as $kri): ?>
			<div class="card-header">
				<h5><b><?=$kri['master_id']?> | </b><?=$kri['kri']?></h5>
			</div>
			<div class="card-body">
				<!-- KRI -->
				<div class="form-floating mb-3">
					<input type="text" value="<?= $kri['kri'] ?>" required class="form-control" name="kri" id="floatingInput" placeholder="Insegra un nombre">
					<label for="floatingInput">Nombre del KRI</label>
				</div>
				<!-- OBJECTIVO -->
				<div class="form-floating">
					<textarea class="form-control mb-3" name="objective" id="floatingTextarea2"><?= $kri["objective"] ?></textarea>
					<label for="floatingTextarea2">Objetivo</label>
				</div>
				<div class="row">
					<div class="col-6">
						<!-- PROPIEDAD -->
						<div class="form-floating mb-3">
							<select name="propertie_id" class="form-select" id="datalistOptions" aria-label="">
								<option value="<?= $kri['propertie_id'] ?>" selected><?= $kri['propertie']?></option>
							</select>
							<label for="floatingSelect">Propiedad</label>
						</div>
					</div>
					<div class="col-6">
						<!-- PORCENTAJE -->
						<div class="form-floating mb-3">
							<input name="percentage" type="number" value="<?= $kri['percentage'] ?>" class="form-control">
							<label for="floatingInput">Porcentaje</label>
						</div>
					</div>
				</div>
				<!-- SYNTAX-->
				<div class="form-floating mb-3">
					<input name="syntax" type="text" value="<?= $kri['syntax'] ?>" class="form-control disabled">
					<label for="floatingInput">Sintaxis / Operacion de kri</label>
				</div>
				<div class="accordion accordion-flush" id="accordionFlushExample">
					<!-- EVENTOS -->
					<div class="accordion-item">
						<h2 class="accordion-header">
							<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#event-collapse" aria-expanded="false" aria-controls="flush-collapseOne">
								Eventos	
							</button>
						</h2>
						<div id="event-collapse" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
							<div class="my-2">
								<button name="events" type="button" class="form-control btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#exampleModal">
									Añadir evento
								</button>
								<?php  foreach($data["events"] as $event): ?>
								<div class="form-check">
									<input type="checkbox" checked id="<?= $event['event'] ?>" value="<?= $event['id'] ?>" name="event[]" class="form-check-input">
									<label class="form-check-label" for="<?= $event['event'] ?>"><?= $event['event'] ?></label>
								</div>
								<?php  endforeach; ?>
							</div>
						</div>
					</div>
					<!-- QUALIFIERS -->
					<div class="accordion-item">
						<h2 class="accordion-header">
							<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#qualifier-collapse" aria-expanded="false" aria-controls="flush-collapseOne">
								Calificadores
							</button>
						</h2>
						<div id="qualifier-collapse" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
								<?php  foreach($data["qualifiers"] as $qualifier): ?>
								<div class="input-group mb-3">
									<div class="form-floating">
										<input type="text" value="<?= $qualifier['type'] ?>" class="form-control" name="qualifiers[]" id="floatingInputGroup1">
										<label for="floatingInputGroup1">Nombre Calificador</label>
									</div>
									<div class="form-floating">
										<input type="text" class="form-control" value="<?= $qualifier['value'] ?>" name="qualifiers_values[]" id="floatingInputGroup1">
										<label for="floatingInputGroup1">Valor</label>
									</div>
								</div>
								<?php  endforeach; ?>
								<button type="button" onclick="addQualifier()" class="form-control btn btn-outline-primary btn-sm">
									Agregar
								</button>
						</div>
					</div>
					<div class="accordion-item">
						<h2 class="accordion-header">
							<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#map-collapse" aria-expanded="false" aria-controls="flush-collapseOne">
								Mapa relacional
							</button>
						</h2>
						<div id="map-collapse" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
							<div class="row align-items-center my-2">
								<div class="col-6">
									<button class="btn btn-outline-dark btn-sm form-control">
										<?= $kri["kri"] ?>
									</button>
								</div>
								<div class="col-6">
									<?php  foreach($data["events"] as $event): ?>
									<button class="btn btn-outline-dark btn-sm form-control my-2" data-bs-toggle="popover" data-bs-title="Descripcion del evento" data-bs-content="">
										<?= $event["event"]?>
									</button>
									<?php  endforeach; ?>
								</div>
							</div>
						</div>
					</div>
				</div>
				<?php  endforeach; ?>
			</div>
			<div class="card-footer">
				<!-- END FIELD -->
				<div class="row">
					<div class="col-6">
						<button type="reset" class="btn btn-outline-secondary form-control">Limpiar</button>
					</div>
					<div class="col-6">
						<button type="submit" class="btn btn-primary form-control">Actualizar</button>
					</div>
				</div>
			</div>
	</form>
		</div>

		<!-- FORMULARIO DE ADICION DE EVENTOS -->
		<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h1 class="modal-title fs-5" id="exampleModalLabel">Buscar Evento</h1>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<div class="form-floating mb-3">
							<input type="text" required class="form-control" id="searchEvent" placeholder="Insegra un nombre">
							<label for="floatingInput">Buscar evento</label>
						</div>
						<div class="justify-content-center" id="datalistOptionsEvent">
						</div>
					</div>
				</div>
			</div>
		</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
<script src="/assets/js/search.js"></script>
<script>
	searchEvent({
		listOptions: "datalistOptions",
		search: "propertie",
		components: new Map([
			["value","id"]
		]),
		value: "propertie",
		table: "properties",
		tag: "option"
	})
</script>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/b5/2e2a473825ac2719a6deeec6908576f3458f73
  Tamaño: 82        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293535    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.099593925 -0500
Modificación: 2023-06-24 08:01:49.933126171 -0500
      Cambio: 2023-10-20 16:46:06.579999791 -0500
    Creación: 2023-10-20 16:46:06.576666547 -0500
100644 blob b054a03610071be553b00cf4009c922470061c80	index.php
100644 blob d75d75e151582b4db833148749f3bd47db469140	show.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/b5/dc003002c204b8331b8443d6f9d7e541614508
  Tamaño: 707       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293536    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.099593925 -0500
Modificación: 2023-06-24 08:01:27.656460089 -0500
      Cambio: 2023-10-20 16:46:06.579999791 -0500
    Creación: 2023-10-20 16:46:06.579999791 -0500
<?php  
include_once("components/header.php");
?>
<div class="card">
	<div class="card-header">
		<div class="row">
			<div class="col-6">
				<div class="row">
					<div class="input-group mb-3">
						<a href="/kri/create" class="btn btn-primary" type="button" id="button-addon1">+</a>
						<input id="search" type="text" class="form-control" placeholder="Buscar propiedades" aria-label="Example text with button addon" aria-describedby="button-addon1">
					</div>
				</div>
			</div>
			<div class="col-6">
				<div class="row">
					<div class="col-6">
						<input class="form-control" name="from" type="datetime-local">
					</div>
					<div class="col-6">
						<input class="form-control d-flex" name="to" type="datetime-local">
					</div>
				</div>
			</div>
		</div>
	</div>
	<table class="table table-borderless">
		<thead>
			<tr>
				<th scope="col">#</th>
				<th scope="col">Propiedad</th>
				<th scope="col">Fecha de creacion</th>
			</tr>
		</thead>
		<tbody id="properties">
			<?php  foreach($data["properties"] as $kri): ?>
			<tr>
				<th scope="row"><?= $kri["id_master"] ?></th>
				<td>
					<a href="/propertie/show/<?= $kri['id_master'] ?>">
						<?= $kri["propertie"] ?>
					</a>
				</td>
				<td><?= $kri["created_at"] ?></td>
			</tr>
			<?php  endforeach; ?>
		</tbody>
	</table>
</div>
<script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
<script src="assets/js/search.js"></script>
<script>
searchTable({
	componentEvent: "search",
	listOptions: "properties",
	search: "propertie",
	components: [
		"created_at"
	],
	value: "propertie",
	table: "properties",
})
</script>
</script>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/b6/1a11abc6b8d9e42f23f26893bb71ec7ee63efe
  Tamaño: 251       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293556    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.106260500 -0500
Modificación: 2023-10-17 16:44:13.007691203 -0500
      Cambio: 2023-10-20 16:46:06.586666282 -0500
    Creación: 2023-10-20 16:46:06.586666282 -0500
040000 tree c1a43b69371eea8ab5885b0c3a756f816af941ea	event
040000 tree 308825de38a9227b205beaff0966241c92688b54	kri
040000 tree bf26cbec7b3a99878eea5fe64236fa8c6693da97	login
040000 tree 4f27caa9c5680f7c74a99a1cc1eb3911d428c67f	propertie
040000 tree 8494db4705a8620c9116e70e5f31fa4b042d135f	register
040000 tree 7d800670bf70416503ae27c25067f7f3d069b2c4	risk
040000 tree 2f47ccb2e200d0e41df57356190e2cc8bfd87708	type
040000 tree 51b4f483439170ce1f66b8dc07444e95bac424b7	user
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/b6/fa123dd2d1eb37adeb02519451012042267d5b
  Tamaño: 300       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293557    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.106260500 -0500
Modificación: 2023-04-13 16:00:40.123749336 -0500
      Cambio: 2023-10-20 16:46:06.586666282 -0500
    Creación: 2023-10-20 16:46:06.586666282 -0500
100644 blob 5a74ab5739f45e3121c04922d1f722230066f590	Controller.php
100644 blob 7b7d7e81e8468da6cd329024af7e5eb90d11e3a1	EventController.php
100644 blob 03d434714b9c4aeca68bd623c8ac65e1998fea2e	KriController.php
100644 blob ab88d0b50b2f02ca6a63488e849280128184eafb	LoginController.php
100644 blob 12620ce4178e3b649067d4a02a366ef83bb8d47e	RegisterController.php
100644 blob 5fa1c0a8e82b84d03e204b24bdde9483e720aba0	RiskController.php
100644 blob 8c1bb57955e07f847b2b8e617e4db6218f8ced28	SourceController.php
100644 blob 07a9d2abeb523436c2863c3129e2c4f1fd26c654	TemplateController.php
100644 blob fb02603f5e1e778c1b626de544c3f0834532d3e1	UserController.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/b8/2cea160f9cfcea3268f5371dbfc4fff71c4b97
  Tamaño: 3380      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293596    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.126260224 -0500
Modificación: 2023-09-04 05:41:22.376686534 -0500
      Cambio: 2023-10-20 16:46:06.606665755 -0500
    Creación: 2023-10-20 16:46:06.606665755 -0500
-- MySQL dump 10.13  Distrib 5.7.41, for Linux (x86_64)
--
-- Host: localhost    Database: csra
-- ------------------------------------------------------
-- Server version	5.7.41

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

--
-- Table structure for table `events`
--

DROP TABLE IF EXISTS `events`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `events` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `event` varchar(255) DEFAULT NULL,
  `type` enum('automatic','manual') DEFAULT NULL,
  `source_id` int(11) DEFAULT NULL,
  `event_id` int(11) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=28 DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `events`
--

LOCK TABLES `events` WRITE;
/*!40000 ALTER TABLE `events` DISABLE KEYS */;
INSERT INTO `events` VALUES (1,'Escaneo de puertos','automatic',NULL,NULL,'2023-03-30 18:07:33'),(2,'Inundacin de paquetes (synFlood)','automatic',NULL,NULL,'2023-03-30 18:07:33'),(3,'Ataque de fuerza bruta','automatic',NULL,NULL,'2023-03-30 18:07:33'),(4,'Deteccin de malware en estacin de trabajo','automatic',NULL,NULL,'2023-03-30 18:07:33'),(5,'Deteccin de trfico malicioso','automatic',NULL,NULL,'2023-03-30 18:07:33'),(6,'PUA detectada','automatic',NULL,NULL,'2023-03-30 18:07:33'),(7,'PUA limpiada','automatic',NULL,NULL,'2023-03-30 18:07:33'),(8,'Proteccin en tiempo real desactivado','automatic',NULL,NULL,'2023-03-30 18:07:33'),(9,'Deteccin de datos personales','automatic',NULL,NULL,'2023-03-30 18:07:33'),(10,'Correos a buzones personales con informacin restringida','automatic',NULL,NULL,'2023-03-30 18:07:33'),(11,'Compartir informacin restringida en onedrive con usuarios externos','automatic',NULL,NULL,'2023-03-30 18:07:33'),(12,'Deteccin de archivos malilciosos - malware','automatic',NULL,NULL,'2023-03-30 18:07:33'),(13,'Privilegios especiales asignados al nuevo inicio de sesin','automatic',NULL,NULL,'2023-03-30 18:07:33'),(14,'Creacin o desactivacin de usuarios fuera de horario laboral','automatic',NULL,NULL,'2023-03-30 18:07:33'),(15,'Vulnerabilidades detectadas','automatic',NULL,NULL,'2023-03-30 18:07:33'),(16,'Prdida/robo de porttiles','automatic',NULL,NULL,'2023-03-30 18:07:34'),(19,'Malware encontrado','automatic',1861,5,'2023-04-05 10:50:56'),(20,'Display bloqueado','automatic',1738,3,'2023-04-06 12:43:32'),(24,'TEST','automatic',121,1212,'2023-04-17 10:48:05'),(27,'Pedro','automatic',56456,46,'2023-05-13 18:40:43');
/*!40000 ALTER TABLE `events` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `kri_event`
--

DROP TABLE IF EXISTS `kri_event`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `kri_event` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `kri_id` int(11) DEFAULT NULL,
  `event_id` int(11) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=12 DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `kri_event`
--

LOCK TABLES `kri_event` WRITE;
/*!40000 ALTER TABLE `kri_event` DISABLE KEYS */;
INSERT INTO `kri_event` VALUES (10,6,9,'2023-05-14 13:11:41'),(11,6,12,'2023-05-14 13:11:41');
/*!40000 ALTER TABLE `kri_event` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `kris`
--

DROP TABLE IF EXISTS `kris`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `kris` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `kri` varchar(255) DEFAULT NULL,
  `objective` varchar(255) DEFAULT NULL,
  `propertie_id` int(11) DEFAULT NULL,
  `percentage` int(3) DEFAULT NULL,
  `syntax` varchar(255) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=7 DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `kris`
--

LOCK TABLES `kris` WRITE;
/*!40000 ALTER TABLE `kris` DISABLE KEYS */;
INSERT INTO `kris` VALUES (6,'Deteccion de archivos','Detectar archivos maliciosos y compararlos con los archivos privados de los usuarios de sophos',1,20,'9-12','2023-05-14 13:11:41');
/*!40000 ALTER TABLE `kris` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `master_qualifier`
--

DROP TABLE IF EXISTS `master_qualifier`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `master_qualifier` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `high` int(11) DEFAULT NULL,
  `medium` int(11) DEFAULT NULL,
  `low` int(11) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `master_qualifier`
--

LOCK TABLES `master_qualifier` WRITE;
/*!40000 ALTER TABLE `master_qualifier` DISABLE KEYS */;
/*!40000 ALTER TABLE `master_qualifier` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `properties`
--

DROP TABLE IF EXISTS `properties`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `properties` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `propertie` varchar(255) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `properties`
--

LOCK TABLES `properties` WRITE;
/*!40000 ALTER TABLE `properties` DISABLE KEYS */;
INSERT INTO `properties` VALUES (1,'confidencialidad','2023-03-28 21:29:32'),(2,'disponibilidad','2023-03-28 21:29:32'),(3,'integridad','2023-03-28 21:29:32');
/*!40000 ALTER TABLE `properties` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `qualifiers`
--

DROP TABLE IF EXISTS `qualifiers`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `qualifiers` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `type` varchar(255) DEFAULT NULL,
  `value` int(11) DEFAULT NULL,
  `kri_id` int(11) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=15 DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `qualifiers`
--

LOCK TABLES `qualifiers` WRITE;
/*!40000 ALTER TABLE `qualifiers` DISABLE KEYS */;
INSERT INTO `qualifiers` VALUES (11,'Bajo',1,6,'2023-05-14 13:11:41'),(12,'Medio',3,6,'2023-05-14 13:11:41'),(13,'Alto',5,6,'2023-05-14 13:11:41'),(14,'Extremo',7,6,'2023-05-14 13:11:41');
/*!40000 ALTER TABLE `qualifiers` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `records`
--

DROP TABLE IF EXISTS `records`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `records` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `source_id` int(11) DEFAULT NULL,
  `event_id` int(11) DEFAULT NULL,
  `reported_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=22 DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `records`
--

LOCK TABLES `records` WRITE;
/*!40000 ALTER TABLE `records` DISABLE KEYS */;
INSERT INTO `records` VALUES (1,1861,5,'2023-01-21 12:00:00','2023-05-14 14:38:08'),(2,1861,5,'2023-01-21 12:00:00','2023-05-14 14:42:31'),(3,1738,3,'2023-01-23 13:00:00','2023-05-14 14:42:31'),(4,1861,5,'2023-01-21 12:00:00','2023-05-14 14:42:34'),(5,1738,3,'2023-01-23 13:00:00','2023-05-14 14:42:34'),(6,1861,5,'2023-01-21 12:00:00','2023-05-14 14:42:35'),(7,1738,3,'2023-01-23 13:00:00','2023-05-14 14:42:35'),(8,1861,5,'2023-01-21 12:00:00','2023-05-14 14:42:36'),(9,1738,3,'2023-01-23 13:00:00','2023-05-14 14:42:36'),(10,1861,5,'2023-01-21 12:00:00','2023-05-14 14:42:44'),(11,121,1212,'2023-01-21 12:00:00','2023-05-14 14:43:24'),(12,121,1212,'2023-01-21 12:00:00','2023-05-14 14:43:25'),(13,121,1212,'2023-01-21 12:00:00','2023-05-14 14:43:26'),(14,121,1212,'2023-01-21 12:00:00','2023-05-14 14:43:26'),(15,121,1212,'2023-01-21 12:00:00','2023-05-14 14:43:27'),(16,56456,46,'2023-01-21 12:00:00','2023-05-14 14:43:46'),(17,56456,46,'2023-01-21 12:00:00','2023-05-14 14:43:47'),(18,56456,46,'2023-01-21 12:00:00','2023-05-14 14:43:47'),(19,56456,46,'2023-01-21 12:00:00','2023-05-14 14:43:48'),(20,56456,46,'2023-01-21 12:00:00','2023-05-14 14:43:48'),(21,56456,466,'2023-01-21 12:00:00','2023-05-14 14:45:50');
/*!40000 ALTER TABLE `records` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `risk_kri`
--

DROP TABLE IF EXISTS `risk_kri`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `risk_kri` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `risk_id` int(11) DEFAULT NULL,
  `kri_id` int(11) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `risk_kri`
--

LOCK TABLES `risk_kri` WRITE;
/*!40000 ALTER TABLE `risk_kri` DISABLE KEYS */;
INSERT INTO `risk_kri` VALUES (1,1,1,'2023-03-30 19:34:49'),(2,1,2,'2023-03-30 19:34:49');
/*!40000 ALTER TABLE `risk_kri` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `risks`
--

DROP TABLE IF EXISTS `risks`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `risks` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `type_id` int(11) DEFAULT NULL,
  `propertie_id` int(11) DEFAULT NULL,
  `risk` varchar(255) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=24 DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `risks`
--

LOCK TABLES `risks` WRITE;
/*!40000 ALTER TABLE `risks` DISABLE KEYS */;
INSERT INTO `risks` VALUES (1,3,3,'Prdida financiera causada por Acceso no autorizado','2023-03-30 18:06:22'),(2,3,2,'Sancin legal causada por Fuga de informacin malintencionada','2023-03-30 18:06:22'),(3,3,3,'Prdida financiera causada por Fuga de informacin por error involuntario','2023-03-30 18:06:22'),(4,2,1,'Prdida operativa causada por Ingeniera social/Spear Phising, Cryptojacking/Cryptomining, Cloud-Jacking, Ramsonware, Cyber espionaje, IoT, Hacktivism, Crimen organizado, Fearware, Coordinated attack, Cyber warfare','2023-03-30 18:06:22'),(5,4,1,'Prdida operativa causada por Ataque Fuerza bruta, Desbordamiento buffer, XSS, MiM, Spoof, Inyeccion SQL','2023-03-30 18:06:22'),(6,4,1,'Perdida de capacidad tecnolgica causada por Suplantacin de identidad','2023-03-30 18:06:22'),(7,5,1,'Perdida de capacidad tecnolgica causada por Abuso o elevacin de privilegios','2023-03-30 18:06:22'),(8,5,3,'Prdida financiera causada por Modificacin de la informacin por error involuntario','2023-03-30 18:06:22'),(9,1,3,'Sancin legal causada por Modificacin de la informacin malintencionada','2023-03-30 18:06:22'),(10,4,2,'Prdida financiera causada por Robo','2023-03-30 18:06:22'),(11,2,1,'Prdida operativa causada por Ataque informtico (Malware, APT, BackDoor, DoS)','2023-03-30 18:06:22'),(12,3,2,'Prdida operativa causada por Corte o fallas en el suministro elctrico','2023-03-30 18:06:22'),(13,4,1,'Prdida operativa causada por Dao por agua, humedad o lquidos','2023-03-30 18:06:22'),(14,3,2,'Perdida de capacidad tecnolgica causada por Denegacin de servicio malintencionado','2023-03-30 18:06:22'),(15,2,2,'Perdida de capacidad tecnolgica causada por Denegacin de servicio por error involuntario','2023-03-30 18:06:22'),(16,2,3,'Prdida operativa causada por Descarga elctrica','2023-03-30 18:06:22'),(17,3,2,'Prdida estratgica causada por Destruccin de la informacin por error involuntario','2023-03-30 18:06:22'),(18,2,2,'Prdida financiera causada por Destruccin o eliminacin de la informacin malintencionada','2023-03-30 18:06:22'),(19,4,2,'Prdida financiera causada por Fuego','2023-03-30 18:06:22'),(20,3,1,'Prdida operativa causada por Interferencia electromagntica','2023-03-30 18:06:22'),(21,3,3,'Prdida operativa causada por Paro','2023-03-30 18:06:23'),(22,2,1,'Prdida operativa causada por Pandemias (Covid-19, emergentes)','2023-03-30 18:06:23'),(23,4,1,'Prdida operativa causada por Terremoto','2023-03-30 18:06:24');
/*!40000 ALTER TABLE `risks` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `sources`
--

DROP TABLE IF EXISTS `sources`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `sources` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `source` varchar(255) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `sources`
--

LOCK TABLES `sources` WRITE;
/*!40000 ALTER TABLE `sources` DISABLE KEYS */;
/*!40000 ALTER TABLE `sources` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `types`
--

DROP TABLE IF EXISTS `types`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `types` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `type` varchar(255) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `types`
--

LOCK TABLES `types` WRITE;
/*!40000 ALTER TABLE `types` DISABLE KEYS */;
INSERT INTO `types` VALUES (1,'estrategico','2023-03-28 22:02:20'),(2,'financiero','2023-03-28 22:02:20'),(3,'legal','2023-03-28 22:02:20'),(4,'operacional','2023-03-30 17:27:18'),(5,'tecnologico','2023-03-30 17:27:18');
/*!40000 ALTER TABLE `types` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `users`
--

DROP TABLE IF EXISTS `users`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `users` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(255) DEFAULT NULL,
  `email` varchar(255) DEFAULT NULL,
  `password` varchar(255) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `users`
--

LOCK TABLES `users` WRITE;
/*!40000 ALTER TABLE `users` DISABLE KEYS */;
INSERT INTO `users` VALUES (1,'DragonyteEvol','acuarionevol@outlook.com','$2y$10$Ws65FRcPjyK6eSI0bDcPIurUe.QlzLG6zctOAuwIzXBcsWI./7GSq','2023-03-26 10:26:18');
/*!40000 ALTER TABLE `users` ENABLE KEYS */;
UNLOCK TABLES;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;

-- Dump completed on 2023-09-04 10:39:18
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/b8/6d6040e2ff33646684be75e19a09975f41468b
  Tamaño: 2486      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293594    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.126260224 -0500
Modificación: 2023-10-18 16:45:38.157256572 -0500
      Cambio: 2023-10-20 16:46:06.603332510 -0500
    Creación: 2023-10-20 16:46:06.603332510 -0500
<?php 
class Model{
	public $db;
	public $data;
	private $process_data;

	public function __construct($second_database = FALSE){
		$this->db=Connection::connect($second_database);
	}

	/* permite ejecutar consultas sql customizadas a cada modelo */
	/* 	retorna la informacion consultada o registrada */
	public function getCustom($sql,$param=0){
		$this->execute($sql,$this->table,$param);
	}

	/* toma todos los usuarios de la base de datos */
	/* 	retorna un lista con usuarios */
	/* puede recibir un array de nobres de tablas para generar una relacion de uno a muchos */
	public function getAll(){
		/* relacion de tablas */
		$sql = "SELECT *,$this->table.id as id_master FROM $this->table ";
		if(count($this->one_to_one)<>0){
			foreach($this->one_to_one as $join){
				$column = substr($join,0,-1) . "_id";
				$sql = $sql . "INNER JOIN $join ON $this->table.$column=$join.id ";
			}
		}
		/* ejecucion de query */
		$this->execute($sql,$this->table);
		return $this->data;
	}

	/* toma un usuario por id de la base de datos */
	/* 	retorna una lista con el usuario */
	public function selectById($id){
		$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
		//RELACION 1 A 1
		if(count($this->one_to_one)<>0){
			foreach($this->one_to_one as $join){
				$column = substr($join,0,-1) . "_id";
				$sql = $sql . "INNER JOIN $join ON $this->table.$column=$join.id ";
			}
		}
		$sql = $sql . "WHERE $this->table.id=:id";
		$this->execute($sql,$this->table,$id);
		//RELACION 1 A MUCHOS
		if(count($this->one_to_much)<>0){
			$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
			foreach(array_keys($this->one_to_much) as $join){
				$relation= $this->one_to_much[$join];//QUALIFIERS;
				$column_2 = substr($join,0,-1) . "_id"; //KRI_ID;
				$sql = $sql . "INNER JOIN $relation ON $join.id=$relation.$column_2 ";
				$sql = $sql . "WHERE $this->table.id=:id";
				$this->data["sql"]=$sql;
				$this->execute($sql,$relation,$id);
				$sql = str_replace("WHERE $this->table.id=:id","",$sql);
			}
		}
		//RELACION MUCHOS A MUCHOS
		if(count($this->much_to_much)<>0){
			$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
			foreach(array_keys($this->much_to_much) as $join){
				$relation= substr($this->much_to_much[$join],0,-1);
				$table_relation = substr($join,0,-1) . "_" . $relation;
				$column_1 = $relation . "_id";
				$column_2 = substr($join,0,-1) . "_id";
				$join_table = $this->much_to_much[$join];
				$sql = $sql . " INNER JOIN $table_relation ON $join.id=$table_relation.$column_2 ";
				$sql = $sql . " INNER JOIN $join_table ON $table_relation.$column_1=$join_table.id ";
				$sql = $sql . "WHERE $this->table.id=:id";
				$this->execute($sql,$join_table,$id);
				$sql = str_replace("WHERE $this->table.id=:id","",$sql);
			}
		}
		return $this->data;
	}

	/* inserta un registro a la base de datos con sus respectivas relaciones */
	/* 	retorna el id del elemento registrado */
	public function insert(){
		try{
			if(!$this->db->inTransaction()){
				$this->db->beginTransaction();
			}
			$columns = implode(",",$this->columns);
			$args = implode(",",$this->args);
			$sql = "INSERT INTO $this->table($columns) values($args)";
			$state = $this->db->prepare($sql);
			$this->setParams($state);
			$state->execute();
			$id = $this->db->lastInsertId();
			if(count($this->much_to_much)>0){
				foreach(array_keys($this->much_to_much) as $join){
					$relation= substr($this->much_to_much[$join],0,-1);//event
					$table_relation = substr($join,0,-1) . "_" . $relation;//kri_event
					$column_2 = substr($join,0,-1) . "_id";//kri_id
					$column_1 = $relation . "_id";//event_id
					$sql = "INSERT INTO $table_relation($column_1,$column_2) VALUES(:$column_1,:$column_2)";
					for($i=0;$i< count($_POST[$relation]);$i++){
						$state = $this->db->prepare($sql);
						$state->bindParam(":$column_1",$_POST[$relation][$i]);
						$state->bindParam(":$column_2",$id);
						$state->execute();
					}
				}

			}
			return $id;
		}catch(PDOException $e){
			echo $e->getMessage();
			$this->db->rollBack();
		}
	}

	/* modifica un elemento en la base de datos */
	/* recibe el id del elemento a modificar */
	/* 	retorna el ultimo in elemento de la tabla */
	public function update($id){
		try{
			if(!$this->db->inTransaction()){
				$this->db->beginTransaction();
			}
			$prepare_sql = "";
			for($i=0;$i < count($this->args);$i++){
				if((count($this->args)-1)==$i){
					$prepare_sql = $prepare_sql . $this->columns[$i] . "=" . $this->args[$i];
				}else{
					$prepare_sql = $prepare_sql . $this->columns[$i] . "=" . $this->args[$i] . ",";
				}
			}
			$sql = "UPDATE $this->table set $prepare_sql WHERE id=:id";
			$state = $this->db->prepare($sql);
			$state = $this->setParams($state);
			$state->bindParam(":id",$id);
			$state->execute();
			$this->refreshDataRelations($id,$this->much_to_much);
		}catch(PDOException $e){
			var_dump($e);
			$this->db->rollBack();
		}
	}

	/* borra un elemento de la base de datos */
	/* 	no retorna informacion */
	public function delete($id){
		try{
			if(!$this->db->inTransaction()){
				$this->db->beginTransaction();
			}
			$sql = "DELETE FROM $this->table WHERE id=:id";
			$state = $this->db->prepare($sql);
			$state->bindParam(":id",$id);
			$state->execute();
		}catch(PDOException $e){
			$this->db->rollBack();
		}
	}

	/* busca elementos en la base de datos */
	/* 	retorna un array con los elementos encontrados */
	public function search($search){
		$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
		if(count($this->one_to_one)<>0){
			foreach($this->one_to_one as $join){
				$column = substr($join,0,-1) . "_id";
				$sql = $sql . "INNER JOIN $join ON $this->table.$column=$join.id ";
			}
		}
		$column = substr($this->table,0,-1);
		$sql=$sql . " WHERE $column LIKE '%$search%'";
		$this->execute($sql,$this->table);
		return $this->data;
	}

	/* escribe los cambios en la base de datos si el dml esta en una transaccion */
	/* 	no retorna informacion pero termina la transaccion actual */
	public function saveChanges(){
		$this->db->commit();
	}

	/* establece las variables de las consultas preparadas */
	/* 	no retorna informacion pero deja la consulta preparada lista para su ejecucion */
	public function setParams($state){
		for($i=0;$i < count($this->args);$i++){
			if($this->args[$i]==":password"){
				$password = password_hash($this->password,PASSWORD_BCRYPT);
				$state->bindParam($this->args[$i],$password);
			}else{
				$state->bindParam($this->args[$i],$this->{$this->columns[$i]});
			}
		}
		return $state;
	}

	/* ejecuta la consulta preparada */
	/* modifica la variable data adjuntando la informacion en esta variable con llave especifica*/
	public function execute($sql,$key,$id=0){
		$state = $this->db->prepare($sql);
		if($id<>0){
			$state->bindParam(":id",$id);
		}
		if($state->execute()){
			while($row=$state->fetch(PDO::FETCH_ASSOC)){
				$this->process_data[]=$row;
			}
			$this->data[$key]=$this->process_data;
			$this->process_data=[];
		}
	}

	//BORRA Y RECREA LAS RELACIONES MUCHOS A MUCHOS DE UNA TABLA RELACION
	//recibe un id de referencia generalemente el id de el elemento de la tabla principal, y las un diccionario de tabla relacion
	//no retorna informacion
	public function refreshDataRelations($id_reference,$relations){
		if(count($relations)<>0){
			foreach(array_keys($relations) as $join){
				$relation= substr($relations[$join],0,-1);//event
				$table_relation = substr($join,0,-1) . "_" . $relation;//kri_event
				$column_2 = substr($join,0,-1) . "_id";//kri_id
				$column_1 = $relation . "_id";//event_id
				//BORRA LAS DEPENDECIAS O RELACIONES ANTERIORES
				$sql = "DELETE FROM $table_relation WHERE $column_2=:id";
				$state = $this->db->prepare($sql);
				$state->bindParam(":id",$id_reference);
				$state->execute();
				//RECREA LAS DEPENEDENCIAS O RELACIONES
				$sql = "INSERT INTO $table_relation($column_1,$column_2) VALUES(:$column_1,:$column_2)";
				for($i=0;$i< count($_POST[$relation]);$i++){
					$state = $this->db->prepare($sql);
					$state->bindParam(":$column_1",$_POST[$relation][$i]);
					$state->bindParam(":$column_2",$id_reference);
					$state->execute();
				}
			}
		}
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/b8/7f3bc3e2670a781ac9265c829fccc2617c9ac8
  Tamaño: 1780      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293595    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.126260224 -0500
Modificación: 2023-10-07 13:37:49.799589789 -0500
      Cambio: 2023-10-20 16:46:06.603332510 -0500
    Creación: 2023-10-20 16:46:06.603332510 -0500
<?php  
include_once("components/header.php");
?>
<!-- FORMULARIO DE CREACION DE KRIS -->
<div class="container">
	<form action="/kri/insert" method="POST" class="needs-validation">
		<div class="card">
			<div class="card-header">
				<h2 class="my-3">Creacion de KRI</h2>
			</div>
			<div class="card-body">
				<!-- KRI -->
				<div class="form-floating mb-3">
					<input type="text"Crear KRI required class="form-control" name="kri" id="floatingInput" placeholder="Insegra un nombre">
					<label for="floatingInput">Nombre del KRI</label>
				</div>
				<!-- OBJECTIVO -->
				<div class="form-floating">
					<textarea class="form-control mb-3" name="objective" placeholder="Leave a comment here" id="floatingTextarea2" style="height: 100px"></textarea>
					<label for="floatingTextarea2">Objetivo</label>
				</div>
				<div class="row">
					<div class="col-6">
						<!-- PROPIEDAD -->
						<div class="form-floating mb-3">
							<select name="propertie_id" class="form-select" id="datalistOptions" aria-label="">
							</select>
							<label for="floatingSelect">Propiedad</label>
						</div>
					</div>
					<div class="col-6">
						<!-- PORCENTAJE -->
						<div class="form-floating mb-3">
							<input name="percentage" type="number" class="form-control">
							<label for="floatingInput">Porcentaje</label>
						</div>
					</div>
				</div>
				<!-- EVENTOS -->
				<button name="events" type="button" class="form-control btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
					Añadir evento
				</button>
				<select name="event[]" id="events" class="form-select mb-3" multiple>
				</select>
				<!-- SYNTAX-->
				<div class="form-floating mb-3">
					<input name="syntax" type="text" class="form-control disabled">
					<label for="floatingInput">Sintaxis / Operacion de kri</label>
				</div>
				<!-- QUALIFIERS -->
				<div class="card">
					<div class="card-header">
						<h5 class="mt-2">Calificadores</h5>
					</div>
					<div class="card-body" id="qualifiers">
						<div class="input-group mb-3">
							<div class="form-floating">
								<input type="text" class="form-control" name="qualifiers[]" id="floatingInputGroup1">
								<label for="floatingInputGroup1">Nombre Calificador</label>
							</div>
							<div class="form-floating">
								<input type="text" class="form-control" name="qualifiers_values[]" id="floatingInputGroup1">
								<label for="floatingInputGroup1">Valor</label>
							</div>
						</div>
					</div>
					<div class="card-footer">
						<button type="button" onclick="addQualifier()" class="form-control btn btn-primary">
							Agregar
						</button>
					</div>
				</div>
			</div>
			<div class="card-footer">
				<!-- END FIELD -->
				<button type="submit" class="btn btn-primary">Enviar</button>
			</div>
		</div>
	</form>
</div>
<!-- FORMULARIO DE ADICION DE EVENTOS -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h1 class="modal-title fs-5" id="exampleModalLabel">Buscar Evento</h1>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<div class="form-floating mb-3">
					<input type="text" required class="form-control" id="searchEvent" placeholder="Insegra un nombre">
					<label for="floatingInput">Buscar evento</label>
				</div>
				<div class="justify-content-center" id="datalistOptionsEvent">

				</div>
			</div>
		</div>
	</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
<script src="/assets/js/search.js"></script>
<script>
	function addQualifier(){
		qualifiers_list = document.getElementById("qualifiers")
		html = ' <div class="input-group mb-3"> <div class="form-floating"> <input type="text" class="form-control" name="qualifiers[]" id="floatingInputGroup1"> <label for="floatingInputGroup1">Nombre Calificador</label> </div> <div class="form-floating"> <input type="text" class="form-control" name="qualifiers_values[]" id="floatingInputGroup1"> <label for="floatingInputGroup1">Valor</label> </div> </div> '
		qualifiers_list.insertAdjacentHTML("beforeend",html)
	}
	function customFunction(e){
		console.log(e)
		events = document.getElementById("events")
		html = events.innerHTML
		html += "<option selected value=" + e.id + ">["+e.id+"]."+e.event+"</option>"
		events.innerHTML = html
		modal = document.getElementById("exampleModal")
		modal.hide()
	}
	//PROPIEDADES
	searchEvent({
		listOptions: "datalistOptions",
		search: "propertie",
		components: new Map([
			["value","id"]
		]),
		value: "propertie",
		table: "properties",
		tag: "option"
	})
	//EVENTOS
	searchEvent({
		componentEvent: "searchEvent",
		listOptions: "datalistOptionsEvent",
		search: "event",
		components: new Map([
			["id","master_id"],
			["event","event"]
		]),
		value: "event",
		table: "events",
		tag: "button",
		customFunction: "customFunction",
		class: "btn btn-outline-primary form-control m-2' data-bs-dismiss='modal",
	})
</script>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/b9/60b19842af71267007b64da8867db867e259e5
  Tamaño: 1294      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293528    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.096260638 -0500
Modificación: 2023-05-18 14:54:53.525295957 -0500
      Cambio: 2023-10-20 16:46:06.573333301 -0500
    Creación: 2023-10-20 16:46:06.573333301 -0500
<?php  var_dump($data)?>
<?php  
include_once("components/header.php");
?>
<!-- FORMULARIO DE CREACION DE KRIS -->
<div class="container">
	<form action="/kri/insert" method="POST" class="needs-validation">
		<div class="card">
			<?php  foreach($data["kris"] as $kri): ?>
			<div class="card-body">
				<!-- KRI -->
				<div class="form-floating mb-3">
					<input type="text" value="<?= $kri['kri'] ?>" required class="form-control" name="kri" id="floatingInput" placeholder="Insegra un nombre">
					<label for="floatingInput">Nombre del KRI</label>
				</div>
				<!-- OBJECTIVO -->
				<div class="form-floating">
					<textarea class="form-control mb-3" value="pedro" name="objective" id="floatingTextarea2"></textarea>
					<label for="floatingTextarea2">Objetivo</label>
				</div>
				<div class="row">
					<div class="col-6">
						<!-- PROPIEDAD -->
						<div class="form-floating mb-3">
							<select name="propertie_id" class="form-select" id="datalistOptions" aria-label="">
							</select>
							<label for="floatingSelect">Propiedad</label>
						</div>
					</div>
					<div class="col-6">
						<!-- PORCENTAJE -->
						<div class="form-floating mb-3">
							<input name="percentage" type="number" value="<?= $kri['percentage'] ?>" class="form-control">
							<label for="floatingInput">Porcentaje</label>
						</div>
					</div>
				</div>
				<!-- EVENTOS -->
				<button name="events" type="button" class="form-control btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
					Añadir evento
				</button>
				<select name="event[]" id="events" class="form-select mb-3" multiple>
				</select>
				<!-- SYNTAX-->
				<div class="form-floating mb-3">
					<input name="syntax" type="text" value="<?= $kri['syntax'] ?>" class="form-control disabled">
					<label for="floatingInput">Sintaxis / Operacion de kri</label>
				</div>
				<!-- QUALIFIERS -->
				<div class="card">
					<div class="card-header">
						<h5 class="mt-2">Calificadores</h5>
					</div>
					<div class="card-body" id="qualifiers">
						<div class="input-group mb-3">
							<div class="form-floating">
								<input type="text" class="form-control" name="qualifiers[]" id="floatingInputGroup1">
								<label for="floatingInputGroup1">Nombre Calificador</label>
							</div>
							<div class="form-floating">
								<input type="text" class="form-control" name="qualifiers_values[]" id="floatingInputGroup1">
								<label for="floatingInputGroup1">Valor</label>
							</div>
						</div>
					</div>
					<div class="card-footer">
						<button type="button" onclick="addQualifier()" class="form-control btn btn-primary">
							Agregar
						</button>
					</div>
				</div>
			</div>
			<?php  endforeach; ?>
			<div class="card-footer">
				<!-- END FIELD -->
				<button type="submit" class="btn btn-primary">Enviar</button>
			</div>
		</div>
	</form>
</div>
<!-- FORMULARIO DE ADICION DE EVENTOS -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h1 class="modal-title fs-5" id="exampleModalLabel">Buscar Evento</h1>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<div class="form-floating mb-3">
					<input type="text" required class="form-control" id="searchEvent" placeholder="Insegra un nombre">
					<label for="floatingInput">Buscar evento</label>
				</div>
				<div class="justify-content-center" id="datalistOptionsEvent">

				</div>
			</div>
		</div>
	</div>
</div>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/bb/1d6970a29b7f77631c4fdd3df8f977777ea8af
  Tamaño: 156       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293747    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.199592546 -0500
Modificación: 2023-03-09 13:43:50.275762584 -0500
      Cambio: 2023-10-20 16:46:06.673330665 -0500
    Creación: 2023-10-20 16:46:06.673330665 -0500
<?php
class UserController{
	public function index(){

		require_once("models/UserModel.php");
		$user = new UserModel();
		$data=$user->getUsers();
		var_dump($data);
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/bb/7e7b902dbec4dd958723b80470a4bdb2215940
  Tamaño: 359       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293746    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.199592546 -0500
Modificación: 2023-10-07 13:37:54.429465328 -0500
      Cambio: 2023-10-20 16:46:06.669997419 -0500
    Creación: 2023-10-20 16:46:06.669997419 -0500
100644 blob 049ba487ee94127dfec1da4843fdb9d482387562	EventModel.php
100644 blob 9fa84c6af2c461ad4bdcf7fb3776f5d3b20bd00f	KriModel.php
100644 blob 41f0b8abe193d55fd96162fac82d261582034c0a	Model.php
100644 blob cf27b3beec50366ce112f05e7a070bf6cf045070	PropertieModel.php
100644 blob 2b7e2e2a08d9bfe6fc287d1eadf68a3ae2bef753	QualifierModel.php
100644 blob 3f36dc91c903e4be4239b127f4d48a9f11011911	RecordModel.php
100644 blob 730a24116f0181eadde3a5c5ca6e2d03d57ba8f7	RiskModel.php
100644 blob 05d7d4d8f9670e0e5b2c24fe3469c804e2f0f4b4	SourceModel.php
100644 blob 94c0b90d03c95b7e9484842795b32a9d4a3eacb3	TemplateModel.php
100644 blob 95085117329d973fd6c36029b44293bcedd69742	TypeModel.php
100644 blob 98bcd9d15ece27bab02c81584e6e0b10ed3cfd21	UserModel.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/bc/f616d3942cc000681f5c65d3cabf8bb6701ce3
  Tamaño: 55        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293635    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.146259948 -0500
Modificación: 2023-05-14 07:37:26.345367517 -0500
      Cambio: 2023-10-20 16:46:06.623331983 -0500
    Creación: 2023-10-20 16:46:06.623331983 -0500
100644 blob 8da63fbf74cf835ff158729337f1e8159f2a805e	styles.css
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/bd/52b7171daf26ac23cf0eb9f0916f01071354c3
  Tamaño: 436       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293944    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.346257192 -0500
Modificación: 2023-10-07 12:37:25.940479939 -0500
      Cambio: 2023-10-20 16:46:06.783327766 -0500
    Creación: 2023-10-20 16:46:06.783327766 -0500
100644 blob 46141854b6c4aac2047018836b3340f5f62dd0c2	.htaccess
100644 blob da437ed708de7ea2d1ed5bb37dc51d00740740f6	Dockerfile
040000 tree 6819d61481e38d0edb2ff89b3235ec0aae360f80	assets
040000 tree 0994b646c5cf6fe1259596f6e540c6055d0d4e1c	components
100644 blob 886fe19262e1dcc9bc5827b9b360744e6fe4cf58	config.php
040000 tree 83002027fc0d31216b0a79e85e19fd40efaa5e6d	controllers
100644 blob 8dadb53d86e692a9145d4db33bc19d31c3303116	data.sql
100644 blob 82c1b06cf8655c3159204f46dafb691aa3fe03c0	database.php
100644 blob 27dae4899dda3ef6df80d4bdc4ec9c52248ccb59	index.php
040000 tree c05d74568c8bff3f962389e235fc6e0b708b6d09	models
100644 blob d9a4ec66dfeb45d52c58647f352aaaae6b84cd28	router.php
100644 blob b82cea160f9cfcea3268f5371dbfc4fff71c4b97	seeder.sql
040000 tree e7771c87d4527ac5eff48b7797847c843d24a4a0	views
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/be/4d0deedfe7815f0b89e97f2a3d557991469cfb
  Tamaño: 225       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293520    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.092927350 -0500
Modificación: 2023-10-17 16:04:10.679701957 -0500
      Cambio: 2023-10-20 16:46:06.570000055 -0500
    Creación: 2023-10-20 16:46:06.570000055 -0500
tree 2deb9ccdbfeae04c5aae7d04596d0107d8c32932
parent 30f2000552c83bf93a8b18c8d39bf7ad3e04c634
author DragonyteEvol <acuarionevol@outlook.com> 1697576593 -0500
committer DragonyteEvol <acuarionevol@outlook.com> 1697576593 -0500

fix: Update event
- The form of view only updated the row 27
- Added event_id to uri for dinamic update
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/bf/26cbec7b3a99878eea5fe64236fa8c6693da97
  Tamaño: 54        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293808    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.226258846 -0500
Modificación: 2023-04-06 11:42:36.056050983 -0500
      Cambio: 2023-10-20 16:46:06.699996629 -0500
    Creación: 2023-10-20 16:46:06.699996629 -0500
100644 blob a96238e7ad3f434f44f64b7b694876c08568b9e8	index.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/bf/5097b23f98e15ac7c6c3302674281da19c5d4c
  Tamaño: 178       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293810    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.226258846 -0500
Modificación: 2023-03-16 15:57:55.305061616 -0500
      Cambio: 2023-10-20 16:46:06.699996629 -0500
    Creación: 2023-10-20 16:46:06.699996629 -0500
tree 29efbdddff199cb88547a0f4aaf77c5212ae2414
parent 9ba768c45d69a7218257028a9de73ccb8c28d2f7
author DragonyteEvol <acuarionevol@outlook.com> 1679000275 +0000
committer DragonyteEvol <acuarionevol@outlook.com> 1679000275 +0000

controller and model structure
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/bf/6e20922a18266f9ee123a24b5bd385187d5759
  Tamaño: 115       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293809    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.226258846 -0500
Modificación: 2023-05-19 15:57:49.892809675 -0500
      Cambio: 2023-10-20 16:46:06.699996629 -0500
    Creación: 2023-10-20 16:46:06.699996629 -0500
100644 blob 97b1828d19670ca13dd69f3270dd0eac7ec6fe5b	create.php
100644 blob 95db84274bcdf088a7f0c9914dcd9b4f8926be36	index.php
100644 blob af1b8f6d28b35162f5418a733301b8b66d43081d	show.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/c0/46e77dec8f8548b2d3988bd00fcccc880fe757
  Tamaño: 180       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293524    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.092927350 -0500
Modificación: 2023-05-19 15:57:49.919476343 -0500
      Cambio: 2023-10-20 16:46:06.573333301 -0500
    Creación: 2023-10-20 16:46:06.573333301 -0500
tree 86e430f7640a9b71b2c32da5c1612f2bf04d0700
parent c6d402739c5a887ebf3cfed72c2d11d734fd1ad5
author DragonyteEvol <acuarionevol@outlook.com> 1684529869 +0000
committer DragonyteEvol <acuarionevol@outlook.com> 1684529869 +0000

structure: view of kri show
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/c0/5d74568c8bff3f962389e235fc6e0b708b6d09
  Tamaño: 358       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293526    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.092927350 -0500
Modificación: 2023-10-07 12:37:25.803817008 -0500
      Cambio: 2023-10-20 16:46:06.573333301 -0500
    Creación: 2023-10-20 16:46:06.573333301 -0500
100644 blob d5d9eb8738a6f7498112842987cc8ab456c42399	EventModel.php
100644 blob 75ecfefcec79175ffb210f3fcbbe5c8b2e773879	KriModel.php
100644 blob 703c36d27c25912aa212a39ec145f446855afdbb	Model.php
100644 blob cf27b3beec50366ce112f05e7a070bf6cf045070	PropertieModel.php
100644 blob 2b7e2e2a08d9bfe6fc287d1eadf68a3ae2bef753	QualifierModel.php
100644 blob 3f36dc91c903e4be4239b127f4d48a9f11011911	RecordModel.php
100644 blob 730a24116f0181eadde3a5c5ca6e2d03d57ba8f7	RiskModel.php
100644 blob 05d7d4d8f9670e0e5b2c24fe3469c804e2f0f4b4	SourceModel.php
100644 blob 94c0b90d03c95b7e9484842795b32a9d4a3eacb3	TemplateModel.php
100644 blob 95085117329d973fd6c36029b44293bcedd69742	TypeModel.php
100644 blob 98bcd9d15ece27bab02c81584e6e0b10ed3cfd21	UserModel.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/c0/fae699e8c80695907e038ab3b366c594d0172a
  Tamaño: 333       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293525    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.092927350 -0500
Modificación: 2023-05-14 10:25:27.585102171 -0500
      Cambio: 2023-10-20 16:46:06.573333301 -0500
    Creación: 2023-10-20 16:46:06.573333301 -0500
100644 blob 916405f23887474176f88d1c45f7fa7fdbcdd9e2	Controller.php
100644 blob 888248a73fe883e3982223d1a84670bdf1a19641	EventController.php
100644 blob 26b0fa7d9a575d91a0321146d0533890494024af	KriController.php
100644 blob ab88d0b50b2f02ca6a63488e849280128184eafb	LoginController.php
100644 blob 56b41c3c0b81d3e213654e2b64a9e8e43e0c8b30	PropertieController.php
100644 blob 12620ce4178e3b649067d4a02a366ef83bb8d47e	RegisterController.php
100644 blob 5fa1c0a8e82b84d03e204b24bdde9483e720aba0	RiskController.php
100644 blob 8c1bb57955e07f847b2b8e617e4db6218f8ced28	SourceController.php
100644 blob 07a9d2abeb523436c2863c3129e2c4f1fd26c654	TemplateController.php
100644 blob fb02603f5e1e778c1b626de544c3f0834532d3e1	UserController.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/c1/7619f39e32fd2794c6f06fe11b9e65958b669b
  Tamaño: 54        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293914    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.322924180 -0500
Modificación: 2023-05-14 07:37:26.345367517 -0500
      Cambio: 2023-10-20 16:46:06.766661539 -0500
    Creación: 2023-10-20 16:46:06.766661539 -0500
100644 blob 47ffcc953f9139a5dc77e07e0409298e6bfbdc1d	search.js
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/c1/a43b69371eea8ab5885b0c3a756f816af941ea
  Tamaño: 115       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293913    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.322924180 -0500
Modificación: 2023-10-17 16:03:13.351188567 -0500
      Cambio: 2023-10-20 16:46:06.766661539 -0500
    Creación: 2023-10-20 16:46:06.766661539 -0500
100644 blob e69de29bb2d1d6434b8b29ae775ad8c2e48c5391	create.php
100644 blob 1d46055131350fa0ce58e3fe2f796772ad5d5acc	index.php
100644 blob 3b74a7b2ff84c733dc5074553dda75cb66b3a132	show.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/c2/03a5a40ec2cdbacea1d398f28dc83096d11f9a
  Tamaño: 436       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293513    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.089594063 -0500
Modificación: 2023-10-17 15:55:35.073072444 -0500
      Cambio: 2023-10-20 16:46:06.570000055 -0500
    Creación: 2023-10-20 16:46:06.566666810 -0500
100644 blob 46141854b6c4aac2047018836b3340f5f62dd0c2	.htaccess
100644 blob da437ed708de7ea2d1ed5bb37dc51d00740740f6	Dockerfile
040000 tree dd6218d45158d9a2b0981c704e5c5c0d3130c418	assets
040000 tree ee84c1fda671963354e74a972bfc478930dd45c8	components
100644 blob 886fe19262e1dcc9bc5827b9b360744e6fe4cf58	config.php
040000 tree d10ce92c241bfadf68d3af2d0dda28bbb5aeac2a	controllers
100644 blob 8dadb53d86e692a9145d4db33bc19d31c3303116	data.sql
100644 blob 82c1b06cf8655c3159204f46dafb691aa3fe03c0	database.php
100644 blob 27dae4899dda3ef6df80d4bdc4ec9c52248ccb59	index.php
040000 tree 4e5307607b853a090094f466239af64662013f01	models
100644 blob d9a4ec66dfeb45d52c58647f352aaaae6b84cd28	router.php
100644 blob 46dfb9c57e8457a46bcf674b8b4097ac91049470	seeder.sql
040000 tree 305c1a20a126abf03b08778ca6b3560ca0640a42	views
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/c2/39fc53c58bda758970f22d883078bb441f7f9e
  Tamaño: 54        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293515    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.089594063 -0500
Modificación: 2023-03-28 17:22:24.331311181 -0500
      Cambio: 2023-10-20 16:46:06.570000055 -0500
    Creación: 2023-10-20 16:46:06.570000055 -0500
100644 blob 7a0130545fcf43ae1a38b7fd5aff33962568c03b	index.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/c2/7ef1419872057a0e6427d628d815166b454b22
  Tamaño: 571       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293514    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.089594063 -0500
Modificación: 2023-05-14 08:13:40.278643597 -0500
      Cambio: 2023-10-20 16:46:06.570000055 -0500
    Creación: 2023-10-20 16:46:06.570000055 -0500
<?php  
include_once("components/header.php");
?>
<div class="card">
	<div class="card-header">
		<div class="row">
			<div class="col-6">
				<div class="row">
					<div class="input-group mb-3">
						<a href="/kri/create" class="btn btn-primary" type="button" id="button-addon1">+</a>
						<input type="text" class="form-control" placeholder="Buscar Kri" aria-label="Example text with button addon" aria-describedby="button-addon1">
					</div>
				</div>
			</div>
			<div class="col-6">
				<div class="row">
					<div class="col-6">
						<input class="form-control" name="from" type="datetime-local">
					</div>
					<div class="col-6">
						<input class="form-control d-flex" name="to" type="datetime-local">
					</div>
				</div>
			</div>
		</div>
	</div>
	<table class="table table-borderless">
		<thead>
			<tr>
				<th scope="col">#</th>
				<th scope="col">KRI</th>
				<th scope="col">Objetivo</th>
				<th scope="col">Propiedad</th>
				<th scope="col">Porcentage</th>
			</tr>
		</thead>
		<tbody>
			<?php  foreach($data["kris"] as $kri): ?>
			<tr>
				<th scope="row"><?= $kri["id_master"] ?></th>
				<td>
					<a href="/kri/show/<?= $kri['id_master'] ?>">
						<?= $kri["kri"] ?>
					</a>
				</td>
				<td><?= $kri["objective"] ?></td>
				<td><?= $kri["propertie"] ?></td>
				<td><?= $kri["percentage"] ?>%</td>
			</tr>
			<?php  endforeach; ?>
		</tbody>
	</table>
</div>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/c2/e419c28d43ba1407fde4e413cdaab74e81544c
  Tamaño: 344       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293512    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.089594063 -0500
Modificación: 2023-10-07 12:37:09.294268403 -0500
      Cambio: 2023-10-20 16:46:06.566666810 -0500
    Creación: 2023-10-20 16:46:06.566666810 -0500
<?php
require_once("models/EventModel.php");
class EventController extends Controller{

	public $autosave = true;

	public function __construct(){
		parent::__construct();
		$this->model = new EventModel();
	}

	public function sophos(){
		$array_number = array();
		$syntax = '(22+3)+(4*825)';
		$number = "";
		for($i=0;$i<strlen($syntax);$i++){
			if(is_numeric($syntax[$i])){
				$number = $number . $syntax[$i];
			}else{
				if($number!=""){
					array_push($array_number,$number);
					$number = "";
				}	
			}
		}
		eval("\$var = $syntax;");
		echo($var);
	}

}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/c3/0106bebe8e4c8d15269163413d17eb08e94520
  Tamaño: 258       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293969    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.386256641 -0500
Modificación: 2023-03-09 13:43:50.275762584 -0500
      Cambio: 2023-10-20 16:46:06.793327503 -0500
    Creación: 2023-10-20 16:46:06.793327503 -0500
<?php
/* variables de configuracion */
/* require_once("config.php"); */
class Connection{
	public static function connect(){
		include "config.php" ;
		try{
			$conn = new PDO("mysql:host=$server;dbname=$database",$username,$password);
			return $conn;
		}catch(PDOException $e){
			die("Connection Failed: " . $e->getMessage());
		}
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/c3/ab34a28c63d96d86a5343ed9d8251db98c5fcb
  Tamaño: 1054      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293968    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.369590204 -0500
Modificación: 2023-03-30 15:50:16.840976186 -0500
      Cambio: 2023-10-20 16:46:06.793327503 -0500
    Creación: 2023-10-20 16:46:06.793327503 -0500
<?php 
class Model{
	public $db;
	private $data;

	public function __construct($second_database = FALSE){
		$this->db=Connection::connect($second_database);
	}
	public function getCustom($sql){
		$state = $this->db->prepare($sql);
		if($state->execute()){
			while($row=$state->fetch(PDO::FETCH_ASSOC)){
				$this->data[]=$row;
			}
			return $this->data;
		}
	}

	/* toma todos los usuarios de la base de datos */
	/* 	retorna un lista con usuarios */
	/* puede recibir un array de nobres de tablas para generar una relacion de uno a muchos */
	public function getAll(){
		/* relacion de tablas */
		if(count($this->relations)<>0){
			foreach($this->relations as $join){
				$column = (substr($join,0,-1)) . "_id";
				$sql = $sql . "INNER JOIN $join ON $this->table.$column=$join.id ";
			}
		}
		/* ejecucion de query */
		$state = $this->db->prepare($sql);
		if($state->execute()){
			while($row=$state->fetch(PDO::FETCH_ASSOC)){
				$this->data[]=$row;
			}
			return $this->data;
		}
	}


	/* toma un usuario por id de la base de datos */
	/* 	retorna una lista con el usuario */
	public function selectById($id){
		$sql = "SELECT *,$this->table.id as id_master FROM $this->table WHERE id=:id ";
		foreach(array_keys($this->much_to_much) as $key){
			echo $key;
		}
		return;
		if(count($this->much_to_much)<>0){
			foreach($this->much_to_much as $join){
				$column = (substr($join,0,-1)) . "_id";
				$sql = $sql . "INNER JOIN $join ON $this->table.$column=$join.id ";
			}
		}
		$state = $this->db->prepare($sql);
		$state->bindParam(":id",$id);
		if($state->execute()){
			while($row=$state->fetch(PDO::FETCH_ASSOC)){
				$this->data[]=$row;
			}
			return $this->data;
		}
	}

	/* inserta un usuario en la base de datos */
	/* 	retorna el numero de id de el usuario registrado */
	public function insert(){
		$columns = implode(",",$this->columns);
		$args = implode(",",$this->args);
		$sql = "INSERT INTO $this->table($columns) values($args)";
		$state = $this->db->prepare($sql);
		$this->setParams($state);
		$state->execute();
		return $this->db->lastInsertId();
	}


	public function update(){
		$prepare_sql = "";
		for($i=0;$i < count($this->args);$i++){
			if((count($this->args)-1)==$i){
				$prepare_sql = $prepare_sql . $this->columns[$i] . "=" . $this->args[$i];
			}else{
				$prepare_sql = $prepare_sql . $this->columns[$i] . "=" . $this->args[$i] . ",";
			}
		}
		$sql = "UPDATE $this->table set $prepare_sql WHERE id=:id";
		$state = $this->db->prepare($sql);
		$this->setParams($state);
		$state->bindParam(":id",$this->id);
		$state->execute();
		return $this->db->lastInsertId();
	}

	public function delete($id){
		$sql = "DELETE FROM $this->table WHERE id=:id";
		$state = $this->db->prepare($sql);
		$state->bindParam(":id",$id);
		$state->execute();
	}

	private function setParams($state){
		for($i=0;$i < count($this->args);$i++){
			if($this->args[$i]==":password"){
				$password = password_hash($this->password,PASSWORD_BCRYPT);
				$state->bindParam($this->args[$i],$password);
			}else{
				$state->bindParam($this->args[$i],$this->{$this->columns[$i]});
			}
		}
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/c3/b0a2f0013cd03222fe73764d39cd1d0ced1df7
  Tamaño: 348       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293967    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.366256917 -0500
Modificación: 2023-05-15 15:43:00.066708524 -0500
      Cambio: 2023-10-20 16:46:06.793327503 -0500
    Creación: 2023-10-20 16:46:06.789994257 -0500
<?php
require_once("models/KriModel.php");
require_once("models/QualifierModel.php");
class KriController extends Controller{

	public $autosave = false;

	public function __construct(){
		parent::__construct();
		/* modelos */
		$this->model = new KriModel();
		$this->qualifier_model = new QualifierModel();
	}

	/* inseta un kri en base de datos y sus calificadores */
	/* 	retorna una redireccion al index de kri */
	public function insert(){
		$this->modelParams();
		$id = $this->model->insert();
		$this->qualifier_model->insertQualifiers($id,$this->model->db);
		$this->model->saveChanges();
		header("Location: /$this->controller");
	}

}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/c4/43b1afdad166a61b199a2315c5cf681dcb766b
  Tamaño: 305       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293588    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.122926937 -0500
Modificación: 2023-03-30 15:50:16.840976186 -0500
      Cambio: 2023-10-20 16:46:06.603332510 -0500
    Creación: 2023-10-20 16:46:06.603332510 -0500
<?php  
include_once("components/header.php");
?>

<table class="table table-borderless">
  <thead>
    <tr>
      <th scope="col">#</th>
      <th scope="col">Riesgo</th>
      <th scope="col">Propiedad</th>
      <th scope="col">Tipo</th>
    </tr>
  </thead>
  <tbody>
	  <?php  foreach($data as $risk): ?>
	  <tr>
		  <th scope="row"><?= $risk["id_master"] ?></th>
		  <td>
			  <a href="/risk/show/<?= $risk['id_master'] ?>">
			  <?= $risk["risk"] ?>
			  </a>
		  </td>
		  <td><?= $risk["propertie"] ?></td>
		  <td><?= $risk["type"] ?></td>
	  </tr>
	  <?php  endforeach; ?>
  </tbody>
</table>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/c5/53744c52992965b6281e0645c8e3867ca7c4cb
  Tamaño: 436       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293821    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.232925421 -0500
Modificación: 2023-10-17 16:44:13.007691203 -0500
      Cambio: 2023-10-20 16:46:06.703329875 -0500
    Creación: 2023-10-20 16:46:06.703329875 -0500
100644 blob 46141854b6c4aac2047018836b3340f5f62dd0c2	.htaccess
100644 blob da437ed708de7ea2d1ed5bb37dc51d00740740f6	Dockerfile
040000 tree dd6218d45158d9a2b0981c704e5c5c0d3130c418	assets
040000 tree ee84c1fda671963354e74a972bfc478930dd45c8	components
100644 blob 886fe19262e1dcc9bc5827b9b360744e6fe4cf58	config.php
040000 tree 302133f4f330c58639271e8434f7364d757cc868	controllers
100644 blob 8dadb53d86e692a9145d4db33bc19d31c3303116	data.sql
100644 blob 82c1b06cf8655c3159204f46dafb691aa3fe03c0	database.php
100644 blob 27dae4899dda3ef6df80d4bdc4ec9c52248ccb59	index.php
040000 tree 0fff838871cb857cf76c1f8e3ce22d160d054f1d	models
100644 blob d9a4ec66dfeb45d52c58647f352aaaae6b84cd28	router.php
100644 blob 46dfb9c57e8457a46bcf674b8b4097ac91049470	seeder.sql
040000 tree b61a11abc6b8d9e42f23f26893bb71ec7ee63efe	views
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/c6/d402739c5a887ebf3cfed72c2d11d734fd1ad5
  Tamaño: 181       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293793    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.219592271 -0500
Modificación: 2023-05-18 14:55:49.921963639 -0500
      Cambio: 2023-10-20 16:46:06.689996892 -0500
    Creación: 2023-10-20 16:46:06.689996892 -0500
tree 2be2a51092458052ab4cadc975f44f9ec12049c9
parent 03556fbfaac81427b6c9ff918bebe1b7e69b84e2
author DragonyteEvol <acuarionevol@outlook.com> 1684439749 +0000
committer DragonyteEvol <acuarionevol@outlook.com> 1684439749 +0000

feat: dinamic relation one to much
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/c6/fcef640a78c9903fb6370e39da1c2dad660112
  Tamaño: 115       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293794    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.219592271 -0500
Modificación: 2023-10-07 13:37:54.439465059 -0500
      Cambio: 2023-10-20 16:46:06.689996892 -0500
    Creación: 2023-10-20 16:46:06.689996892 -0500
100644 blob e69de29bb2d1d6434b8b29ae775ad8c2e48c5391	create.php
100644 blob 1d46055131350fa0ce58e3fe2f796772ad5d5acc	index.php
100644 blob 23aceaabb11dba079e2e4032b13463e21062eed3	show.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/c7/6a0a907d381a4e648401d5f3e431c3de645266
  Tamaño: 172       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293583    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.122926937 -0500
Modificación: 2023-10-17 16:44:09.867769344 -0500
      Cambio: 2023-10-20 16:46:06.599999264 -0500
    Creación: 2023-10-20 16:46:06.599999264 -0500
<?php
require_once("models/RiskModel.php");
class RiskController extends Controller{
	public $autosave = true;	

	public function __construct(){
		parent::__construct();
		$this->model = new RiskModel();
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/c7/de421c9e74da78c171f2838f7c55f776b4ec05
  Tamaño: 229       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293584    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.122926937 -0500
Modificación: 2023-10-16 17:34:11.597901122 -0500
      Cambio: 2023-10-20 16:46:06.599999264 -0500
    Creación: 2023-10-20 16:46:06.599999264 -0500
tree e2752eb85b044cefa09933c1d92d49b280f9b9da
parent a5d7c91d4eec0b59c42c1a0b1c146ea1111d2624
author DragonyteEvol <acuarionevol@outlook.com> 1697495609 -0500
committer DragonyteEvol <acuarionevol@outlook.com> 1697495609 -0500

feat: implemented update event to database
- View modify to reach all fields
- Logic to modify autocomit events
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/c8/1d35df6c60b54d1c416b7487f81156beff6d61
  Tamaño: 599       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293695    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.172926248 -0500
Modificación: 2023-10-17 15:55:29.859874294 -0500
      Cambio: 2023-10-20 16:46:06.646664701 -0500
    Creación: 2023-10-20 16:46:06.646664701 -0500
<?php
require_once("models/KriModel.php");
require_once("models/QualifierModel.php");
require_once("models/EventModel.php");
class KriController extends Controller{

	public $autosave = false;

	public function __construct(){
		parent::__construct();
		/* modelos */
		$this->model = new KriModel(); //AFECTA A LA TABLA KRIS
		$this->event_model = new EventModel(); //AFECTA LA TABLA EVENTS
		$this->qualifier_model = new QualifierModel(); //AFECTA A LA TABLA QUALIFIERS
	}

	/* inserta un kri en base de datos y sus calificadores */
	/* 	retorna una redireccion al index de kri */
	public function insert(){
		$this->modelParams();
		$id = $this->model->insert();
		$this->qualifier_model->insertQualifiers($id,$this->model->db);
		$this->model->saveChanges();
		header("Location: /$this->controller");
	}

	/* consulta un kri a apartir de su id y despliega la vista de modificacion de kri */
	/* calcula el puntaje del kri */
	/* returna una vista con la informacion del kri y su puntaje*/
	public function show(){
		$id = $_GET["id"]; 
		$data = $this->model->getByIdScore($id);
		/* VISTA */
		require_once("views/$this->controller/show.php");
	}

	public function update(){
		$id = $_GET["id"];
		$this->modelParams();
		$this->model->update($id);
		$this->qualifier_model->updateQualifiers($id,$this->model->db);
		$this->model->saveChanges();
		header("Location: /$this->controller");
	}

}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/c8/3546b1aa08d5e6e76f4b74b1ea2499011b801e
  Tamaño: 679       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293697    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.172926248 -0500
Modificación: 2023-02-24 01:39:29.044068616 -0500
      Cambio: 2023-10-20 16:46:06.649997947 -0500
    Creación: 2023-10-20 16:46:06.649997947 -0500
<?php 
require("database.php");
$message= "";
if(!empty($_POST["email"]) && !empty($_POST["password"])){
	$sql = "INSERT INTO users(email,password) values(:email,:password)";
	$state = $conn->prepare($sql);
	$state->bindParam(":email",$_POST["email"]);
	$password = password_hash($_POST["password"],PASSWORD_BCRYPT);
	$state->bindParam(":password",$password);
	if($state->execute()){
		$message = "Succesfully created new user";
	}else{
		$message = "Sorry, We cant create the user";
	}
}


?>
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<link rel="stylesheet" href="assets/css/styles.css">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100&display=swap" rel="stylesheet">
	<title></title>
</head>
<body>
	<?php require("components/header.php") ?>
	<h1>SingUP</h1>
	<span>or <a href="login.php">Login</a></span>
	<form action="" method="POST">
		<input type="text" name="name" placeholder="Enter your name">
		<input type="text" name="email" placeholder="Enter your email">
		<input type="password" name="password" placeholder="Enter your password">
		<input type="password" name="confirm_password" placeholder="Confirm your password">
		<input type="submit" value="Send">
	</form>
</body>
</html>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/c8/dc0abfd6095d873a7f6613b05bc0670ad81955
  Tamaño: 2647      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293696    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.172926248 -0500
Modificación: 2023-10-17 15:55:29.949871960 -0500
      Cambio: 2023-10-20 16:46:06.649997947 -0500
    Creación: 2023-10-20 16:46:06.649997947 -0500
<?php  
include_once("components/header.php");
?>

<!-- FORMULARIO DE CREACION DE KRIS -->
<div class="container">
	<?php  foreach($data["kris"] as $kri): ?>
	<form action="/kri/update/<?= $kri['master_id'] ?>" method="POST" class="needs-validation">
		<!-- PRIMERA FILA -->
		<div class="row">
			<div class="col-xl-4 col-lg-6 mb-4">
				<div class="bg-white rounded-lg p-5 shadow">
					<h2 class="h6 font-weight-bold text-center mb-4">Valoración del Indicador</h2>
					<!-- Progress bar 1 -->
					<div class="progress" role="progressbar" aria-label="Example with label" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">
						<div class="progress-bar" style="width: 25%">Bajo</div>
					</div>
					<!-- END -->

						<!-- Demo info -->
						<div class="row text-center mt-4">
							<div class="col-6 border-right">
								<div class="h4 font-weight-bold mb-0"><?= $data['score'] ?> P.</div><span class="small text-gray">Puntaje calculado</span>
							</div>
							<div class="col-6">
								<div class="h4 font-weight-bold mb-0"><?= $data["score_qualified"]["value"] ?></div><span class="small text-gray"><?= $data["score_qualified"]["type"] ?></span>
							</div>
						</div>
						<!-- END -->
					</div>
				</div>
				<div class="col-xl-4 col-lg-4 mb-4">
					<div class="bg-white rounded-lg p-5 shadow">
						<h2 class="h6 font-weight-bold text-center mb-4">Mapa relacional</h2>
						<div class="row align-items-center my-2">
							<div class="col-6">
								<button class="btn btn-outline-dark btn-sm form-control">
									<?= $kri["kri"] ?>
								</button>
							</div>
							<div class="col-6">
								<?php  foreach($data["events"] as $event): ?>
								<button class="btn btn-outline-dark btn-sm form-control my-2" data-bs-toggle="popover" data-bs-title="Descripcion del evento" data-bs-content="">
									<?= $event["event"]?>
								</button>
								<?php  endforeach; ?>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="card-header">
				<h5><b><?=$kri['master_id']?> | </b><?=$kri['kri']?></h5>
			</div>
			<div class="card-body">
				<!-- KRI -->
				<div class="form-floating mb-3">
					<input type="text" value="<?= $kri['kri'] ?>" required class="form-control" name="kri" id="floatingInput" placeholder="Insegra un nombre">
					<label for="floatingInput">Nombre del KRI</label>
				</div>
				<!-- OBJECTIVO -->
				<div class="form-floating">
					<textarea class="form-control mb-3" name="objective" id="floatingTextarea2"><?= $kri["objective"] ?></textarea>
					<label for="floatingTextarea2">Objetivo</label>
				</div>
				<div class="row">
					<div class="col-6">
						<!-- PROPIEDAD -->
						<div class="form-floating mb-3">
							<select name="propertie_id" class="form-select" id="datalistOptions" aria-label="">
								<option value="<?= $kri['propertie_id'] ?>" selected><?= $kri['propertie']?></option>
							</select>
							<label for="floatingSelect">Propiedad</label>
						</div>
					</div>
					<div class="col-6">
						<!-- PORCENTAJE -->
						<div class="form-floating mb-3">
							<input name="percentage" type="number" value="<?= $kri['percentage'] ?>" class="form-control">
							<label for="floatingInput">Porcentaje</label>
						</div>
					</div>
				</div>
				<!-- SYNTAX-->
				<div class="form-floating mb-3">
					<input name="syntax" type="text" value="<?= $kri['syntax'] ?>" class="form-control disabled">
					<label for="floatingInput">Sintaxis / Operacion de kri</label>
				</div>
				<div class="accordion accordion-flush" id="accordionFlushExample">
					<!-- EVENTOS -->
					<div class="accordion-item">
						<h2 class="accordion-header">
							<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#event-collapse" aria-expanded="false" aria-controls="flush-collapseOne">
								Eventos	
							</button>
						</h2>
						<div id="event-collapse" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
							<div class="my-2">
								<button name="events" type="button" class="form-control btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#exampleModal">
									Añadir evento
								</button>
								<?php  foreach($data["events"] as $event): ?>
								<div class="form-check">
									<input type="checkbox" checked id="<?= $event['event'] ?>" value="<?= $event['id'] ?>" name="event[]" class="form-check-input">
									<label class="form-check-label" for="<?= $event['event'] ?>"><?= $event['id']." | ".$event['event'] ?></label>
								</div>
								<?php  endforeach; ?>
							</div>
						</div>
					</div>
					<!-- QUALIFIERS -->
					<div class="accordion-item">
						<h2 class="accordion-header">
							<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#qualifier-collapse" aria-expanded="false" aria-controls="flush-collapseOne">
										   Calificadores
							</button>
						</h2>
						<div id="qualifier-collapse" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
							<div id="qualifiers">
								<?php  foreach($data["qualifiers"] as $qualifier): ?>
								<div class="input-group mb-3">
									<div class="form-floating">
										<input type="text" value="<?= $qualifier['type'] ?>" class="form-control" name="qualifier[]" id="floatingInputGroup1">
										<label for="floatingInputGroup1">Nombre Calificador</label>
									</div>
									<div class="form-floating">
										<input type="text" class="form-control" value="<?= $qualifier['value'] ?>" name="qualifier_value[]" id="floatingInputGroup1">
										<label for="floatingInputGroup1">Valor</label>
									</div>
								</div>
								<?php  endforeach; ?>
							</div>
							<button type="button" onclick="addQualifier()" class="form-control btn btn-outline-primary btn-sm">
								Agregar
							</button>
						</div>
					</div>
					<div class="accordion-item">
						<h2 class="accordion-header">
							<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#map-collapse" aria-expanded="false" aria-controls="flush-collapseOne">
								Mapa relacional
							</button>
						</h2>
						<div id="map-collapse" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
							<div class="row align-items-center my-2">
								<div class="col-6">
									<button class="btn btn-outline-dark btn-sm form-control">
										<?= $kri["kri"] ?>
									</button>
								</div>
								<div class="col-6">
									<?php  foreach($data["events"] as $event): ?>
									<button class="btn btn-outline-dark btn-sm form-control my-2" data-bs-toggle="popover" data-bs-title="Descripcion del evento" data-bs-content="">
										<?= $event["event"]?>
									</button>
									<?php  endforeach; ?>
								</div>
							</div>
						</div>
					</div>
				</div>
				<?php  endforeach; ?>
			</div>
			<div class="card-footer">
				<!-- END FIELD -->
				<div class="row">
					<div class="col-6">
						<button type="reset" class="btn btn-outline-secondary form-control">Limpiar</button>
					</div>
					<div class="col-6">
						<button type="submit" class="btn btn-primary form-control">Actualizar</button>
					</div>
				</div>
	</form>
			</div>

			<!-- FORMULARIO DE ADICION DE EVENTOS -->
			<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h1 class="modal-title fs-5" id="exampleModalLabel">Buscar Evento</h1>
							<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
						</div>
						<div class="modal-body">
							<div class="form-floating mb-3">
								<input type="text" required class="form-control" id="searchEvent" placeholder="Insegra un nombre">
								<label for="floatingInput">Buscar evento</label>
							</div>
							<div class="justify-content-center" id="datalistOptionsEvent">
							</div>
						</div>
					</div>
				</div>
			</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
<script src="/assets/js/search.js"></script>
<script>
	function addQualifier(){
		qualifiers_list = document.getElementById("qualifiers")
		html = ' <div class="input-group mb-3"> <div class="form-floating"> <input type="text" class="form-control" name="qualifier[]" id="floatingInputGroup1"> <label for="floatingInputGroup1">Nombre Calificador</label> </div> <div class="form-floating"> <input type="text" class="form-control" name="qualifiers_values[]" id="floatingInputGroup1"> <label for="floatingInputGroup1">Valor</label> </div> </div> '
		qualifiers_list.insertAdjacentHTML("beforeend",html)
	}
	searchEvent({
		listOptions: "datalistOptions",
		search: "propertie",
		components: new Map([
			["value","id"]
		]),
		value: "propertie",
		table: "properties",
		tag: "option"
	})
</script>

---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/cb/8348ef0beb3185e6c2441d67b11ee3dd20ceb8
  Tamaño: 180       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293651    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.152926524 -0500
Modificación: 2023-04-13 16:00:40.180416003 -0500
      Cambio: 2023-10-20 16:46:06.633331719 -0500
    Creación: 2023-10-20 16:46:06.633331719 -0500
tree 70e45ceb47c7d15dbfedbd1057dddd618a3faab6
parent 536d83aa5fd66d851be4f0a317aeb6fe0ad42670
author DragonyteEvol <acuarionevol@outlook.com> 1681419640 +0000
committer DragonyteEvol <acuarionevol@outlook.com> 1681419640 +0000

create and insert functions separated
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/cc/5b145a856deed5758e9b07bc1f1774370e2d4e
  Tamaño: 116       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293541    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.099593925 -0500
Modificación: 2023-06-24 08:01:49.923126170 -0500
      Cambio: 2023-10-20 16:46:06.579999791 -0500
    Creación: 2023-10-20 16:46:06.579999791 -0500
100644 blob e69de29bb2d1d6434b8b29ae775ad8c2e48c5391	create.php
100644 blob 3ab77b78586ed176ad4a45bb4f96f519f97090eb	index.php
100644 blob a304f375bdf785e19cc02369d54ea893fe1b9fc5	show.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/cc/9e32ea4e986eec0662cbb0bf5238c07a50a0a6
  Tamaño: 251       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293540    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.099593925 -0500
Modificación: 2023-10-17 16:03:13.361188307 -0500
      Cambio: 2023-10-20 16:46:06.579999791 -0500
    Creación: 2023-10-20 16:46:06.579999791 -0500
040000 tree c1a43b69371eea8ab5885b0c3a756f816af941ea	event
040000 tree 308825de38a9227b205beaff0966241c92688b54	kri
040000 tree bf26cbec7b3a99878eea5fe64236fa8c6693da97	login
040000 tree 4f27caa9c5680f7c74a99a1cc1eb3911d428c67f	propertie
040000 tree 8494db4705a8620c9116e70e5f31fa4b042d135f	register
040000 tree 4d17a1f804549e5391f2e10983a9f8becdd63319	risk
040000 tree 2f47ccb2e200d0e41df57356190e2cc8bfd87708	type
040000 tree 51b4f483439170ce1f66b8dc07444e95bac424b7	user
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/cf/08f28d8f82235f4e9a7f4bff674b0fd4cc38cb
  Tamaño: 732       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293751    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.199592546 -0500
Modificación: 2023-06-24 08:01:27.596460091 -0500
      Cambio: 2023-10-20 16:46:06.673330665 -0500
    Creación: 2023-10-20 16:46:06.673330665 -0500
<?php  
include_once("components/header.php");
?>
<div class="card">
	<div class="card-header">
		<div class="row">
			<div class="col-6">
				<div class="row">
					<div class="input-group mb-3">
						<a href="/kri/create" class="btn btn-primary" type="button" id="button-addon1">+</a>
						<input id="search" type="text" class="form-control" placeholder="Buscar Kri" aria-label="Example text with button addon" aria-describedby="button-addon1">
					</div>
				</div>
			</div>
			<div class="col-6">
				<div class="row">
					<div class="col-6">
						<input class="form-control" name="from" type="datetime-local">
					</div>
					<div class="col-6">
						<input class="form-control d-flex" name="to" type="datetime-local">
					</div>
				</div>
			</div>
		</div>
	</div>
	<table class="table table-borderless">
		<thead>
			<tr>
				<th scope="col">#</th>
				<th scope="col">KRI</th>
				<th scope="col">Objetivo</th>
				<th scope="col">Propiedad</th>
				<th scope="col">Porcentage</th>
			</tr>
		</thead>
		<tbody id="kris">
			<?php  foreach($data["kris"] as $kri): ?>
			<tr>
				<th scope="row"><?= $kri["id_master"] ?></th>
				<td>
					<a href="/kri/show/<?= $kri['id_master'] ?>">
						<?= $kri["kri"] ?>
					</a>
				</td>
				<td><?= $kri["objective"] ?></td>
				<td><?= $kri["propertie"] ?></td>
				<td><?= $kri["percentage"] ?>%</td>
			</tr>
			<?php  endforeach; ?>
		</tbody>
	</table>
</div>
<script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
<script src="assets/js/search.js"></script>
<script>
searchTable({
	componentEvent: "search",
	listOptions: "kris",
	search: "kri",
	components: [
		"objective",
		"propertie",
		"percentage"
	],
	value: "kri",
	table: "kris",
})
</script>
</script>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/cf/27b3beec50366ce112f05e7a070bf6cf045070
  Tamaño: 157       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293749    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.199592546 -0500
Modificación: 2023-03-28 17:22:06.607978311 -0500
      Cambio: 2023-10-20 16:46:06.673330665 -0500
    Creación: 2023-10-20 16:46:06.673330665 -0500
<?php 
class PropertieModel extends Model{
	protected $table = "properties";
	protected $columns = ["propertie"];
	protected $args= [":propertie"];

	public function __construct(){
		parent::__construct();
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/cf/46f779337d6837f9e61d3a5217427646cefcc9
  Tamaño: 269       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293752    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.199592546 -0500
Modificación: 2023-05-15 15:43:00.036708523 -0500
      Cambio: 2023-10-20 16:46:06.673330665 -0500
    Creación: 2023-10-20 16:46:06.673330665 -0500
<?php
require_once("models/EventModel.php");
class EventController extends Controller{

	public $autosave = true;

	public function __construct(){
		parent::__construct();
		$this->model = new EventModel();
	}

	public function show(){
		$numbers = [0,1,2,3,4,5,6,7,8,9];
		$syntax = "(22+3)+(4*825)";
		$z=4;
		is_
		if(is_numeric($syntax[$z])){
			echo $syntax[$z];
		}
	}

}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/cf/8370dc257425bfd170576deb5a3328613bf915
  Tamaño: 231       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293750    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.199592546 -0500
Modificación: 2023-10-07 12:40:03.952836059 -0500
      Cambio: 2023-10-20 16:46:06.673330665 -0500
    Creación: 2023-10-20 16:46:06.673330665 -0500
tree bd52b7171daf26ac23cf0eb9f0916f01071354c3
parent 1d1dde553e77e1ba21a74dbf3347ccc2ff350e71
author DragonyteEvol <acuarionevol@outlook.com> 1696700302 -0500
committer DragonyteEvol <acuarionevol@outlook.com> 1696700302 -0500

feat: view show event
- Designed view to show unique event
- Function to calculate value of kri because asociated events
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/d0/8b6bd70952d6953478a03f27843416f607eabb
  Tamaño: 1783      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293861    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.249591858 -0500
Modificación: 2023-10-17 15:55:29.946538714 -0500
      Cambio: 2023-10-20 16:46:06.719996103 -0500
    Creación: 2023-10-20 16:46:06.719996103 -0500
<?php  
include_once("components/header.php");
?>
<!-- FORMULARIO DE CREACION DE KRIS -->
<div class="container">
	<form action="/kri/insert" method="POST" class="needs-validation">
		<div class="card">
			<div class="card-header">
				<h2 class="my-3">Creacion de KRI</h2>
			</div>
			<div class="card-body">
				<!-- KRI -->
				<div class="form-floating mb-3">
					<input type="text"Crear KRI required class="form-control" name="kri" id="floatingInput" placeholder="Insegra un nombre">
					<label for="floatingInput">Nombre del KRI</label>
				</div>
				<!-- OBJECTIVO -->
				<div class="form-floating">
					<textarea class="form-control mb-3" name="objective" placeholder="Leave a comment here" id="floatingTextarea2" style="height: 100px"></textarea>
					<label for="floatingTextarea2">Objetivo</label>
				</div>
				<div class="row">
					<div class="col-6">
						<!-- PROPIEDAD -->
						<div class="form-floating mb-3">
							<select name="propertie_id" class="form-select" id="datalistOptions" aria-label="">
							</select>
							<label for="floatingSelect">Propiedad</label>
						</div>
					</div>
					<div class="col-6">
						<!-- PORCENTAJE -->
						<div class="form-floating mb-3">
							<input name="percentage" type="number" class="form-control">
							<label for="floatingInput">Porcentaje</label>
						</div>
					</div>
				</div>
				<!-- EVENTOS -->
				<button name="events" type="button" class="form-control btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
					Añadir evento
				</button>
				<select name="event[]" id="events" class="form-select mb-3" multiple>
				</select>
				<!-- SYNTAX-->
				<div class="form-floating mb-3">
					<input name="syntax" type="text" class="form-control disabled">
					<label for="floatingInput">Sintaxis / Operacion de kri</label>
				</div>
				<!-- QUALIFIERS -->
				<div class="card">
					<div class="card-header">
						<h5 class="mt-2">Calificadores</h5>
					</div>
					<div class="card-body" id="qualifiers">
						<div class="input-group mb-3">
							<div class="form-floating">
								<input type="text" class="form-control" name="qualifiers[]" id="floatingInputGroup1">
								<label for="floatingInputGroup1">Nombre Calificador</label>
							</div>
							<div class="form-floating">
								<input type="text" class="form-control" name="qualifiers_values[]" id="floatingInputGroup1">
								<label for="floatingInputGroup1">Valor</label>
							</div>
						</div>
					</div>
					<div class="card-footer">
						<button type="button" onclick="addQualifier()" class="form-control btn btn-primary">
							Agregar
						</button>
					</div>
				</div>
			</div>
			<div class="card-footer">
				<!-- END FIELD -->
				<button type="submit" class="btn btn-primary">Enviar</button>
			</div>
		</div>
	</form>
</div>
<!-- FORMULARIO DE ADICION DE EVENTOS -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h1 class="modal-title fs-5" id="exampleModalLabel">Buscar Evento</h1>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<div class="form-floating mb-3">
					<input type="text" required class="form-control" id="searchEvent" placeholder="Insegra un nombre">
					<label for="floatingInput">Buscar evento</label>
				</div>
				<div class="justify-content-center" id="datalistOptionsEvent">

				</div>
			</div>
		</div>
	</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
<script src="/assets/js/search.js"></script>
<script>
	function addQualifier(){
		qualifiers_list = document.getElementById("qualifiers")
		html = ' <div class="input-group mb-3"> <div class="form-floating"> <input type="text" class="form-control" name="qualifier[]" id="floatingInputGroup1"> <label for="floatingInputGroup1">Nombre Calificador</label> </div> <div class="form-floating"> <input type="text" class="form-control" name="qualifiers_values[]" id="floatingInputGroup1"> <label for="floatingInputGroup1">Valor</label> </div> </div> '
		qualifiers_list.insertAdjacentHTML("beforeend",html)
	}
	function customFunction(e){
		console.log(e)
		events = document.getElementById("events")
		html = events.innerHTML
		html += "<option selected value=" + e.id + ">["+e.id+"]."+e.event+"</option>"
		events.innerHTML = html
		modal = document.getElementById("exampleModal")
		modal.hide()
	}
	//PROPIEDADES
	searchEvent({
		listOptions: "datalistOptions",
		search: "propertie",
		components: new Map([
			["value","id"]
		]),
		value: "propertie",
		table: "properties",
		tag: "option"
	})
	//EVENTOS
	searchEvent({
		componentEvent: "searchEvent",
		listOptions: "datalistOptionsEvent",
		search: "event",
		components: new Map([
			["id","master_id"],
			["event","event"]
		]),
		value: "event",
		table: "events",
		tag: "button",
		customFunction: "customFunction",
		class: "btn btn-outline-primary form-control m-2' data-bs-dismiss='modal",
	})
</script>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/d1/0ce92c241bfadf68d3af2d0dda28bbb5aeac2a
  Tamaño: 360       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293869    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.269591582 -0500
Modificación: 2023-10-17 15:55:34.906410099 -0500
      Cambio: 2023-10-20 16:46:06.723329347 -0500
    Creación: 2023-10-20 16:46:06.723329347 -0500
100644 blob f5fbcc6ec8eff868d90ec3a3664548402436f1e5	Controller.php
100644 blob 43b66da7c98ec0406611ebd66751eba7be411194	EventController.php
100644 blob c81d35df6c60b54d1c416b7487f81156beff6d61	KriController.php
100644 blob ab88d0b50b2f02ca6a63488e849280128184eafb	LoginController.php
100644 blob 56b41c3c0b81d3e213654e2b64a9e8e43e0c8b30	PropertieController.php
100644 blob 12620ce4178e3b649067d4a02a366ef83bb8d47e	RegisterController.php
100644 blob 49aedabe24402bb06934d43ae75a8bfd21e9a880	RiskController.php
100644 blob 8c1bb57955e07f847b2b8e617e4db6218f8ced28	SourceController.php
100644 blob 07a9d2abeb523436c2863c3129e2c4f1fd26c654	TemplateController.php
100644 blob 9948526e371ec84f39ad45662721203603f6abf6	TypeController.php
100644 blob fb02603f5e1e778c1b626de544c3f0834532d3e1	UserController.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/d3/4cedb25b0582d36473d68458496b397d49d338
  Tamaño: 359       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293452    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.049594614 -0500
Modificación: 2023-06-24 08:01:49.923126170 -0500
      Cambio: 2023-10-20 16:46:06.540000846 -0500
    Creación: 2023-10-20 16:46:06.540000846 -0500
100644 blob 34dcbd5666a9705354669066f464e69bdd63f1f5	EventModel.php
100644 blob 75ecfefcec79175ffb210f3fcbbe5c8b2e773879	KriModel.php
100644 blob e29d14bb2db7aedf74297d203bbce70dafd4b31b	Model.php
100644 blob cf27b3beec50366ce112f05e7a070bf6cf045070	PropertieModel.php
100644 blob 2b7e2e2a08d9bfe6fc287d1eadf68a3ae2bef753	QualifierModel.php
100644 blob 3f36dc91c903e4be4239b127f4d48a9f11011911	RecordModel.php
100644 blob 730a24116f0181eadde3a5c5ca6e2d03d57ba8f7	RiskModel.php
100644 blob 05d7d4d8f9670e0e5b2c24fe3469c804e2f0f4b4	SourceModel.php
100644 blob 94c0b90d03c95b7e9484842795b32a9d4a3eacb3	TemplateModel.php
100644 blob 95085117329d973fd6c36029b44293bcedd69742	TypeModel.php
100644 blob 98bcd9d15ece27bab02c81584e6e0b10ed3cfd21	UserModel.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/d3/e13d48b66ef96b3ec7c46c90db83f1014dd3e6
  Tamaño: 251       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293453    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.049594614 -0500
Modificación: 2023-10-15 17:00:51.989324130 -0500
      Cambio: 2023-10-20 16:46:06.540000846 -0500
    Creación: 2023-10-20 16:46:06.540000846 -0500
040000 tree c6fcef640a78c9903fb6370e39da1c2dad660112	event
040000 tree 12e9e38aa524c73274e5c41f3f465df3a3835029	kri
040000 tree bf26cbec7b3a99878eea5fe64236fa8c6693da97	login
040000 tree 4f27caa9c5680f7c74a99a1cc1eb3911d428c67f	propertie
040000 tree 8494db4705a8620c9116e70e5f31fa4b042d135f	register
040000 tree a7766349f98c6f1e8f360cb711d5fe799c94b10c	risk
040000 tree 2f47ccb2e200d0e41df57356190e2cc8bfd87708	type
040000 tree 51b4f483439170ce1f66b8dc07444e95bac424b7	user
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/d4/2377cb3fad9128901b030b8e9d16d2e3cb4167
  Tamaño: 116       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293628    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.142926661 -0500
Modificación: 2023-04-13 16:00:40.143749336 -0500
      Cambio: 2023-10-20 16:46:06.619998737 -0500
    Creación: 2023-10-20 16:46:06.619998737 -0500
100644 blob e69de29bb2d1d6434b8b29ae775ad8c2e48c5391	create.php
100644 blob 74863a65588c18ada0a0b8aec8f70bb06a61be29	index.php
100644 blob a304f375bdf785e19cc02369d54ea893fe1b9fc5	show.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/d5/194d1e6de2888c8bd40e995811876acc35db19
  Tamaño: 240       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293436    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.042928040 -0500
Modificación: 2023-10-15 17:01:51.571106468 -0500
      Cambio: 2023-10-20 16:46:06.533334355 -0500
    Creación: 2023-10-20 16:46:06.530001109 -0500
tree 42a5b042b534855b510393d47c6c21950a941734
parent 205573f9bfd3e887896441a4cc6cfa3e448b913b
author DragonyteEvol <acuarionevol@outlook.com> 1697407252 -0500
committer DragonyteEvol <acuarionevol@outlook.com> 1697407252 -0500

feat: Map view only one risk
- Relational map to view
- Form to modify risk
- Added funtionality to add or disable kri to risk
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/d5/d9eb8738a6f7498112842987cc8ab456c42399
  Tamaño: 744       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293437    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.042928040 -0500
Modificación: 2023-10-07 12:37:09.294268403 -0500
      Cambio: 2023-10-20 16:46:06.533334355 -0500
    Creación: 2023-10-20 16:46:06.533334355 -0500
<?php 
class EventModel extends Model{
	protected $table = "events";
	protected $columns = ["event","type","source_id","event_id"];
	protected $args= [":event",":type",":source_id",":event_id"];
	protected $record_table="records";
	protected $search_criteria="event";

	public function __construct(){
		parent::__construct();
	}

	public function getAll(){
		//optencion de query
		$sql = $this->getSelectQuery(TRUE);
		/* ejecucion de query */
		$this->execute($sql,$this->table);
		return $this->data;
	}

	/* busca elementos en la base de datos */
	/* 	retorna un array con los elementos encontrados */
	public function search($search){
		$sql = $this->getSelectQuery(FALSE);
		$sql=$sql . " WHERE $this->search_criteria LIKE '%$search%' ";
		//AGRUPACION POR ID DE OSIEM Y FUENTE PARA EVITAR CRUCES DE EVENTOS
		$sql = $sql . "GROUP BY $this->table.id,$this->table.event_id,$this->table.source_id";
		$this->execute($sql,$this->table);
		return $this->data;
	}

	//genera el query principal de la seleccion de eventos
	//recibe como paremetros un booleano para inyectar al query la agrupacion por evento y fuente
	//retorna un string con la query a ejecutar
	private function getSelectQuery($group){
		$sql = "SELECT *,count($this->table.event_id) as score,$this->table.id as id_master FROM $this->table ";
		//UNION A CALCULO DE PUNTAJE 
		$sql = $sql . "LEFT JOIN $this->record_table ON $this->table.event_id=$this->record_table.event_id AND $this->table.source_id=$this->record_table.source_id ";
		//AGRUPACION POR ID DE OSIEM Y FUENTE PARA EVITAR CRUCES DE EVENTOS
		if($group){
			$sql = $sql . "GROUP BY $this->table.id,$this->table.event_id,$this->table.source_id";
		}
		return $sql;
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/d7/5d75e151582b4db833148749f3bd47db469140
  Tamaño: 175       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293830    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.236258708 -0500
Modificación: 2023-04-06 11:42:20.719384036 -0500
      Cambio: 2023-10-20 16:46:06.706663120 -0500
    Creación: 2023-10-20 16:46:06.706663120 -0500
<?php  
include_once("components/header.php");
var_dump($data);
?>
<form>
<?php foreach($data["kris"] as $risk): ?>
<input type="text" name="" class="form-control" value="<?= $risk['risk'] ?>"
<?php endforeach; ?>
</form>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/d9/a4ec66dfeb45d52c58647f352aaaae6b84cd28
  Tamaño: 402       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293921    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.326257467 -0500
Modificación: 2023-06-24 08:01:27.566460092 -0500
      Cambio: 2023-10-20 16:46:06.769994784 -0500
    Creación: 2023-10-20 16:46:06.769994784 -0500
<?php
require_once("database.php");
require("models/Model.php");
require("controllers/Controller.php");

/* var_dump($_GET); */
/* extrae el nombre del controlador de la uri de la url*/
/* http://sy.com/mycontroller =====>>> mycontroller */
$controller = $_GET["controller"];
/* extrae el nombre de la funcion a llamar de la uri de la url */
/* http://sy.com/mycontroller/show =====>>> show*/
$action = $_GET["action"];
/* extrae el id o parametro personalizado en la funcion de la uri de la url */
/* http://sy.com/mycontroller/show/1 =====>>> 1*/
$id = $_GET["id"];

if(empty($action)){
	$action = "index";
}

$controller = ucfirst($controller) . "Controller";

/* referencia el controlador accedido por la uri y crea una instancia */
include "controllers/$controller.php";
$ctrl = new $controller;
/* llama a la funcion de la uri */
$ctrl->{$action}();
?>

---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/d9/cda7e6a6b7d896f14678d4a3d816ccd89bdb5e
  Tamaño: 358       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293922    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.326257467 -0500
Modificación: 2023-10-16 17:33:29.682258620 -0500
      Cambio: 2023-10-20 16:46:06.769994784 -0500
    Creación: 2023-10-20 16:46:06.769994784 -0500
100644 blob 8618fc15415a02efb22777cf80b5c28f37726a59	EventModel.php
100644 blob 05849fd380fdaae9648c991784a066c1360b099e	KriModel.php
100644 blob 701c934864ebd8c1a7624167e84da4fa42653d2f	Model.php
100644 blob cf27b3beec50366ce112f05e7a070bf6cf045070	PropertieModel.php
100644 blob 451577bd049f836b07b10907d0cd862efcd8dbb2	QualifierModel.php
100644 blob 3f36dc91c903e4be4239b127f4d48a9f11011911	RecordModel.php
100644 blob 730a24116f0181eadde3a5c5ca6e2d03d57ba8f7	RiskModel.php
100644 blob 05d7d4d8f9670e0e5b2c24fe3469c804e2f0f4b4	SourceModel.php
100644 blob 94c0b90d03c95b7e9484842795b32a9d4a3eacb3	TemplateModel.php
100644 blob 95085117329d973fd6c36029b44293bcedd69742	TypeModel.php
100644 blob 98bcd9d15ece27bab02c81584e6e0b10ed3cfd21	UserModel.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/da/2d29e849e1ebec1ccf31e933891f35c47e63bb
  Tamaño: 359       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293610    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.132926799 -0500
Modificación: 2023-05-15 15:43:32.893375742 -0500
      Cambio: 2023-10-20 16:46:06.613332246 -0500
    Creación: 2023-10-20 16:46:06.613332246 -0500
100644 blob 34dcbd5666a9705354669066f464e69bdd63f1f5	EventModel.php
100644 blob 0012f9ae90c3e8d5ae8bfea1873c7a7de1ca77fe	KriModel.php
100644 blob 6664345e7c9f4d964dbaff1cb0aca2ee5b622992	Model.php
100644 blob cf27b3beec50366ce112f05e7a070bf6cf045070	PropertieModel.php
100644 blob 2b7e2e2a08d9bfe6fc287d1eadf68a3ae2bef753	QualifierModel.php
100644 blob 3f36dc91c903e4be4239b127f4d48a9f11011911	RecordModel.php
100644 blob da44e54bc0a27b71b4025e2ec66691e9e08ae0d1	RiskModel.php
100644 blob 05d7d4d8f9670e0e5b2c24fe3469c804e2f0f4b4	SourceModel.php
100644 blob 94c0b90d03c95b7e9484842795b32a9d4a3eacb3	TemplateModel.php
100644 blob 95085117329d973fd6c36029b44293bcedd69742	TypeModel.php
100644 blob 98bcd9d15ece27bab02c81584e6e0b10ed3cfd21	UserModel.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/da/437ed708de7ea2d1ed5bb37dc51d00740740f6
  Tamaño: 69        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293607    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.132926799 -0500
Modificación: 2023-02-24 01:39:28.757401944 -0500
      Cambio: 2023-10-20 16:46:06.609999001 -0500
    Creación: 2023-10-20 16:46:06.609999001 -0500
FROM php:7.0-apache

COPY . /var/www/html

EXPOSE 80
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/da/44e54bc0a27b71b4025e2ec66691e9e08ae0d1
  Tamaño: 352       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293608    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.132926799 -0500
Modificación: 2023-04-06 11:42:20.699384035 -0500
      Cambio: 2023-10-20 16:46:06.613332246 -0500
    Creación: 2023-10-20 16:46:06.609999001 -0500
<?php 
class RiskModel extends Model{
	/* tabla en la que actua  este modelo en base de datos */
	protected $table = "risks";

	/* columns que modifica el modelo en base de datos */
	protected $columns = ["type_id","propertie_id","risk",];

	/* columnas para modificacion en base de datos con consulta preparada */
	protected $args= [":type_id",":propertie_id",":risk"];

	/* relaciones entre bases de datos uno a muchos */
	protected $relations= ["properties","types"];

	/* relaciones entre bases de datos de muchos a muchos se debe definir las dos tablas que se desean relacionar */
	protected $much_to_much= ["risks"=>"kris","kris"=>"events"];

	public function __construct(){
		parent::__construct();
	}

}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/da/7cd98fedd69b4a6d29210ba564bc6e76c726cb
  Tamaño: 233       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293609    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.132926799 -0500
Modificación: 2023-10-18 16:46:37.132322091 -0500
      Cambio: 2023-10-20 16:46:06.613332246 -0500
    Creación: 2023-10-20 16:46:06.613332246 -0500
tree 8a6006886b17d01bfdb198e794f800f01cc7f305
parent 17f4d865577dbfb276e0d08703c097a5f49064cc
author DragonyteEvol <acuarionevol@outlook.com> 1697665546 -0500
committer DragonyteEvol <acuarionevol@outlook.com> 1697665546 -0500

feat: Funtions calculate risk value
-Funtion to calculate score risk because each kri
- View score implemented on show risk
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/db/0400e2c51cbb721276811d9c198a82b538572e
  Tamaño: 645       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293494    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.076260913 -0500
Modificación: 2023-10-08 19:55:08.167278357 -0500
      Cambio: 2023-10-20 16:46:06.556667073 -0500
    Creación: 2023-10-20 16:46:06.556667073 -0500
<?php
require_once("models/KriModel.php");
require_once("models/QualifierModel.php");
require_once("models/EventModel.php");
class KriController extends Controller{

	public $autosave = false;

	public function __construct(){
		parent::__construct();
		/* modelos */
		$this->model = new KriModel(); //AFECTA A LA TABLA KRIS
		$this->event_model = new EventModel(); //AFECTA LA TABLA EVENTS
		$this->qualifier_model = new QualifierModel(); //AFECTA A LA TABLA QUALIFIERS
	}

	/* inserta un kri en base de datos y sus calificadores */
	/* 	retorna una redireccion al index de kri */
	public function insert(){
		$this->modelParams();
		$id = $this->model->insert();
		$this->qualifier_model->insertQualifiers($id,$this->model->db);
		$this->model->saveChanges();
		header("Location: /$this->controller");
	}

	/* consulta un kri a apartir de su id y despliega la vista de modificacion de kri */
	/* calcula el puntaje del kri */
	/* returna una vista con la informacion del kri y su puntaje*/
	public function show(){
		$id = $_GET["id"]; 
		$data=$this->model->selectById($id);
		/* CALCULAR PUNTAJE DE KRI */
		$syntax = $data["kris"][0]["syntax"];
		$score = $this->event_model->calculateScore($syntax);
		$data["score"] = $score;
		/* VISTA */
		require_once("views/$this->controller/show.php");
	}

}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/dc/9cfb9c2e93b41acbe9d8bcc6932aa67031e82d
  Tamaño: 3111      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293888    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.312924318 -0500
Modificación: 2023-03-30 15:50:16.840976186 -0500
      Cambio: 2023-10-20 16:46:06.736662329 -0500
    Creación: 2023-10-20 16:46:06.733329084 -0500
-- MariaDB dump 10.19  Distrib 10.11.2-MariaDB, for Linux (x86_64)
--
-- Host: 172.17.0.2    Database: csra
-- ------------------------------------------------------
-- Server version	5.7.41

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8mb4 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

--
-- Table structure for table `events`
--

DROP TABLE IF EXISTS `events`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `events` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `event` varchar(255) DEFAULT NULL,
  `type` enum('automatic','manual') DEFAULT NULL,
  `source_id` int(11) DEFAULT NULL,
  `event_id` int(11) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=17 DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `events`
--

LOCK TABLES `events` WRITE;
/*!40000 ALTER TABLE `events` DISABLE KEYS */;
INSERT INTO `events` VALUES
(1,'Escaneo de puertos',NULL,NULL,NULL,'2023-03-30 18:07:33'),
(2,'Inundacin de paquetes (synFlood)',NULL,NULL,NULL,'2023-03-30 18:07:33'),
(3,'Ataque de fuerza bruta',NULL,NULL,NULL,'2023-03-30 18:07:33'),
(4,'Deteccin de malware en estacin de trabajo',NULL,NULL,NULL,'2023-03-30 18:07:33'),
(5,'Deteccin de trfico malicioso',NULL,NULL,NULL,'2023-03-30 18:07:33'),
(6,'PUA detectada',NULL,NULL,NULL,'2023-03-30 18:07:33'),
(7,'PUA limpiada',NULL,NULL,NULL,'2023-03-30 18:07:33'),
(8,'Proteccin en tiempo real desactivado',NULL,NULL,NULL,'2023-03-30 18:07:33'),
(9,'Deteccin de datos personales',NULL,NULL,NULL,'2023-03-30 18:07:33'),
(10,'Correos a buzones personales con informacin restringida',NULL,NULL,NULL,'2023-03-30 18:07:33'),
(11,'Compartir informacin restringida en onedrive con usuarios externos',NULL,NULL,NULL,'2023-03-30 18:07:33'),
(12,'Deteccin de archivos malilciosos - malware',NULL,NULL,NULL,'2023-03-30 18:07:33'),
(13,'Privilegios especiales asignados al nuevo inicio de sesin',NULL,NULL,NULL,'2023-03-30 18:07:33'),
(14,'Creacin o desactivacin de usuarios fuera de horario laboral',NULL,NULL,NULL,'2023-03-30 18:07:33'),
(15,'Vulnerabilidades detectadas',NULL,NULL,NULL,'2023-03-30 18:07:33'),
(16,'Prdida/robo de porttiles',NULL,NULL,NULL,'2023-03-30 18:07:34');
/*!40000 ALTER TABLE `events` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `kri_event`
--

DROP TABLE IF EXISTS `kri_event`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `kri_event` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `kri_id` int(11) DEFAULT NULL,
  `event_id` int(11) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `kri_event`
--

LOCK TABLES `kri_event` WRITE;
/*!40000 ALTER TABLE `kri_event` DISABLE KEYS */;
/*!40000 ALTER TABLE `kri_event` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `kris`
--

DROP TABLE IF EXISTS `kris`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `kris` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `kri` varchar(255) DEFAULT NULL,
  `objective` varchar(255) DEFAULT NULL,
  `propertie_id` int(11) DEFAULT NULL,
  `percentage` int(3) DEFAULT NULL,
  `syntax` varchar(255) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=9 DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `kris`
--

LOCK TABLES `kris` WRITE;
/*!40000 ALTER TABLE `kris` DISABLE KEYS */;
INSERT INTO `kris` VALUES
(1,'Monitoreo y control de aplicaciones potencialmente no deseadas','Monitorear las detecciones y limpieza automtica de PUAs realizadas por la plataforma de proteccin de punto final contra malware',2,15,'1+1','2023-03-30 18:07:00'),
(2,'Monitoreo y control de aplicaciones potencialmente no deseadas','Monitorear las detecciones y limpieza automtica de PUAs realizadas por la plataforma de proteccin de punto final contra malware',2,15,'1+1','2023-03-30 18:07:00'),
(3,'Monitoreo y control de aplicaciones potencialmente no deseadas','Monitorear las detecciones y limpieza automtica de PUAs realizadas por la plataforma de proteccin de punto final contra malware',2,15,'1+1','2023-03-30 18:07:00'),
(4,'Monitoreo y control de aplicaciones potencialmente no deseadas','Monitorear las detecciones y limpieza automtica de PUAs realizadas por la plataforma de proteccin de punto final contra malware',2,15,'1+1','2023-03-30 18:07:00'),
(5,'Monitoreo y control de aplicaciones potencialmente no deseadas','Monitorear las detecciones y limpieza automtica de PUAs realizadas por la plataforma de proteccin de punto final contra malware',2,15,'1+1','2023-03-30 18:07:00'),
(6,'Monitoreo y control de aplicaciones potencialmente no deseadas','Monitorear las detecciones y limpieza automtica de PUAs realizadas por la plataforma de proteccin de punto final contra malware',2,15,'1+1','2023-03-30 18:07:00'),
(7,'Monitoreo y control de aplicaciones potencialmente no deseadas','Monitorear las detecciones y limpieza automtica de PUAs realizadas por la plataforma de proteccin de punto final contra malware',2,15,'1+1','2023-03-30 18:07:00'),
(8,'Monitoreo y control de aplicaciones potencialmente no deseadas','Monitorear las detecciones y limpieza automtica de PUAs realizadas por la plataforma de proteccin de punto final contra malware',2,15,'1+1','2023-03-30 18:07:03');
/*!40000 ALTER TABLE `kris` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `master_qualifier`
--

DROP TABLE IF EXISTS `master_qualifier`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `master_qualifier` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `high` int(11) DEFAULT NULL,
  `medium` int(11) DEFAULT NULL,
  `low` int(11) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `master_qualifier`
--

LOCK TABLES `master_qualifier` WRITE;
/*!40000 ALTER TABLE `master_qualifier` DISABLE KEYS */;
/*!40000 ALTER TABLE `master_qualifier` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `properties`
--

DROP TABLE IF EXISTS `properties`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `properties` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `propertie` varchar(255) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `properties`
--

LOCK TABLES `properties` WRITE;
/*!40000 ALTER TABLE `properties` DISABLE KEYS */;
INSERT INTO `properties` VALUES
(1,'confidencialidad','2023-03-28 21:29:32'),
(2,'disponibilidad','2023-03-28 21:29:32'),
(3,'integridad','2023-03-28 21:29:32');
/*!40000 ALTER TABLE `properties` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `qualifiers`
--

DROP TABLE IF EXISTS `qualifiers`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `qualifiers` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `type` enum('alto','medio','bajo') DEFAULT NULL,
  `value` int(11) DEFAULT NULL,
  `kri_id` int(11) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `qualifiers`
--

LOCK TABLES `qualifiers` WRITE;
/*!40000 ALTER TABLE `qualifiers` DISABLE KEYS */;
/*!40000 ALTER TABLE `qualifiers` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `records`
--

DROP TABLE IF EXISTS `records`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `records` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `source_id` int(11) DEFAULT NULL,
  `event_id` int(11) DEFAULT NULL,
  `reported_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `records`
--

LOCK TABLES `records` WRITE;
/*!40000 ALTER TABLE `records` DISABLE KEYS */;
/*!40000 ALTER TABLE `records` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `risk_kri`
--

DROP TABLE IF EXISTS `risk_kri`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `risk_kri` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `risk_id` int(11) DEFAULT NULL,
  `kri_id` int(11) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `risk_kri`
--

LOCK TABLES `risk_kri` WRITE;
/*!40000 ALTER TABLE `risk_kri` DISABLE KEYS */;
INSERT INTO `risk_kri` VALUES
(1,1,1,'2023-03-30 19:34:49'),
(2,1,2,'2023-03-30 19:34:49');
/*!40000 ALTER TABLE `risk_kri` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `risks`
--

DROP TABLE IF EXISTS `risks`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `risks` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `type_id` int(11) DEFAULT NULL,
  `propertie_id` int(11) DEFAULT NULL,
  `risk` varchar(255) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=24 DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `risks`
--

LOCK TABLES `risks` WRITE;
/*!40000 ALTER TABLE `risks` DISABLE KEYS */;
INSERT INTO `risks` VALUES
(1,3,3,'Prdida financiera causada por Acceso no autorizado','2023-03-30 18:06:22'),
(2,3,2,'Sancin legal causada por Fuga de informacin malintencionada','2023-03-30 18:06:22'),
(3,3,3,'Prdida financiera causada por Fuga de informacin por error involuntario','2023-03-30 18:06:22'),
(4,2,1,'Prdida operativa causada por Ingeniera social/Spear Phising, Cryptojacking/Cryptomining, Cloud-Jacking, Ramsonware, Cyber espionaje, IoT, Hacktivism, Crimen organizado, Fearware, Coordinated attack, Cyber warfare','2023-03-30 18:06:22'),
(5,4,1,'Prdida operativa causada por Ataque Fuerza bruta, Desbordamiento buffer, XSS, MiM, Spoof, Inyeccion SQL','2023-03-30 18:06:22'),
(6,4,1,'Perdida de capacidad tecnolgica causada por Suplantacin de identidad','2023-03-30 18:06:22'),
(7,5,1,'Perdida de capacidad tecnolgica causada por Abuso o elevacin de privilegios','2023-03-30 18:06:22'),
(8,5,3,'Prdida financiera causada por Modificacin de la informacin por error involuntario','2023-03-30 18:06:22'),
(9,1,3,'Sancin legal causada por Modificacin de la informacin malintencionada','2023-03-30 18:06:22'),
(10,4,2,'Prdida financiera causada por Robo','2023-03-30 18:06:22'),
(11,2,1,'Prdida operativa causada por Ataque informtico (Malware, APT, BackDoor, DoS)','2023-03-30 18:06:22'),
(12,3,2,'Prdida operativa causada por Corte o fallas en el suministro elctrico','2023-03-30 18:06:22'),
(13,4,1,'Prdida operativa causada por Dao por agua, humedad o lquidos','2023-03-30 18:06:22'),
(14,3,2,'Perdida de capacidad tecnolgica causada por Denegacin de servicio malintencionado','2023-03-30 18:06:22'),
(15,2,2,'Perdida de capacidad tecnolgica causada por Denegacin de servicio por error involuntario','2023-03-30 18:06:22'),
(16,2,3,'Prdida operativa causada por Descarga elctrica','2023-03-30 18:06:22'),
(17,3,2,'Prdida estratgica causada por Destruccin de la informacin por error involuntario','2023-03-30 18:06:22'),
(18,2,2,'Prdida financiera causada por Destruccin o eliminacin de la informacin malintencionada','2023-03-30 18:06:22'),
(19,4,2,'Prdida financiera causada por Fuego','2023-03-30 18:06:22'),
(20,3,1,'Prdida operativa causada por Interferencia electromagntica','2023-03-30 18:06:22'),
(21,3,3,'Prdida operativa causada por Paro','2023-03-30 18:06:23'),
(22,2,1,'Prdida operativa causada por Pandemias (Covid-19, emergentes)','2023-03-30 18:06:23'),
(23,4,1,'Prdida operativa causada por Terremoto','2023-03-30 18:06:24');
/*!40000 ALTER TABLE `risks` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `sources`
--

DROP TABLE IF EXISTS `sources`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `sources` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `source` varchar(255) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `sources`
--

LOCK TABLES `sources` WRITE;
/*!40000 ALTER TABLE `sources` DISABLE KEYS */;
/*!40000 ALTER TABLE `sources` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `types`
--

DROP TABLE IF EXISTS `types`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `types` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `type` varchar(255) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `types`
--

LOCK TABLES `types` WRITE;
/*!40000 ALTER TABLE `types` DISABLE KEYS */;
INSERT INTO `types` VALUES
(1,'estrategico','2023-03-28 22:02:20'),
(2,'financiero','2023-03-28 22:02:20'),
(3,'legal','2023-03-28 22:02:20'),
(4,'operacional','2023-03-30 17:27:18'),
(5,'tecnologico','2023-03-30 17:27:18');
/*!40000 ALTER TABLE `types` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `users`
--

DROP TABLE IF EXISTS `users`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `users` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(255) DEFAULT NULL,
  `email` varchar(255) DEFAULT NULL,
  `password` varchar(255) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `users`
--

LOCK TABLES `users` WRITE;
/*!40000 ALTER TABLE `users` DISABLE KEYS */;
INSERT INTO `users` VALUES
(1,'DragonyteEvol','acuarionevol@outlook.com','$2y$10$Ws65FRcPjyK6eSI0bDcPIurUe.QlzLG6zctOAuwIzXBcsWI./7GSq','2023-03-26 10:26:18');
/*!40000 ALTER TABLE `users` ENABLE KEYS */;
UNLOCK TABLES;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;

-- Dump completed on 2023-03-30 20:49:53
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/dd/6218d45158d9a2b0981c704e5c5c0d3130c418
  Tamaño: 71        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293632    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.146259948 -0500
Modificación: 2023-10-14 17:45:49.125658979 -0500
      Cambio: 2023-10-20 16:46:06.619998737 -0500
    Creación: 2023-10-20 16:46:06.619998737 -0500
040000 tree 39edb8eb928c77e8fafaa1e956c0864b32e60038	css
040000 tree e74a82b92004eeed6e65f046e35653162b6e982c	js
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/dd/7c5504be6a44771008fd24ebe0dd6c0dc999aa
  Tamaño: 293       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293633    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.146259948 -0500
Modificación: 2023-03-28 17:22:06.611311644 -0500
      Cambio: 2023-10-20 16:46:06.623331983 -0500
    Creación: 2023-10-20 16:46:06.619998737 -0500
<?php 
class RiskModel extends Model{
	/* tabla en la que actua  este modelo en base de datos */
	protected $table = "risks";
	
	/* columns que modifica el modelo en base de datos */
	protected $columns = ["type_id","propertie_id","risk",];

	/* columnas para modificacion en base de datos con consulta preparada */
	protected $args= [":type_id",":propertie_id",":risk"];

	/* relaciones entre bases de datos uno a muchos */
	protected $relations= ["properties","types"];

	public function __construct(){
		parent::__construct();
	}

}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/df/c63cc3d8ba1f499d4cceaeb0bb7d89bf4900ef
  Tamaño: 1351      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293465    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.056261189 -0500
Modificación: 2023-04-06 11:42:20.722717369 -0500
      Cambio: 2023-10-20 16:46:06.546667337 -0500
    Creación: 2023-10-20 16:46:06.543334091 -0500
<?php  
include_once("components/header.php");
?>

<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalCreate">
  Launch static backdrop modal
</button>

<table class="table table-borderless">
  <thead>
    <tr>
      <th scope="col">#</th>
      <th scope="col">Evento</th>
      <th scope="col">Tipo</th>
    </tr>
  </thead>
  <tbody>
	  <?php  foreach($data["events"] as $risk): ?>
	  <tr>
		  <th scope="row"><?= $risk["id_master"] ?></th>
		  <td>
			  <a href="/event/show/<?= $risk['id_master'] ?>">
			  <?= $risk["event"] ?>
			  </a>
		  </td>
		  <td><?= $risk["propertie"] ?></td>
		  <td><?= $risk["type"] ?></td>
	  </tr>
	  <?php  endforeach; ?>
  </tbody>
</table>
<!-- ///////////////// -->
 <!-- Formulario modal para creacion de eventos --> 
<div id="modalCreate" class="modal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Crear evento</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
	  <div class="modal-body">
		  <!-- formulario de inicio de sesion -->
		  <form action="/event/create" method="POST" class="needs-validation">
			<!-- TEMPLATE -->
			  <div class="form-floating mb-3">
				  <input type="text" class="form-control" list="datalistOptions" id="template" placeholder="Type to search...">
				  <datalist id="datalistOptions">
				  </datalist>
				  <label for="floatingInput">Selecciona y busca una platilla</label>
			  </div>

			  <!-- NOMBRE -->
			  <div class="form-floating mb-3">
				  <input type="text" required class="form-control" name="event" id="floatingInput" placeholder="Insegra un nombre">
				  <label for="floatingInput">Ingresa un nombre</label>
			  </div>
			  <!-- TIPO DE EVENTO -->
			  <div class="form-floating mb-3">
				  <select name="type" class="form-select" id="floatingSelect" aria-label="Floating label select example">
					  <option selected value="automatic">Automatico</option>
					  <option value="manual">Manual</option>
				  </select>
				  <label for="floatingSelect">Tipo de evento</label>
			  </div>
			  <!-- ID DE LA FUENTE -->
			  <div class="form-floating mb-3">
				  <input type="text" name="source_id" class="form-control disabled" id="source_id">
				  <label for="floatingInput">ID de la fuente</label>
			  </div>
			  <!-- IDE DEL EVENTO -->
			  <div class="form-floating mb-3">
				  <input name="event_id" type="text" class="form-control disabled" id="event_id">
				  <label for="floatingInput">ID del evento</label>
			  </div>
			  <!-- FUENTE -->
			  <div class="form-floating mb-3">
				  <input type="text" disabled class="form-control" id="source">
				  <label for="floatingInput">Fuente</label>
			  </div>
			  <div class="modal-footer">
				  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
				  <button type="submit" class="btn btn-primary">Enviar</button>
			  </div>
		  </form>
	  </div>
	</div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
<script src="assets/css/js/search.js"></script>
<script>
/* searchEvent({ */
/* componentEvent: "template", */
/* 	listOptions: "datalistOptions", */
/* 	search: "template", */
/* 	components: new Map([ */
/* 		["source_id","plugin_id"], */
/* 		["source","vendor"], */
/* 		["event_id","sid"] */
/* 	]), */
/* 	value: "name" */
/* }) */
searchEvent({
componentEvent: "template",
	listOptions: "datalistOptions",
	search: "template",
	components: new Map([
		["source_id","plugin_id"],
		["source","vendor"],
		["event_id","sid"]
	]),
	value: "name"
})
</script>
</script>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/e1/13041fe89261410d0353ec84abb48d128f4c7c
  Tamaño: 54        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293687    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.169592961 -0500
Modificación: 2023-06-24 08:01:49.706459510 -0500
      Cambio: 2023-10-20 16:46:06.646664701 -0500
    Creación: 2023-10-20 16:46:06.643331456 -0500
100644 blob 2fa4a95f4909b0ba34f5fb69a041e4dbd994d8c9	search.js
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/e2/22df3b1877efd3ae1266aed9f28cf79fec14b1
  Tamaño: 174       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293448    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.049594614 -0500
Modificación: 2023-10-18 16:45:38.140590360 -0500
      Cambio: 2023-10-20 16:46:06.536667600 -0500
    Creación: 2023-10-20 16:46:06.536667600 -0500
<?php
require_once("models/PropertieModel.php");
class PropertieController extends Controller{

	public $autosave = true;

	public function __construct(){
		parent::__construct();
		$this->model = new PropertieModel();
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/e2/752eb85b044cefa09933c1d92d49b280f9b9da
  Tamaño: 437       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293450    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.049594614 -0500
Modificación: 2023-10-16 17:33:29.758923413 -0500
      Cambio: 2023-10-20 16:46:06.536667600 -0500
    Creación: 2023-10-20 16:46:06.536667600 -0500
100644 blob 46141854b6c4aac2047018836b3340f5f62dd0c2	.htaccess
100644 blob da437ed708de7ea2d1ed5bb37dc51d00740740f6	Dockerfile
040000 tree dd6218d45158d9a2b0981c704e5c5c0d3130c418	assets
040000 tree ee84c1fda671963354e74a972bfc478930dd45c8	components
100644 blob 886fe19262e1dcc9bc5827b9b360744e6fe4cf58	config.php
040000 tree 4531288b596791d10f2177fa8493cf79bb86123c	controllers
100644 blob 8dadb53d86e692a9145d4db33bc19d31c3303116	data.sql
100644 blob 82c1b06cf8655c3159204f46dafb691aa3fe03c0	database.php
100644 blob 27dae4899dda3ef6df80d4bdc4ec9c52248ccb59	index.php
040000 tree d9cda7e6a6b7d896f14678d4a3d816ccd89bdb5e	models
100644 blob d9a4ec66dfeb45d52c58647f352aaaae6b84cd28	router.php
100644 blob b82cea160f9cfcea3268f5371dbfc4fff71c4b97	seeder.sql
040000 tree 000dcca5291b3482208f5e60169095097db50258	views
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/e2/9d14bb2db7aedf74297d203bbce70dafd4b31b
  Tamaño: 2123      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293449    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.049594614 -0500
Modificación: 2023-06-24 08:01:27.566460092 -0500
      Cambio: 2023-10-20 16:46:06.536667600 -0500
    Creación: 2023-10-20 16:46:06.536667600 -0500
<?php 
class Model{
	public $db;
	private $data;
	private $process_data;

	public function __construct($second_database = FALSE){
		$this->db=Connection::connect($second_database);
	}

	/* permite ejecutar consultas sql customizadas a cada modelo */
	/* 	retorna la informacion consultada o registrada */
	public function getCustom($sql,$param=0){
		$this->execute($sql,$this->table,$param);
		return $this->data;
	}

	/* toma todos los usuarios de la base de datos */
	/* 	retorna un lista con usuarios */
	/* puede recibir un array de nobres de tablas para generar una relacion de uno a muchos */
	public function getAll(){
		/* relacion de tablas */
		$sql = "SELECT *,$this->table.id as id_master FROM $this->table ";
		if(count($this->one_to_one)<>0){
			foreach($this->one_to_one as $join){
				$column = substr($join,0,-1) . "_id";
				$sql = $sql . "INNER JOIN $join ON $this->table.$column=$join.id ";
			}
		}
		/* ejecucion de query */
		$this->execute($sql,$this->table);
		return $this->data;
	}

	/* toma un usuario por id de la base de datos */
	/* 	retorna una lista con el usuario */
	public function selectById($id){
		$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
		//RELACION 1 A 1
		if(count($this->one_to_one)<>0){
			foreach($this->one_to_one as $join){
				$column = substr($join,0,-1) . "_id";
				$sql = $sql . "INNER JOIN $join ON $this->table.$column=$join.id ";
			}
		}
		$sql = $sql . "WHERE $this->table.id=:id";
		$this->execute($sql,$this->table,$id);
		//RELACION 1 A MUCHOS
		if(count($this->one_to_much)<>0){
			$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
			foreach(array_keys($this->one_to_much) as $join){
				$relation= $this->one_to_much[$join];//QUALIFIERS;
				$column_2 = substr($join,0,-1) . "_id"; //KRI_ID;
				$sql = $sql . "INNER JOIN $relation ON $join.id=$relation.$column_2 ";
				$sql = $sql . "WHERE $this->table.id=:id";
				$this->data["sql"]=$sql;
				$this->execute($sql,$relation,$id);
				$sql = str_replace("WHERE $this->table.id=:id","",$sql);
			}
		}
		//RELACION MUCHOS A MUCHOS
		if(count($this->much_to_much)<>0){
			$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
			foreach(array_keys($this->much_to_much) as $join){
				$relation= substr($this->much_to_much[$join],0,-1);
				$table_relation = substr($join,0,-1) . "_" . $relation;
				$column_1 = $relation . "_id";
				$column_2 = substr($join,0,-1) . "_id";
				$join_table = $this->much_to_much[$join];
				$sql = $sql . "INNER JOIN $table_relation ON $join.id=$table_relation.$column_2 ";
				$sql = $sql . "INNER JOIN $join_table ON $table_relation.$column_1=$join_table.id ";
				$sql = $sql . "WHERE $this->table.id=:id";
				$this->execute($sql,$join_table,$id);
				$sql = str_replace("WHERE $this->table.id=:id","",$sql);
			}
		}
		return $this->data;
	}

	/* inserta un registro a la base de datos con sus respectivas relaciones */
	/* 	retorna el id del elemento registrado */
	public function insert(){
		try{
			if(!$this->db->inTransaction()){
				$this->db->beginTransaction();
			}
			$columns = implode(",",$this->columns);
			$args = implode(",",$this->args);
			$sql = "INSERT INTO $this->table($columns) values($args)";
			$state = $this->db->prepare($sql);
			$this->setParams($state);
			$state->execute();
			$id = $this->db->lastInsertId();
			if(count($this->much_to_much)>0){
				foreach(array_keys($this->much_to_much) as $join){
					$relation= substr($this->much_to_much[$join],0,-1);//event
					$table_relation = substr($join,0,-1) . "_" . $relation;//kri_event
					$column_2 = substr($join,0,-1) . "_id";//kri_id
					$column_1 = $relation . "_id";//event_id
					$sql = "INSERT INTO $table_relation($column_1,$column_2) VALUES(:$column_1,:$column_2)";
					for($i=0;$i< count($_POST[$relation]);$i++){
						$state = $this->db->prepare($sql);
						$state->bindParam(":$column_1",$_POST[$relation][$i]);
						$state->bindParam(":$column_2",$id);
						$state->execute();
					}
				}

			}
			return $id;
		}catch(PDOException $e){
			echo $e->getMessage();
			$this->db->rollBack();
		}
	}

	/* modifica un elemento en la base de datos */
	/* 	retorna el ultimo in elemento de la tabla */
	public function update(){
		try{
			if(!$this->db->inTransaction()){
				$this->db->beginTransaction();
			}
			$prepare_sql = "";
			for($i=0;$i < count($this->args);$i++){
				if((count($this->args)-1)==$i){
					$prepare_sql = $prepare_sql . $this->columns[$i] . "=" . $this->args[$i];
				}else{
					$prepare_sql = $prepare_sql . $this->columns[$i] . "=" . $this->args[$i] . ",";
				}
			}
			$sql = "UPDATE $this->table set $prepare_sql WHERE id=:id";
			$state = $this->db->prepare($sql);
			$this->setParams($state);
			$state->bindParam(":id",$this->id);
			$state->execute();
			return $this->db->lastInsertId();
		}catch(PDOException $e){
			$this->db->rollBack();
		}
	}

	/* borra un elemento de la base de datos */
	/* 	no retorna informacion */
	public function delete($id){
		try{
			if(!$this->db->inTransaction()){
				$this->db->beginTransaction();
			}
			$sql = "DELETE FROM $this->table WHERE id=:id";
			$state = $this->db->prepare($sql);
			$state->bindParam(":id",$id);
			$state->execute();
		}catch(PDOException $e){
			$this->db->rollBack();
		}
	}

	/* busca elementos en la base de datos */
	/* 	retorna un array con los elementos encontrados */
	public function search($search){
		$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
		if(count($this->one_to_one)<>0){
			foreach($this->one_to_one as $join){
				$column = substr($join,0,-1) . "_id";
				$sql = $sql . "INNER JOIN $join ON $this->table.$column=$join.id ";
			}
		}
		$column = substr($this->table,0,-1);
		$sql=$sql . " WHERE $column LIKE '%$search%'";
		$this->execute($sql,$this->table);
		return $this->data;
	}

	/* escribe los cambios en la base de datos si el dml esta en una transaccion */
	/* 	no retorna informacion pero termina la transaccion actual */
	public function saveChanges(){
		$this->db->commit();
	}

	/* establece las variables de las consultas preparadas */
	/* 	no retorna informacion pero deja la consulta preparada lista para su ejecucion */
	private function setParams($state){
		for($i=0;$i < count($this->args);$i++){
			if($this->args[$i]==":password"){
				$password = password_hash($this->password,PASSWORD_BCRYPT);
				$state->bindParam($this->args[$i],$password);
			}else{
				$state->bindParam($this->args[$i],$this->{$this->columns[$i]});
			}
		}
	}

	/* ejecuta la consulta preparada */
	/* modifica la variable data adjuntando la informacion en esta variable */
	private function execute($sql,$key,$id=0){
		$state = $this->db->prepare($sql);
		if($id<>0){
			$state->bindParam(":id",$id);
		}
		if($state->execute()){
			while($row=$state->fetch(PDO::FETCH_ASSOC)){
				$this->process_data[]=$row;
			}
			$this->data[$key]=$this->process_data;
			$this->process_data=[];
		}
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/e4/cfa66a43780ef08ffbbed9999051a08ca6be8c
  Tamaño: 170       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293653    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.156259811 -0500
Modificación: 2023-06-12 07:27:41.874686096 -0500
      Cambio: 2023-10-20 16:46:06.633331719 -0500
    Creación: 2023-10-20 16:46:06.633331719 -0500
tree 3e63814567a93a8f386235f79383aa0364a3aae8
parent c046e77dec8f8548b2d3988bd00fcccc880fe757
author DragonyteEvol <acuarionevol@outlook.com> 1686572861 +0000
committer DragonyteEvol <acuarionevol@outlook.com> 1686572861 +0000

feat: update view
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/e5/ae2b993393e809756d4609d0ff2a23a307be1e
  Tamaño: 360       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293470    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.059594477 -0500
Modificación: 2023-10-16 16:47:27.996402298 -0500
      Cambio: 2023-10-20 16:46:06.546667337 -0500
    Creación: 2023-10-20 16:46:06.546667337 -0500
100644 blob 916405f23887474176f88d1c45f7fa7fdbcdd9e2	Controller.php
100644 blob 43b66da7c98ec0406611ebd66751eba7be411194	EventController.php
100644 blob 8fadc7a627eea16c36528f45d360b17d0cee6b5e	KriController.php
100644 blob ab88d0b50b2f02ca6a63488e849280128184eafb	LoginController.php
100644 blob 56b41c3c0b81d3e213654e2b64a9e8e43e0c8b30	PropertieController.php
100644 blob 12620ce4178e3b649067d4a02a366ef83bb8d47e	RegisterController.php
100644 blob 49aedabe24402bb06934d43ae75a8bfd21e9a880	RiskController.php
100644 blob 8c1bb57955e07f847b2b8e617e4db6218f8ced28	SourceController.php
100644 blob 07a9d2abeb523436c2863c3129e2c4f1fd26c654	TemplateController.php
100644 blob 9948526e371ec84f39ad45662721203603f6abf6	TypeController.php
100644 blob fb02603f5e1e778c1b626de544c3f0834532d3e1	UserController.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/e5/e9dd20b527b3d1ecc0ae70151f50b5803c41b0
  Tamaño: 437       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293469    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.059594477 -0500
Modificación: 2023-06-24 08:01:49.939792837 -0500
      Cambio: 2023-10-20 16:46:06.546667337 -0500
    Creación: 2023-10-20 16:46:06.546667337 -0500
100644 blob 46141854b6c4aac2047018836b3340f5f62dd0c2	.htaccess
100644 blob da437ed708de7ea2d1ed5bb37dc51d00740740f6	Dockerfile
040000 tree a3c245af4c9ef315b8ed5df7e7f1f775fd76b243	assets
040000 tree 0994b646c5cf6fe1259596f6e540c6055d0d4e1c	components
100644 blob 886fe19262e1dcc9bc5827b9b360744e6fe4cf58	config.php
040000 tree 3329768bb423a41c591994dd10004b955cd995aa	controllers
100644 blob 8dadb53d86e692a9145d4db33bc19d31c3303116	data.sql
100644 blob 82c1b06cf8655c3159204f46dafb691aa3fe03c0	database.php
100644 blob 27dae4899dda3ef6df80d4bdc4ec9c52248ccb59	index.php
040000 tree d34cedb25b0582d36473d68458496b397d49d338	models
100644 blob d9a4ec66dfeb45d52c58647f352aaaae6b84cd28	router.php
100644 blob dc9cfb9c2e93b41acbe9d8bcc6932aa67031e82d	seeder.sql
040000 tree 22d0529b836f7a825229a1712d4887fa03362824	views
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/e6/9de29bb2d1d6434b8b29ae775ad8c2e48c5391
  Tamaño: 15        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293500    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.079594201 -0500
Modificación: 2023-04-13 16:00:20.353748983 -0500
      Cambio: 2023-10-20 16:46:06.563333564 -0500
    Creación: 2023-10-20 16:46:06.560000319 -0500
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/e7/163dc73857b94aef2fd3bef6b5c904a4c4abb1
  Tamaño: 115       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293931    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.329590755 -0500
Modificación: 2023-05-14 07:37:26.522034178 -0500
      Cambio: 2023-10-20 16:46:06.773328030 -0500
    Creación: 2023-10-20 16:46:06.773328030 -0500
100644 blob e69de29bb2d1d6434b8b29ae775ad8c2e48c5391	create.php
100644 blob 1a2d0a5475f349943b7edba21a42333b1f1fc73d	index.php
100644 blob a304f375bdf785e19cc02369d54ea893fe1b9fc5	show.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/e7/4a82b92004eeed6e65f046e35653162b6e982c
  Tamaño: 54        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293928    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.329590755 -0500
Modificación: 2023-10-07 13:37:54.402799378 -0500
      Cambio: 2023-10-20 16:46:06.773328030 -0500
    Creación: 2023-10-20 16:46:06.773328030 -0500
100644 blob e798c63471dbf3fc2c2218d0c3cb306466375bf1	search.js
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/e7/771c87d4527ac5eff48b7797847c843d24a4a0
  Tamaño: 252       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293929    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.329590755 -0500
Modificación: 2023-10-07 12:37:25.873815094 -0500
      Cambio: 2023-10-20 16:46:06.773328030 -0500
    Creación: 2023-10-20 16:46:06.773328030 -0500
040000 tree 379ee99587344673b6d14dd4eed529953cf9b11d	event
040000 tree 40cf13e2e9105df27d498d6be62b4c67bbabfdd1	kri
040000 tree bf26cbec7b3a99878eea5fe64236fa8c6693da97	login
040000 tree 4f27caa9c5680f7c74a99a1cc1eb3911d428c67f	propertie
040000 tree 8494db4705a8620c9116e70e5f31fa4b042d135f	register
040000 tree b52e2a473825ac2719a6deeec6908576f3458f73	risk
040000 tree 2f47ccb2e200d0e41df57356190e2cc8bfd87708	type
040000 tree 51b4f483439170ce1f66b8dc07444e95bac424b7	user
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/e7/7dba7e36ef5f99bd55874141d89b923c8bd3b3
  Tamaño: 775       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293930    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.329590755 -0500
Modificación: 2023-03-23 13:20:08.675631069 -0500
      Cambio: 2023-10-20 16:46:06.773328030 -0500
    Creación: 2023-10-20 16:46:06.773328030 -0500
<?php 
class Model{
	private $db;
	private $data;

	public function __construct(){
		$this->db=Connection::connect();
		$this->data=array();
	}

	/* toma todos los usuarios de la base de datos */
	/* 	retorna un lista con usuarios */
	public function getUsers(){
		$sql = "SELECT * FROM $this->table";
		$state = $this->db->prepare($sql);
		if($state->execute()){
			while($row=$state->fetch(PDO::FETCH_ASSOC)){
				$this->data[]=$row;
			}
			return $this->data;
		}
	}


	/* toma un usuario por id de la base de datos */
	/* 	retorna una lista con el usuario */
	public function getUserById($id){
		$sql = "SELECT * FROM $this->table WHERE id=:id";
		$state = $this->db->prepare($sql);
		$state->bindParam(":id",$id);
		if($state->execute()){
			while($row=$state->fetch(PDO::FETCH_ASSOC)){
				$this->data[]=$row;
			}
			return $this->data;
		}
	}

	/* inserta un usuario en la base de datos */
	/* 	retorna el numero de id de el usuario registrado */
	public function insert(){
		$columns = implode(",",$this->columns);
		$args = implode(",",$this->args);
		$sql = "INSERT INTO $this->table($columns) values($args)";
		$state = $this->db->prepare($sql);
		$this->setParams($state);
		$state->execute();
		return $this->db->lastInsertId();
	}


	public function update(){
		$prepare_sql = "";
		for($i=0;$i < count($this->args);$i++){
			if((count($this->args)-1)==$i){
				$prepare_sql = $prepare_sql . $this->columns[$i] . "=" . $this->args[$i];
			}else{
				$prepare_sql = $prepare_sql . $this->columns[$i] . "=" . $this->args[$i] . ",";
			}
		}
		$sql = "UPDATE $this->table set $prepare_sql WHERE id=:id";
		$state = $this->db->prepare($sql);
		$this->setParams($state);
		$state->bindParam(":id",$this->id);
		echo "pedor". $this->id;
		$state->execute();
		return $this->db->lastInsertId();
	}

	private function setParams($state){
		for($i=0;$i < count($this->args);$i++){
			if($this->args[$i]==":password"){
				$password = password_hash($this->password,PASSWORD_BCRYPT);
				$state->bindParam($this->args[$i],$password);
			}else{
				$state->bindParam($this->args[$i],$this->{$this->columns[$i]});
			}
		}
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/e7/98c63471dbf3fc2c2218d0c3cb306466375bf1
  Tamaño: 1643      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293932    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.332924043 -0500
Modificación: 2023-10-07 13:37:49.696259233 -0500
      Cambio: 2023-10-20 16:46:06.773328030 -0500
    Creación: 2023-10-20 16:46:06.773328030 -0500
 // crea los eventos necesarios para una busqueda y sus consecuencias
// recibe como parametro de entra un json con la configuracion de la busqueda

// componenetEvent = El componente que recibira los eventos de cambio y keyup
// listOptions = la lista de opciones que se modificara cuando el servidor arroge respuesta
// searh = el nombre del modelo sin "controller" sobre el cual se realizara la busqueda
// componnets = el arreglo de componenetes que se quiere modificar cuando el evento arroje respuesta
// value = el valor que se quiere representar en la opcion de listOptions
	// EJEMPLO
// ({
// componentEvent: "template",
// 	listOptions: "datalistOptions",
// 	search: "template",
// 	components: new Map([
// 		["source_id","plugin_id"],
// 		["source","vendor"],
// 		["event_id","sid"]
// 	]),
// 	value: "name",
// 	table: "plugin_sid"
// })
function searchEvent(args){
	// Tomar los elementos pricipales de la busqueda
	var componentEvent = document.getElementById(args.componentEvent)
	var options = document.getElementById(args.listOptions)
	if(componentEvent==null){
		axios_get(args,options)
	}else{
		// evento de keyup y axios
		componentEvent.addEventListener('keyup',(e) =>{
			search = componentEvent.value;
			axios_get(args,options,search)
		})
		//evento de cambio
		componentEvent.addEventListener("change", (e)=>{
			for(var option of options.childNodes){
				if(option.value==componentEvent.value){
					for(c of args.components.keys()){
						var com = document.getElementById(c)
						com.value = option.attributes[c].value
					}
				}
			}

		})
	}
}

function axios_get(args,options,search=""){
	axios({
		method: "GET",
		url: "/"+args.search+"/search/" + (search.replace(" ","_"))
	}).then(res =>{
		console.log(res.data)
		options.innerHTML = ""
		select_options = ""
		for(var p of res.data[args.table]){
			select_options += "<"+args.tag+" "
			for(var pa of args.components){
				var val = pa[1]
				select_options += pa[0] + "='"+p[val]+"' "
			}
			var internalValue = args.value
			select_options += "value='"+p[internalValue]+"' class='"+args.class+"' onclick='"+args.customFunction+"({"
			for(var pa of args.components){
				var val = pa[1]
				select_options += pa[0] + ": "+ '"'+p[val]+'",'
			}
			select_options += "})'>"+p[internalValue]+"</"+args.tag+">"
		}
		options.innerHTML = select_options
	}).catch(e => {
		console.log("DEBUG:" + e)
	})
}

//-------------------------------------------------------------------------------
//Busca de forma asincrona en una tabla de base de datos para representarl la informacion consultada en una tabla
//resibe como entrada un argumento de tipo json de la siguiente forma:
//
/*{
componentevent: "search",
	listoptions: "kris",
	search: "kri",
	components: [
		"objective",
		"propertie",
		"percentage"
	],
	value: "kri",
	table: "kris",
}*/
//donde componentEvent es el cuadro de texto sobre el cual se realiza la busqueda
//listOptions es el cuerpo del elemento sobre el cual se van a mostrar los datos
//componenets es un array lista o elemeto iterable que contiene todos los datos a representar en la fila de informacion
//value es el campo principal del registro que generalmente es el nombre y que tiene un link asociado a el
//tabla es la tabla en base de datos sobre la cual se realizara la consulta
function searchTable(args){
	// Tomar los elementos pricipales de la busqueda
	var componentEvent = document.getElementById(args.componentEvent)
	var options = document.getElementById(args.listOptions)
	// evento de keyup y axios
	componentEvent.addEventListener('keyup',(e) =>{
		search = componentEvent.value;
		axios({
			method: "GET",
			url: "/"+args.search+"/search/" + (search.replace(" ","_"))
		}).then(res =>{
			var html = ""
			for(var p of res.data[args.table]){
				html+="<tr><th scope='row'>"+p.master_id+"</th>"
				html+="<td><a href='/"+args.value+"/show/"+p.master_id+"'>"+p[args.value]+"</a></td>"
				for(o of args.components){
					if(o=="score"){
						html+="<td><span class='badge text-bg-primary'>"+p[o]+"</span></td>"
					}else{
						html+="<td>"+p[o]+"</td>"
					}
				}
				html+="</tr>"
				options.innerHTML=html
			}
		}).catch(e => {
			console.log("DEBUG:" + e)
		})
	})
}
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/e7/b4164ff2349c065930802e765066958bcda685
  Tamaño: 191       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293933    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.332924043 -0500
Modificación: 2023-05-14 08:14:49.431975112 -0500
      Cambio: 2023-10-20 16:46:06.776661275 -0500
    Creación: 2023-10-20 16:46:06.776661275 -0500
040000 tree e7163dc73857b94aef2fd3bef6b5c904a4c4abb1	event
040000 tree 64bb9e326f281cd95fb75d48fcd34fb5e03091cf	kri
040000 tree bf26cbec7b3a99878eea5fe64236fa8c6693da97	login
040000 tree 8494db4705a8620c9116e70e5f31fa4b042d135f	register
040000 tree 3f996d487c0a5063b1b018a35ccab9e527738db6	risk
040000 tree 51b4f483439170ce1f66b8dc07444e95bac424b7	user
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/e8/1f05bbeda163e0e39501b8f78efcb7ca7ea64f
  Tamaño: 359       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293851    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.242925283 -0500
Modificación: 2023-10-08 19:55:10.970539802 -0500
      Cambio: 2023-10-20 16:46:06.716662857 -0500
    Creación: 2023-10-20 16:46:06.716662857 -0500
100644 blob 5fcc2bc439f2a2043f7e2104bb1f50d3f8d9935e	EventModel.php
100644 blob 5ddd49437dbda282e8e56f199a604c40734658fc	KriModel.php
100644 blob 246b016aa69ab4b6deddf8ad403b11770307d811	Model.php
100644 blob cf27b3beec50366ce112f05e7a070bf6cf045070	PropertieModel.php
100644 blob 2b7e2e2a08d9bfe6fc287d1eadf68a3ae2bef753	QualifierModel.php
100644 blob 3f36dc91c903e4be4239b127f4d48a9f11011911	RecordModel.php
100644 blob 730a24116f0181eadde3a5c5ca6e2d03d57ba8f7	RiskModel.php
100644 blob 05d7d4d8f9670e0e5b2c24fe3469c804e2f0f4b4	SourceModel.php
100644 blob 94c0b90d03c95b7e9484842795b32a9d4a3eacb3	TemplateModel.php
100644 blob 95085117329d973fd6c36029b44293bcedd69742	TypeModel.php
100644 blob 98bcd9d15ece27bab02c81584e6e0b10ed3cfd21	UserModel.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/e8/4f4a94a8e57fb3cf003f895465e525249203d6
  Tamaño: 1583      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293850    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.242925283 -0500
Modificación: 2023-05-14 07:33:53.885373117 -0500
      Cambio: 2023-10-20 16:46:06.716662857 -0500
    Creación: 2023-10-20 16:46:06.716662857 -0500
<?php 
class Model{
	public $db;
	private $data;
	private $process_data;

	public function __construct($second_database = FALSE){
		$this->db=Connection::connect($second_database);
	}

	public function getCustom($sql,$param=0){
		$this->execute($sql,$this->table,$param);
		return $this->data;
	}

	/* toma todos los usuarios de la base de datos */
	/* 	retorna un lista con usuarios */
	/* puede recibir un array de nobres de tablas para generar una relacion de uno a muchos */
	public function getAll(){
		/* relacion de tablas */
		$sql = "SELECT *,$this->table.id as id_master FROM $this->table ";
		if(count($this->relations)<>0){
			foreach($this->relations as $join){
				$column = substr($join,0,-1) . "_id";
				$sql = $sql . "INNER JOIN $join ON $this->table.$column=$join.id ";
			}
		}
		/* ejecucion de query */
		$this->execute($sql,$this->table);
		return $this->data;
	}

	/* toma un usuario por id de la base de datos */
	/* 	retorna una lista con el usuario */

	public function selectById($id){
		$sql = "SELECT *,$this->table.id as master_id FROM $this->table WHERE $this->table.id=:id";
		$this->execute($sql,$this->table,$id);
		if(count($this->much_to_much)<>0){
			$sql = "SELECT *,$this->table.id as master_id FROM $this->table ";
			foreach(array_keys($this->much_to_much) as $join){
				$relation= substr($this->much_to_much[$join],0,-1);
				$table_relation = substr($join,0,-1) . "_" . $relation;
				$column_1 = $relation . "_id";
				$column_2 = substr($join,0,-1) . "_id";
				$join_table = $this->much_to_much[$join];
				$sql = $sql . "INNER JOIN $table_relation ON $join.id=$table_relation.$column_2 ";
				$sql = $sql . "INNER JOIN $join_table ON $table_relation.$column_1=$join_table.id ";
				$sql = $sql . "WHERE $this->table.id=:id";
				$this->execute($sql,$join_table,$id);
				$sql = str_replace("WHERE $this->table.id=:id","",$sql);
			}
		}
		return $this->data;
	}

	public function insert(){
		try{
			if(!$this->db->inTransaction()){
				$this->db->beginTransaction();
			}
			$columns = implode(",",$this->columns);
			$args = implode(",",$this->args);
			$sql = "INSERT INTO $this->table($columns) values($args)";
			$state = $this->db->prepare($sql);
			$this->setParams($state);
			$state->execute();
			$id = $this->db->lastInsertId();
			if(count($this->much_to_much)>0){
				foreach(array_keys($this->much_to_much) as $join){
					$relation= substr($this->much_to_much[$join],0,-1);//event
					$table_relation = substr($join,0,-1) . "_" . $relation;//kri_event
					$column_2 = substr($join,0,-1) . "_id";//kri_id
					$column_1 = $relation . "_id";//event_id
					$sql = "INSERT INTO $table_relation($column_1,$column_2) VALUES(:$column_1,:$column_2)";
					for($i=0;$i< count($_POST[$relation]);$i++){
						$state = $this->db->prepare($sql);
						$state->bindParam(":$column_1",$_POST[$relation][$i]);
						$state->bindParam(":$column_2",$id);
						$state->execute();
					}
				}

			}
			return $id;
		}catch(PDOException $e){
			echo $e->getMessage();
			$this->db->rollBack();
		}
	}

	public function update(){
		try{
			if(!$this->db->inTransaction()){
				$this->db->beginTransaction();
			}
			$prepare_sql = "";
			for($i=0;$i < count($this->args);$i++){
				if((count($this->args)-1)==$i){
					$prepare_sql = $prepare_sql . $this->columns[$i] . "=" . $this->args[$i];
				}else{
					$prepare_sql = $prepare_sql . $this->columns[$i] . "=" . $this->args[$i] . ",";
				}
			}
			$sql = "UPDATE $this->table set $prepare_sql WHERE id=:id";
			$state = $this->db->prepare($sql);
			$this->setParams($state);
			$state->bindParam(":id",$this->id);
			$state->execute();
			return $this->db->lastInsertId();
		}catch(PDOException $e){
			$this->db->rollBack();
		}
	}

	public function delete($id){
		try{
			if(!$this->db->inTransaction()){
				$this->db->beginTransaction();
			}
			$sql = "DELETE FROM $this->table WHERE id=:id";
			$state = $this->db->prepare($sql);
			$state->bindParam(":id",$id);
			$state->execute();
		}catch(PDOException $e){
			$this->db->rollBack();
		}
	}

	public function search($search){
		$column = substr($this->table,0,-1);
		$sql = "SELECT * FROM $this->table WHERE $column LIKE '%$search%'";
		$this->execute($sql,$this->table);
		return $this->data;
	}

	public function saveChanges(){
		$this->db->commit();
	}

	private function setParams($state){
		for($i=0;$i < count($this->args);$i++){
			if($this->args[$i]==":password"){
				$password = password_hash($this->password,PASSWORD_BCRYPT);
				$state->bindParam($this->args[$i],$password);
			}else{
				$state->bindParam($this->args[$i],$this->{$this->columns[$i]});
			}
		}
	}

	private function execute($sql,$key,$id=0){
		$state = $this->db->prepare($sql);
		if($id<>0){
			$state->bindParam(":id",$id);
		}
		if($state->execute()){
			while($row=$state->fetch(PDO::FETCH_ASSOC)){
				$this->process_data[]=$row;
			}
			$this->data[$key]=$this->process_data;
			$this->process_data=[];
		}
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/ea/798c332d7a4925b373b75e6d99fc951c80fc0b
  Tamaño: 58        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293818    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.229592133 -0500
Modificación: 2023-03-16 15:57:44.938394760 -0500
      Cambio: 2023-10-20 16:46:06.703329875 -0500
    Creación: 2023-10-20 16:46:06.703329875 -0500
100644 blob 8c0ed5853a4e83a0647c777c0bdba5db22dbd7b4	UserModel.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/ea/fe13d3607c0e02c8d4c6ed9f30f268234fe113
  Tamaño: 2432      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293819    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.229592133 -0500
Modificación: 2023-10-18 16:45:38.183922511 -0500
      Cambio: 2023-10-20 16:46:06.703329875 -0500
    Creación: 2023-10-20 16:46:06.703329875 -0500
<?php  
include_once("components/header.php");
var_dump($data);
?>
<div class="container">
	<!-- ----------------------------------- -->
	<?php foreach($data["risks"] as $risk): ?>
	<div class="card">
		<form action="/risk/update/<?= $risk['master_id'] ?>" method="POST" class="needs-validation">
			<div class="row">
				<div class="col-xl-4 col-lg-6 mb-4">
					<div class="bg-white rounded-lg p-5 shadow">
						<h2 class="h6 font-weight-bold text-center mb-4">Valoración del Riesgo</h2>
						<!-- Progress bar 1 -->
						<div class="progress" role="progressbar" aria-label="Example with label" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">
							<div class="progress-bar" style="width: 25%">Bajo</div>
						</div>
						<!-- END -->

						<!-- Demo info -->
						<div class="row text-center mt-4">
							<div class="col-6 border-right">
								<div class="h4 font-weight-bold mb-0"><?= $data['score'] ?> P.</div><span class="small text-gray">Puntaje calculado</span>
							</div>
							<div class="col-6">
								<div class="h4 font-weight-bold mb-0"><?= $data["score_qualified"]["value"] ?></div><span class="small text-gray"><?= $data["score_qualified"]["type"] ?></span>
							</div>
						</div>
						<!-- END -->
					</div>
				</div>
				<div class="col-xl-8 col-lg-8 mb-8">
					<div class="bg-white rounded-lg p-5 shadow">
						<h2 class="h6 font-weight-bold text-center mb-4">Mapa relacional</h2>
						<div class="row align-items-center my-2">
							<div class="col-4">
								<button class="btn btn-outline-dark btn-sm form-control">
									<?= $risk["risk"] ?>
								</button>
							</div>
							<div class="col-4">
								<?php  foreach($data["kris"] as $kri): ?>
								<button class="btn btn-outline-dark btn-sm form-control my-2" data-bs-toggle="popover" data-bs-title="Descripcion del evento" data-bs-content="">
									<?= $kri["kri"]?>
								</button>
								<?php  endforeach; ?>
							</div>
							<div class="col-4">
								<?php  foreach($data["events"] as $event): ?>
								<button class="btn btn-outline-dark btn-sm form-control my-2" data-bs-toggle="popover" data-bs-title="Descripcion del evento" data-bs-content="">
									<?= $event["event"]?>
								</button>
								<?php  endforeach; ?>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- PRIMERA FILA -->
			<div class="card-header">
				<h5><b><?=$risk['master_id']?> | </b><?=$risk['risk']?></h5>
			</div>
			<div class="card-body">
				<!-- KRI -->
				<div class="form-floating mb-3">
					<input type="text" value="<?= $risk['risk'] ?>" required class="form-control" name="risk" id="floatingInput" placeholder="Insegra un nombre">
					<label for="floatingInput">Nombre del riesgo</label>
				</div>
				<div class="row">
					<div class="col-6">
						<!-- PROPIEDAD -->
						<div class="form-floating mb-3">
							<select name="propertie_id" class="form-select" id="datalistOptionsProperty" aria-label="">
							</select>
							<label for="floatingSelect">Propiedad</label>
						</div>
					</div>
					<div class="col-6">
						<!-- TIPO -->
						<div class="form-floating mb-3">
							<select name="type_id" class="form-select" id="datalistOptionsType" aria-label="">
							</select>
							<label for="floatingSelect">Tipo</label>
						</div>
					</div>
				</div>
				<div class="accordion accordion-flush" id="accordionFlushExample">
					<!-- KRI -->
					<div class="accordion-item">
						<h2 class="accordion-header">
							<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#event-collapse" aria-expanded="false" aria-controls="flush-collapseOne">
								KRIs	
							</button>
						</h2>
						<div id="event-collapse" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
							<div class="my-2">
								<button name="events" type="button" class="form-control btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addKri">
									Añadir KRI
								</button>
								<div class="form-check" id="kris"> 
									<?php  foreach($data["kris"] as $kri): ?>
									<div>
										<input type="checkbox" name="kri[]" value="<?= $kri['id'] ?>" class="btn-check" id="<?= $kri['kri'] ?>" autocomplete="off" checked>
										<label class="btn btn-sm btn-outline-danger my-2 form-control" for="<?= $kri['kri'] ?>"><?= $kri['kri'] ?> <span class="badge bg-secondary"><?= $kri['percentage'] ?>%</span></label>
									</div>
									<?php  endforeach; ?>
								</div>
							</div>
						</div>
					</div>
					<?php  endforeach; ?>
				</div>
				<div class="card-footer">
					<!-- END FIELD -->
					<div class="row">
						<div class="col-6">
							<button type="reset" class="btn btn-outline-secondary form-control">Limpiar</button>
						</div>
						<div class="col-6">
							<button type="submit" class="btn btn-primary form-control">Actualizar</button>
						</div>
					</div>
		</form>
				</div>
			</div>
			<!-- FORMULARIO DE ADICION DE KRIS -->
			<div class="modal fade" id="addKri" tabindex="-1" aria-labelledby="addKriLabel" aria-hidden="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h1 class="modal-title fs-5" id="addKriLabel">Buscar Evento</h1>
							<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
						</div>
						<div class="modal-body">
							<div class="form-floating mb-3">
								<input type="text" required class="form-control" id="searchKRI" placeholder="Insegra un nombre">
								<label for="floatingInput">Buscar evento</label>
							</div>
							<div class="justify-content-center" id="datalistOptionsKRI">
							</div>
						</div>
					</div>
				</div>
			</div>
	</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
<script src="/assets/js/search.js"></script>
<script>
	function customFunction(e){
		console.log(e)
		kris = document.getElementById("kris")
		html = kris.innerHTML
		html += "<div><input name='kri[]' value='"+e.id+"' type='checkbox' class='btn-check' id='"+e.kri+"' autocomplete='off' checked><label class='btn btn-sm btn-outline-danger my-2 form-control' for='"+e.kri+"'>"+e.kri+" <span class='badge bg-secondary'>"+e.percentage+"%</span></label></div>"
		kris.innerHTML = html
		modal = document.getElementById("addKri")
		modal.hide()
	}
	//EVENTOS
	searchEvent({
		componentEvent: "searchKRI",
		listOptions: "datalistOptionsKRI",
		search: "kri",
		components: new Map([
			["id","master_id"],
			["kri","kri"],
			["percentage","percentage"]
		]),
		value: "kri",
		table: "kris",
		tag: "button",
		customFunction: "customFunction",
		class: "btn btn-outline-primary form-control m-2' data-bs-dismiss='modal",
	})
	//PROPERTIES
	searchEvent({
		listOptions: "datalistOptionsProperty",
		search: "propertie",
		components: new Map([
			["value","id"]
		]),
		value: "propertie",
		table: "properties",
		tag: "option"
	})
	//TYPES
	searchEvent({
		listOptions: "datalistOptionsType",
		search: "type",
		components: new Map([
			["value","id"]
		]),
		value: "type",
		table: "types",
		tag: "option"
	})
</script>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/eb/0f19e0d5d94c25e293bbc27cf8e48b233322f9
  Tamaño: 136       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293883    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.306257743 -0500
Modificación: 2023-03-01 15:27:34.892807428 -0500
      Cambio: 2023-10-20 16:46:06.733329084 -0500
    Creación: 2023-10-20 16:46:06.733329084 -0500
tree a1898242470f4afb2306690ead8fd07775ac4e1f
author DragonyteEvol <acuarionevol@outlook.com> 1677702454 +0000
committer DragonyteEvol <acuarionevol@outlook.com> 1677702454 +0000

alpha dream
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/eb/80b910725f6fedef9abb25fa52368623ff15c1
  Tamaño: 405       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293884    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.306257743 -0500
Modificación: 2023-03-28 17:22:24.381311179 -0500
      Cambio: 2023-10-20 16:46:06.733329084 -0500
    Creación: 2023-10-20 16:46:06.733329084 -0500
100644 blob 6d6439aba4747c1cef248b31d8b285cea7edaec4	.htaccess
100644 blob da437ed708de7ea2d1ed5bb37dc51d00740740f6	Dockerfile
040000 tree 0d92498866d4f8052aa2042686156a488dbc030e	assets
040000 tree 9c4a38e4261dc3f0ad3cb12e32ec9b1eaa1b8d09	components
100644 blob fc5c9dceab7ea6a3e92e9e475208d3d4a4402846	config.php
040000 tree 8949a5ae499c81ef2ce2fb9336af3a0b5ee227de	controllers
100644 blob 8dadb53d86e692a9145d4db33bc19d31c3303116	data.sql
100644 blob 82c1b06cf8655c3159204f46dafb691aa3fe03c0	database.php
100644 blob 27dae4899dda3ef6df80d4bdc4ec9c52248ccb59	index.php
040000 tree ed4fdaf36b446955120b7155ddd5a92c849a8907	models
100644 blob 30cca64a0adebfcd8627b0ae4cd71f260a04b1d0	router.php
040000 tree 35ba8647a01b93a9470941f4276df9afa68f334e	views
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/ec/6972a4e4b0a2325c44ca8e11d0f43be31ff4bc
  Tamaño: 521       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293833    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.236258708 -0500
Modificación: 2023-03-09 13:43:50.275762584 -0500
      Cambio: 2023-10-20 16:46:06.709996366 -0500
    Creación: 2023-10-20 16:46:06.709996366 -0500
<?php 
class UserModel{
	private $db;
	private $users;

	public function __construct(){
		require_once("database.php");
		$this->db=Connection::connect();
		$this->users=array();
	}

	public function getUsers(){
		$sql = "SELECT * FROM users;";
		$state = $this->db->prepare($sql);
		if($state->execute()){
			while($row=$state->fetch(PDO::FETCH_ASSOC)){
				$this->users[]=$row;
			}
			return $this->users;
		}
	}
}
/* if(!empty($_POST["email"]) && !empty($_POST["password"]) && !empty($_POST["name"])){ */
/* 	$sql = "INSERT INTO users(name,email,password) values(:name,:email,:password)"; */
/* 	$state = $conn->prepare($sql); */
/* 	$state->bindParam(":name",$_POST["name"]); */
/* 	$state->bindParam(":email",$_POST["email"]); */
/* 	$password = password_hash($_POST["password"],PASSWORD_BCRYPT); */
/* 	$state->bindParam(":password",$password); */
/* 	if($state->execute()){ */
/* 		$message = "Succesfully created new user"; */
/* 	}else{ */
/* 		$message = "Sorry, We cant create the user"; */
/* 	} */
/* } */
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/ec/c8de047fcd81f87dbe5154a3eb4eb70a1c1c8c
  Tamaño: 283       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293832    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.236258708 -0500
Modificación: 2023-03-16 15:57:33.071727880 -0500
      Cambio: 2023-10-20 16:46:06.709996366 -0500
    Creación: 2023-10-20 16:46:06.706663120 -0500
<?php
require_once("models/UserModel.php");
class UserController{
	private $model;

	public function __construct(){
		$this->model = new UserModel();
	}
	public function index(){
		$data=$this->model->getUsers();
		var_dump($data);
	}

	public function show(){
		$data=$this->model->getUserById(2);
		var_dump($data);
	}

	/* index - lista todos los elementos */
	/* show - muestra un elemento por su id */
	/* create - crea un elemento */
	/* update - modifica un elemento */
	/* delete - borra un elemento */
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/ec/f8f46cfad0e4507c5dfe2f10a592c1afe9bb35
  Tamaño: 349       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293834    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.236258708 -0500
Modificación: 2023-05-18 14:54:53.481962622 -0500
      Cambio: 2023-10-20 16:46:06.709996366 -0500
    Creación: 2023-10-20 16:46:06.709996366 -0500
<?php
require_once("models/KriModel.php");
require_once("models/QualifierModel.php");
class KriController extends Controller{

	public $autosave = false;

	public function __construct(){
		parent::__construct();
		/* modelos */
		$this->model = new KriModel();
		$this->qualifier_model = new QualifierModel();
	}

	/* inserta un kri en base de datos y sus calificadores */
	/* 	retorna una redireccion al index de kri */
	public function insert(){
		$this->modelParams();
		$id = $this->model->insert();
		$this->qualifier_model->insertQualifiers($id,$this->model->db);
		$this->model->saveChanges();
		header("Location: /$this->controller");
	}

}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/ed/4fdaf36b446955120b7155ddd5a92c849a8907
  Tamaño: 328       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293848    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.242925283 -0500
Modificación: 2023-03-28 17:22:24.331311181 -0500
      Cambio: 2023-10-20 16:46:06.716662857 -0500
    Creación: 2023-10-20 16:46:06.716662857 -0500
100644 blob 34dcbd5666a9705354669066f464e69bdd63f1f5	EventModel.php
100644 blob b3c9286a163b4b0860a0fb6bf721ff41da998359	KriModel.php
100644 blob 03ff85d3fd9304ea946de68fb0ad15f65fb2b607	Model.php
100644 blob cf27b3beec50366ce112f05e7a070bf6cf045070	PropertieModel.php
100644 blob efa9faad575764b049d5e235a17f25c991dd5a2d	QualifierModel.php
100644 blob 3f36dc91c903e4be4239b127f4d48a9f11011911	RecordModel.php
100644 blob dd7c5504be6a44771008fd24ebe0dd6c0dc999aa	RiskModel.php
100644 blob 6320883040fcc985f2ac32c5aa844826a093d35d	SourceModel.php
100644 blob 95085117329d973fd6c36029b44293bcedd69742	TypeModel.php
100644 blob 98bcd9d15ece27bab02c81584e6e0b10ed3cfd21	UserModel.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/ee/0167b87622e62a458b69dfe977561d4250c004
  Tamaño: 163       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293739    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.196259259 -0500
Modificación: 2023-03-30 15:50:29.587642372 -0500
      Cambio: 2023-10-20 16:46:06.669997419 -0500
    Creación: 2023-10-20 16:46:06.669997419 -0500
tree 338f08711752934ac7796d89008e8601848ba04b
parent 5dcce7af4cfc3edba4fbcf6e1c7f70959382404a
author DragonyteEvol <acuarionevol@outlook.com> 1680209429 +0000
committer DragonyteEvol <acuarionevol@outlook.com> 1680209429 +0000

seeder
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/ee/06d43b65d5e5df0c182c099e95ea2f00eaf2e1
  Tamaño: 387       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293740    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.196259259 -0500
Modificación: 2023-02-24 01:39:28.994068615 -0500
      Cambio: 2023-10-20 16:46:06.669997419 -0500
    Creación: 2023-10-20 16:46:06.669997419 -0500
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Login</title>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>
	<?php require("components/header.php")  ?>
	<h1>Login</h1>
	<form action="login.php" method="POST">
		<input type="text" name="email" placeholder="enter your email">
		<input type="password" name="password" placeholder="enter your password">
		<input type="submit" value="Send">
	</form>
</body>
</html>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/ee/84c1fda671963354e74a972bfc478930dd45c8
  Tamaño: 54        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293738    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.192925972 -0500
Modificación: 2023-10-14 17:45:49.208989931 -0500
      Cambio: 2023-10-20 16:46:06.666664174 -0500
    Creación: 2023-10-20 16:46:06.666664174 -0500
100644 blob 19b02a0196c7f2006ced697a2c220cd35c80791d	header.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/ef/a9648e148a5040e3f1dc1466a9603935db2b25
  Tamaño: 84        	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293959    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.362923628 -0500
Modificación: 2023-03-09 13:44:00.559096102 -0500
      Cambio: 2023-10-20 16:46:06.789994257 -0500
    Creación: 2023-10-20 16:46:06.789994257 -0500
100644 blob 2d76721c290a256bc1563cd8805ab40cbb847e66	login.php
100644 blob b39c25f566b37f522483a453100653f3ae7b3ad9	signup.php
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/ef/a9faad575764b049d5e235a17f25c991dd5a2d
  Tamaño: 175       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293960    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.366256917 -0500
Modificación: 2023-03-28 17:22:06.607978311 -0500
      Cambio: 2023-10-20 16:46:06.789994257 -0500
    Creación: 2023-10-20 16:46:06.789994257 -0500
<?php 
class QualifierModel extends Model{
	protected $table = "qualifiers";
	protected $columns = ["type","value","kri_id"];
	protected $args= [":type",":value",":kri_id"];

	public function __construct(){
		parent::__construct();
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/f0/884e35b716d60b93b38a60c1e8868a6f6f9cea
  Tamaño: 251       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293720    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.186259398 -0500
Modificación: 2023-07-30 06:50:23.041667217 -0500
      Cambio: 2023-10-20 16:46:06.656664437 -0500
    Creación: 2023-10-20 16:46:06.656664437 -0500
040000 tree 89db20e052349da0522caad9fc862a4b611216e3	event
040000 tree 40cf13e2e9105df27d498d6be62b4c67bbabfdd1	kri
040000 tree bf26cbec7b3a99878eea5fe64236fa8c6693da97	login
040000 tree 4f27caa9c5680f7c74a99a1cc1eb3911d428c67f	propertie
040000 tree 8494db4705a8620c9116e70e5f31fa4b042d135f	register
040000 tree b52e2a473825ac2719a6deeec6908576f3458f73	risk
040000 tree 2f47ccb2e200d0e41df57356190e2cc8bfd87708	type
040000 tree 51b4f483439170ce1f66b8dc07444e95bac424b7	user
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/f0/eb5f89aa31e90b7e9053415fef8096016728bf
  Tamaño: 219       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293721    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.186259398 -0500
Modificación: 2023-03-23 13:20:08.675631069 -0500
      Cambio: 2023-10-20 16:46:06.656664437 -0500
    Creación: 2023-10-20 16:46:06.656664437 -0500
<?php
require_once("database.php");
require("models/Model.php");
/* var_dump($_GET); */
$controller = $_GET["controller"];
$action = $_GET["action"];
$id = $_GET["id"];

if(empty($action)){
	$action = "index";
}
$controller = ucfirst($controller) . "Controller";
include "controllers/$controller.php";
$ctrl = new $controller;
$ctrl->{$action}();
?>

---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/f1/562673fb0c495c4bdf7a70a6c59f834216445c
  Tamaño: 706       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293789    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.216258984 -0500
Modificación: 2023-10-17 15:55:29.933205726 -0500
      Cambio: 2023-10-20 16:46:06.689996892 -0500
    Creación: 2023-10-20 16:46:06.689996892 -0500
<?php 
class QualifierModel extends Model{
	protected $table = "qualifiers";
	protected $columns = ["type","value","kri_id"];
	protected $args= [":type",":value",":kri_id"];

	public function __construct(){
		parent::__construct();
	}

	/* realciona un puntaje con el valor de un calificador */
	/* recibe el id del kri y el puntaje a relacionar */
	/* retorna una lista con el typo de calificador y su valor ej. Alto,45 */
	public function getQualifierScore($kri_id,$score){
		$sql = "SELECT * FROM $this->table WHERE kri_id=$kri_id AND value >=$score ORDER BY value LIMIT 1";
	 	$this->getCustom($sql,"score_qualified");
		$type = ($this->data["qualifiers"][0]["type"]);
		$value = ($this->data["qualifiers"][0]["value"]);
		return ["type"=>$type,"value"=>$value];
	}

	/* inserta los calificadores de un kri */
	/* recibe el id del kri y la conexion con base de datos para continuar la transaccion */
	/* no retorna informacion */
	public function insertQualifiers($kri_id,$db){
		$this->db = $db;
		$this->kri_id=$kri_id;
		for($i=0;$i < count($_POST["qualifier"]);$i++){
			$this->type=$_POST["qualifier"][$i];
			$this->value=$_POST["qualifier_value"][$i];
			$this->insert();
		}
	}

	//Actualiza los calificadores de un kri los borra y los recrea
	//no retorna informacion
	//recibe el id del kri y la conexion con base de datos para continuar la transaccion
	public function updateQualifiers($kri_id,$db){
		$this->db = $db;
		$sql = "DELETE FROM $this->table WHERE kri_id=:id";
		$state = $this->db->prepare($sql);
		$state->bindParam(":id",$kri_id);
		$state->execute();
		$this->insertQualifiers($kri_id,$db);
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/f1/981ec9a329fa949247d4e820570503dbc2c090
  Tamaño: 1644      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293790    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.219592271 -0500
Modificación: 2023-10-17 16:44:09.867769344 -0500
      Cambio: 2023-10-20 16:46:06.689996892 -0500
    Creación: 2023-10-20 16:46:06.689996892 -0500
<?php  
include_once("components/header.php");
?>
<div class="container">
	<!-- ----------------------------------- -->
	<div class="card">
		<form action="/risk/insert" method="POST" class="needs-validation">
			<!-- PRIMERA FILA -->
			<div class="card-header">
				<h5>Crear Riesgo</h5>
			</div>
			<div class="card-body">
				<!-- KRI -->
				<div class="form-floating mb-3">
					<input type="text" required class="form-control" name="risk" id="floatingInput" placeholder="Insegra un nombre">
					<label for="floatingInput">Nombre del riesgo</label>
				</div>
				<div class="row">
					<div class="col-6">
						<!-- PROPIEDAD -->
						<div class="form-floating mb-3">
							<select name="propertie_id" class="form-select" id="datalistOptionsProperty" aria-label="">
							</select>
							<label for="floatingSelect">Propiedad</label>
						</div>
					</div>
					<div class="col-6">
						<!-- TIPO -->
						<div class="form-floating mb-3">
							<select name="type_id" class="form-select" id="datalistOptionsType" aria-label="">
							</select>
							<label for="floatingSelect">Tipo</label>
						</div>
					</div>
				</div>
				<div class="accordion accordion-flush" id="accordionFlushExample">
					<!-- KRI -->
					<div class="accordion-item">
						<h2 class="accordion-header">
							<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#event-collapse" aria-expanded="false" aria-controls="flush-collapseOne">
								KRIs	
							</button>
						</h2>
						<div id="event-collapse" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
							<div class="my-2">
								<button name="events" type="button" class="form-control btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addKri">
									Añadir KRI
								</button>
								<div class="form-check" id="kris"> 
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="card-footer">
					<!-- END FIELD -->
					<div class="row">
						<div class="col-6">
							<button type="reset" class="btn btn-outline-secondary form-control">Limpiar</button>
						</div>
						<div class="col-6">
							<button type="submit" class="btn btn-primary form-control">Enviar</button>
						</div>
					</div>
		</form>
				</div>
			</div>
			<!-- FORMULARIO DE ADICION DE KRIS -->
			<div class="modal fade" id="addKri" tabindex="-1" aria-labelledby="addKriLabel" aria-hidden="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h1 class="modal-title fs-5" id="addKriLabel">Buscar Evento</h1>
							<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
						</div>
						<div class="modal-body">
							<div class="form-floating mb-3">
								<input type="text" required class="form-control" id="searchKRI" placeholder="Insegra un nombre">
								<label for="floatingInput">Buscar evento</label>
							</div>
							<div class="justify-content-center" id="datalistOptionsKRI">
							</div>
						</div>
					</div>
				</div>
			</div>
	</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
<script src="/assets/js/search.js"></script>
<script>
	function customFunction(e){
		console.log(e)
		kris = document.getElementById("kris")
		html = kris.innerHTML
		html += "<div><input name='kri[]' value='"+e.id+"' type='checkbox' class='btn-check' id='"+e.kri+"' autocomplete='off' checked><label class='btn btn-sm btn-outline-danger my-2 form-control' for='"+e.kri+"'>"+e.kri+" <span class='badge bg-secondary'>"+e.percentage+"%</span></label></div>"
		kris.innerHTML = html
		modal = document.getElementById("addKri")
		modal.hide()
	}
	//EVENTOS
	searchEvent({
		componentEvent: "searchKRI",
		listOptions: "datalistOptionsKRI",
		search: "kri",
		components: new Map([
			["id","master_id"],
			["kri","kri"],
			["percentage","percentage"]
		]),
		value: "kri",
		table: "kris",
		tag: "button",
		customFunction: "customFunction",
		class: "btn btn-outline-primary form-control m-2' data-bs-dismiss='modal",
	})
	//PROPERTIES
	searchEvent({
		listOptions: "datalistOptionsProperty",
		search: "propertie",
		components: new Map([
			["value","id"]
		]),
		value: "propertie",
		table: "properties",
		tag: "option"
	})
	//TYPES
	searchEvent({
		listOptions: "datalistOptionsType",
		search: "type",
		components: new Map([
			["value","id"]
		]),
		value: "type",
		table: "types",
		tag: "option"
	})
</script>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/f1/e45e6403b94eee9c4566b08b8733949eb4658d
  Tamaño: 221       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293791    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.219592271 -0500
Modificación: 2023-05-14 07:37:26.762034173 -0500
      Cambio: 2023-10-20 16:46:06.689996892 -0500
    Creación: 2023-10-20 16:46:06.689996892 -0500
tree 6024df72a5b90f682353b1268b652a837ec9fc26
parent cb8348ef0beb3185e6c2441d67b11ee3dd20ceb8
author DragonyteEvol <acuarionevol@outlook.com> 1684067846 +0000
committer DragonyteEvol <acuarionevol@outlook.com> 1684067846 +0000

refactor: database transaction on dml

modificacion de conexion y modelo dml para gestion de transacciones
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/f2/3d45901fe22a0ccdb21bfc95f1a231bd06a2bc
  Tamaño: 195       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293664    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.159593098 -0500
Modificación: 2023-02-24 01:39:28.880735281 -0500
      Cambio: 2023-10-20 16:46:06.636664965 -0500
    Creación: 2023-10-20 16:46:06.636664965 -0500
<?php
	$server = "mysql";
	$username = "root";
	$password = "1234";
	$database = "csra";

	try{
		$conn = new PDO("mysql:host=$server;dbname=$database",$username,$password);
	}catch(PDOException $e){
		die("Connection Failed: " . $e->getMessage());
	}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/f4/c57c999b6b5ffebe3bfab3989f0c379c3ba691
  Tamaño: 259       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293856    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.246258570 -0500
Modificación: 2023-03-23 13:20:08.658964402 -0500
      Cambio: 2023-10-20 16:46:06.719996103 -0500
    Creación: 2023-10-20 16:46:06.719996103 -0500
<?php
/* variables de configuracion */
/* require_once("config.php"); */
class Connection{

	public static function connect(){
		include "config.php" ;
		try{
			$conn = new PDO("mysql:host=$server;dbname=$database",$username,$password);
			return $conn;
		}catch(PDOException $e){
			die("Connection Failed: " . $e->getMessage());
		}
	}
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/f5/fbcc6ec8eff868d90ec3a3664548402436f1e5
  Tamaño: 736       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293867    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.249591858 -0500
Modificación: 2023-10-17 16:44:09.867769344 -0500
      Cambio: 2023-10-20 16:46:06.723329347 -0500
    Creación: 2023-10-20 16:46:06.723329347 -0500
<?php
class Controller{

	public $controller;

	/* el contructor trae el controllador al que se accede desde la url y lo aloja en la clase */
	public function __construct()
	{
		$this->controller = $_GET["controller"];
	}

	/* retona la vista de inicio y trae sus datos en lista */
	public function index(){
		$data=$this->model->getAll();
		require_once("views/$this->controller/index.php");
	}

	/* despliega el formulario de creacion */
	public function create(){
		require_once("views/$this->controller/create.php");
	}

	/* retorna la vista de mostrar un solo elemento con la informacion del elemnto */
	public function show(){
		$id = $_GET["id"]; 
		$data=$this->model->selectById($id);
		require_once("views/$this->controller/show.php");
	}

	/* crea un elemento y redirecciona al inicio */
	public function insert(){
		$this->modelParams();
		$id = $this->model->insert();
		if($this->autosave){
			$this->model->saveChanges();
			header("Location: /$this->controller");
		}
		return $id;
	}

	/* modifica un elemento y redirecciona al inicio */
	public function update(){
		$id = $_GET["id"];
		$this->modelParams();
		$this->model->update($id);
		if($this->autosave){
			$this->model->saveChanges();
			header("Location: /$this->controller");
		}
	}

	/* borra un elemento y redireccion al inicio */
	public function delete(){
		$id = $_GET["id"];
		$this->model->delete($id);
		header("Location: /$this->controller");
	}

	public function search(){
		$search = $_GET["id"];
		$data = $this->model->search($search);
		echo json_encode($data);
	}

	/* relaciona los parametros de entrado por POST con parametros de la clase */
	public function modelParams(){
		foreach(array_keys($_POST) as $key){
			$this->model->{$key} = $_POST[$key];
		}
	}

	/* index - lista todos los elementos */
	/* show - muestra un elemento por su id */
	/* create - crea un elemento */
	/* update - modifica un elemento */
	/* delete - borra un elemento */
}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/f7/4ed6ddae77f565f22c5304e67fa1a552396f47
  Tamaño: 437       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293878    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.306257743 -0500
Modificación: 2023-10-07 13:37:54.482797228 -0500
      Cambio: 2023-10-20 16:46:06.726662593 -0500
    Creación: 2023-10-20 16:46:06.726662593 -0500
100644 blob 46141854b6c4aac2047018836b3340f5f62dd0c2	.htaccess
100644 blob da437ed708de7ea2d1ed5bb37dc51d00740740f6	Dockerfile
040000 tree 8441109a06b6984f8ca8f81b5b38b979e7cda8d2	assets
040000 tree 0994b646c5cf6fe1259596f6e540c6055d0d4e1c	components
100644 blob 886fe19262e1dcc9bc5827b9b360744e6fe4cf58	config.php
040000 tree 83002027fc0d31216b0a79e85e19fd40efaa5e6d	controllers
100644 blob 8dadb53d86e692a9145d4db33bc19d31c3303116	data.sql
100644 blob 82c1b06cf8655c3159204f46dafb691aa3fe03c0	database.php
100644 blob 27dae4899dda3ef6df80d4bdc4ec9c52248ccb59	index.php
040000 tree bb7e7b902dbec4dd958723b80470a4bdb2215940	models
100644 blob d9a4ec66dfeb45d52c58647f352aaaae6b84cd28	router.php
100644 blob b82cea160f9cfcea3268f5371dbfc4fff71c4b97	seeder.sql
040000 tree 03af754393850698c31d45a634f08c29dd9b28bf	views
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/f7/86f5bcd89fc671e9d9267d1fe463d37b53020d
  Tamaño: 2499      	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293879    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.306257743 -0500
Modificación: 2023-10-15 17:00:48.692743281 -0500
      Cambio: 2023-10-20 16:46:06.726662593 -0500
    Creación: 2023-10-20 16:46:06.726662593 -0500
<?php  
include_once("components/header.php");
?>

<!-- FORMULARIO DE CREACION DE KRIS -->
<div class="container">
	<form action="/kri/update" method="POST" class="needs-validation">
			<?php  foreach($data["kris"] as $kri): ?>
			<!-- PRIMERA FILA -->
			<div class="row">
				<div class="col-xl-4 col-lg-6 mb-4">
					<div class="bg-white rounded-lg p-5 shadow">
						<h2 class="h6 font-weight-bold text-center mb-4">Valoración del Indicador</h2>
						<!-- Progress bar 1 -->
						<div class="progress" role="progressbar" aria-label="Example with label" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">
							<div class="progress-bar" style="width: 25%">Bajo</div>
						</div>
						<!-- END -->

						<!-- Demo info -->
						<div class="row text-center mt-4">
							<div class="col-6 border-right">
								<div class="h4 font-weight-bold mb-0"><?= $data['score'] ?> P.</div><span class="small text-gray">Puntaje calculado</span>
							</div>
							<div class="col-6">
								<div class="h4 font-weight-bold mb-0"><?= $data["score_qualified"]["value"] ?></div><span class="small text-gray"><?= $data["score_qualified"]["type"] ?></span>
							</div>
						</div>
						<!-- END -->
					</div>
				</div>
				<div class="col-xl-4 col-lg-4 mb-4">
					<div class="bg-white rounded-lg p-5 shadow">
						<h2 class="h6 font-weight-bold text-center mb-4">Mapa relacional</h2>
						<div class="row align-items-center my-2">
							<div class="col-6">
								<button class="btn btn-outline-dark btn-sm form-control">
									<?= $kri["kri"] ?>
								</button>
							</div>
							<div class="col-6">
								<?php  foreach($data["events"] as $event): ?>
								<button class="btn btn-outline-dark btn-sm form-control my-2" data-bs-toggle="popover" data-bs-title="Descripcion del evento" data-bs-content="">
									<?= $event["event"]?>
								</button>
								<?php  endforeach; ?>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="card-header">
				<h5><b><?=$kri['master_id']?> | </b><?=$kri['kri']?></h5>
			</div>
			<div class="card-body">
				<!-- KRI -->
				<div class="form-floating mb-3">
					<input type="text" value="<?= $kri['kri'] ?>" required class="form-control" name="kri" id="floatingInput" placeholder="Insegra un nombre">
					<label for="floatingInput">Nombre del KRI</label>
				</div>
				<!-- OBJECTIVO -->
				<div class="form-floating">
					<textarea class="form-control mb-3" name="objective" id="floatingTextarea2"><?= $kri["objective"] ?></textarea>
					<label for="floatingTextarea2">Objetivo</label>
				</div>
				<div class="row">
					<div class="col-6">
						<!-- PROPIEDAD -->
						<div class="form-floating mb-3">
							<select name="propertie_id" class="form-select" id="datalistOptions" aria-label="">
								<option value="<?= $kri['propertie_id'] ?>" selected><?= $kri['propertie']?></option>
							</select>
							<label for="floatingSelect">Propiedad</label>
						</div>
					</div>
					<div class="col-6">
						<!-- PORCENTAJE -->
						<div class="form-floating mb-3">
							<input name="percentage" type="number" value="<?= $kri['percentage'] ?>" class="form-control">
							<label for="floatingInput">Porcentaje</label>
						</div>
					</div>
				</div>
				<!-- SYNTAX-->
				<div class="form-floating mb-3">
					<input name="syntax" type="text" value="<?= $kri['syntax'] ?>" class="form-control disabled">
					<label for="floatingInput">Sintaxis / Operacion de kri</label>
				</div>
				<div class="accordion accordion-flush" id="accordionFlushExample">
					<!-- EVENTOS -->
					<div class="accordion-item">
						<h2 class="accordion-header">
							<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#event-collapse" aria-expanded="false" aria-controls="flush-collapseOne">
								Eventos	
							</button>
						</h2>
						<div id="event-collapse" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
							<div class="my-2">
								<button name="events" type="button" class="form-control btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#exampleModal">
									Añadir evento
								</button>
								<?php  foreach($data["events"] as $event): ?>
								<div class="form-check">
									<input type="checkbox" checked id="<?= $event['event'] ?>" value="<?= $event['id'] ?>" name="event[]" class="form-check-input">
									<label class="form-check-label" for="<?= $event['event'] ?>"><?= $event['id']." | ".$event['event'] ?></label>
								</div>
								<?php  endforeach; ?>
							</div>
						</div>
					</div>
					<!-- QUALIFIERS -->
					<div class="accordion-item">
						<h2 class="accordion-header">
							<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#qualifier-collapse" aria-expanded="false" aria-controls="flush-collapseOne">
										   Calificadores
							</button>
						</h2>
						<div id="qualifier-collapse" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
							<?php  foreach($data["qualifiers"] as $qualifier): ?>
							<div class="input-group mb-3">
								<div class="form-floating">
									<input type="text" value="<?= $qualifier['type'] ?>" class="form-control" name="qualifiers[]" id="floatingInputGroup1">
									<label for="floatingInputGroup1">Nombre Calificador</label>
								</div>
								<div class="form-floating">
									<input type="text" class="form-control" value="<?= $qualifier['value'] ?>" name="qualifiers_values[]" id="floatingInputGroup1">
									<label for="floatingInputGroup1">Valor</label>
								</div>
							</div>
							<?php  endforeach; ?>
							<button type="button" onclick="addQualifier()" class="form-control btn btn-outline-primary btn-sm">
								Agregar
							</button>
						</div>
					</div>
					<div class="accordion-item">
						<h2 class="accordion-header">
							<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#map-collapse" aria-expanded="false" aria-controls="flush-collapseOne">
								Mapa relacional
							</button>
						</h2>
						<div id="map-collapse" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
							<div class="row align-items-center my-2">
								<div class="col-6">
									<button class="btn btn-outline-dark btn-sm form-control">
										<?= $kri["kri"] ?>
									</button>
								</div>
								<div class="col-6">
									<?php  foreach($data["events"] as $event): ?>
									<button class="btn btn-outline-dark btn-sm form-control my-2" data-bs-toggle="popover" data-bs-title="Descripcion del evento" data-bs-content="">
										<?= $event["event"]?>
									</button>
									<?php  endforeach; ?>
								</div>
							</div>
						</div>
					</div>
				</div>
				<?php  endforeach; ?>
			</div>
			<div class="card-footer">
				<!-- END FIELD -->
				<div class="row">
					<div class="col-6">
						<button type="reset" class="btn btn-outline-secondary form-control">Limpiar</button>
					</div>
					<div class="col-6">
						<button type="submit" class="btn btn-primary form-control">Actualizar</button>
					</div>
				</div>
	</form>
			</div>

			<!-- FORMULARIO DE ADICION DE EVENTOS -->
			<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h1 class="modal-title fs-5" id="exampleModalLabel">Buscar Evento</h1>
							<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
						</div>
						<div class="modal-body">
							<div class="form-floating mb-3">
								<input type="text" required class="form-control" id="searchEvent" placeholder="Insegra un nombre">
								<label for="floatingInput">Buscar evento</label>
							</div>
							<div class="justify-content-center" id="datalistOptionsEvent">
							</div>
						</div>
					</div>
				</div>
			</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
<script src="/assets/js/search.js"></script>
<script>
	searchEvent({
		listOptions: "datalistOptions",
		search: "propertie",
		components: new Map([
			["value","id"]
		]),
		value: "propertie",
		table: "properties",
		tag: "option"
	})
</script>

---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/f9/6a4f7f7a0644a989321e07c6e80f192ef770cd
  Tamaño: 190       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293946    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.359590341 -0500
Modificación: 2023-05-19 15:57:49.902809676 -0500
      Cambio: 2023-10-20 16:46:06.783327766 -0500
    Creación: 2023-10-20 16:46:06.783327766 -0500
040000 tree e7163dc73857b94aef2fd3bef6b5c904a4c4abb1	event
040000 tree bf6e20922a18266f9ee123a24b5bd385187d5759	kri
040000 tree bf26cbec7b3a99878eea5fe64236fa8c6693da97	login
040000 tree 8494db4705a8620c9116e70e5f31fa4b042d135f	register
040000 tree 3f996d487c0a5063b1b018a35ccab9e527738db6	risk
040000 tree 51b4f483439170ce1f66b8dc07444e95bac424b7	user
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/fb/02603f5e1e778c1b626de544c3f0834532d3e1
  Tamaño: 159       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293538    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.099593925 -0500
Modificación: 2023-03-28 17:22:06.567978311 -0500
      Cambio: 2023-10-20 16:46:06.579999791 -0500
    Creación: 2023-10-20 16:46:06.579999791 -0500
<?php
require_once("models/UserModel.php");
class UserController extends Controller{

	public function __construct(){
		parent::__construct();
		$this->model = new UserModel();
	}

}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/fc/5c9dceab7ea6a3e92e9e475208d3d4a4402846
  Tamaño: 172       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293875    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.299591169 -0500
Modificación: 2023-03-28 17:22:06.567978311 -0500
      Cambio: 2023-10-20 16:46:06.726662593 -0500
    Creación: 2023-10-20 16:46:06.726662593 -0500
<?php
	/* base de datos anfitrion */
	$server = "mysql";
	$username = "root";
	$password = "1234";
	$database = "csra";

	/* base de datos remota */
	$server2 = "192.168.1.199";
	$username2 = "bot";
	$password2 = "@Globaltek@2022";
	$database2 = "alienvault";
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/fc/ee99b97e460cc55341d071a423b702cb3fee91
  Tamaño: 754       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293876    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.302924456 -0500
Modificación: 2023-10-17 15:55:29.893206763 -0500
      Cambio: 2023-10-20 16:46:06.726662593 -0500
    Creación: 2023-10-20 16:46:06.726662593 -0500
<?php 
require_once("models/QualifierModel.php");
require_once("models/EventModel.php");
class KriModel extends Model{
	protected $table = "kris";
	protected $columns = ["kri","objective","propertie_id","percentage","syntax"];
	protected $args= [":kri",":objective",":propertie_id",":percentage",":syntax"];
	protected $one_to_one= ["kris"=>"properties"];
	protected $one_to_much= ["kris"=>"qualifiers"];
	protected $much_to_much= ["kris"=>"events"];
	protected $table_relations = ["qualifiers"=>["type","value"],"events"];

	public function __construct(){
		parent::__construct();
		$this->event_model = new EventModel(); //AFECTA LA TABLA EVENTS
		$this->qualifier_model = new QualifierModel(); //AFECTA A LA TABLA QUALIFIERS
	}

	/* selecciona un kri de la base de datos calcula su puntaje */
	/* retorna un array de elementos con los datos del kri y su puntje */
	/* recibe un id de kri */
	public function getByIdScore($id){
		$this->selectById($id);
		/* CALCULAR PUNTAJE DE KRI */
		$syntax = $this->data["kris"][0]["syntax"];
		$this->getScore($id,$syntax);
		return $this->data;
	}

	/* calcula el puntaje ponderado y calificado de un kri */
	/* adjunta los resultados al array principal del modelo retorna el valor cualificado*/
	/* requiere como datos de entrada un id de kri y una syntax o ecuacion ejemplo 2+4 */
	public function getScore($id,$syntax){
		/* puntaje calculado por ecuacion */
		$this->data["score"] = $this->event_model->getScore($syntax);
		/* puntaje ponderado por calificadores */
		$this->data["score_qualified"]=$this->qualifier_model->getQualifierScore($id,$this->data["score"]);
		return $this->data["score_qualified"];
	}

}
?>
---------------------------------------------------------------------------------
  Fichero: /home/dragonyte/Backup/csra1/.git/objects/fd/00205ddb919bd4a04be65a1bb9b173163fcb47
  Tamaño: 399       	Bloques: 8          Bloque E/S: 4096   fichero regular
Device: 8,2	Inode: 27293463    Links: 1
Acceso: (0444/-r--r--r--)  Uid: ( 1000/dragonyte)   Gid: ( 1000/dragonyte)
      Acceso: 2023-10-21 11:46:59.056261189 -0500
Modificación: 2023-03-23 13:25:12.305636537 -0500
      Cambio: 2023-10-20 16:46:06.543334091 -0500
    Creación: 2023-10-20 16:46:06.543334091 -0500
100644 blob 6d6439aba4747c1cef248b31d8b285cea7edaec4	.htaccess
100644 blob da437ed708de7ea2d1ed5bb37dc51d00740740f6	Dockerfile
040000 tree 0d92498866d4f8052aa2042686156a488dbc030e	assets
040000 tree b055b0905a34aea1429e2e0a15223facdb174cd3	components
100644 blob 518e0b10de2304163e8239495cd07c0bfdeaf0db	config.php
040000 tree 0956b0e17c0dca01d2d22e6dcfff983d8e0308cd	controllers
100644 blob 8dadb53d86e692a9145d4db33bc19d31c3303116	data.sql
100644 blob f4c57c999b6b5ffebe3bfab3989f0c379c3ba691	database.php
100644 blob 819b8069ed804d4494505e0b6b43eb9db46c3990	database2.php
040000 tree 995e0e7b2db8556e80640a1994f1f8ab4a62fbc4	models
100644 blob f0eb5f89aa31e90b7e9053415fef8096016728bf	router.php
040000 tree 2f5d7e49cca0b3a746dded8d83c025c0948a170b	views
---------------------------------------------------------------------------------
---------------------------------------------------------------------------------
---------------------------------------------------------------------------------
